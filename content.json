{"posts":[{"title":"OOç¬¬äºŒå•å…ƒæ€»ç»“","text":"/* å¸¸ç”¨é¢œè‰²ç±» */ .text-cadetblue { color: CadetBlue !important; } .text-blue { color: #007bff !important; } .text-green { color: #28a745 !important; } .text-red { color: #DC143C !important; } .text-orange { color: #fd7e14 !important; } .text-purple { color: #6f42c1 !important; } .text-emphasis { color: #007bff; font-weight: bold; } .text-warning { color: #ffc107; font-weight: bold; } .text-success { color: #28a745; font-weight: bold; } .text-danger { color: #7835dc; font-weight: bold; } /* è­¦å‘Šæ¡†æ ·å¼ */ blockquote { position: relative; margin: 20px 0; padding: 16px 20px; border-left: 4px solid #007bff; background: #f8f9fa; border-radius: 0 6px 6px 0; font-style: normal; } blockquote[data-callout=\"important\"] { border-left-color: #7835dc; background: rgb(242, 241, 251); border-left-width: 6px; } blockquote[data-callout=\"important\"]::before { content: \"ğŸ’¬ é‡è¦\"; display: block; font-weight: bold; color: #7835dc; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } blockquote[data-callout=\"caution\"] { border-left-color: #ffc107; background: #fffbf0; border-left-width: 6px; } blockquote[data-callout=\"caution\"]::before { content: \"âš ï¸ æ³¨æ„\"; display: block; font-weight: bold; color: #b8860b; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } blockquote[data-callout=\"note\"] { border-left-color: #17a2b8; background: #f0f9ff; border-left-width: 6px; } blockquote[data-callout=\"note\"]::before { content: \"â„¹ï¸ æç¤º\"; display: block; font-weight: bold; color: #17a2b8; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } // å¤„ç†è­¦å‘Šæ¡† document.addEventListener('DOMContentLoaded', function() { const blockquotes = document.querySelectorAll('blockquote'); blockquotes.forEach(function(blockquote) { const firstParagraph = blockquote.querySelector('p:first-child'); if (firstParagraph) { const text = firstParagraph.textContent; const calloutMatch = text.match(/\\[!(IMPORTANT|CAUTION|NOTE)\\]/i); if (calloutMatch) { const calloutType = calloutMatch[1].toLowerCase(); blockquote.setAttribute('data-callout', calloutType); // ç§»é™¤æ ‡è®°æ–‡æœ¬ const cleanText = text.replace(/\\[![^\\]]+\\]\\s*/, ''); firstParagraph.textContent = cleanText; } } }); }); å¦‚æœè¦è®©æˆ‘å¯¹è¿™å……æ»¡åå·çš„â€œç”µæ¢¯æœˆâ€åšä¸€ä¸ªæ€»ç»“ï¼Œæˆ‘è®¤ä¸ºè´å…‹ç‰¹çš„è¿™ä¸€å¥åè¨€æ— ç–‘æ˜¯æœ€è´´åˆ‡çš„ï¼š [!IMPORTANT] Ever tried,Ever failed,No matter.Try again,Fail again,Fail better. â€“å¡ç¼ªå°”Â·è´å…‹ç‰¹ äº‹å®ä¸Šï¼Œå¦‚æœä½ ç¢°å·§æ˜¯ä¸€åæ–‡å­¦çˆ±å¥½è€…ï¼Œé‚£ä¹ˆä½ å¯èƒ½å¾ˆéš¾ç›¸ä¿¡ä»¥è’è¯æ–‡å­¦é—»åçš„è´å…‹ç‰¹ä¼šè¯´å‡ºè¿™æ ·åŠ±å¿—çš„åè¨€ã€‚æ­£å¦‚åœ¨çœŸæ­£å®Œæˆè¿™ä¸€å•å…ƒä¹‹å‰ï¼Œæˆ‘ä¹Ÿä¸ä¼šæƒ³åˆ°è‡ªå·±ä¼šåœ¨é¢å¯¹å¤šçº¿ç¨‹å±‚å‡ºä¸ç©·çš„Bugæ—¶ï¼Œä¾ç„¶åšæŒâ€Fail again, fail betterâ€ã€‚ å‰è¨€ç¬¬äºŒå•å…ƒæˆ‘ä»¬è¦å®ç°çš„æ˜¯åŸºäºå…±äº«æ•°æ®çš„ï¼Œå¤šçº¿ç¨‹ç”µæ¢¯è°ƒåº¦é—®é¢˜ï¼Œåœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œè¦è¿­ä»£å‡ºç”µæ¢¯é‡ç½®ï¼ŒåŒè½¿ç”µæ¢¯ç­‰åŠŸèƒ½ã€‚ç›¸æ¯”ç¬¬ä¸€å•å…ƒï¼Œåœ¨ç¬¬äºŒå•å…ƒçš„è®¾è®¡å·¥ä½œä¸­ï¼Œæˆ‘æ·±åˆ»æ„Ÿå—åˆ°äº†è®¾è®¡æ¶æ„çš„é‡è¦æ€§ï¼Œä»¥åŠå¤šçº¿ç¨‹å¹¶è¡Œè®¡ç®—çš„ä¼˜åŠ¿ã€‚ æ•´ä½“æ¶æ„å›¾UMLå›¾ç”±äºæ˜¯è¿­ä»£å¼€å‘ï¼Œåœ¨è¿™å¼ UMLå›¾ä¸Šæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸€è·¯çš„è¿‡ç¨‹ã€‚ ç™½è‰²çš„éƒ¨åˆ†ä»£è¡¨ç¬¬ä¸€æ¬¡ä½œä¸šã€‚ ç»¿è‰²çš„éƒ¨åˆ†ä»£è¡¨ç¬¬äºŒæ¬¡ä½œä¸šçš„å¢æ·»ã€‚ ç´«è‰²çš„éƒ¨åˆ†ä»£è¡¨ç¬¬ä¸‰æ¬¡ä½œä¸šçš„å¢æ·»ã€‚ æ—¶åºå›¾ è®¾è®¡æ¶æ„å¼€å‘å†ç¨‹ [!CAUTION] ç¬¬äºŒå•å…ƒçš„æ¶æ„å¼€å‘ï¼Œæˆ‘æƒ³å¤šä»‹ç»ä¸€äº›ï¼Œ å¯¹æ¯”ç¬¬ä¸€å•å…ƒä½œä¸šï¼Œæ€§èƒ½ä¸åœ¨æ˜¯å®å®åœ¨åœ¨çš„éœ€æ±‚ï¼Œè€Œæ˜¯ç›¸å¯¹è™šæ— ç¼¥ç¼ˆçš„ä¸œè¥¿ã€‚åœ¨ä¿è¯æ­£ç¡®æ€§çš„å‰æä¸‹ï¼Œä¸è¿›è¡Œä»»ä½•æ€§èƒ½ä¼˜åŒ–ï¼Œä¹Ÿèƒ½æœ‰ä¸é”™çš„æ€§èƒ½åˆ†ï¼Œå› æ­¤æ¶æ„å æ®äº†ç»å¯¹çš„ä¸»å¯¼ä½œç”¨ã€‚ å…³äºæ–¹æ³•çš„å¤æ‚åº¦å°±æ”¾åœ¨æœ€åä¸€èµ·åˆ†æäº†ã€‚ ä½œä¸šè¦æ±‚ï¼šç¬¬äºŒå•å…ƒçš„ä»»åŠ¡ä¸ºæ¨¡æ‹Ÿç¾¤æ§ç”µæ¢¯è°ƒåº¦ï¼Œé‡ç‚¹åœ¨äºå¤šçº¿ç¨‹å¹¶å‘çš„è®¾è®¡ã€‚ä»¥ä¸‹æ˜¯ä»»åŠ¡çš„è¿­ä»£ï¼šÂ· hw5æ¨¡æ‹Ÿäº†6éƒ¨ç”µæ¢¯çš„è°ƒåº¦ï¼Œä¹˜å®¢çš„è¯·æ±‚ä¼šæŒ‡å®šç‰¹å®šç”µæ¢¯Â· hw6çš„ä¹˜å®¢å¯ä»¥è‡ªç”±åˆ†é…ç»™ä»»æ„ä¸€éƒ¨ç”µæ¢¯ï¼Œç”µæ¢¯éœ€è¦è¾“å‡ºå·²æ¥æ”¶ä¿¡å·ã€‚åŒæ—¶å¢åŠ äº†ç”µæ¢¯å‚æ•°çš„é‡ç½®ï¼Œé‡ç½®æ—¶ä¼šæš‚åœå¹¶å¤„äºé™é»˜çŠ¶æ€Â· hw7å¢åŠ äº†åˆ†è£‚ä¸ºåŒè½¿å¢çš„é‡ç½®æ¨¡å¼ï¼Œéœ€è¦åœ¨æ¢ä¹˜å±‚è¿›è¡Œåè°ƒ hw5åŒæ­¥å—å’Œé”ç¬¬ä¸€æ¬¡ä½œä¸šï¼ŒåŒæ—¶ä¹Ÿæ˜¯é¦–æ¬¡è¿›è¡Œå¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œå®Œæˆä½œä¸šçš„å¤§éƒ¨åˆ†æ—¶é—´éƒ½æ”¾åœ¨äº†ç†è§£ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹ï¼Œä»¥åŠä»€ä¹ˆæ˜¯åŒæ­¥å—ä¸Šã€‚ é‚£ä¹ˆä»€ä¹ˆæ˜¯åŒæ­¥å—å‘¢ï¼Ÿç®€å•æ¥è¯´å°±æ˜¯ï¼Œéšä¾¿æ‰¾ç‚¹ä»€ä¹ˆï¼Œå¤šä¸ªç±»å…±ç”¨ï¼ˆæŒ‡çš„æ˜¯å¤šä¸ªçº¿ç¨‹åœ¨åŒä¸€æ—¶åˆ»å…±åŒè®¿é—®ï¼‰ï¼Œå¥—ä¸Š synchronizedå…³é”®å­—ã€‚åŒæ­¥å—çš„æ•ˆæœæ˜¯ä»€ä¹ˆï¼Ÿå¥—ä¸Š synchronizedå…³é”®å­—ä¹‹åï¼Œåœ¨æ¯ä¸€ä¸ªæ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®ã€‚ä»€ä¹ˆæ˜¯é”ï¼Ÿé”æ˜¯å½“å¤šä¸ªçº¿ç¨‹ç«äº‰åŒä¸€ä¸ªå…±äº«æ•°æ®çš„æ—¶å€™ï¼Œä¸è®©å…¶ä»–çº¿ç¨‹è®¿é—®çš„é‡è¦æ­¦å™¨ã€‚åœ¨ synchronizedä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡é‡å…¥é”ï¼Œè¯»å†™é”ç­‰æ–¹å¼å®ç°çµæ´»çš„ä¸Šé”ã€‚ ç”±äºç¬¬ä¸€æ¬¡ä½œä¸šè¦æ±‚å®åœ¨å¤ªè¿‡ç®€å•ï¼Œå…­å°ç”µæ¢¯åˆ†åˆ«æœ‰è‡ªå·±å¯¹åº”çš„ä¹˜å®¢ï¼Œå› æ­¤åªéœ€å°†æ€»è¯·æ±‚æ± ä¸Šé”å³å¯ï¼ŒåŒæ—¶åœ¨ç”µæ¢¯éœ€è¦è¿›è¡Œ sleep()æ—¶ç»™ç”µæ¢¯ä¸Šé”ï¼Œç¡®ä¿å…¶çŠ¶æ€ä¸å—æ”¹å˜å°±å¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå…·ä½“ç»†èŠ‚ä¸Šé‡‡ç”¨ ReentrantLockå³å¯å®ç°ï¼Œæ— éœ€å¤šè¨€ã€‚ è°ƒåº¦å™¨å’Œè°ƒåº¦ç­–ç•¥ç”±äºç¬¬ä¸€æ¬¡ä¸æ¶‰åŠâ€œç”µæ¢¯æŠ¢äººâ€çš„é—®é¢˜ï¼Œæ‰€ä»¥æ— éœ€è®¾è®¡è°ƒåº¦å™¨ä»¥åŠè°ƒåº¦ç­–ç•¥ã€‚ ç”µæ¢¯è¿è¡Œç®—æ³•é‡‡ç”¨çš„æ˜¯ LOOKè¿è¡Œç®—æ³•ï¼Œä¹Ÿæ˜¯æ—¥å¸¸ç”Ÿæ´»ä¸­çš„ç”µæ¢¯ç®—æ³•ï¼Œå³é¡ºå¸¦æ¥äººè¿è¡Œç­–ç•¥ï¼Œç•¥å¾®ä¸åŒçš„åœ°æ–¹æ˜¯ï¼Œç°å®ä¸­ï¼Œåœ¨ä¹˜å®¢è¿›å…¥ç”µæ¢¯å‰ï¼Œæˆ‘ä»¬æ˜¯ä¸çŸ¥é“ä¹˜å®¢çš„ç›®çš„åœ°çš„ã€‚ä½†åœ¨æœ¬å•å…ƒçš„ä½œä¸šä¸­ï¼Œäººä¸æ˜¯çº¿ç¨‹è€Œæ˜¯ä¸€ä¸ª Objectï¼Œä¸ä»…æ–¹ä¾¿äº†è°ƒåº¦å™¨çš„åˆ†é…ï¼Œè€Œä¸”é™ä½äº†å¤æ‚åº¦ã€‚ hw6åŒæ­¥å—å’Œé”ä¸ç¬¬ä¸€æ¬¡ä½œä¸šç±»ä¼¼ï¼Œå®é™…ä¸Šï¼Œç”±äºæˆ‘ä»¬çš„åˆ†é…æ“ä½œæ˜¯å°†ä¸€ä¸ªä¸ªè¯·æ±‚æ·»åŠ åˆ°æ¯ä¸ªç”µæ¢¯å„è‡ªçš„è¯·æ±‚çš„è¯·æ±‚é˜Ÿåˆ—ä¸­ï¼Œè¿˜æ˜¯è¦å°†è¯·æ±‚æ± ï¼Œç”µæ¢¯å„è‡ªçš„è¯·æ±‚é˜Ÿåˆ—ä»¥åŠç”µæ¢¯è‡ªèº«è®¾ä¸ºå…±äº«å¯¹è±¡ï¼Œå¹¶å›´ç»•ä»–ä»¬æ„å»ºåŒæ­¥å—ï¼Œè¿›è¡Œä¸Šé”ã€‚ è°ƒåº¦å™¨å’Œè°ƒåº¦ç­–ç•¥è°ƒåº¦å™¨é‡‡ç”¨**å½±å­ç”µæ¢¯**ç­–ç•¥ï¼Œå³ç®—å‡ºå±€éƒ¨æœ€ä¼˜è§£åˆ†é…ç»™6ä¸ªçº¿ç¨‹ã€‚å…·ä½“åšæ³•æ˜¯å¯¹ç”µæ¢¯å’Œè¯¥ç”µæ¢¯çš„å¤„ç†é˜Ÿåˆ—è¿›è¡Œæ·±å…‹éš†ï¼Œè°ƒç”¨å…‹éš†åçš„ shadowElevator.move()å®ç°æ¨¡æ‹Ÿæ¨è¿›æ—¶é—´ï¼Œéå†6ä¸ªç”µæ¢¯ï¼Œæ‰¾å‡ºèƒ½å¤Ÿä½¿å¾—æ–°è¯·æ±‚åŠ å…¥åæ•´ä½“è¿è¡Œæ—¶é—´ç»“æŸæœ€æ—©çš„é‚£ä¸€ç§åŠ å…¥è¯·æ±‚ç®—æ³•ã€‚ ä¸ºæ–¹ä¾¿è¯´æ˜ï¼Œä¸¾ä¾‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šç»¿è‰²æ–¹å—ä¸ºç”µæ¢¯åŸæœ‰è¯·æ±‚å®Œæˆéœ€è¦èŠ±è´¹æ—¶é—´ï¼Œæ¯ä¸€åˆ—ä¸ºä¸€ç§åˆ†é…ç­–ç•¥å¯¹åº”å„ä¸ªç”µæ¢¯ç”¨æ—¶ï¼ˆå…±å…­ç§ï¼Œå³æŠŠæ–°è¯·æ±‚åˆ†é…ç»™å…­ä¸ªç”µæ¢¯ï¼Œåˆ†åˆ«éå†ï¼‰ï¼Œæ‰¾å‡ºè¯¥ç­–ç•¥ä¸‹ç”¨æ—¶æœ€ä¹…çš„ç”µæ¢¯ä¸ºè¯¥ç­–ç•¥å¯¹åº”çš„å…¨å±€ä»»åŠ¡å®Œæˆæ—¶é—´ï¼Œå†å°†å…­ä¸ªç­–ç•¥çš„æ—¶é—´æ‰¾å‡ºæœ€çŸ­çš„ï¼Œå°±è·å¾—äº†å±€éƒ¨æœ€ä¼˜è§£ã€‚ä¸‹å›¾çš„æƒ…å†µå³ä¸ºå°†æ–°è¯·æ±‚åŠ å…¥3å·ç”µæ¢¯æ˜¯å±€éƒ¨æœ€ä¼˜è§£ã€‚ æ³¨ï¼šç¤ºä¾‹å›¾ç‰‡æ¥è‡ªæ­¦å½¬ç…¦å­¦é•¿çš„åšå®¢ è¿™æ ·ï¼Œè°ƒåº¦å™¨æˆä¸ºäº†çº¿ç¨‹ï¼Œè°ƒåº¦å™¨å’Œè¾“å…¥çº¿ç¨‹ä¹‹é—´ï¼Œè°ƒåº¦å™¨å’Œå„ä¸ªç”µæ¢¯ä¹‹é—´ï¼Œé€šè¿‡ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—è¿æ¥ã€‚ è¿™æ ·çš„ç­–ç•¥å¯ä»¥åšåˆ°å±€éƒ¨æ—¶é—´æœ€ä¼˜ï¼Œç”±äºæœ¬äººçš„æ‡’æƒ°ï¼Œå¹¶æœªåœ¨å½±å­ç”µæ¢¯çš„æŒ‡æ ‡ä¸­åŠ å…¥è€—ç”µé‡çš„è€ƒé‡ã€‚ hw7åŒæ­¥å—å’Œé”ä¸ç¬¬äºŒæ¬¡ä½œä¸šç±»ä¼¼ï¼Œå®é™…ä¸Šï¼Œç”±äºæˆ‘ä»¬çš„åˆ†é…æ“ä½œæ˜¯å°†ä¸€ä¸ªä¸ªè¯·æ±‚æ·»åŠ åˆ°æ¯ä¸ªç”µæ¢¯å„è‡ªçš„è¯·æ±‚çš„è¯·æ±‚é˜Ÿåˆ—ä¸­ï¼Œè¿˜æ˜¯è¦å°†è¯·æ±‚æ± ï¼Œç”µæ¢¯å„è‡ªçš„è¯·æ±‚é˜Ÿåˆ—ä»¥åŠç”µæ¢¯è‡ªèº«è®¾ä¸ºå…±äº«å¯¹è±¡ï¼Œå¹¶å›´ç»•ä»–ä»¬æ„å»ºåŒæ­¥å—ï¼Œè¿›è¡Œä¸Šé”ã€‚äº‹å®ä¸Šï¼Œè¿™åªæ˜¯æˆ‘ç²—æµ…çš„ç†è§£ï¼Œè®©æˆ‘åœ¨äº’æµ‹ä¸­èº«ä¸­15åˆ€ [!CAUTION] äº‹å®ä¸Šï¼Œç”±äºæˆ‘çš„è®¾è®¡ä¸­ï¼ŒDC Resetè¦å¾€è°ƒåº¦å™¨ç±»ä¸­çš„ç”µæ¢¯é˜Ÿåˆ—é‡Œæ·»åŠ ç”µæ¢¯ï¼Œè€Œåœ¨åˆ¤æ–­è°ƒåº¦å™¨çº¿ç¨‹æ˜¯å¦ç»“æŸæ—¶è¦éå†ç”µæ¢¯é˜Ÿåˆ—ï¼Œè€Œæˆ‘æœªå¯¹ç”µæ¢¯é˜Ÿåˆ—ä¸Šé”ï¼Œè¿™æ ·ä¼šæŠ¥é”™ ConcurrentModificationExceptionğŸ˜­ è°ƒåº¦å™¨å’Œè°ƒåº¦ç­–ç•¥è°ƒåº¦å™¨ä¾æ—§é‡‡ç”¨**å½±å­ç”µæ¢¯**ç­–ç•¥ï¼Œç”±äºè¿™æ¬¡å­˜åœ¨åŒè½¿å¢ç”µæ¢¯ï¼Œè€Œå½±å­ç”µæ¢¯æ— æ³•æ¨¡æ‹Ÿæ¢ä¹˜ï¼Œå› æ­¤åœ¨è®¡ç®—ç”µæ¢¯ç»“æŸæ—¶é—´æ—¶ï¼Œå¯¹äºåŒè½¿å¢ç”µæ¢¯ä¸­æ— æ³•ç›´è¾¾çš„è¯·æ±‚ï¼Œé‡‡å–æƒ©ç½šè¡¥æ—¶ï¼Œæ¥è¿›è¡Œç²—ç•¥æ¨¡æ‹Ÿï¼Œæ•ˆæœè¿˜å¯ä»¥ã€‚ åŒè½¿å¢ç”µæ¢¯å®‰å…¨æ§åˆ¶åœ¨è®¾è®¡è¿™æ¬¡ä½œä¸šæ—¶OSæ­£å¥½åœ¨å­¦ä¿¡å·é‡ï¼Œäº‹å®ä¸Šï¼Œæ¢ä¹˜æ¥¼å±‚åªå…è®¸ä¸€ä¸ªè½¿å¢åœé ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç§ä¿¡å·é‡æ“ä½œï¼Œè€Œæœ€å¤§å€¼ä¸ºä¸€çš„ä¿¡å·é‡å®é™…ä¸Šå°±æ˜¯ä¸€æŠŠé”ï¼Œä¸¤è½¿å¢è¦è¿›å…¥æ¢ä¹˜æ¥¼å±‚æ—¶å°è¯•è·å¾—é”ï¼Œç¦»å¼€æ¢ä¹˜æ¥¼å±‚æ—¶é‡Šæ”¾é”å³å¯ã€‚ å…·ä½“ä»£ç ä¸Šé€šè¿‡è®¾ç½® Policeç±»æ¥ç›‘ç®¡åŒè½¿å¢ï¼š 123456789101112131415161718192021222324252627public class Police { private boolean occupied = false; public synchronized void getAccess(Character type) { tryAccess(type); occupied = true; notifyAll(); } private synchronized void tryAccess(Character type) { notifyAll(); while (occupied) { try { wait(); } catch (InterruptedException e) { throw new RuntimeException(e); } } } public synchronized void release() { occupied = false; notifyAll(); }} ç¨³å®šå’Œæ˜“å˜ç¨³å®šï¼šç¨³å®šçš„å†…å®¹ä¸»è¦è¿˜æ˜¯ç”µæ¢¯çš„æå¸¦ä¸€ç›´é‡‡å– LOOKç®—æ³•ï¼Œä¿è¯äº†ç»å¤§å¤šæ•°æƒ…å†µä¸‹ç”µæ¢¯å¹³å‡æ€§èƒ½çš„ä¼˜è¶Šæ€§ã€‚åŒæ—¶åœ¨äºŒä¸‰æ¬¡ä½œä¸šä¸­éƒ½é‡‡å–äº†å½±å­ç”µæ¢¯æ¨¡æ‹Ÿçš„è°ƒåº¦ç­–ç•¥ï¼Œæ”¹å˜ä¸å¤§ã€‚ æ˜“å˜ï¼šä¹˜å®¢éœ€æ±‚ï¼Œç”µæ¢¯çš„ç±»å‹æ¯æ¬¡ä½œä¸šéƒ½åœ¨æ”¹å˜ï¼Œè€Œè¿™äº›éƒ½æ˜¯é€šè¿‡ ResetæŒ‡ä»¤å®ç°çš„ï¼Œå¦‚ä½•å¦¥å–„å®ç°è¿™äº›æŒ‡ä»¤ä¹Ÿæ­£æ˜¯æœ¬å•å…ƒçš„è®¾è®¡é‡ç‚¹ã€‚ ç»“æŸçš„æ¡ä»¶ä¹Ÿéšä¹‹å˜åŒ–ï¼Œä»æ¯ä¸ªç”µæ¢¯è‡ªå·±ç»“æŸï¼Œåˆ°è°ƒåº¦å™¨ç»Ÿä¸€åˆ†é…ç»“æŸã€‚ BUGåˆ†æhw5ç¬¬äº”æ¬¡ä½œä¸šè¾ƒä¸ºç®€å•ï¼Œåœ¨æœ¬åœ°ç¼–å†™ä»£ç ä»¥åŠçº¿ä¸Šæµ‹è¯•æ—¶éƒ½æœªå‘ç°Bug hw6ç¬¬å…­æ¬¡ä½œä¸šåœ¨ç¼–å†™æ—¶é‡åˆ°çš„æœ€ä¸»è¦çš„Bugåœ¨äºçº¿ç¨‹æ— æ³•å®‰å…¨ç»“æŸï¼ŒåŸå› åœ¨äºä¸ç¬¬äº”æ¬¡ä½œä¸šä¸åŒï¼Œåœ¨ç¬¬å…­æ¬¡ä½œä¸šä¸­è°ƒåº¦å™¨æ˜¯ä½œä¸ºä¸€ä¸ªçº¿ç¨‹å­˜åœ¨çš„ï¼Œå› æ­¤è¦ç¡®å®šå®ƒå’Œç”µæ¢¯çº¿ç¨‹ç»“æŸçš„é¡ºåºå°±æˆä¸ºäº†Bugäº§ç”Ÿçš„é‡ç¾åŒºï¼Œæœ€ç»ˆä¹Ÿæ˜¯é€šè¿‡ä¸æ–­é€šè¿‡è¯„æµ‹æœºæµ‹è¯•å¾—åˆ°é”™è¯¯æ•°æ®å†é€šè¿‡ Printå¤§æ³•æ¥æŸ¥çœ‹çº¿ç¨‹å…·ä½“ç»“æŸæƒ…å†µæœ€ç»ˆè§£å†³Bugã€‚ åœ¨äº’æµ‹ä¸­äº§ç”Ÿäº†ä¸€ä¸ªBugï¼ŒåŸå› æ˜¯åœ¨äº”å°ç”µæ¢¯ Resetæ—¶ä¼šå°†æ‰€æœ‰è¯·æ±‚åˆ†ç»™ä¸€å°å¯ä»¥ä½¿ç”¨çš„ç”µæ¢¯ï¼Œæœ€ç»ˆå¯¼è‡´ RTLEã€‚åªè¦åœ¨åªæœ‰ä¸€å°ç”µæ¢¯ä¸åœ¨ Resetæ—¶è®©è°ƒåº¦å™¨ç­‰ä¸€ç­‰å°±è¡Œäº†ï¼Œä¹Ÿä¸ä¼šè½®è¯¢ã€‚ hw7ç¬¬ä¸ƒæ¬¡ä½œä¸šçš„Bugå ªç§°æœ€æç¬‘çš„ä¸€é›†ã€‚ å¼ºæµ‹ä¸­æ²¡å‡ºç°Bugï¼Œä½†åœ¨äº’æµ‹ä¸­ï¼Œç”±äºæˆ‘çš„è®¾è®¡åœ¨DC Reseæ—¶è¦å¾€è°ƒåº¦å™¨ç±»ä¸­çš„ç”µæ¢¯é˜Ÿåˆ—é‡Œæ·»åŠ ç”µæ¢¯ï¼Œè€Œåœ¨åˆ¤æ–­è°ƒåº¦å™¨çº¿ç¨‹æ˜¯å¦ç»“æŸæ—¶è¦éå†ç”µæ¢¯é˜Ÿåˆ—ï¼Œè€Œæˆ‘æœªå¯¹ç”µæ¢¯é˜Ÿåˆ—ä¸Šé”ï¼Œè¿™æ ·ä¼šæŠ¥é”™ ConcurrentModificationExceptionï¼Œæˆ–è€…é€ æˆæ— æ³•æ­£å¸¸ Resetï¼Œå¯¼è‡´CTLEï¼Œæœ€ç»ˆèº«ä¸­15åˆ€ã€‚ è§£å†³åŠæ³•æ˜¯åš ArrayList&lt;Elevator&gt; elevators $\\to$ CopyOnWriteArrayList&lt;Elevator&gt; elevatorsçš„ä¿®æ”¹å³å¯ã€‚ æ€»ç»“æ¯«æ— ç–‘é—®ï¼Œå¯¹äºå¤šçº¿ç¨‹ç¼–ç¨‹è€Œè¨€ï¼ŒDebugç»å¯¹æ˜¯æœ€ç—›è‹¦ï¼Œæœ€è€—æ—¶çš„éƒ¨åˆ†ã€‚æ€»ç»“æ¥çœ‹ï¼Œä¸€ä¸ªå¥½çš„æ¶æ„å¾€å¾€èƒ½ä¿è¯è¾ƒé«˜çš„Bugå¤ç°ç‡ã€‚ è€Œå¯¹äºå¤šçº¿ç¨‹Bugï¼Œé™¤äº† Printå¤§æ³•æˆ‘æ·±æ„Ÿæ— åŠ›ï¼Œè¿™ä¹Ÿå¯¼è‡´åœ¨å¼ºæµ‹ç»“æœå‡ºæ¥å‰æˆ‘ä¸€ç›´ä¿æŒç€â€œå…ˆè´¨ç–‘ï¼Œå†è´¨ç–‘â€çš„æ€åº¦ï¼Œå¥½åœ¨æœ€åå¼ºæµ‹éƒ½æ²¡å‡ºäº‹ï¼Œä¹Ÿç®—æ˜¯ä¸‡å¹¸ã€‚ [!IMPORTANT] è¿˜æ˜¯é‚£å¥è€è¯ï¼Œå¯¹äºå¤šçº¿ç¨‹æµ‹è¯•ï¼Œè¯„æµ‹æœºä¸Šåä¸‡ç»„æ­£ç¡®æ•°æ®éƒ½ä¸å¦‚ä¸€ä¸ªèƒ½ç¨³å®šå¤ç°çš„Bugæ¥çš„é‡‘è´µå’Œå®‰å¿ƒã€‚ å¿ƒå¾—ä½“ä¼šçº¿ç¨‹å®‰å…¨ä»å•çº¿ç¨‹åˆ°å¤šçº¿ç¨‹ï¼Œæ€§èƒ½ä¸Šçš„å·¨å¤§é£è·ƒï¼Œå¿…ç„¶å¸¦æ¥çš„æ˜¯è®¾è®¡ä¸Šçš„å¤æ‚æ€§ï¼Œæ•°æ®å®‰å…¨ä¾¿æ˜¯è¿™æ–¹é¢çš„æ ¸å¿ƒï¼Œä½†æ˜¯æ›´é‡è¦çš„æ˜¯ä¿è¯çº¿ç¨‹å®‰å…¨çš„åŒæ—¶ï¼Œæé«˜è§£å†³æ•ˆç‡ï¼Œä¸èƒ½é•¿æ—¶é—´å æœ‰é”ï¼Œæ›´ä¸èƒ½åœ¨ sleepçš„æ—¶å€™å æœ‰é”ï¼Œè¦ä¿è¯åŸå­æ€§ï¼Œä½†ä¸€å®šè¦å¯¹åŒä¸€æ—¶é—´çš„å¤šæ¡åˆ¤æ–­è¯­å¥è¿›è¡ŒåŸå­é”ã€‚ ä¿è¯çº¿ç¨‹å®‰å…¨ä¸‹çš„æé«˜æ•ˆç‡ï¼ŒçœŸæ­£çš„æ‹‰å¼€äº†ä¸å•çº¿ç¨‹ä¹‹é—´çš„å·®è·ï¼Œåªæ³¨é‡æ•°æ®çš„å®‰å…¨çš„ç»“æœå¾€å¾€æ˜¯æ­»é”ï¼Œå’Œè½®è¯¢ï¼Œè¿™æ˜¯è¦æåŠ›é¿å…çš„ã€‚ å±‚æ¬¡åŒ–è®¾è®¡å¥½çš„è®¾è®¡å¸¦æ¥çš„ä¼˜åŠ¿åœ¨è¿™ä¸€å•å…ƒä½“ç°çš„æ·‹æ¼“å°½è‡´ã€‚æ­£å¦‚å‰æ–‡æ‰€è¨€ï¼Œå¥½çš„è®¾è®¡èƒ½å¤Ÿæå¤§å‡å°‘æ€§èƒ½ä¼˜åŒ–ä¸Šçš„å·¥ä½œï¼Œä»¥åŠæé«˜æœ¬åœ°æµ‹è¯•æ—¶çš„Bugå¤ç°ç‡ï¼Œèƒ½å¤Ÿå‡å°‘ä»£ç ç¼–å†™æ—¶çš„æ—¶é—´è€—è´¹ã€‚ â€œä¸¤å¤©è®¾è®¡ï¼Œä¸€æ—¥ç¼–ç â€ã€‚è¿™å•å…ƒæœ€å¥½çš„å·¥ä½œæµç¨‹å°±æ˜¯è¿™æ ·ï¼Œå¤šçº¿ç¨‹ç¼–ç¨‹è®¾è®¡ç»†èŠ‚é¢‡å¤šï¼Œå¦‚æœæ— æ³•åœ¨è®¾è®¡ä¸Šæå‰è§„åˆ’è¿™äº›ç»†èŠ‚ï¼Œé‚£ä¹ˆåªä¼šå¾’å¢Bugï¼Œç™½ç™½æµªè´¹æ—¶é—´ç½¢äº†ã€‚","link":"/2025/08/13/OO-2/"},{"title":"OOç¬¬å››å•å…ƒæ€»ç»“æš¨è¯¾ç¨‹æ€»ç»“","text":"/* å¸¸ç”¨é¢œè‰²ç±» */ .text-cadetblue { color: CadetBlue !important; } .text-blue { color: #007bff !important; } .text-green { color: #28a745 !important; } .text-red { color: #DC143C !important; } .text-orange { color: #fd7e14 !important; } .text-purple { color: #6f42c1 !important; } .text-emphasis { color: #007bff; font-weight: bold; } .text-warning { color: #ffc107; font-weight: bold; } .text-success { color: #28a745; font-weight: bold; } .text-danger { color: #7835dc; font-weight: bold; } /* è­¦å‘Šæ¡†æ ·å¼ */ blockquote { position: relative; margin: 20px 0; padding: 16px 20px; border-left: 4px solid #007bff; background: #f8f9fa; border-radius: 0 6px 6px 0; font-style: normal; } blockquote[data-callout=\"important\"] { border-left-color: #7835dc; background: rgb(242, 241, 251); border-left-width: 6px; } blockquote[data-callout=\"important\"]::before { content: \"ğŸ’¬ é‡è¦\"; display: block; font-weight: bold; color: #7835dc; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } blockquote[data-callout=\"caution\"] { border-left-color: #ffc107; background: #fffbf0; border-left-width: 6px; } blockquote[data-callout=\"caution\"]::before { content: \"âš ï¸ æ³¨æ„\"; display: block; font-weight: bold; color: #b8860b; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } blockquote[data-callout=\"note\"] { border-left-color: #17a2b8; background: #f0f9ff; border-left-width: 6px; } blockquote[data-callout=\"note\"]::before { content: \"â„¹ï¸ æç¤º\"; display: block; font-weight: bold; color: #17a2b8; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } // å¤„ç†è­¦å‘Šæ¡† document.addEventListener('DOMContentLoaded', function() { const blockquotes = document.querySelectorAll('blockquote'); blockquotes.forEach(function(blockquote) { const firstParagraph = blockquote.querySelector('p:first-child'); if (firstParagraph) { const text = firstParagraph.textContent; const calloutMatch = text.match(/\\[!(IMPORTANT|CAUTION|NOTE)\\]/i); if (calloutMatch) { const calloutType = calloutMatch[1].toLowerCase(); blockquote.setAttribute('data-callout', calloutType); // ç§»é™¤æ ‡è®°æ–‡æœ¬ const cleanText = text.replace(/\\[![^\\]]+\\]\\s*/, ''); firstParagraph.textContent = cleanText; } } }); }); å†™åœ¨å‰é¢è¿™æ˜¯RooKie_Zå¯¹äºOO Unit4å’Œè¯¾ç¨‹æ€»ä½“çš„æ€»ç»“åšå®¢ æ­£å‘å»ºæ¨¡ä¸å¼€å‘å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ æ­£å‘å»ºæ¨¡ä¸å¼€å‘ çš„å®šä¹‰ æ­£å‘å»ºæ¨¡ä¸å¼€å‘æ˜¯ä¸€ç§æ ¹æ®ç»™å®šçš„éœ€æ±‚åˆ›å»ºæˆ–åˆ¶ä½œåº”ç”¨ç¨‹åºçš„æ–¹æ³•ã€‚æ­£å‘å»ºæ¨¡ä¸å¼€å‘ä¹Ÿè¢«ç§°ä¸ºç¿»æ–°å’Œå›æ”¶ã€‚æ­£å‘å»ºæ¨¡ä¸å¼€å‘éœ€è¦é«˜æ°´å¹³çš„æŠ€èƒ½ï¼Œå®ƒéœ€è¦æ›´å¤šçš„æ—¶é—´æ¥æ„å»ºæˆ–å¼€å‘åº”ç”¨ç¨‹åºã€‚æ­£å‘å»ºæ¨¡ä¸å¼€å‘æ˜¯ä¸€ç§åˆ›å»ºé«˜å±‚æ¨¡å‹æˆ–è®¾è®¡çš„æŠ€æœ¯ï¼Œä»¥å¢åŠ å¤æ‚æ€§å’Œä½å±‚ä¿¡æ¯ã€‚å› æ­¤ï¼Œè¿™ç§å·¥ç¨‹åœ¨ä¸åŒçš„è½¯ä»¶å’Œæ•°æ®åº“è¿‡ç¨‹ä¸­æœ‰ä¸åŒçš„åŸåˆ™ã€‚æ­£å‘å»ºæ¨¡ä¸å¼€å‘åº”ç”¨äº†æ‰€æœ‰çš„è½¯ä»¶å·¥ç¨‹è¿‡ç¨‹ï¼ŒåŒ…æ‹¬è½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸï¼ˆSDLCï¼‰ï¼Œä»¥é‡æ–°åˆ›å»ºç°æœ‰çš„åº”ç”¨ç¨‹åºã€‚å®ƒæ˜¯ä¸ºäº†æ»¡è¶³ç”¨æˆ·çš„æ–°éœ€æ±‚è€Œè¿›è¡Œé‡æ„çš„ã€‚ æœ¬å•å…ƒçš„ä¸»é¢˜æ˜¯ UMLï¼Œæ­£å‘å»ºæ¨¡ä¸å¼€å‘è‡ªç„¶æ˜¯æœ€é‡è¦çš„ä¸€ç¯ï¼Œæˆ‘ä¸ªäººä¹Ÿæ˜¯æŒ‰ç…§è¯¾ç¨‹ç»„çš„æŒ‡å¯¼ï¼Œæ¯æ¬¡ä½œä¸šå…ˆåšå¥½å»ºæ¨¡è®¾è®¡å†å†™ä»£ç ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š é€šè¯»æŒ‡å¯¼ä¹¦ï¼Œè®°å½•éœ€æ±‚é‡ç‚¹å’Œç»†èŠ‚ï¼Œå¹¶é’ˆå¯¹è¾¹ç•Œæƒ…å†µï¼Œå„ç§åŠŸèƒ½ç¼–å†™å„ç§æ ·ä¾‹ ä¾æ®æ ·ä¾‹ï¼Œæ•´ç†é¡¹ç›®é€»è¾‘ï¼Œè®°å½•å„ä¸ªç±»çš„åä½œå…³ç³»(ç±»ä¼¼äºé¡ºåºå›¾çš„è¦æ±‚) ä¾æ®æ•´ç†çš„é€»è¾‘è¿›è¡Œè®¾è®¡ï¼Œç”»å‡ºç±»å›¾è‰å›¾å’Œåä½œå›¾è‰å›¾ ç¼–å†™ä»£ç  ä½¿ç”¨ StarUml è½¯ä»¶å‚ç…§ç”» uml å›¾ å…¶å®å‰å‡ æ­¥åœ¨å…¶ä»–å‡ ä¸ªå•å…ƒçš„ä½œä¸šä¸­æˆ‘ä¹Ÿä¼šåšï¼Œæ¯•ç«Ÿåœ¨å®Œå…¨ä¸åšè®¾è®¡çš„æƒ…å†µä¸‹å†™ä»£ç æ˜¯å¾ˆéš¾çš„ã€‚ä½†æ˜¯æˆ‘è®¤ä¸ºåœ¨è®¾è®¡é˜¶æ®µå°±ç”»ä»”ç»†çš„ uml å›¾å…¶å®ä¸å¤ªæ–¹ä¾¿ï¼Œå› ä¸º StarUml ç»†èŠ‚æ¯”è¾ƒå¤šï¼Œè¦ç”¨é¼ æ ‡ç‚¹æ¥ç‚¹å»ï¼Œä¼šåˆ†æ•£è®¾è®¡é˜¶æ®µçš„æ³¨æ„åŠ›ï¼Œä½†ç”¨çº¸å’Œç¬”æ¥ç”»è‰å›¾å°±å¾ˆæ–¹ä¾¿ï¼Œè€Œä¸”è¿˜å¯ä»¥è‡ªå·±åŠ å„ç§æç¤ºåœ¨å›¾ä¸­ã€‚æ‰€ä»¥æˆ‘æ¯æ¬¡éƒ½æ˜¯å…ˆç”»è‰å›¾ï¼Œå†åœ¨å…¨éƒ¨å†™å®Œä»¥åç”¨ StarUmlç”»å‡ºæœ€ç»ˆçš„ uml å›¾ã€‚ æ”¾ä¸Šä¸€å¼  Unit1çš„è®¾è®¡å›¾ï¼Œä¹Ÿç®—æ˜¯æœ‰å§‹æœ‰ç»ˆäº†ğŸ¥³ï¼š ![](OO Unit1æ¶æ„.jpg) æ¶æ„è®¾è®¡å’ŒUMLæ¨¡å‹è®¾è®¡ä¹‹é—´çš„è¿½è¸ªå…³ç³»æœ¬å•å…ƒæ¶æ„ï¼š åœ¨è¿™å‡ æ¬¡çš„ä½œä¸šä¸­ï¼Œä¸ºäº†åšåˆ°é«˜å†…èšï¼Œä½è€¦åˆï¼Œæˆ‘æ ¹æ®æŒ‡å¯¼ä¹¦çš„è¦æ±‚å¯¹äºç›¸åº”çš„å¯¹è±¡éƒ½å»ºäº†ç±»ï¼Œè®©ä»–ä»¬å„å¸å…¶èŒã€‚ä½†æ˜¯éšç€éœ€æ±‚çš„å¢å¤šä»¥åŠå¤æ‚åº¦è¦æ±‚æ›´é«˜ï¼Œå¯¹äºä½è€¦åˆçš„å®ç°å°±é€ æˆäº†å¾ˆå¤§çš„å›°éš¾ï¼Œå°¤å…¶åœ¨ OrderRecordå’Œ BorrowRecordä¸¤ä¸ªç±»å‘ˆç°å‡ºè¾ƒå¤§çš„è€¦åˆæ€§ã€‚å¯¹äºä¸€è‡´æ€§æ–¹é¢ï¼Œæµç¨‹å›¾ä»¥åŠçŠ¶æ€å›¾çš„å®ç°éƒ½è¾ƒç®€å•ï¼Œå› æ­¤ä¸€è‡´æ€§è¾ƒå¥½ã€‚ æ¶æ„è®¾è®¡æ€ç»´çš„æ¼”è¿›å…¶å®æˆ‘æ„Ÿè§‰ç¬¬ä¸€å•å…ƒæ˜¯æ¶æ„è®¾è®¡æœ€å¤æ‚çš„å•å…ƒï¼Œå› ä¸ºè¡¨è¾¾å¼ååˆ†æŠ½è±¡ï¼Œå¦‚æœæ²¡æœ‰ trainingå’Œå®éªŒï¼Œæˆ‘ç”šè‡³éƒ½ä¸çŸ¥é“æ€ä¹ˆè®¾è®¡å„ä¸ªç±»ï¼Œå¯¼è‡´æ¶æ„è®¾è®¡çš„éš¾åº¦å¾ˆé«˜ï¼Œæ‰€ä»¥æˆ‘çš„æ¶æ„è®¾è®¡èƒ½åŠ›åŸºæœ¬æ˜¯åœ¨ç¬¬ä¸€å•å…ƒä¸­å…»æˆçš„ã€‚æˆ‘è®¾è®¡æ¶æ„ä»¥åŠå†™ä»£ç çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯è¿½æ±‚ç®€å•ï¼Œæ€ä¹ˆç®€å•æ€ä¹ˆæ¥ã€‚å› ä¸ºé€»è¾‘ç®€å•çš„ä»£ç æ›´å¥½æŠŠæ§ï¼Œæ›´ä¸å®¹æ˜“å‡º bugï¼Œå³ä½¿çœŸçš„å‡ºé—®é¢˜ä¹Ÿå¾ˆå¥½å®šä½ã€‚æˆ‘åœ¨ 1ï¼Œ2 å•å…ƒä¸­éƒ½è¿›è¡Œäº†è½»å¾®é‡æ„ï¼Œé‡æ„çš„æ–¹å‘éƒ½æ˜¯æŠŠåŸæ¥å¤æ‚ä¸€äº›çš„ä»£ç åŒ–ç®€ï¼Œå³ä½¿è¿™å¯èƒ½ä¼šç‰ºç‰²ä¸€äº›æ€§èƒ½æˆ–æ˜¯æ¶æ„çš„ç¾è§‚æ€§ã€‚å…¶å®â€œé¢å‘å¯¹è±¡æ€§â€å’Œæ¶æ„ç®€å•æ€§çš„çŸ›ç›¾æ˜¯æˆ‘ä¸€ç›´åœ¨æ€è€ƒçš„å†…å®¹ã€‚ä»¥ç¬¬å››å•å…ƒä¸¾ä¾‹ï¼Œå¦‚æœæƒ³ç§‰æ‰¿æ¨¡å—åŒ–ç­‰æ€æƒ³ï¼Œæ˜¯åº”è¯¥æŠŠæ¯ä¸ªåŠŸèƒ½å¤„æ‹†æˆå•ä¸ªç±»æ¥å†™çš„ï¼Œè€Œä¸æ˜¯åœ¨å›¾ä¹¦é¦†ç±»é‡Œé¢å†™å¤šä¸ªç»„åˆå‡½æ•°ã€‚ä½†æ›´å¤šçš„ç±»ã€æ›´å¤šçš„åŒ…è£…ä¼šå¯¼è‡´æ›´å¤šçš„å‡½æ•°åµŒå¥—è°ƒç”¨æˆ–æ˜¯å¯¹è±¡çš„åµŒå¥—ä½¿ç”¨ï¼Œè¿™å…¶å®ä¼šå¢åŠ ä»£ç é€»è¾‘ä¸Šçš„å¤æ‚åº¦ï¼Œä¹Ÿå¯èƒ½ä¼šå¢åŠ å‡ºé—®é¢˜æ—¶ debug çš„éš¾åº¦ï¼Œæ’æŸ¥ä¸€ä¸ªé—®é¢˜æ—¶å¯èƒ½éœ€è¦è·³è½¬å¤šä¸ªå‡½æ•°ï¼Œä¸”å¤šä¸ªå‡½æ•°ä¹‹é—´éƒ½å¯èƒ½å‡ºç°é—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜æˆ‘ä¸€ç›´æ²¡æœ‰ä¸€ä¸ªæ¸…æ™°çš„ç­”æ¡ˆï¼Œåœ¨å‡ ä¸ªå•å…ƒçš„ä½œä¸šä¸­ï¼Œæˆ‘è®¤ä¸ºä»£ç é€»è¾‘ç®€å•æ›´é‡è¦ï¼Œä½†è¿™ç§æƒ³æ³•ä¹Ÿä¸ä¸€å®šå¯¹ã€‚è¿™ä¸ªé—®é¢˜æœ€ç»ˆçš„ç­”æ¡ˆæˆ‘å¯èƒ½ä¹Ÿè¦åˆ°åç»­çš„ä»£ç ç¼–å†™å®è·µä¸­è·å–äº†ã€‚ æµ‹è¯•æ€ç»´çš„æ¼”è¿›å…¶å®åœ¨è¿™å››ä¸ªå•å…ƒä¸­ï¼Œæˆ‘çš„æµ‹è¯•æ€è·¯æ²¡æœ‰ä»€ä¹ˆå˜åŒ–ï¼Œéƒ½æ˜¯é»‘ç™½ç®±ç»“åˆçš„æ–¹å¼ã€‚ä¸€æ–¹é¢é€šè¿‡é˜…è¯»ä»£ç æ¢³ç†é€»è¾‘ç­‰æ–¹å¼è¿›è¡Œç™½ç®±æµ‹è¯•ï¼Œå¦ä¸€æ–¹é¢ç¼–å†™è¯„æµ‹æœºæˆ–è€…æ•°æ®ç”Ÿæˆå™¨è¿›è¡Œæµ‹è¯•æˆ–å¯¹æ‹ã€‚è¿™ç§æµ‹è¯•æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯æ•ˆæœå°šå¯ï¼Œåªè¦ç”Ÿæˆçš„æ•°æ®å¼ºåº¦è¿‡ç¡¬å°±èƒ½æµ‹å‡ºä»£ç çš„ bugï¼ŒåŒæ—¶ç»“åˆä¸€ç‚¹ç¼–å†™é’ˆå¯¹æ€§debugæ ·ä¾‹çš„æŠ€å·§ï¼Œèƒ½å¤Ÿå¿«é€Ÿåœ°å®šä½bugï¼Œä¾¿äºåç»­debugã€‚ å…·ä½“è€Œè¨€ï¼š ç¬¬ä¸€å•å…ƒï¼Œå€Ÿç”¨é€’å½’ä¸‹é™çš„ä¼˜åŠ¿ï¼Œæµ‹è¯•æ•°æ®çš„ç”Ÿæˆï¼Œå’Œç¨‹åºçš„ç¼–å†™ï¼Œéƒ½å¯ä»¥ä¸€åŒä½¿ç”¨ï¼Œé‡‡ç”¨äº†å¤§é‡çš„éšæœºæ•°æ®ä¸å°‘æ•°ç‰¹æ®Šæ•°æ®å› å­ç›¸ç»“åˆçš„æ„å»ºæ–¹æ³•ã€‚ ç¬¬äºŒå•å…ƒï¼ŒDPOğŸ˜­ç‹ ç‹ çš„è†œäº†ã€‚ ç¬¬ä¸‰å•å…ƒï¼Œä¸»è¦æ˜¯éšæœºæ•°æ®ï¼ŒåŒæ—¶è€ƒè™‘æŸ¥è¯¢æ•°æ®çš„å¤§é‡æ€§ï¼Œä¿è¯åŸºæœ¬æ­£ç¡®æ€§çš„å‰æä¸‹ï¼Œæ„å»ºå¤§é‡æŸ¥è¯¢è¾¹ç•Œæ•°æ®æ¥æµ‹è¯• TLEã€‚å¦å¤–ï¼Œè¿˜æœ‰ Junitæµ‹è¯•ã€‚ ç¬¬å››å•å…ƒï¼Œé‰´äºæ•°æ®æœ‰æå¤§çš„é™åˆ¶ï¼Œå‰æœŸè¾¹ç•Œæ¡ä»¶çš„æ¨¡ç³Šï¼Œåœ¨æ²¡æœ‰ä¿è¯è‡ªå·±è¯„æµ‹ä¼šä¸ä¼šæ­£ç¡®çš„å‰æä¸‹ï¼Œåç»­å‚è€ƒå¼ é‘«å’Œé«˜é¹é£åŒå­¦çš„è¯„æµ‹æœºå¹¶åŠ ä»¥é­”æ”¹æ¥å®Œæˆè¯„æµ‹ã€‚ è¯¾ç¨‹æ”¶è· å…¥å®å±±ä¸è¦ç©ºæ‰‹è€Œå½’ å…¶å®åœ¨ä¸Š OO è¯¾ä¹‹å‰ï¼Œæˆ‘å°±å·²ç»å¬è¯´è¿‡å…¶å¤§åäº†ï¼ŒçŸ¥é“ OO å¾ˆè‹¦å¾ˆç´¯ä½†æ˜¯èƒ½å­¦åˆ°ä¸å°‘ä¸œè¥¿ã€‚ä½†å®é™…ä½“éªŒçš„æ”¶è·è¿˜æ˜¯è¶…ä¹æˆ‘çš„æƒ³è±¡ã€‚æˆ‘ç«Ÿç„¶è¿˜åœ¨ä¸€ä¸ªæ˜ŸæœŸå†…å­¦ä¼šäº†å¤šçº¿ç¨‹ï¼Œè¿™ç§é«˜æ•ˆç‡çš„å­¦ä¹ æ˜¯æˆ‘éå¸¸å–œæ¬¢çš„ã€‚åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä¹Ÿè‡ªå­¦è¿‡å„ç§ä¸œè¥¿ï¼Œä½†ç½‘ä¸Šçš„æ•™ç¨‹æ€»æ˜¯å­¦èµ·æ¥æ•ˆç‡å¾ˆä½ï¼Œä¸”ç¼ºä¹åœ¨æŒ‡å¯¼ä¸‹çš„å¤§è§„æ¨¡é«˜æ•ˆå®è·µï¼Œå¯¼è‡´å­¦å‡ºæ¥åªèƒ½ç”¨æ¥å¹æ²¡æ³•å®å¹²ã€‚ä½† OO è¯¾ç¨‹å´å®Œå…¨è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼ŒOO è¯¾é€šè¿‡é«˜å‹çš„è®­ç»ƒå’Œé€‚å½“çš„å¼•å¯¼è®©æˆ‘å¾ˆå¿«çš„å‘ç°è§£å†³é—®é¢˜æ‰€éœ€çš„é‡ç‚¹çŸ¥è¯†å¹¶æŒæ¡äº†å®ƒä»¬ï¼Œåœ¨ OO è¯¾ç¨‹çš„å­¦ä¹ ä¸­ï¼Œæˆ‘è¿˜æ¥è§¦äº†å¾ˆå¤šé¢å‘å¯¹è±¡å’Œ Java ä»¥å¤–çš„æœ‰ç”¨çš„ä¸œè¥¿ï¼Œæ¯”å¦‚ JML ä¸å¥‘çº¦å¼ç¼–ç¨‹æˆ–æ˜¯éå¸¸ä½¿ç”¨çš„ UMLè¿˜æœ‰é€šè¿‡pythonæ¥æ­å»ºè¯„æµ‹æœºã€‚è¿™äº›çŸ¥è¯†ä¹Ÿè®©æˆ‘å—ç›ŠåŒªæµ…ã€‚æ€»è€Œè¨€ä¹‹ï¼Œé€šè¿‡ OO è¯¾ç¨‹çš„å­¦ä¹ ï¼Œæˆ‘è§è¯†å¹¶æŒæ¡äº†å¾ˆå¤šå„ç§å„æ ·çš„çŸ¥è¯†ï¼Œç»ƒå°±äº†å„ç§å„æ ·çš„èƒ½åŠ›ï¼Œæ”¶è·æ»¡æ»¡ã€‚æœ€åï¼Œå¾ˆæ„Ÿè°¢è€å¸ˆä»¬å’ŒåŠ©æ•™ä»¬é•¿ä¹…ä»¥æ¥çš„ä»˜å‡ºå’Œå¯¹æˆ‘çš„å¸®åŠ©ï¼Œä¹Ÿæ³¨ OO è¯¾ç¨‹è¶ŠåŠè¶Šå¥½ã€‚ è¿˜æ˜¯é‚£å¥å¤è®­ï¼Œæ— è®ºè‰°éš¾å›°è‹¦ï¼Œæœ€åç»“æœæˆåŠŸä¹Ÿå¥½ï¼Œå¤±è´¥ä¹Ÿç½¢ï¼Œè«ä»¥æˆè´¥è®ºè‹±é›„ï¼Œ å…¥å®å±±åˆ‡è«ç©ºæ‰‹è€Œå½’ï¼ï¼ï¼","link":"/2025/08/13/OO-4/"},{"title":"RooKie_Z challenge-shellå®ç°æŠ¥å‘Š","text":"/* å¸¸ç”¨é¢œè‰²ç±» */ .text-cadetblue { color: CadetBlue !important; } .text-blue { color: #007bff !important; } .text-green { color: #28a745 !important; } .text-red { color: #DC143C !important; } .text-orange { color: #fd7e14 !important; } .text-purple { color: #6f42c1 !important; } .text-emphasis { color: #007bff; font-weight: bold; } .text-warning { color: #ffc107; font-weight: bold; } .text-success { color: #28a745; font-weight: bold; } .text-danger { color: #7835dc; font-weight: bold; } /* è­¦å‘Šæ¡†æ ·å¼ */ blockquote { position: relative; margin: 20px 0; padding: 16px 20px; border-left: 4px solid #007bff; background: #f8f9fa; border-radius: 0 6px 6px 0; font-style: normal; } blockquote[data-callout=\"important\"] { border-left-color: #7835dc; background: rgb(242, 241, 251); border-left-width: 6px; } blockquote[data-callout=\"important\"]::before { content: \"ğŸ’¬ é‡è¦\"; display: block; font-weight: bold; color: #7835dc; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } blockquote[data-callout=\"caution\"] { border-left-color: #ffc107; background: #fffbf0; border-left-width: 6px; } blockquote[data-callout=\"caution\"]::before { content: \"âš ï¸ æ³¨æ„\"; display: block; font-weight: bold; color: #b8860b; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } blockquote[data-callout=\"note\"] { border-left-color: #17a2b8; background: #f0f9ff; border-left-width: 6px; } blockquote[data-callout=\"note\"]::before { content: \"â„¹ï¸ æç¤º\"; display: block; font-weight: bold; color: #17a2b8; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } // å¤„ç†è­¦å‘Šæ¡† document.addEventListener('DOMContentLoaded', function() { const blockquotes = document.querySelectorAll('blockquote'); blockquotes.forEach(function(blockquote) { const firstParagraph = blockquote.querySelector('p:first-child'); if (firstParagraph) { const text = firstParagraph.textContent; const calloutMatch = text.match(/\\[!(IMPORTANT|CAUTION|NOTE)\\]/i); if (calloutMatch) { const calloutType = calloutMatch[1].toLowerCase(); blockquote.setAttribute('data-callout', calloutType); // ç§»é™¤æ ‡è®°æ–‡æœ¬ const cleanText = text.replace(/\\[![^\\]]+\\]\\s*/, ''); firstParagraph.textContent = cleanText; } } }); }); æ€»è¿°å…ˆä¸Šå›¾ï¼Œçœ‹çœ‹æˆ‘çš„æˆå“Shell ç”±äºæˆ‘é€‰æ‹©çš„æ˜¯Lab6çš„æŒ‘æˆ˜æ€§ä»»åŠ¡ï¼Œæ•´ä½“çš„å­ä»»åŠ¡æ•°è¾ƒå¤šï¼Œæ•…æ¥ä¸‹æ¥çš„ä»‹ç»é¡ºåºå®Œå…¨åŸºäºæˆ‘çš„å®ç°è¿‡ç¨‹ï¼Œå¦‚æœ‰ä¸æ¸…æ¥šä¹‹å¤„ï¼Œå®Œå…¨æºäºæœ¬äººçš„èƒ½åŠ›ä¸è¶³ï¼Œçƒ¦è¯·å„ä½çœ‹å®˜æµ·æ¶µã€‚ æŒ‰ç…§è¯„æµ‹æµ‹è¯•ç‚¹ï¼Œæˆ‘çš„å®ç°é¡ºåºä¸º $3 \\to 4 \\to 2 \\to 1 \\to 5$ï¼Œæ¥ä¸‹æ¥æŒ‰ç…§è¿™ç§é¡ºåºä»‹ç»ã€‚ å…·ä½“å®ç°å®ç°ä¸å¸¦ .b åç¼€æŒ‡ä»¤spawnå‡½æ•°ä¸ fork å‡½æ•°ç±»ä¼¼ï¼Œå…¶æœ€ç»ˆæ•ˆæœéƒ½æ˜¯äº§ç”Ÿä¸€ä¸ªå­è¿›ç¨‹ï¼Œä¸è¿‡ä¸ forkå‡½æ•°ä¸åŒçš„æ˜¯ï¼Œspawn å‡½æ•°äº§ç”Ÿçš„å­è¿›ç¨‹ä¸å†æ‰§è¡Œä¸çˆ¶è¿›ç¨‹ç›¸åŒçš„ç¨‹åºï¼Œè€Œæ˜¯è£…è½½æ–°çš„ ELFæ–‡ä»¶ï¼Œæ‰§è¡Œæ–°çš„ç¨‹åºã€‚ äº‹å®ä¸Š spawnå°±æ˜¯åœ¨å°è¯•æ‰§è¡Œshellé‡Œçš„å‘½ä»¤ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œå°è¯•è¿½åŠ æ‰§è¡Œæ˜¯æœ€ä½³ä½ç½®ã€‚å³å½“ç”¨æˆ·æŒ‡å®šçš„ç¨‹åºè·¯å¾„ä¸å­˜åœ¨æ—¶ï¼Œåœ¨è¿™é‡Œå°è¯•åœ¨è·¯å¾„åè¿½åŠ  .b å†æ‰“å¼€ã€‚ å…·ä½“ä»£ç ï¼š 123456789101112131415161718192021// user/lib/spawn.c spawnchar tmp[MAXPATHLEN]; if (prog[0] != '.') { strcpy(tmp, &quot;/&quot;); strcpy(tmp + 1, prog); } else { strcpy(tmp, prog); } int fd; fd = open(tmp, O_RDONLY); if (fd &lt; 0) { int len = strlen(tmp); strcpy(tmp + len, &quot;.b&quot;); fd = open(tmp, O_RDONLY); } if (fd &lt; 0) { return fd; } å®ç°åå¼•å·ã€æ³¨é‡Šå’Œå†å²æŒ‡ä»¤å®ç°åå¼•å·å®ç°åå¼•å·çš„æ€è·¯å®é™…ä¸Šä¸å¼•å·ç±»ä¼¼ï¼Œå°±æ˜¯å½“ parsecmdè°ƒç”¨ gettokenè¯»åˆ° `,åï¼Œè¿›ä¸€æ­¥è§£æå…¶åçš„å­—ç¬¦ä¸²ï¼Œç›´åˆ°å¦ä¸€ä¸ªåå¼•å·ä½ç½®ï¼Œè·å–å…¶ä¸­çš„å­—ç¬¦ä¸²ï¼Œç›´æ¥ runcmd()ï¼Œå…·ä½“æ€è·¯å¯è§ä¸‹é¢çš„ç¤ºæ„å›¾ï¼š å®é™…ä¸Šï¼Œä¸Šè¿°æ€è·¯çš„å®ç°å°šä¸æˆç†Ÿï¼Œä¸‹é™„ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142//sh.c gettokenif (*s == '`') { in_quot = !in_quot; }if (in_quot) { *p1 = s; while (*s &amp;&amp; ((in_quot &amp;&amp; !strchr(&quot;`&quot;, *s)) ||!strchr(WHITESPACE SYMBOLS, *s))) { if (*s == '#') { while (*s) { *s++ = 0; } } else { s++; } } *p2 = s; } //sh.c parsecmdcase '`': debugf(&quot;clg: use `\\n&quot;); gettoken(0, &amp;t); char s[100]; strcpy(s, t); char ch = gettoken(0, &amp;t); ch = gettoken(0, &amp;t); if (ch == 0 || ch == '\\0') { runcmd(s); } else { if (ch == ';') { int fork1 = 0; fork1 = fork(); if (fork1) { wait(fork1); return parsecmd(argv, rightpipe, 1, job_flag); } else { runcmd(s); } } runcmd(s); } å®é™…ä¸Šï¼Œåœ¨åæ¥å¤„ç†å¼•å·çš„æ—¶å€™ï¼Œæ€è·¯å°±å¾ˆæ¸…æ™°äº†ï¼š 12345678910111213//sh.c gettokenif(*s == '`') { // è¯†åˆ«åå¼•å· *s = 0; s++; *p1 = s; while(*s &amp;&amp; (*s != '`')){ s++; } *s++ = 0; *p2 = s; return 'r'; //è¡¨ç¤ºåå¼•å·} å®ç°æ³¨é‡Šå®é™…ä¸Šï¼Œæ³¨é‡Šçš„åŠŸèƒ½å’Œè¯»å–ç©ºç™½ç¬¦å¹¶æ— åŒºåˆ«ï¼Œè¾ƒä¸ºç®€å•ï¼Œä»£ç è§ä¸‹ï¼š 12345678910111213//sh.c gettoken*p1 = s; while (*s &amp;&amp; (!strchr(WHITESPACE SYMBOLS, *s))) { if (*s == '#') { while (*s) { *s++ = 0; } } else { s++; } } *p2 = s; ç”±äºå†å²æŒ‡ä»¤çš„å®ç°æˆ‘ä½¿ç”¨äº†è¿½åŠ é‡å®šå‘çš„åŠŸèƒ½ï¼Œæ•…æ”¾åˆ°ä¸‹æ–‡ä¸€å¹¶è¯´ å®ç°è¿½åŠ é‡å®šå‘å’Œå¼•å·æ”¯æŒå®ç°å¼•å·æ”¯æŒä¸ä¸Šæ–‡åå¼•å·æ€è·¯ç›¸åŒï¼Œç›´æ¥ç»™å‡ºä»£ç ï¼š 123456789101112131415161718192021222324//sh.c gettokenif(*s == '\\&quot;') { // è¯†åˆ«å¼•å· *s = 0; s++; *p1 = s; while(*s &amp;&amp; (*s != '\\&quot;')){ s++; } *s++ = 0; *p2 = s; return 's'; // it means &quot;string&quot; }//sh.c parsecmdcase 's': if (argc &gt;= MAXARGS) { debugf(&quot;too many arguments\\n&quot;); exit(); } if (need) { argv[argc++] = t; } å®ç°è¿½åŠ é‡å®šå‘æˆ‘çš„æ€è·¯æ˜¯æ·»åŠ ä¸€ä¸ªæ–°çš„å†™å…¥æ–¹å¼ï¼Œå³è¿½åŠ  APPEND 123456//user/include/lib.h#define O_APPEND 0x0004//user/lib/file.c openif ((mode &amp; O_APPEND) != 0) { fd-&gt;fd_offset = size;} å› ä¸ºæˆ‘ä»¬çš„shellåŸæœ¬å°±æ”¯æŒå¯¹äº &gt;&gt;çš„è§£æï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åœ¨ parsecmdä¸­ç¨ä½œä¿®æ”¹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849case '&gt;':; int cc; cc = gettoken(0, &amp;t); if (cc == '&gt;') { if (gettoken(0, &amp;t) != 'w') { debugf(&quot;syntax error: &gt; not followed by word\\n&quot;); exit(); } // Open 't' for writing, create it if not exist and trunc it if exist, dup // it onto fd 1, and then close the original fd. // If the 'open' function encounters an error, // utilize 'debugf' to print relevant messages, // and subsequently terminate the process using 'exit'. /* Exercise 6.5: Your code here. (2/3) */ if((fd = open(t, O_WRONLY | O_APPEND | O_CREAT)) &lt; 0) { debugf(&quot;failed to open '%s'\\n&quot;, t); exit(); } if((r = dup(fd, 1)) &lt; 0) { debugf(&quot;failed to duplicate file to &lt;stdout&gt;\\n&quot;); exit(); } close(fd); } else { if (cc != 'w') { debugf(&quot;syntax error: &gt; not followed by word\\n&quot;); exit(); } // Open 't' for writing, create it if not exist and trunc it if exist, dup // it onto fd 1, and then close the original fd. // If the 'open' function encounters an error, // utilize 'debugf' to print relevant messages, // and subsequently terminate the process using 'exit'. /* Exercise 6.5: Your code here. (2/3) */ if((fd = open(t, O_WRONLY | O_CREAT)) &lt; 0) { debugf(&quot;failed to open '%s'\\n&quot;, t); exit(); } if((r = dup(fd, 1)) &lt; 0) { debugf(&quot;failed to duplicate file to &lt;stdout&gt;\\n&quot;); exit(); } close(fd); } //argv[argc++] = t; //user_panic(&quot;&gt; redirection not implemented&quot;); re_alloc = 1; è¿™é‡Œçš„ re_allocæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œè¡¨ç¤ºæŒ‡ä»¤è¿›è¡Œäº†é‡å®šå‘ï¼Œåœ¨åç»­ä¸€è¡Œå¤šæŒ‡ä»¤çš„å®ç°ä¸­èµ·äº†ä½œç”¨ã€‚ å®ç°å†å²æŒ‡ä»¤ç”±äºæˆ‘ä»¬å·²ç»å®ç°äº†è¿½åŠ å†™å…¥ï¼Œé‚£ä¹ˆä¿å­˜å‘½ä»¤å°±ç®€å•äº†ï¼š 1234567891011121314//sh.c save_cmdvoid save_cmd(char* cmd) { int r = open(&quot;/.mosh_history&quot;, O_CREAT | O_WRONLY | O_APPEND); if (r &lt; 0) { debugf(&quot;open /.mosh_history failed to save&quot;); return r; } write(r, cmd, strlen(cmd)); write(r, &quot;\\n&quot;, 1); return 0;}//sh.c main save_cmd(buf); æ¥ä¸‹æ¥å°±å¯ä»¥é€šè¿‡ historyå‘½ä»¤è°ƒå–å†å²è®°å½•å¹¶è¾“å‡ºï¼š 1234567891011121314151617181920212223242526272829//sh.c rumcmd å®ç°å†…ç½®æŒ‡ä»¤if (strcmp(argv[0], &quot;history&quot;) == 0) { history(); }//sh.c historyvoid history() { int fdnum = open(&quot;/.mosh_history&quot;, O_RDONLY); if (fdnum &lt; 0) { debugf(&quot;open /.mosh_history failed\\n&quot;); return; } char buf; int r; int cnt = 0; int newline = 1; while ((r = read(fdnum, &amp;buf, 1)) != 0) { if (newline) { debugf(&quot;%c&quot;, buf); cnt++; newline = 0; } else { debugf(&quot;%c&quot;, buf); } if (buf == '\\n') { newline = 1; } }} å®ç°æŒ‡ä»¤å›æ˜¾ç”±äºè¿™éƒ¨åˆ†åœ¨è¯„æµ‹ä¸­å°šæœªæ¶‰åŠï¼Œæ•…ä¸å¤šèµ˜è¿°ï¼Œç®€å•ä»‹ç»åŸç† æˆ‘ä»¬çŸ¥é“ Linuxå¯¹äºä¸Šä¸‹å·¦å³é”®çš„ç¼–ç  ä¸Šä¸‹å·¦å³é”®åœ¨linuxä¸­ä¼šè¢«ç¼–ç ä¸º ä¸Šï¼š 27 â€˜[â€™ â€˜Aâ€™ ä¸‹ï¼š 27 â€˜[â€™ â€˜Bâ€™ å³ï¼š 27 â€˜[â€™ â€˜Câ€™ å·¦ï¼š 27 â€˜[â€™ â€˜Dâ€™ æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨è¯»åˆ°27 [Esc]åè¿ç»­è¯»å–ä¸¤ä¸ªå­—ç¬¦ä»¥åˆ¤æ–­æŒ‡ä»¤çš„ç±»å‹,ä»è€Œåˆ†åˆ«è°ƒç”¨å±äºå·¦å³é”®å’Œä¸Šä¸‹é”®çš„ä¸åŒåŠŸèƒ½ã€‚ å…·ä½“è¿™éƒ¨åˆ†ä»£ç éƒ¨åˆ†å‚è€ƒäº†Charleså­¦é•¿çš„åšå®¢ï¼Œä¸‹é™„ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180int newDirCmd = 1;int offset; // 0:empty line, -1:last cmd, -2:...int solveDirCmd(char* buf, int type) { // type: 0 means up, 1 means down if (newDirCmd == 1) { offset = 0; } if (type == 0) { offset--; } else if (offset &lt; 0) { offset++; } int x = 0; if (offset == 0) { while (buf[x] != '\\0') { buf[x] = '\\0'; x++; } return -1; } int fdnum = open(&quot;/.mosh_history&quot;, O_RDONLY); if (fdnum &lt; 0) { debugf(&quot;open /.mosh_history failed in sloveDir!\\n&quot;); return 0; } struct Fd* fd = num2fd(fdnum); char* c; char* begin = fd2data(fd); char* end = begin + ((struct Filefd*)fd)-&gt;f_file.f_size; c = end - 1; while (((*c) == '\\n' || (*c) == 0) &amp;&amp; (c &gt; begin)) { c--; } if (c == begin) { // no history cmd buf[0] = '\\0'; return 0; } c++; // last \\n or \\0 int i; for (i = 0; i &gt; offset; i--) { while ((*c) != '\\n' &amp;&amp; (*c) != '\\0') { c--; if (c &lt;= begin) { break; } } c--; if (c &lt;= begin) { break; } } offset = i; // avoid offset too bigger than real cmd num if (c &gt; begin) { while (c &gt; begin &amp;&amp; (*c) != '\\n') { c--; } if ((*c) == '\\n') { c++; } } else { c = begin; } int now = 0; while (buf[now] != '\\0') { buf[now] = '\\0'; now++; } now = 0; while ((*c) != '\\n' &amp;&amp; (*c) != '\\0' &amp;&amp; (*c) &lt; end) { buf[now] = *c; now++; c++; } return now;}#define MOVELEFT(y) printf(&quot;\\033[%dD&quot;, (y))#define MOVERIGHT(y) printf(&quot;\\033[%dC&quot;, (y))void readline(char* buf, u_int n) { /* TODO:lab6-challenge */ int r; int off = 0; int len = 0; char op; while (off &lt; n) { if ((r = read(0, &amp;op, 1)) != 1) { if (r &lt; 0) { debugf(&quot;read error: %d\\n&quot;, r); } exit(); } if (op == '\\b' || op == 0x7f) { /* TODO:lab6-challenge */ if (off &gt; 0) { if (off == len) { buf[--off] = 0; printf(&quot;\\033[D \\033[D&quot;); } else { for (int j = off - 1; j &lt; len - 1; j++) { buf[j] = buf[j + 1]; } buf[len - 1] = 0; MOVELEFT(off--); printf(&quot;%s &quot;, buf); MOVELEFT(len - off); } len -= 1; } // } else if (op == '\\r' || op == '\\n') { buf[len] = 0; return; } /* TODO:lab6-challenge */ else if (op == 27) { char tmp; read(0, &amp;tmp, 1); char tmp2; read(0, &amp;tmp2, 1); if (tmp == 91 &amp;&amp; tmp2 == 65) { debugf(&quot;\\x1b[B&quot;); // down to cmd line int j; for (j = 0; j &lt; off; j++) { debugf(&quot;\\x1b[D&quot;); // left to line head } debugf(&quot;\\x1b[K&quot;); // clean line off = solveDirCmd(buf, 0); len = strlen(buf); debugf(&quot;%s&quot;, buf); } else if (tmp == 91 &amp;&amp; tmp2 == 66) { int j; for (j = 0; j &lt; off; j++) { debugf(&quot;\\x1b[D&quot;); } debugf(&quot;\\x1b[K&quot;); off = solveDirCmd(buf, 1); len = strlen(buf); debugf(&quot;%s&quot;, buf); } /* TODO:lab6-challenge */ else if (tmp == 91 &amp;&amp; tmp2 == 67) { if (off &lt; len) { off++; } else { MOVELEFT(1); } } else if (tmp == 91 &amp;&amp; tmp2 == 68) { if (off &gt; 0) { off--; } else { MOVERIGHT(1); } } // newDirCmd = 0; } else { newDirCmd = 1; if (off == len) { buf[off++] = op; } else { // i &lt; len for (int j = len; j &gt; off; j--) { buf[j] = buf[j - 1]; } buf[off] = op; buf[len + 1] = 0; MOVELEFT(++off); printf(&quot;%s&quot;, buf); MOVELEFT(len - off + 1); } len += 1; } } debugf(&quot;line too long\\n&quot;); while ((r = read(0, buf, 1)) == 1 &amp;&amp; buf[0] != '\\r' &amp;&amp; buf[0] != '\\n') { ; } buf[0] = 0;} ç”±äºåŒæ—¶ç›‘å¬äº†å·¦å³é”®ï¼Œæ‰€ä»¥åŒæ—¶äº†å®ç°é”®å…¥å‘½ä»¤æ—¶ä»»æ„ä½ç½®çš„ä¿®æ”¹å®ç°äº†åœ¨å½“å‰å…‰æ ‡ä½ç½®è¿›è¡Œå­—ç¬¦çš„å¢åŠ ä¸åˆ é™¤ã€‚åœ¨ä¸åŒä½ç½®é”®å…¥åï¼Œå¯ä»¥å®Œæ•´å›æ˜¾ä¿®æ”¹åçš„å‘½ä»¤ï¼Œå¹¶ä¸”é”®å…¥å›è½¦åå¯ä»¥æ­£å¸¸è¿è¡Œä¿®æ”¹åçš„å‘½ä»¤ã€‚ å®ç°ä¸€è¡Œå¤šæŒ‡ä»¤shellçš„åŸç†æ˜¯ main ä»æ§åˆ¶å°è¯»å–ä¸€è¡Œå forkï¼ŒæŠŠè¿™ä¸€è¡Œå‘½ä»¤ä¼ é€’ç»™å­è¿›ç¨‹ã€‚å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•åé€€å‡ºï¼Œçˆ¶è¿›ç¨‹è°ƒç”¨ waitå‡½æ•°ç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œç»“æŸè¢«æ‘§æ¯ã€‚ å› ä¸ºåœ¨ user/sh.cä¸­çš„ä¿ç•™ SYMBOLS é‡Œå·²ç»é¢„ç•™æœ‰ ; å­—ç¬¦ï¼Œgettoken å‡½æ•°æœ¬èº«å°±èƒ½å¤Ÿè§£æä¸‹ä¸€ä¸ª ; å­—ç¬¦ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°†ï¼›ä½œä¸ºä¸€ä¸ªç‰¹æ®Šçš„tokenå³å¯ï¼Œæˆ‘ä»¬æ— éœ€æ”¹å˜è¯æ³•éƒ¨åˆ†ï¼Œåªéœ€æ”¹å˜è¯­æ³•è§£é‡Šéƒ¨åˆ†ã€‚ [!CAUTION] æ³¨æ„ï¼Œåœ¨å®ç°ä¸€è¡Œå¤šå‘½ä»¤çš„è¿‡ç¨‹ä¸­ï¼ŒåŠ¡å¿…è€ƒè™‘ä»¥ä¸‹é‡å®šå‘æ ·ä¾‹ echo &quot;aaa&quot; &gt;&gt; file1; cat file1 å¦‚æœåœ¨ä¸Šæ¡å‘½ä»¤æ‰§è¡ŒåæœªåŠæ—¶é‡å®šå‘å›æ ‡å‡†è¾“å‡ºï¼Œåˆ™å†è¿›è¡Œä¸€æ¬¡ cat file1ä¼šå‘ç° file1ä¸­å†™å…¥äº†ä¸¤ä¸ª aaa ä¸‹é™„ä»£ç ï¼š 1234567891011121314151617case ';':; if (need == 0) { return parsecmd(argv, rightpipe, 1, job_flag); } else { int child = fork(); // forkå‡ºä¸¤ä¸ªè¿›ç¨‹ if(child) { // çˆ¶è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œå®Œå†æ‰§è¡Œ';'å³è¾¹çš„å‘½ä»¤ if(re_alloc == 0){ // å¦‚æœå‰ä¸€æ¡å‘½ä»¤å‡ºç°äº†é‡å®šå‘ï¼Œé‚£ä¹ˆå†é‡å®šå‘å›æ¥ dup(1, 0); } else if(re_alloc == 1) { dup(0, 1); } wait(child); return parsecmd(argv, rightpipe, 1, job_flag); } else { // å­è¿›ç¨‹æ‰§è¡Œ';'å·¦è¾¹çš„å‘½ä»¤ return argc; } } å®ç°æ›´å¤šæŒ‡ä»¤touchæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå°±åˆ›å»ºæ–‡ä»¶å°±è¡Œäº†ï¼Œä¸‹é™„ä»£ç ï¼š 12345678910111213141516171819202122232425#include &lt;lib.h&gt;void usage(void) { debugf(&quot;usage: touch file...\\n&quot;); exit();}int main(int argc, char *argv[]) { int fd; if (argc &lt; 2) { usage(); } for (int i = 1; i &lt; argc; i++) { if ((fd = open(argv[i], O_CREAT)) &gt;= 0) { close(fd); } else { printf(&quot;touch: cannot touch \\'%s\\': No such file or directory\\n&quot;, argv[i]); } } return 0;} rmrmæŒ‡ä»¤éœ€è¦è§£æå…¶è¾“å…¥åçš„å‚æ•°ï¼Œå¦‚ -r, -f, -rfç­‰ç­‰ï¼Œæˆ‘é‡‡ç”¨äº†å…¨å±€å˜é‡æ¥å®ç°ï¼ŒåŒæ—¶ç¼–å†™äº†å·¥å…·å‡½æ•° isdiræ¥åˆ¤æ–­è¦æ±‚çš„æ–‡ä»¶æ˜¯ä¸æ˜¯ç›®å½•: 123456789101112131415static void init(){ enableForce = 0; // -f enableRecursive = 0; // -r}int isdir(const char* path){ struct Stat st; if (stat(path, &amp;st) &lt; 0) return 0; return st.st_isdir;} ä¸»ä½“å®ç°éƒ¨åˆ†ä¸ºä¸¤ä¸ªå‡½æ•° rm å’Œ _rmåˆ†åˆ«è¡¨ç¤ºåˆ é™¤æ–‡ä»¶å’Œç›®å½•ï¼ŒåŸç†è¾ƒä¸ºç®€å•ï¼Œrmè°ƒç”¨ removeåˆ é™¤æ–‡ä»¶ï¼Œ_rmåˆ™é€šè¿‡éå†ç›®æ ‡ç›®å½•åä¸æ–­é€’å½’è°ƒç”¨è‡ªèº«ï¼Œæ¥å®ç°å¯¹äºç›®æ ‡ç›®å½•çš„é€’å½’åˆ é™¤ï¼Œä¸‹é™„ä»£ç : 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364static void rm(const char* path){ int ret; struct Stat st; if ((ret = stat(path, &amp;st)) &lt; 0) { if (!enableForce) printf(&quot;rm: cannot remove \\'%s\\': No such file or directory\\n&quot;, path); return; } if (st.st_isdir &amp;&amp; !enableRecursive) { printf(&quot;rm: cannot remove \\'%s\\': Is a directory\\n&quot;, path); return; } if (st.st_isdir) _rm(path); ret = remove(path); if (ret != 0) debugf(&quot;Failed to remove '%s': %d\\n&quot;, path, ret);}static void _rm(const char* path){ char dir[MAXPATHLEN]; // open directory int fd; if ((fd = open(path, O_RDONLY)) &lt; 0) { if (!enableForce) printf(&quot;rm: cannot remove \\'%s\\': No such file or directory\\n&quot;, path); return; } // get number of sub items int size; int ret; int is_dir; struct File file; while ((size = readn(fd, &amp;file, sizeof(struct File))) == sizeof(struct File)) { if (!file.f_name[0]) continue; strcpy(dir, path); strcat_(dir, &quot;/&quot;); strcat_(dir, file.f_name); is_dir = isdir(dir); if (is_dir) { if (!enableRecursive) printf(&quot;rm: cannot remove \\'%s\\': Is a directory\\n&quot;, path); else _rm(dir); } ret = remove(dir); if (ret != 0) debugf(&quot;Failed to remove '%s': %d\\n&quot;, dir, ret); }} mkdirmkdiræ˜¯è¿™3ä¸ªæŒ‡ä»¤ä¸­æœ€éº»çƒ¦çš„ä¸€ä¸ªï¼Œè€ƒè™‘åˆ° -pæŒ‡ä»¤çš„ç‰¹æ®Šæ€§ï¼Œä¸ºå®ç°è¿™ä¸€æ¡æŒ‡ä»¤ï¼Œæ–°å¢äº†ä¸å°‘å·¥å…·å‡½æ•°ï¼š 12345678910111213141516171819202122232425262728293031323334//user/include/fsreq.hstruct Fsreq_create{ char req_path[MAXPATHLEN]; u_int req_omode;}; //è¡¨ç¤ºåˆ›å»ºç›®å½•//fs/fs.cint file_creat(const char* path, u_int omode, struct File** pfile){ char name[MAXNAMELEN]; struct File* dir; struct File* f; int ret; if ((ret = walk_path(path, &amp;dir, &amp;f, name)) == 0) return -E_FILE_EXISTS; if ((ret != -E_NOT_FOUND) || (dir == NULL)) return ret; if ((ret = dir_alloc_file(dir, &amp;f)) &lt; 0) return ret; strcpy(f-&gt;f_name, name); f-&gt;f_type = (omode &amp; O_MKDIR) ? FTYPE_DIR : FTYPE_REG; if (pfile) *pfile = f; // file_flush(f); return 0;} //åˆ›å»ºç›®å½• åœ¨ mkdir.cä¸­ï¼Œæ€è·¯ä¸ rmç±»ä¼¼ï¼ŒåŒæ—¶åˆ›å»ºäº† accesså·¥å…·å‡½æ•°ï¼Œä¸‹é™„ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859static void init(){ enableParents = 0;}//accessint access(const char* path, int type){ char dir[MAXPATHLEN]; struct Stat st; int ret; while (*path &amp;&amp; (*path == ' ')) path++; strcpy_(dir, path); // debugf(&quot;Access: %s\\n&quot;, dir); ret = stat(dir, &amp;st); if (ret &lt; 0) { // debugf(&quot;Acess error: %d\\n&quot;, ret); return 0; } if (type == FTYPE_DIR) return st.st_isdir; else if (type == FTYPE_REG) return !st.st_isdir; return 1;}//mkdirstatic int mkdir(const char* path){ char dir[MAXPATHLEN]; const char* p = path; const char* base = path; while (*p != '\\0') { while (*p &amp;&amp; (*p != '/')) p++; memcpy_(dir, base, p - base); dir[p - base] = '\\0'; while (*p &amp;&amp; (*p == '/')) p++; if (*p) // there are remaining directories to create try(_create(dir, enableParents, 0)); else // the last element try(_create(dir, 1, 1)); } return 0;} ä¸»ä½“ mkdirå‡½æ•°ä¸­ï¼Œé€šè¿‡ä¸æ–­è°ƒç”¨ _createå‡½æ•°ï¼Œæ¥å®ç°ç›®å½•çš„é€’å½’åˆ›å»ºï¼š 12345678910111213141516171819202122232425static int _create(const char* path, int create, int final){ if (access(path, FTYPE_DIR)) { if (!final) return 0; printf(&quot;mkdir: cannot create directory \\'%s\\': File exists\\n&quot;, path); return 11; } // now, there is no such a file if (!create &amp;&amp; !final) { printf(&quot;mkdir: cannot create directory \\'%s\\': No such file or directory\\n&quot;, path); return 13; } // now, it's time to create file int ret = creat(path, O_MKDIR); if (ret &lt; 0) { debugf(&quot;Failed to create '%s': %d\\n&quot;, path, ret); return ret; } return 0;} å®ç°æŒ‡ä»¤æ¡ä»¶æ‰§è¡Œä¸ªäººè®¤ä¸ºè¿™æ˜¯æœ¬æ¬¡æŒ‘æˆ˜æ€§ä»»åŠ¡ä¸­æœ€éš¾çš„ä¸€ä¸ªç‚¹ï¼Œåœ¨æ·±æ€ç†Ÿè™‘åï¼Œæˆ‘å¹¶æœªé‡‡å–è¯¾ç¨‹ç»„æä¾›çš„ä¿®æ”¹ exitå‡½æ•°çš„æ€è·¯ æŒ‡ä»¤è¿”å›å€¼è·å–åŒæ—¶ï¼Œæ ¹æ®è®¨è®ºåŒºäºæ©æ³½åŒå­¦çš„å‰è½¦ä¹‹é‰´ï¼Œæˆ‘æ–°å»ºäº†ä¸“é—¨çš„ ipcæ¥å‘é€è¿”å›å€¼ï¼š 12345678910111213141516171819202122232425262728//user/lib/ipc.cvoid ipc_send_cmd(u_int whom, u_int val, const void *srcva, u_int perm) { int r; while ((r = syscall_ipc_try_send_cmd(whom, val, srcva, perm)) == -E_IPC_NOT_RECV) { syscall_yield(); } user_assert(r == 0);}u_int ipc_recv_cmd(u_int *whom, void *dstva, u_int *perm) { int r = syscall_ipc_recv_cmd(dstva); if (r != 0) { user_panic(&quot;syscall_ipc_recv err: %d&quot;, r); } if (whom) { *whom = env-&gt;env_ipc_from; } if (perm) { *perm = env-&gt;env_ipc_perm; } return env-&gt;env_ipc_value;}//env.hu_int env_ipc_recving_cmd; //whether this env is receiving cmd ç„¶ååœ¨ libos.c å’Œ debugf.cä¸­è¿›è¡Œä¿®æ”¹ï¼Œä½¿ç›¸å…³å‡½æ•°èƒ½å¤Ÿå‘é€è¿”å›å€¼ï¼š 12345678910111213141516171819202122232425262728//libos.cvoid libmain(int argc, char **argv) { // set env to point at our env structure in envs[]. env = &amp;envs[ENVX(syscall_getenvid())]; // call user main routine int r; r = main(argc, argv); debugf(&quot;Begin send : child %d, parent %d\\n&quot;, env-&gt;env_id, env-&gt;env_parent_id); ipc_send_cmd(env-&gt;env_parent_id, r, 0, 0); syscall_env_job_done(env-&gt;env_id); // exit gracefully exit();}//debugf.cvoid _user_panic(const char *file, int line, const char *fmt, ...) { debugf(&quot;panic at %s:%d: &quot;, file, line); va_list ap; va_start(ap, fmt); vdebugf(fmt, ap); va_end(ap); debugf(&quot;\\n&quot;); // //ipc_send(env-&gt;env_parent_id, r, 0, 0); ipc_send_cmd(env-&gt;env_parent_id, -1, 0, 0); exit();} æ ¹æ®è¿”å›å€¼æ¡ä»¶æ‰§è¡ŒæŒ‡ä»¤åŒæ—¶åœ¨ runcmdä¸­è¿›è¡Œä¿®æ”¹ï¼Œæ¥è·å–å’Œå‘é€è¿”å›å€¼ï¼ŒåŒæ—¶ç»™ parsecmdæ·»åŠ ä¸€ä¸ªå‚æ•°ï¼Œæ ¹æ®ä¸Šæ¡å‘½ä»¤çš„è¿”å›å€¼ï¼Œæ¥æŒ‡ç¤ºå½“å‰å‘½ä»¤æ˜¯å¦æ‰§è¡Œï¼ŒåŒæ—¶åœ¨ gettokenä¸­æ·»åŠ åˆ¤æ–­ï¼Œæ¥è§£æ &amp;&amp; å’Œ ||ï¼Œä¸‹é™„ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980//gettokenif (*s == '&amp;') { if (*(s + 1) == '&amp;') { *s++ = 0; flag = 'a'; } } if (*s == '|') { if (*(s + 1) == '|') { *s++ = 0; flag = 'o'; } } //parsecmd case 'a': debugf(&quot;we have &amp;&amp;\\n&quot;); if (need) { forkand = fork(); if (forkand == 0) { condition = 1; return argc; } else { int i = ipc_recv_cmd(NULL, 0, 0); //debugf(&quot;received return : %d\\n&quot;, i); int need_ = (i == 0) ? 1 : 0; condition = 0; return parsecmd(argv, rightpipe, need_, job_flag); } } else { return parsecmd(argv, rightpipe, 1, job_flag); }â€¦â€¦ case 'o': debugf(&quot;we have ||\\n&quot;); if (need) { forkor = fork(); if (forkor == 0) { condition = 1; return argc; } else { int i = ipc_recv_cmd(NULL, 0, 0); //debugf(&quot;received return : %d\\n&quot;, i); //wait(forkand); int need_ = (i == 0) ? 0 : 1; condition = 0; return parsecmd(argv, rightpipe, need_, job_flag); } } else { return parsecmd(argv, rightpipe, 0, job_flag); }//runcmdif (argc == 0) { if (condition) { //debugf(&quot;Begin send : child %d, parent %d\\n&quot;, env-&gt;env_id, env-&gt;env_parent_id); ipc_send_cmd(env-&gt;env_parent_id, 0, 0, 0); } return; }int child = spawn(argv[0], argv); close_all(); if (child &gt;= 0) { //debugf(&quot;Begin recv : child %d, parent %d\\n&quot;, env-&gt;env_id, env-&gt;env_parent_id); if (job_flag) { syscall_env_save_job(child, tmp); } int r = ipc_recv_cmd(NULL, 0, 0); if (condition) { //debugf(&quot;Begin send : child %d, parent %d\\n&quot;, env-&gt;env_id, env-&gt;env_parent_id); ipc_send_cmd(env-&gt;env_parent_id, r, 0, 0); } å®ç°å‰åå°ä»»åŠ¡ç®¡ç†åå°ä»»åŠ¡è¿è¡Œæ‰€è°“åå°è¿è¡Œæ‰€éœ€è¦çš„ä»»åŠ¡ä¾¿æ˜¯shell ä¸éœ€è¦ç­‰å¾…æ­¤å‘½ä»¤æ‰§è¡Œå®Œæ¯•åå†ç»§ç»­æ‰§è¡Œï¼Œå³å½“å­˜åœ¨ &amp;æ—¶ï¼Œä¸è¿›è¡Œ waitå³å¯ï¼Œä¸‹é™„ä»£ç ï¼š 12345678910111213141516//parsecmdcase '&amp;':; int child_ = fork(); if(child_) { // çˆ¶è¿›ç¨‹æ‰§è¡Œå³è¾¹çš„å‘½ä»¤ if(re_alloc == 0){ // å¦‚æœå‰ä¸€æ¡å‘½ä»¤å‡ºç°äº†é‡å®šå‘ï¼Œé‚£ä¹ˆå†é‡å®šå‘å›æ¥ dup(1, 0); } else if(re_alloc == 1) { dup(0, 1); } re_alloc = 0; return parsecmd(argv, rightpipe, 1, job_flag); } else { // å­è¿›ç¨‹æ‰§è¡Œå·¦è¾¹çš„å‘½ä»¤ re_alloc = 0; *job_flag = 1; return argc; } åå°ä»»åŠ¡ç®¡ç†è€ƒè™‘åˆ°å¦‚æœåœ¨ç”¨æˆ·è¿›ç¨‹ä¸­ç»´æŠ¤ä¸€ä¸ªä»»åŠ¡åˆ—è¡¨ï¼Œé‚£ä¹ˆå„è¿›ç¨‹é—´å…±äº«å°†ä¼šéå¸¸éº»çƒ¦ï¼Œäºæ˜¯è¿›è¿‡æ…é‡è€ƒè™‘ï¼Œæˆ‘å†³å®šåœ¨å†…æ ¸ç»´æŠ¤ä¸€ä¸ªä»»åŠ¡åˆ—è¡¨ï¼Œé€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¥è¿›è¡Œæ“ä½œã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091//env.hstruct Job { int status; // 0è¡¨ç¤ºå·²ç»ç»“æŸï¼Œ1è¡¨ç¤ºæ­£åœ¨è¿è¡Œ int envid; char cmd[200]; };//env.cstatic struct Job jobs[2000];void env_save_job(u_int envid, char *cmd) { jobs[job_cnt].envid = envid; strcpy(jobs[job_cnt].cmd, cmd); jobs[job_cnt].status = 1; job_cnt++;}void env_job_done(u_int envid) { for (int i = 0; i &lt; job_cnt; i++) { if (jobs[i].envid == envid) { jobs[i].status = 0; break; } }}int env_get_job(int i) { if (i &gt; job_cnt) { return -1; } return jobs[i - 1].envid;}void env_jobs() { char str[20]; for (int i = 0; i &lt; job_cnt; i++) { if (jobs[i].status == 0) { strcpy(str, &quot;Done&quot;); } else { strcpy(str, &quot;Running&quot;); } printk(&quot;[%d] %-10s 0x%08x %s\\n&quot;, i + 1, str, jobs[i].envid, jobs[i].cmd); }}//syscall_all.cvoid sys_env_save_job(u_int envid, char *cmd) { env_save_job(envid, cmd);}void sys_env_job_done(u_int envid) { env_job_done(envid);}int sys_env_get_job(int i) { return env_get_job(i);}void sys_env_jobs() { env_jobs();}//sh.cvoid jobs() { syscall_env_jobs();}void kill(int job_id) { int envid = syscall_env_get_job(job_id); if (envid == -1) { printf(&quot;fg: job (%d) do not exist\\n&quot;, job_id); return; } else if (envs[ENVX(envid)].env_status == ENV_FREE) { printf(&quot;fg: (0x%08x) not running\\n&quot;, envid); } else { syscall_env_destroy(envid); syscall_env_job_done(envid); }}void fg(int job_id) { int envid = syscall_env_get_job(job_id); if (envid == -1) { printf(&quot;fg: job (%d) do not exist\\n&quot;, job_id); return; } else if (envs[ENVX(envid)].env_status == ENV_FREE) { printf(&quot;fg: (0x%08x) not running\\n&quot;, envid); } else { wait(envid); }} fgå³ waitè¯¥ä»»åŠ¡å®Œæˆã€‚ åŒæ—¶ï¼Œè®¾ç½®å…¨å±€å˜é‡ job_flagï¼Œè¡¨ç¤ºè¯¥ä»»åŠ¡æ˜¯å¦ä¸ºåå°ä»»åŠ¡ï¼Œéœ€è¦è¿›è¡Œç®¡ç†ï¼Œåœ¨ runcmdä¸­å®Œæˆå†…ç½®æŒ‡ä»¤çš„å®ç°ï¼š 12345678910111213141516171819202122232425//sh.c runcmdelse if (strcmp(argv[0], &quot;jobs&quot;) == 0 &amp;&amp; argc == 1) { jobs(); close_all(); } else if (strcmp(argv[0], &quot;kill&quot;) == 0 &amp;&amp; argc == 2) { int ret = 0; char *s = argv[1]; while (*s) { ret = ret * 10 + (*s++ - '0'); } kill(ret); close_all(); } else if (strcmp(argv[0], &quot;fg&quot;) == 0 &amp;&amp; argc == 2) { int ret = 0; char *s = argv[1]; while (*s) { ret = ret * 10 + (*s++ - '0'); } syscall_env_job_done(ret); fg(ret); close_all(); } æ˜“é”™ç‚¹åŒæ—¶ï¼Œæœ‰å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼š 123456789101112//libos.c libmainsyscall_env_job_done(env-&gt;env_id); åœ¨æŒ‡ä»¤ç»“æŸå‰å°†ä»»åŠ¡è®¾ç½®ä¸ºDone//syscall_all.cint sys_cgetc(void) { int ch; //while ((ch = scancharc()) == 0) { //} ch = scancharc(); //Shell-Challenge return ch;}åˆ é™¤äº†é€ æˆå¿™ç­‰çš„æ­»å¾ªç¯ å®Œç»“æ’’èŠ±ï¼ï¼ï¼è‡³æ­¤ï¼ŒæŒ‘æˆ˜æ€§ä»»åŠ¡çš„æ‰€æœ‰åŠŸèƒ½å®ç°å®Œæ¯• å¿ƒè·¯å†ç¨‹ä»å¼€å§‹åˆ°ç»“æŸï¼Œæ€»è®¡135æ¬¡commit(è¶…è¿‡äº†OOä¸¤å­¦æœŸçš„commitæ€»å’Œ)ï¼Œç»ˆäºæ˜¯æŠŠShellåšå®Œäº†ï¼Œè™½ç„¶æ˜¯ä¸€ä¸ªæ®‹åºŸç‰ˆçš„shellï¼Œæ„Ÿè°¢ yezï¼Œzytï¼Œzxå‡ ä½å¤§ä½¬ï¼Œä»¥åŠåŠ©æ•™ shkä¸åŒå…¶çƒ¦åœ°è§£ç­”æˆ‘çš„ç–‘é—®ï¼Œæ˜¯ä½ ä»¬æ‹¯æ•‘äº†æˆ‘ç¾¸å¼±çš„OSï¼Œè¡·å¿ƒæ„Ÿè°¢","link":"/2025/08/14/challenge-shell/"},{"title":"OOç¬¬ä¸€å•å…ƒæ€»ç»“","text":"/* å¸¸ç”¨é¢œè‰²ç±» */ .text-cadetblue { color: CadetBlue !important; } .text-blue { color: #007bff !important; } .text-green { color: #28a745 !important; } .text-red { color: #DC143C !important; } .text-orange { color: #fd7e14 !important; } .text-purple { color: #6f42c1 !important; } .text-emphasis { color: #007bff; font-weight: bold; } .text-warning { color: #ffc107; font-weight: bold; } .text-success { color: #28a745; font-weight: bold; } .text-danger { color: #7835dc; font-weight: bold; } /* è­¦å‘Šæ¡†æ ·å¼ */ blockquote { position: relative; margin: 20px 0; padding: 16px 20px; border-left: 4px solid #007bff; background: #f8f9fa; border-radius: 0 6px 6px 0; font-style: normal; } blockquote[data-callout=\"important\"] { border-left-color: #7835dc; background: rgb(242, 241, 251); border-left-width: 6px; } blockquote[data-callout=\"important\"]::before { content: \"ğŸ’¬ é‡è¦\"; display: block; font-weight: bold; color: #7835dc; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } blockquote[data-callout=\"caution\"] { border-left-color: #ffc107; background: #fffbf0; border-left-width: 6px; } blockquote[data-callout=\"caution\"]::before { content: \"âš ï¸ æ³¨æ„\"; display: block; font-weight: bold; color: #b8860b; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } blockquote[data-callout=\"note\"] { border-left-color: #17a2b8; background: #f0f9ff; border-left-width: 6px; } blockquote[data-callout=\"note\"]::before { content: \"â„¹ï¸ æç¤º\"; display: block; font-weight: bold; color: #17a2b8; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } // å¤„ç†è­¦å‘Šæ¡† document.addEventListener('DOMContentLoaded', function() { const blockquotes = document.querySelectorAll('blockquote'); blockquotes.forEach(function(blockquote) { const firstParagraph = blockquote.querySelector('p:first-child'); if (firstParagraph) { const text = firstParagraph.textContent; const calloutMatch = text.match(/\\[!(IMPORTANT|CAUTION|NOTE)\\]/i); if (calloutMatch) { const calloutType = calloutMatch[1].toLowerCase(); blockquote.setAttribute('data-callout', calloutType); // ç§»é™¤æ ‡è®°æ–‡æœ¬ const cleanText = text.replace(/\\[![^\\]]+\\]\\s*/, ''); firstParagraph.textContent = cleanText; } } }); }); å‰è¨€å¤æ‚åº¦åˆ†æä½¿ç”¨IDEAçš„ MetricsReloadedæ’ä»¶ ä»£ç è§„æ¨¡åˆ†æåˆ©ç”¨IDEAçš„ staticæ’ä»¶ UMLç±»å›¾ä½¿ç”¨IDEAç»˜å›¾ï¼Œå†è‡ªè¡Œè°ƒæ•´ ä»»åŠ¡æ¦‚è§ˆä½œä¸šè¦æ±‚ ä½œä¸š1ï¼šæ ¹æ®å½¢å¼åŒ–å®šä¹‰è§£æè¾“å…¥çš„è¡¨è¾¾å¼ï¼Œè¾“å‡ºæ’ç­‰å˜å½¢å±•å¼€æ‹¬å·åçš„è¡¨è¾¾å¼ã€‚ ä½œä¸š2ï¼šå½¢å¼åŒ–å®šä¹‰åŠ å…¥æŒ‡æ•°å‡½æ•°å’Œè‡ªå®šä¹‰å‡½æ•°ã€‚ ä½œä¸š3ï¼šæ”¯æŒè‡ªå®šä¹‰å‡½æ•°åµŒå¥—å¹¶åŠ å…¥æ±‚å¯¼ç®—å­ã€‚ ç¬¬ä¸€æ¬¡ä½œä¸šç¬¬ä¸€æ¬¡ä½œä¸šä¸ºå¯¹åŒ…å«å¹‚å‡½æ•°ä¸å¸¸æ•°çš„è¡¨è¾¾å¼è¿›è¡ŒåŒ–ç®€ï¼Œæ¶‰åŠç›¸å¯¹ç®€å•çš„åµŒå¥—ï¼ŒUMLç±»å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚ æ¶æ„åˆ†æé€šè¿‡åˆ†æ Exprä¸ Termçš„ç»“æ„ã€‚æˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œä¸€ä¸ªåŸºæœ¬çš„ Exprå¯ä»¥çœ‹æˆåˆä¸€ä¸ªä¸ªåŸºå…ƒæ„æˆï¼Œå³ $$Expr = \\sum a \\times x ^ b$$ æ•°æ®å­˜å‚¨ä¸Šï¼Œä¾ç…§å½¢å¼åŒ–è¡¨è¾¾è®¾è®¡ä¸º Expr-&gt;Term-&gt;Factorã€‚Parserå’Œ Lexerä½œä¸ºå·¥å…·ç±»ï¼Œåˆ†åˆ«æ‰¿æ‹…å¥æ³•åˆ†æå’Œè¯æ³•åˆ†æçš„åŠŸèƒ½ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ¶æ„ä¸­äº‹å®ä¸Šæ²¡æœ‰åŒºåˆ† Numå’Œ Powerï¼Œè€Œæ˜¯å°†å…¶ç»Ÿä¸€ä¸º Unitç±»ï¼Œå­˜å‚¨ä¸€ä¸ªå½¢å¦‚$a \\times x ^ b$çš„å› å­ã€‚ åœ¨è¯»å–å’Œå­˜å‚¨è¿‡ç¨‹ä¸­ï¼ŒParserå’Œ Lexeråˆä½œï¼Œæ„å»ºäº†ä¸€æ£µå¤šå‰è¡¨è¾¾å¼æ ‘ã€‚ Factoræ¥å£ä¸ºå› å­ç±»çš„å…¬å…±æ¥å£ï¼Œæ‰€æœ‰çš„å› å­éƒ½å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œæ‰€æœ‰çš„é Unitç±»é€šè¿‡ Polyï¼Œå³å¤šé¡¹å¼ç±»è¿›è¡Œè¿ç®—ï¼Œæœ€åé€šè¿‡ Polyç±»è°ƒç”¨ Unitç±»çš„ toStringæ–¹æ³•å®ç°è¾“å‡ºã€‚ ä¸‹å›¾å±•ç¤ºäº†è¿™ç§è¯»å–å’Œå­˜å‚¨çš„è¿‡ç¨‹çš„ä¸€ä¸ªä¾‹å­ï¼š å…·ä½“è€Œè¨€ï¼Œè·å¾—ç­”æ¡ˆçš„è®¡ç®—è¿‡ç¨‹æ˜¯å’Œè¯»å–è§£æç›¸è§£è€¦åˆçš„ã€‚åœ¨è°ƒç”¨é¡¶å±‚ Exprå¯¹è±¡çš„ extend()æ–¹æ³•åï¼Œé€å±‚å‘ä¸‹è°ƒç”¨ extend()æ–¹æ³•ï¼Œå¾—åˆ°å±•å¼€å¼ã€‚è¿™å…¶ä¸­ï¼Œå¾—ç›Šäº Unitç±»çš„ç»Ÿä¸€æ€§ï¼Œæ¯ä¸€å±‚å‘ä¸Šè¿”å›çš„éƒ½æ˜¯ä¸€ä¸ª Unitå¯¹è±¡çš„é›†åˆï¼Œè¾¾åˆ°äº†å½¢å¼ä¸Šå’Œæ¥å£çš„ç»Ÿä¸€ã€‚ å¤æ‚åº¦åˆ†ææœ¬æ¬¡ä½œä¸šéƒ¨åˆ†æ–¹æ³•å¤æ‚åº¦å¦‚ä¸‹å›¾ï¼Œå…¶ä½™æ–¹æ³•å¤æ‚åº¦è¾ƒä½ï¼Œæœªåœ¨å›¾ä¸­ä½“ç°ã€‚ å¯ä»¥çœ‹åˆ°ï¼ŒParserä¸­çš„ parseFactor()æ–¹æ³•å¤æ‚åº¦è¾ƒé«˜ï¼Œåˆ†æåŸå› çŸ¥ï¼Œè®¾è®¡è¯¥æ–¹æ³•æ—¶å¯¹äºå¸¸æ•°å’Œå¹‚å‡½æ•°çš„è§£æéƒ½å…¨éƒ¨åˆ—åœ¨å…¶ä¸­ï¼Œæ²¡æœ‰åˆ†åˆ«æŠ½è±¡ä¸ºåˆ†åˆ«çš„æ–¹æ³•ï¼›Unitä¸­çš„ toString()æ–¹æ³•å¤æ‚åº¦è¾ƒé«˜ï¼Œä¸ºäº†ä¼˜åŒ–è¾“å‡ºçš„é•¿åº¦å¯¼è‡´ç‰¹åˆ¤è¾ƒå¤šï¼Œå¤æ‚åº¦è¾ƒé«˜ã€‚ Method CogC ev(G) iv(G) v(G) Parser.parseFactor() 14 1 8 8 Parser.parseExpr() 8 1 6 6 expr.Unit.toString() 7 1 6 7 Lexer.next() 6 2 4 6 expr.Expr.extend() 6 2 6 6 expr.Poly.toString() 5 4 3 5 expr.Term.extend() 5 1 4 4 Parser.parseTerm() 4 1 4 4 expr.Poly.multiUnit(Unit) 4 1 3 3 expr.Poly.Merge() 3 1 3 3 expr.Poly.adjustUnit() 3 3 2 3 expr.Poly.multiExpr(Poly) 3 1 3 3 Lexer.getNumber() 2 1 3 3 Parser.getExp() 1 1 2 2 Processor.treatPlusMinus() 1 1 2 2 expr.Poly.Negate() 1 1 2 2 Lexer.Lexer(String) 0 1 1 1 Lexer.peek() 0 1 1 1 Main.main(String[]) 0 1 1 1 Parser.Parser(Lexer) 0 1 1 1 Processor.adjustSign() 0 1 1 1 Processor.consumeBlank() 0 1 1 1 Processor.getString(String) 0 1 1 1 Processor.newInput(String) 0 1 1 1 Processor.outputString() 0 1 1 1 Processor.replaceDoubleStar() 0 1 1 1 expr.Expr.Negate() 0 1 1 1 expr.Expr.addTerm(Term) 0 1 1 1 expr.Expr.equals(Expr) 0 1 1 1 expr.Expr.setExp(BigInteger) 0 1 1 1 expr.Poly.Poly() 0 1 1 1 expr.Poly.add(Poly) 0 1 1 1 expr.Poly.createOne() 0 1 1 1 expr.Poly.unitMulti(Unit, Unit) 0 1 1 1 expr.Term.Negate() 0 1 1 1 expr.Term.addFactor(Factor) 0 1 1 1 expr.Unit.Negate() 0 1 1 1 expr.Unit.Unit(BigInteger) 0 1 1 1 expr.Unit.Unit(Type) 0 1 1 1 expr.Unit.canMerge(Unit) 0 1 1 1 expr.Unit.compareTo(Unit) 0 1 1 1 expr.Unit.getCoff() 0 1 1 1 expr.Unit.getExp() 0 1 1 1 expr.Unit.getType() 0 1 1 1 expr.Unit.merge(Unit) 0 1 1 1 expr.Unit.multiUnit(Unit) 0 1 1 1 expr.Unit.setCoff(BigInteger) 0 1 1 1 expr.Unit.setExp(BigInteger) 0 1 1 1 Bugåˆ†ææœ¬æ¬¡ä½œä¸šæ²¡æœ‰å‡ºç°bugã€‚ åœ¨å¯¹roomå†…å…¶ä»–åŒå­¦äº’æµ‹æ—¶ï¼Œå‘ç°ä¸¤ä¸ªbugï¼šä¸€ä¸ªæ˜¯æ²¡æœ‰å¤„ç†$0$çš„è¾“å‡ºï¼›å¦ä¸€ä¸ªæ˜¯æ²¡æœ‰å¦¥å–„å¤„ç†è¡¨è¾¾å¼é‡Œçš„ \\tå’Œç©ºæ ¼ã€‚ åŒæ—¶ï¼Œæˆ‘åœ¨æ­¤æ¬¡ä½œä¸šä¸­è®¾è®¡å¹¶å®ç°äº†ä¸€ä¸ªè‡ªåŠ¨åŒ–è¯„æµ‹æœºï¼Œè¿™å¯¹æ£€éªŒç¨‹åºçš„æ­£ç¡®æ€§æœ‰ä¸å°çš„å¸®åŠ©ï¼Œä¹Ÿå¸®åŠ©æˆ‘å®ç°äº†hackï¼Œè¯¦ç»†çš„åˆ†æå°†åœ¨è¯„æµ‹éƒ¨åˆ†ä»‹ç»ã€‚ æ€»ç»“â€œå·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨â€ åœ¨å†™æœ¬æ¬¡ä½œä¸šä¹‹åˆï¼Œæˆ‘è®¾è®¡è¿‡å¾ˆå¤šæ¶æ„ï¼Œåœ¨è®¾è®¡é˜¶æ®µå°±æ¨å€’é‡æ¥è‹¥å¹²æ¬¡ã€‚å°½ç®¡åœ¨Preä¸­çš„å†’é™©è€…æ¸¸æˆä¸­å·²ç»æˆ‘åˆæ­¥é¢†ä¼šäº†é¢å‘å¯¹è±¡çš„æ€æƒ³ï¼Œä½†æ˜¯é¢å¯¹è¾ƒä¸ºæŠ½è±¡çš„è¡¨è¾¾å¼è§£æä»ç„¶æ˜¾å¾—æ‰è¥Ÿè§è‚˜ã€‚ å°½ç®¡å¦‚æ­¤ï¼Œå¾—ç›Šäº trainingéƒ¨åˆ†æä¾›çš„ Parserå’Œ Lexeræ€è·¯ï¼Œæˆ‘æœ€ç»ˆå¾—ä»¥ç¡®å®šè¿™ä¸ªè¾ƒä¸ºé¢å‘å¯¹è±¡çš„è®¾è®¡ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªæ¶æ„ä¾ç„¶å­˜åœ¨ç›¸å½“çš„ä¸è¶³ï¼Œåœ¨åé¢çš„è¿­ä»£å¼€å‘ä»‹ç»ä¸­å°†ä¼šç€é‡ä»‹ç»ã€‚ ç¬¬äºŒæ¬¡ä½œä¸šç›¸æ¯”äºç¬¬ä¸€æ¬¡ä½œä¸šï¼Œç¬¬äºŒæ¬¡ä½œä¸šæ–°å¢äº†è‡ªå®šä¹‰å‡½æ•°ä¸æŒ‡æ•°å‡½æ•°ç›¸å…³çš„å†…å®¹ï¼ŒåŒæ—¶æ”¯æŒåµŒå¥—æ‹¬å·çš„è§£æã€‚ ç›¸æ¯”ç¬¬ä¸€æ¬¡ä½œä¸šï¼Œå¢åŠ äº† Funcç±»å¤„ç†è‡ªå®šä¹‰å‡½æ•°ï¼ŒåŒæ—¶å¢åŠ äº† Expç±»å¤„ç†æŒ‡æ•°å‡½æ•°ï¼ŒUMLç±»å›¾å¦‚ä¸‹ï¼š æ¶æ„åˆ†æç›¸è¾ƒäºä¸Šä¸€æ¬¡ä½œä¸šä»¥åŠæœªæ¥çš„ç¬¬ä¸‰æ¬¡ä½œä¸šï¼Œæœ¬æ¬¡ä½œä¸šçš„å·¥ä½œé‡æ— ç–‘æ˜¯æœ€å¤§çš„ï¼Œä¹Ÿéš¾æ€ªçºªä¸€é¹è€å¸ˆè¯´è¿™æ¬¡ä½œä¸šå¾ˆæœ‰å¯èƒ½ä¼šæ˜¯æœ¬å­¦æœŸOOçš„éš¾åº¦å·…å³°ã€‚ å¯¹äºæœ¬æ¬¡ä½œä¸šçš„ä¸¤ä¸ªæ–°å¢è¦æ±‚ï¼Œæˆ‘å…ˆå®Œæˆäº†è‡ªå®šä¹‰å‡½æ•°çš„å®ç°ï¼Œå†å®Œæˆäº†æŒ‡æ•°å‡½æ•°çš„éƒ¨åˆ†ã€‚ è‡ªå®šä¹‰å‡½æ•°éƒ¨åˆ†è‡ªå®šä¹‰å‡½æ•°åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€æ˜¯è¯»å…¥ï¼ŒäºŒæ˜¯è°ƒç”¨ã€‚ æœ‰å…³è¯»å…¥ï¼Œç”±äºå‡½æ•°å®šä¹‰å¼ä¾ç„¶ç¬¦åˆæˆ‘ä»¬çš„å¤šé¡¹å¼è¯­æ„ï¼Œä¸”å®šä¹‰å¼å†…ä¸å…è®¸å¾ªç¯å®šä¹‰ï¼Œæ•…è€Œç›´æ¥æ²¿ç”¨ä¸Šä¸€æ¬¡çš„ Lexerå’Œ Parseræ¥è§£æã€‚ æœ‰å…³è°ƒç”¨ï¼Œæˆ‘åœ¨è¯»å…¥è¡¨è¾¾å¼æ—¶ï¼Œå°±å»ºç«‹äº†å‚æ•°ä¸å®å‚çš„Mapï¼Œåœ¨è§£ææ—¶åˆ©ç”¨Mapä¸­çš„Map.Entryæ¥å£è¿›è¡Œæ›¿æ¢ï¼Œæ•ˆæœä¸é”™ï¼Œä½†æ˜¯ç›¸è¾ƒæ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢çš„æ–¹æ³•ï¼Œè™½ç„¶æ­£ç¡®æ€§ä¸Šæœ‰ä¿éšœï¼Œä½†æ˜¯æ—¶é—´å¤æ‚åº¦è¾ƒé«˜ã€‚ æŒ‡æ•°å‡½æ•°éƒ¨åˆ†é€šè¿‡åˆ†ææœ¬æ¬¡å¼å­å¯çŸ¥ï¼Œæœ¬æ¬¡åŸºå…ƒæœ‰æ‰€æ›´æ–° $$Expr = \\sum a \\times x ^ b \\times exp(Factor) ^ c$$ ç”±äºæŒ‡æ•°å‡½æ•°çš„ç‰¹æ®Šæ€§ï¼Œæ•…æˆ‘ç›´æ¥åœ¨åˆå§‹åŒ–æŒ‡æ•°å‡½æ•°æ—¶ç›´æ¥å°†åŸºå…ƒå˜å½¢æˆå¦‚ä¸‹å¼å­ï¼Œä¾¿äºåç»­è®¡ç®—ï¼š $$Expr = \\sum a \\times x ^ b \\times exp(Factor \\times c)$$ åŒæ ·ï¼Œæˆ‘åˆ©ç”¨Polyç±»çš„ toStringæ–¹æ³•å’ŒStringç±»çš„equalsæ–¹æ³•åˆ¤æ–­expå†…çš„Factoræ˜¯å¦ç›¸ç­‰ï¼Œæ¥è¿›è¡Œåç»­åˆå¹¶ã€‚ å¤æ‚åº¦åˆ†æ Method CogC ev(G) iv(G) v(G) Term.replace(HashMap&lt;Type, Factor&gt;) 30 1 8 8 Parser.parseFactor() 19 1 12 12 Unit.isSimple() 11 7 9 15 Unit.toString() 11 1 9 10 Unit.setExp(BigInteger) 10 1 4 8 Lexer.next() 9 2 5 7 Parser.parseExpr() 8 1 6 6 Unit.compareTo(Unit) 8 7 7 8 Exp.ifOne() 7 5 2 5 Expr.extend() 6 2 6 6 Poly.Merge() 6 1 5 5 Func.invoke(List &lt;Factor&gt;) 5 1 2 4 Poly.toString() 5 4 3 5 Term.extend() 5 1 4 4 Parser.parseTerm() 4 1 4 4 Poly.multiUnit(Unit) 4 1 3 3 Poly.unitMulti(Unit, Unit) 4 1 5 5 Unit.multiUnit(Unit) 4 1 4 5 Unit.wipeExp() 4 4 1 5 Exp.Exp(Factor) 3 1 3 4 Exp.toString() 3 1 3 3 Poly.adjustUnit() 3 3 2 3 Poly.multiExpr(Poly) 3 1 3 3 Unit.Unit(Type) 3 1 1 4 Unit.replace(HashMap&lt;Type, Factor&gt;) 3 3 3 4 Exp.replace(HashMap&lt;Type, Factor&gt;) 2 1 2 2 Lexer.getNumber() 2 1 3 3 Parser.parseFuncDef() 2 1 3 3 Poly.isSimple() 2 3 1 3 Unit.clone() 2 1 3 3 Expr.clone() 1 1 2 2 Expr.pow(BigInteger) 1 1 2 2 Expr.replace(HashMap&lt;Type, Factor&gt;) 1 1 2 2 Main.main(String[]) 1 1 2 2 Parser.getExp() 1 1 2 2 Parser.parseFunc() 1 1 2 2 Poly.Negate() 1 1 2 2 Poly.clone() 1 1 2 2 Poly.pow(BigInteger) 1 1 2 2 Processor.treatPlusMinus() 1 1 2 2 Term.clone() 1 1 2 2 Exp.clone() 0 1 1 1 Exp.compareTo(Exp) 0 1 1 1 Exp.equals(Exp) 0 1 1 1 Exp.getExponent() 0 1 1 1 Exp.isSimple() 0 1 1 1 Exp.multExp(Exp) 0 1 1 1 Exp.pow(BigInteger) 0 1 1 1 Exp.setExponent(BigInteger) 0 1 1 1 Expr.Negate() 0 1 1 1 Expr.addExpr(Expr) 0 1 1 1 Expr.addTerm(Term) 0 1 1 1 Expr.equals(Expr) 0 1 1 1 Expr.setExp(BigInteger) 0 1 1 1 Func.Func(String, Character[]) 0 1 1 1 Lexer.Lexer(String) 0 1 1 1 Lexer.peek() 0 1 1 1 Parser.Parser(Lexer) 0 1 1 1 Poly.Poly() 0 1 1 1 Poly.add(Poly) 0 1 1 1 Poly.createOne() 0 1 1 1 Poly.isEmpty() 0 1 1 1 Processor.adjustSign() 0 1 1 1 Processor.consumeBlank() 0 1 1 1 Processor.getString(String) 0 1 1 1 Processor.newInput(String) 0 1 1 1 Processor.outputString() 0 1 1 1 Processor.replaceDoubleStar() 0 1 1 1 Term.Negate() 0 1 1 1 Term.addFactor(Factor) 0 1 1 1 Term.pow(BigInteger) 0 1 1 1 Unit.Negate() 0 1 1 1 Unit.Unit(BigInteger) 0 1 1 1 Unit.Unit(Type, Factor) 0 1 1 1 Unit.canMerge(Unit) 0 1 1 1 Unit.getCoff() 0 1 1 1 Unit.getExp() 0 1 1 1 Unit.getExpFunc() 0 1 1 1 Unit.getType() 0 1 1 1 Unit.merge(Unit) 0 1 1 1 Unit.pow(BigInteger) 0 1 1 1 Unit.setCoff(BigInteger) 0 1 1 1 Unit.setExpFunc(Exp) 0 1 1 1 Unit.setType(Type) 0 1 1 1 å¯ä»¥çœ‹å‡ºï¼Œæœ¬æ¬¡æ¶æ„åœ¨Termç±»ä¸­å®ç°è‡ªå®šä¹‰å‡½æ•°çš„æ›¿æ¢éƒ¨åˆ†çš„ replaceæ–¹æ³•å¤æ‚åº¦æé«˜ï¼Œåœ¨Debugè¿‡ç¨‹ä¸­ï¼Œä¹ŸåŒæ ·æ˜¯è¿™ä¸ªæ–¹æ³•è€—å»äº†æˆ‘å¤§é‡çš„æ—¶é—´ï¼Œå¯è§è¶Šå¤æ‚ï¼Œè¶Šæ˜“é”™ï¼ï¼ï¼ Bugåˆ†ææœ¬æ¬¡ä½œä¸šæ²¡æœ‰å‡ºç°bugã€‚ åœ¨å¯¹roomå†…å…¶ä»–åŒå­¦äº’æµ‹æ—¶ï¼Œå‘ç°ä¸¤ä¸ªbugï¼šä¸€ä¸ªæ˜¯å¯¹äºexpçš„æ‹¬å·åŒ–ç®€å‡ºé”™ï¼›å¦ä¸€ä¸ªæ˜¯è‡ªå®šä¹‰å‡½æ•°ä¸­expå‡½æ•°æ›¿æ¢å‡ºé”™ã€‚ åœ¨æœ¬æ¬¡hackè¿‡ç¨‹ä¸­ï¼Œæˆ‘ç€é‡æŸ¥çœ‹äº†åŒå±‹åŒå­¦ä»£ç æ¶æ„çš„å¤æ‚ç¨‹åº¦è¿›è¡Œäº†åˆ†æï¼Œå¯¹äºæ˜æ˜¾æ¶æ„å¤æ‚çš„ä»£ç è¿›è¡Œhackï¼Œéƒ½å¾—åˆ°äº†æˆåŠŸã€‚ å…·ä½“çš„hackæ–¹æ³•åˆ™æ˜¯åˆ©ç”¨cxcåŒå­¦çš„è¯„æµ‹æœºï¼Œå¯¹äºå¯ç–‘ä»£ç è¿›è¡Œè¯„æµ‹ï¼Œå¾—åˆ°é”™è¯¯è¾“å‡ºåé’ˆå¯¹æ•°æ®è¿›è¡ŒåŒ–ç®€ä½¿å…¶ç¬¦åˆäº’æµ‹æ•°æ®é™åˆ¶ï¼Œæœ€ç»ˆhackæˆåŠŸã€‚ æ€»ç»“ç¬¬äºŒæ¬¡ä½œä¸šæ˜¯æˆ‘åœ¨ç¬¬ä¸€å•å…ƒä¸­èŠ±è´¹æ—¶é—´æœ€é•¿çš„ä¸€æ¬¡ï¼Œå°¤å…¶æ˜¯æŒ‡æ•°å‡½æ•°çš„å¼•å…¥ä¸åŒ–ç®€åˆå¹¶ï¼Œåœ¨Debugæ—¶ç»™æˆ‘é€ æˆäº†ä¸å°çš„å›°éš¾ï¼Œç”±äºåœ¨å®Œæˆæœ¬æ¬¡ä½œä¸šæ—¶æµæ„Ÿå‘çƒ§ï¼Œå› æ­¤æˆ‘åœ¨ä¼˜åŒ–æ–¹é¢ä»…ä»…åšäº†åˆå¹¶åŒç±»é¡¹å’Œå»expå‡½æ•°çš„å¤šä½™æ‹¬å·ï¼Œä½†æ€§èƒ½åˆ†ä¸Šå–å¾—äº† 97.5åˆ†ï¼Œå¯ä»¥è¯´æ˜¯ååˆ†ä¾¥å¹¸çš„ã€‚åŒæ—¶ï¼Œç”±äºå‚¨å­˜åŸºå…ƒæ—¶é‡‡ç”¨äº†ArrayListï¼Œå› æ­¤åœ¨åˆå¹¶åŒç±»é¡¹ä¸Unitè¿ç®—æ—¶è¢«è¿«ä½¿ç”¨æ·±å…‹éš†ï¼Œè€Œç”±äºèº«ä½“çŠ¶æ€ä¸ä½³ï¼Œå¤„äºæ­£ç¡®æ€§è€ƒè™‘ï¼Œæˆ‘å¤§é‡ä½¿ç”¨å…‹éš†ï¼Œè¿™ä¹Ÿä½¿æˆ‘çš„ç¨‹åºè¿è¡Œæ—¶é—´å¤§å¤§å¢é•¿ã€‚ ç¬¬ä¸‰æ¬¡ä½œä¸šæœ¬æ¬¡ä½œä¸šå¼•å…¥äº†æ±‚å¯¼å› å­ã€‚æœ¬ä»¥ä¸ºæ˜¯æœ€ç—›è‹¦çš„ä¸€é›†ï¼Œæ²¡æƒ³åˆ°æˆäº†æœ€é€Ÿçš„ä¸€é›†ã€‚UMLç±»å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š æ¶æ„åˆ†æä¸ç¬¬äºŒæ¬¡ä½œä¸šç›¸æ¯”ï¼Œæœ¬æ¬¡ä½œä¸šæ¶æ„å‡ ä¹æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œæ²¡æœ‰å¼•å…¥æ–°çš„ç±»ã€‚å¯¹äºæ±‚å¯¼æ“ä½œï¼Œä¸æ±‚å­—ç¬¦ä¸²ç›¸ä¼¼ï¼Œåœ¨æ¯ä¸€ä¸ªç›¸å…³çš„ç±»ä¸­å¼•å…¥getDerivative()æ–¹æ³•ï¼Œè¿”å›Polyå¤šé¡¹å¼ç±»ã€‚å¯¹äºå¸¦å‡½æ•°çš„æ±‚å¯¼ï¼Œé‡‡ç”¨å°†è‡ªå®šä¹‰å‡½æ•°å®Œå…¨å±•å¼€åå†è¿›è¡Œæ±‚å¯¼çš„æ–¹æ³•ã€‚ å¤æ‚åº¦åˆ†æ Method CogC ev(G) iv(G) v(G) Term.replace(HashMap&lt;Type, Factor&gt;) 30 1 8 8 Parser.parseFactor() 20 1 13 13 Unit.isSimple() 11 7 9 15 Unit.toString() 11 1 9 10 Lexer.next() 10 2 6 8 Unit.setExp(BigInteger) 10 1 4 8 Parser.parseExpr() 8 1 6 6 Unit.compareTo(Unit) 8 7 7 8 Exp.ifOne() 7 5 2 5 Expr.extend() 6 2 6 6 Poly.Merge() 6 1 5 5 Func.invoke(List &lt;Factor&gt;) 5 1 2 4 Main.main(String[]) 5 3 4 5 Poly.toString() 5 4 3 5 Term.extend() 5 1 4 4 Parser.parseTerm() 4 1 4 4 Poly.multiUnit(Unit) 4 1 3 3 Unit.multiUnit(Unit) 4 1 4 5 Unit.wipeExp() 4 4 1 5 Exp.Exp(Factor) 3 1 3 4 Exp.toString() 3 1 3 3 Parser.parseDerivative() 3 1 4 4 Poly.adjustUnit() 3 3 2 3 Poly.compareTo(Poly) 3 3 3 3 Poly.multiExpr(Poly) 3 1 3 3 Unit.Unit(Type) 3 1 1 4 Unit.replace(HashMap&lt;Type, Factor&gt;) 3 3 3 4 Exp.clone() 2 1 1 2 Exp.replace(HashMap&lt;Type, Factor&gt;) 2 1 2 2 Lexer.getNumber() 2 1 3 3 Parser.parseFuncDef() 2 1 3 3 Poly.isSimple() 2 3 1 3 Unit.clone() 2 1 3 3 Unit.getDerivative(Type) 2 1 3 3 Exp.getDerivative(Type) 1 2 1 2 Expr.clone() 1 1 2 2 Expr.pow(BigInteger) 1 1 2 2 Expr.replace(HashMap&lt;Type, Factor&gt;) 1 1 2 2 Parser.getExp() 1 1 2 2 Parser.parseFunc() 1 1 2 2 Poly.Negate() 1 1 2 2 Poly.clone() 1 1 2 2 Poly.getDerivative(Type) 1 1 2 2 Poly.pow(BigInteger) 1 1 2 2 Poly.toTerms() 1 1 2 2 Processor.treatPlusMinus() 1 1 2 2 Term.clone() 1 1 2 2 Exp.compareTo(Exp) 0 1 1 1 Exp.equals(Exp) 0 1 1 1 Exp.getExponent() 0 1 1 1 Exp.isSimple() 0 1 1 1 Exp.multExp(Exp) 0 1 1 1 Exp.pow(BigInteger) 0 1 1 1 Exp.setExponent(BigInteger) 0 1 1 1 Expr.Expr() 0 1 1 1 Expr.Expr(Poly) 0 1 1 1 Expr.Negate() 0 1 1 1 Expr.addExpr(Expr) 0 1 1 1 Expr.addTerm(Term) 0 1 1 1 Expr.equals(Expr) 0 1 1 1 Expr.getDerivative(Type) 0 1 1 1 Expr.setExp(BigInteger) 0 1 1 1 Func.Func(String, Character[]) 0 1 1 1 Lexer.Lexer(String) 0 1 1 1 Lexer.peek() 0 1 1 1 Parser.Parser(Lexer) 0 1 1 1 Poly.Poly() 0 1 1 1 Poly.add(Poly) 0 1 1 1 Poly.addUnit(Unit) 0 1 1 1 Poly.createOne() 0 1 1 1 Poly.isEmpty() 0 1 1 1 Poly.unitMulti(Unit, Unit) 0 1 1 1 Processor.adjustSign() 0 1 1 1 Processor.consumeBlank() 0 1 1 1 Processor.getString(String) 0 1 1 1 Processor.newInput(String) 0 1 1 1 Processor.outputString() 0 1 1 1 Processor.replaceDoubleStar() 0 1 1 1 Term.Negate() 0 1 1 1 Term.addFactor(Factor) 0 1 1 1 Term.pow(BigInteger) 0 1 1 1 Unit.Negate() 0 1 1 1 Unit.Unit(BigInteger) 0 1 1 1 Unit.Unit(Type, Factor) 0 1 1 1 Unit.canMerge(Unit) 0 1 1 1 Unit.getCoff() 0 1 1 1 Unit.getExp() 0 1 1 1 Unit.getExpFunc() 0 1 1 1 Unit.getType() 0 1 1 1 Unit.merge(Unit) 0 1 1 1 Unit.pow(BigInteger) 0 1 1 1 Unit.setCoff(BigInteger) 0 1 1 1 Unit.setExpFunc(Exp) 0 1 1 1 Unit.setType(Type) 0 1 1 1 Unit.simpleClone() 0 1 1 1 ä¸ç¬¬äºŒæ¬¡ä½œä¸šä¸­å¤æ‚åº¦è¾ƒé«˜çš„æ–¹æ³•ç›¸åŒï¼ŒåŸå› ä¸€è‡´ã€‚ Bugåˆ†ææœ¬æ¬¡ä½œä¸šåœ¨å¼ºæµ‹ä¸­æœªå‡ºç°Bugï¼Œä½†æ˜¯åœ¨äº’æµ‹ä¸­ç”±äºTLEä¸­åˆ€ï¼ŒåŸå› æ­£å¦‚æˆ‘åœ¨ç¬¬äºŒæ¬¡ä½œä¸šæ€»ç»“ä¸­å†™çš„é‚£æ ·â€”â€”æ— è„‘å…‹éš†ï¼Œè€Œå…‹éš†æ–¹æ³•æœ¬èº«éœ€è¦é€’å½’ï¼Œå¯¼è‡´æœ€ç»ˆè¶…æ—¶ï¼Œè¿™ä¹Ÿæ˜¯ç”±äºæˆ‘ä¸ªäººçš„ä¾¥å¹¸å¿ƒç†ï¼Œè®¤ä¸ºäº’æµ‹æ•°æ®ä¸å¼ºï¼Œåœ¨æ˜çŸ¥æœ‰è¶…æ—¶é£é™©æ—¶ï¼Œé€‰æ‹©å†™OSä½œä¸šï¼Œæœªè¿›è¡Œä¼˜åŒ–ã€‚è™½ç„¶å¼ºæµ‹ä¾¥å¹¸è¿‡å…³ï¼Œä½†æ˜¯åœ¨äº’æµ‹ä¸­è¿˜æ˜¯æ¼äº†é©¬è„šï¼Œæœç„¶è¿˜æ˜¯è¿™ä¸ªé“ç†ã€‚ She was still too young to know that life never gives anything for nothing, and that a price is always exacted for what fate bestows. é‚£æ—¶å€™å¥¹è¿˜å¤ªå¹´è½»ï¼Œä¸çŸ¥é“æ‰€æœ‰å‘½è¿é¦ˆèµ çš„ç¤¼ç‰©ï¼Œæ—©å·²åœ¨æš—ä¸­æ ‡å¥½äº†ä»·æ ¼ã€‚ â€”â€”èŒ¨å¨æ ¼ æ€»ç»“ç¬¬ä¸‰æ¬¡ä½œä¸šä¸ä»…æ²¡æœ‰æƒ³è±¡ä¸­å¯æ€•ï¼Œè¿˜æ˜¯ä¸‰æ¬¡ä½œä¸šä¸­è€—æ—¶æœ€å°‘çš„ä¸€æ¬¡ã€‚å¾—ç›Šäºå±‚æ¬¡åŒ–ç»“æ„çš„è®¾è®¡ï¼Œæ–°å¢æ±‚å¯¼è¿ç®—çš„å‡çº§è¿‡ç¨‹éå¸¸é¡ºåˆ©ï¼Œå”¯ä¸€çš„æ³¨æ„ç‚¹æ˜¯æ•°å­¦ä¸Šçš„æ±‚å¯¼æ³•åˆ™ï¼Œéœ€è¦åœ¨ç¼–ç æ—¶ä¸¥æ ¼éµå®ˆã€‚åªæ˜¯å¯æƒœæˆ‘çš„ä¾¥å¹¸å¿ƒç†å¯¼è‡´äº’æµ‹ä¸­åˆ€ï¼Œç°åœ¨æƒ³æ¥ä»ç„¶æ„Ÿåˆ°æ·±æ·±å¯æƒœï¼ï¼ï¼ æµ‹è¯•æœ¬å•å…ƒç”±äºèº«ä½“çŠ¶å†µä¸ä¸ªäººæ—¶é—´çš„å…³ç³»ï¼Œåªåœ¨ç¬¬ä¸€æ¬¡ä½œä¸šæ­å»ºäº†è¯„æµ‹æœºï¼Œåç»­ä½¿ç”¨äº†cxcåŒå­¦çš„è¯„æµ‹æœºï¼Œè¿™é‡Œå†æ¬¡æ„Ÿè°¢cxcåŒå­¦ï¼ï¼ï¼ åœ¨ä¸ªäººæ­å»ºè¯„æµ‹æœºçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¸»è¦è¿˜æ˜¯ä½¿ç”¨æ¨¡æ‹Ÿé€’å½’ä¸‹é™çš„è¿‡ç¨‹æ„å»ºæµ‹è¯•æ•°æ®ï¼Œå¹¶åˆ©ç”¨ Pythonä¸­çš„ SympyåŒ…æ¥è¾¾åˆ°åŒ–ç®€è¡¨è¾¾å¼å¹¶åˆ¤æ–­æ­£è¯¯çš„æ•ˆæœï¼Œå”¯ä¸€çš„ç¼ºç‚¹æ˜¯é€Ÿåº¦å¤ªæ…¢ã€‚åŒæ—¶ï¼Œæˆ‘åœ¨æ„å»ºè¯„æµ‹æ•°æ®æ—¶ç‰¹æ„åŠ å…¥äº†è¯¸å¦‚ x-x,+00000ç­‰æ•°æ®ï¼Œæ¥ä¿è¯éšæœºç”Ÿæˆæ•°æ®çš„ç‰¹æ®Šæ€§ï¼Œä½†æ˜¯åªæ˜¯å¯æƒœè¯„æµ‹æœºhackæ•ˆæœä¸ä½³ï¼Œæ›´å¤šè¿˜æ˜¯é æ‰‹åŠ¨æ„å»ºæ•°æ®ã€‚ å¿ƒå¾—ä½“ä¼šç¬¬ä¸€å•å…ƒå°±è¿™æ ·ç—›å¹¶å¿«ä¹åœ°åšæŒäº†è¿‡å»ï¼Œä½†æ˜¯å’ŒåŒå­¦ä»¬æŠ•å…¥çš„æ—¶é—´ç›¸æ¯”ï¼Œæˆ‘å¥½åƒå®Œæˆå¾—è¿˜ç®—è½»æ¾ï¼ˆ?ï¼‰ é€šè¿‡è¡¨è¾¾å¼è§£æçš„ç»ƒä¹ ï¼Œæˆ‘æ·±åˆ»ä½“ä¼šäº†é¢å‘å¯¹è±¡çš„è®¾è®¡æ€æƒ³ï¼Œäº†è§£äº†é€’å½’ä¸‹é™çš„è§£ææ–¹æ³•ï¼Œåˆæ­¥å°è¯•äº†å±‚æ¬¡åŒ–çš„ç±»è®¾è®¡ï¼Œè¿™ä¹Ÿä¸ºOSçš„Lab1æä¾›äº†ä¸€äº›å¸®åŠ©ã€‚ æœ€åè¿˜æ˜¯æ„Ÿæ…¨ï¼šè®¾è®¡ä¸ºå…ˆï¼Œä¸€ä¸ªå¥½çš„è®¾è®¡èƒ½ä¸ºåç»­çš„ç¼–ç å·¥ä½œçœå»ä¸å°‘éº»çƒ¦ï¼›å°±æ¯”å¦‚ï¼Œæ¯æ¬¡ä½œä¸šå‰ï¼Œæˆ‘éƒ½è¦èŠ±ä¸Šä¸€å¤©åŠæ¥è¿›è¡Œè®¾è®¡ï¼Œè€Œä¸æ˜¯åŸºäºä¸Šæ‰‹ç¼–ç ï¼Œå¦åˆ™ä»£ç å¿…ç„¶æ˜¯æ¼æ´ç™¾å‡ºã€‚æ­¤å¤–ï¼Œè¿˜å¿…é¡»æ³¨é‡å¯æ‰©å±•æ€§ï¼Œå³åœ¨å½“å‰è®¾è®¡ä¸­æ‰“ä¸€ä¸ªæå‰é‡ï¼Œç»™æœªæ¥å¯èƒ½å¼•å…¥çš„è®¾è®¡æå‰é¢„ç•™ä¸€äº›ç©ºé—´ã€‚ æ‰“ä¸ªæ¯”æ–¹ï¼Œæˆ‘çš„ç¨‹åºåœ¨ç¬¬ä¸€æ¬¡å°±æ”¯æŒæ‹¬å·åµŒå¥—ï¼Œç¬¬äºŒæ¬¡å°±æ”¯æŒè‡ªå®šä¹‰å‡½æ•°åµŒå¥—ï¼Œç°åœ¨ç¬¬ä¸‰æ¬¡ä½œä¸šçš„ç¨‹åºè¿˜æ”¯æŒå¤šå˜é‡è¿ç®—ä¸æ±‚å¯¼ç­‰ç­‰ã€‚ æœªæ¥æ–¹å‘æ€»ä½“è€Œè¨€ï¼Œæˆ‘è®¤ä¸ºè¯¾ç¨‹ç»„å¯¹äºç¬¬ä¸€å•å…ƒçš„è®¾ç½®å·²ç›¸å¯¹å®Œå¤‡ï¼Œä½†æ˜¯ç¬¬ä¸‰æ¬¡ä½œä¸šç›¸è¾ƒå‰ä¸¤æ¬¡æ˜æ˜¾è¿‡äºè½»æ¾ï¼Œæˆ‘è®¤ä¸ºå¯ä»¥åŠ å…¥å¤šå˜é‡è¿ç®—ä¸æ±‚å¯¼ç­‰è¦æ±‚ã€‚åŒæ ·ï¼Œæˆ‘è®¤ä¸ºå¼ºæµ‹åº”è¯¥è®¾ç½®ä¸“é—¨æ•°æ®æ¥å¡æ—¶é—´å¤æ‚åº¦ï¼Œè¿™æ ·å°±èƒ½ç‹ ç‹ æ•´æ²»å‘æˆ‘è¿™æ ·å¿ƒå­˜ä¾¥å¹¸çš„åŒå­¦ï¼ï¼ï¼","link":"/2025/08/13/OO-1/"},{"title":"OOç¬¬ä¸‰å•å…ƒæ€»ç»“","text":"/* å¸¸ç”¨é¢œè‰²ç±» */ .text-cadetblue { color: CadetBlue !important; } .text-blue { color: #007bff !important; } .text-green { color: #28a745 !important; } .text-red { color: #DC143C !important; } .text-orange { color: #fd7e14 !important; } .text-purple { color: #6f42c1 !important; } .text-emphasis { color: #007bff; font-weight: bold; } .text-warning { color: #ffc107; font-weight: bold; } .text-success { color: #28a745; font-weight: bold; } .text-danger { color: #7835dc; font-weight: bold; } /* è­¦å‘Šæ¡†æ ·å¼ */ blockquote { position: relative; margin: 20px 0; padding: 16px 20px; border-left: 4px solid #007bff; background: #f8f9fa; border-radius: 0 6px 6px 0; font-style: normal; } blockquote[data-callout=\"important\"] { border-left-color: #7835dc; background: rgb(242, 241, 251); border-left-width: 6px; } blockquote[data-callout=\"important\"]::before { content: \"ğŸ’¬ é‡è¦\"; display: block; font-weight: bold; color: #7835dc; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } blockquote[data-callout=\"caution\"] { border-left-color: #ffc107; background: #fffbf0; border-left-width: 6px; } blockquote[data-callout=\"caution\"]::before { content: \"âš ï¸ æ³¨æ„\"; display: block; font-weight: bold; color: #b8860b; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } blockquote[data-callout=\"note\"] { border-left-color: #17a2b8; background: #f0f9ff; border-left-width: 6px; } blockquote[data-callout=\"note\"]::before { content: \"â„¹ï¸ æç¤º\"; display: block; font-weight: bold; color: #17a2b8; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } // å¤„ç†è­¦å‘Šæ¡† document.addEventListener('DOMContentLoaded', function() { const blockquotes = document.querySelectorAll('blockquote'); blockquotes.forEach(function(blockquote) { const firstParagraph = blockquote.querySelector('p:first-child'); if (firstParagraph) { const text = firstParagraph.textContent; const calloutMatch = text.match(/\\[!(IMPORTANT|CAUTION|NOTE)\\]/i); if (calloutMatch) { const calloutType = calloutMatch[1].toLowerCase(); blockquote.setAttribute('data-callout', calloutType); // ç§»é™¤æ ‡è®°æ–‡æœ¬ const cleanText = text.replace(/\\[![^\\]]+\\]\\s*/, ''); firstParagraph.textContent = cleanText; } } }); }); å†™åœ¨å‰é¢è¿™æ˜¯ä¸€ç¯‡ OO Unit3åŠ©æ•™å½“å¹´å¯¹äºU3çš„åæ§½ï¼Œç°åœ¨çœ‹å®åœ¨æ˜¯å›æ—‹é•–ğŸªƒæ»¡å¤©é£å•ŠğŸ¤£ æµ‹è¯•è¿‡ç¨‹é»‘ç®±æµ‹è¯•ä¸ç™½ç®±æµ‹è¯•é€šè¿‡æŸ¥é˜…èµ„æ–™ï¼Œæˆ‘æš‚ä¸”ç»™å‡ºé»‘ç®±æµ‹è¯•ä¸ç™½ç®±æµ‹è¯•çš„å®šä¹‰å’Œæ–¹æ³•ã€‚ é»‘ç®±æµ‹è¯•ä¹Ÿç§°åŠŸèƒ½æµ‹è¯•ã€æ•°æ®é©±åŠ¨æµ‹è¯•æˆ–åŸºäºè§„æ ¼è¯´æ˜çš„æµ‹è¯•ã€‚æµ‹è¯•è€…åªçŸ¥é“ç¨‹åºçš„è¾“å…¥ã€è¾“å‡ºå’Œç³»ç»Ÿçš„åŠŸèƒ½ï¼Œè¿™æ˜¯ä»ä½¿ç”¨è€…çš„è§’åº¦é’ˆå¯¹è½¯ä»¶çš„æ¥å£ã€åŠŸèƒ½åŠå¤–éƒ¨ç»“æ„è¿›è¡Œçš„æµ‹è¯•ï¼Œä¸è€ƒè™‘ç¨‹åºå†…éƒ¨å®ç°é€»è¾‘ã€‚ ç™½ç®±æµ‹è¯•ä¹Ÿç§°ç»“æ„æµ‹è¯•ã€é€»è¾‘é©±åŠ¨æµ‹è¯•æˆ–åŸºäºç¨‹åºæœ¬èº«çš„æµ‹è¯•ï¼Œæµ‹è¯•ç¨‹åºå†…éƒ¨ç»“æ„æˆ–è¿è¡Œã€‚åœ¨ç™½ç®±æµ‹è¯•æ—¶ï¼Œä»ç¨‹åºè®¾è®¡è¯­è¨€çš„è§’åº¦æ¥è®¾è®¡æµ‹è¯•æ ·ä¾‹ã€‚æµ‹è¯•è€…è¾“å…¥æ•°æ®å¹¶éªŒè¯æ•°æ®åœ¨ç¨‹åºä¸­çš„æµåŠ¨è·¯å¾„ï¼Œå¹¶ç¡®å®šé€‚å½“çš„è¾“å‡ºï¼Œç±»ä¼¼æµ‹è¯•ç”µè·¯ä¸­çš„èŠ‚ç‚¹ã€‚ äº†è§£äº†é»‘ç®±æµ‹è¯•å’Œç™½ç®±æµ‹è¯•çš„å®šä¹‰åï¼Œæˆ‘è®¤è¯†åˆ°è™½ç„¶ä¹‹å‰ä»æœªæ¥è§¦è¿‡è¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œä½†å·²ç»ä½¿ç”¨ç±»ä¼¼çš„æ–¹æ³•å¼€å§‹æµ‹è¯•äº†ã€‚ é¦–å…ˆæ˜¯ç™½ç®±æµ‹è¯•ï¼Œä»Cè¯­è¨€ç¨‹åºè®¾è®¡è¯¾å¼€å§‹ï¼Œæˆ‘ä¼¼ä¹å°±å·²ç»å¼€å§‹ä½¿ç”¨ç™½ç®±æµ‹è¯•äº†ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œç™½ç®±æµ‹è¯•çš„ç”¨å¤„æ˜¯åœ¨å†™å®Œä»£ç åç¡®å®šç¨‹åºä¸­çš„æ¯ä¸€æ­¥æ˜¯å¦éƒ½æ˜¯æŒ‰ç…§è®¾æƒ³æ‰§è¡Œçš„ï¼Œå…·ä½“çš„å®ç°æ–¹æ³•å¾€å¾€æ˜¯åœ¨æ¯ä¸€è¡Œå¯èƒ½æ”¹å˜å˜é‡å€¼çš„ä»£ç åéƒ½åŠ ä¸Š printf()æˆ– System.out.println()è¯­å¥è¾“å‡ºæƒ³è¦æŸ¥çœ‹çš„å˜é‡å€¼ã€‚æˆ‘è®¤ä¸ºè¿™ç§æ–¹æ³•çš„æ•ˆæœä¸å•æ­¥è°ƒè¯•çš„æ•ˆæœç›¸å½“ï¼Œä½†æ›´åŠ ç®€å•ç›´æ¥ã€æ›´åŠ çµæ´»ä¸”å¯ç”¨äºå¤šçº¿ç¨‹æƒ…å†µã€‚ ä¹‹åæ˜¯é»‘ç®±æµ‹è¯•ï¼Œä»…å…³æ³¨åœ¨ç»™å®šåŠŸèƒ½è¦æ±‚å’Œè¾“å…¥ä¸‹çš„è¾“å‡ºã€‚è¿™ä¸ªä¹Ÿä¸é™Œç”Ÿï¼Œå„ç§è¯¾ç¨‹ç»„çš„è¯„æµ‹æœºã€è‡ªå·±å†™çš„è¯„æµ‹æœºå’Œå¯¹æ‹å™¨ä»¥åŠæœ¬å•å…ƒä½œä¸šä¸­å‡ºç°çš„OKTestéƒ½æ˜¯é»‘ç®±æµ‹è¯•ã€‚ åœ¨æ—¥å¸¸ä½¿ç”¨ä¸­ï¼Œå¯¹ä»£ç çš„æµ‹è¯•å¾€å¾€æ˜¯é»‘ç®±å’Œç™½ç®±ç›¸ç»“åˆçš„ã€‚ä»¥OSä¸Šæœºä¸ºä¾‹ï¼Œåœ¨è‡ªè®¤ä¸ºå®Œæˆè¦æ±‚åï¼Œæˆ‘ä¼šå…ˆä½¿ç”¨ make xxxx &amp;&amp; make runè·‘ä¸€ä¸‹è¯¾ç¨‹ç»„çš„æµ‹è¯•ã€‚æµ‹è¯•ä»£ç å¾€å¾€æ˜¯å•ç‹¬çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶åœ¨å…¶å†…è°ƒç”¨æˆ‘å†™å¥½çš„å‡½æ•°ï¼Œé€šè¿‡ assertè¯­å¥æ£€æŸ¥å‡½æ•°çš„è¿”å›å€¼æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œè¿™æ˜¯é»‘ç®±æµ‹è¯•ã€‚åœ¨è¿™æµ‹è¯•åï¼Œå¦‚æœå‡ºç°äº†é—®é¢˜ï¼Œä¾¿éœ€è¦å…·ä½“æ£€æŸ¥å‡½æ•°çš„å®ç°ã€‚è¿™ä¸ªè¿‡ç¨‹æ—¢éœ€è¦ç”¨äººè„‘æ¨¡æ‹Ÿä»£ç çš„æ‰§è¡Œï¼Œåˆå¯ä»¥åœ¨å¤šæ¡å…³é”®è¯­å¥å‰ååŠ ä¸Š printk(), debugf()æ£€æŸ¥å˜é‡å€¼çš„å˜åŒ–æ˜¯å¦ç¬¦åˆé€»è¾‘é¢„æœŸï¼Œç¢°åˆ°ä¸ç¬¦åˆé¢„æœŸçš„åœ°æ–¹ä¾¿æ˜¯å‘ç°bugï¼Œå¯ä»¥å¼€å§‹ä¿®æ”¹äº†ï¼Œæ”¹å®Œä¹‹åä¾¿å¯ä»¥ä½¿ç”¨é»‘ç®±æµ‹è¯•ç»§ç»­æµ‹è¯•æœ€ç»ˆç»“æœï¼Œè‹¥ç»“æœä¸å¯¹å°±ç»§ç»­ç™½ç®±æµ‹è¯•â€¦â€¦ å•å…ƒæµ‹è¯•ç­‰å¤šç§æµ‹è¯•æ‰‹æ®µ å•å…ƒæµ‹è¯•ï¼šå•å…ƒæµ‹è¯•æ˜¯é’ˆå¯¹ç¨‹åºæ¨¡å—ï¼ˆè½¯ä»¶è®¾è®¡çš„æœ€å°å•ä½ï¼‰æ¥è¿›è¡Œæ­£ç¡®æ€§æ£€éªŒçš„æµ‹è¯•å·¥ä½œï¼Œå¯¹é¢å‘è¿‡ç¨‹çš„è¯­è¨€æ¥è¯´æ˜¯æµ‹è¯•å‡½æ•°ï¼Œå¯¹é¢å‘å¯¹è±¡çš„è¯­è¨€æ¥è¯´æ˜¯æµ‹è¯•ç±»çš„è¡Œä¸ºã€‚åœ¨ç¬¬10æ¬¡ä½œä¸šä¸­ï¼Œæˆ‘æ„é€ å¤§æ•°æ®å®Œå…¨å›¾å¯¹ qsp, qtvs, qtav, qba, qcsç­‰æŒ‡ä»¤è¿›è¡Œäº†æµ‹è¯•ï¼Œè¿™ä¾¿æ˜¯å•å…ƒæµ‹è¯•çš„åº”ç”¨ã€‚ åŠŸèƒ½æµ‹è¯•ï¼šé€šè¿‡ä¸Šé¢é»‘ç®±æµ‹è¯•çš„ä»‹ç»å¯çŸ¥åŠŸèƒ½æµ‹è¯•å¤§æ¦‚å°±æ˜¯é»‘ç®±æµ‹è¯•ï¼Œä¸è€ƒè™‘ç¨‹åºå†…éƒ¨ç»“æ„è€Œä»…æµ‹è¯•ç¨‹åºæ‰§è¡Œçš„ç»“æœã€‚ é›†æˆæµ‹è¯•ï¼šé›†æˆæµ‹è¯•æ˜¯æŒ‡æŠŠå¤šä¸ªç¨‹åºæ¨¡å—æ”¾åœ¨ä¸€èµ·æµ‹è¯•çš„æ–¹æ³•ã€‚ç”±äºæ¯ä¸ªæ¨¡å—éƒ½æ­£ç¡®ä¸ä¸€å®šèƒ½ä¿è¯æ•´ä¸ªç¨‹åºæ­£ç¡®ï¼Œåœ¨å•å…ƒæµ‹è¯•åæŠŠå¤šä¸ªå•å…ƒç»“åˆåœ¨ä¸€èµ·æµ‹è¯•çš„é›†æˆæµ‹è¯•å¿…ä¸å¯å°‘ã€‚ä»å®é™…æ•ˆæœä¸Šæ¥è¯´ï¼Œåœ¨ç¬¬ä¸‰å•å…ƒçš„åŠŸèƒ½ä¸æ–­å¢åŠ çš„è¿­ä»£å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå‰ä¸€æ¬¡ä½œä¸šä¸­å…¨é¢çš„å¼ºæµ‹å°±ç›¸å½“äºä¸‹ä¸€æ¬¡ä½œä¸šçš„é›†æˆæµ‹è¯•ã€‚ å‹åŠ›æµ‹è¯•ï¼šå‹åŠ›æµ‹è¯•æ˜¯é’ˆå¯¹ç³»ç»Ÿæˆ–æ˜¯ç»„å»ºï¼Œä¸ºç¡®å®šå…¶ç¨³å®šæ€§è€Œç‰¹æ„è¿›è¡Œçš„ä¸¥æ ¼æµ‹è¯•ã€‚æˆ‘æ„Ÿè§‰å‹åŠ›æµ‹è¯•çš„æ„ä¹‰åœ¨äºä½å‹æµ‹è¯•å¯¹ä¸åŒæƒ…å†µçš„è¦†ç›–ä¸å®Œå…¨ï¼Œä»è€Œå¯èƒ½æ£€æŸ¥ä¸å‡ºç¨‹åºçš„æ½œè—é—®é¢˜ï¼Œè€Œé«˜å‹æµ‹è¯•é€šè¿‡å¤§æ•°æ®ã€é«˜å¹¶å‘(å¦‚æœæ˜¯å¤šçº¿ç¨‹)ï¼Œå¯ä»¥å°½å¯èƒ½æšä¸¾å‡ºå„ç§æƒ…å†µï¼Œå¢å¤§å‘ç°é—®é¢˜çš„æ¦‚ç‡ã€‚è·ç¦»è€Œè¨€ï¼Œåœ¨ç”µæ¢¯å•å…ƒä¸­ï¼Œè‡ªå·±é€ å‡ºçš„å¼±æ•°æ®ä¸ä¸€å®šèƒ½å‘ç°åƒæ˜¯è½®è¯¢ã€æ­»é”ä¹‹ç±»çš„é—®é¢˜ï¼Œè€ŒåŠ©æ•™å‡ºçš„å‹åŠ›æµ‹è¯•å¼ºæ•°æ®ä»¥åŠè¯„æµ‹æœºè¶…å¤šçº¿ç¨‹åŒæ—¶è·‘å¤šä»½ä»£ç çš„æƒ…å†µåˆ™å‡ ä¹å¯ä»¥å‘ç°ç»å¤§å¤šæ•°é—®é¢˜ã€‚ å›å½’æµ‹è¯•ï¼šå›å½’æµ‹è¯•æ—¨åœ¨æµ‹è¯•è½¯ä»¶åŸæœ‰åŠŸèƒ½åœ¨ä¿®æ”¹åæ˜¯å¦ä¿æŒå®Œæ•´ï¼Œè¿™ä¹Ÿæ˜¯çºªè€å¸ˆåœ¨è¯¾ä¸Šå¤šæ¬¡æåˆ°çš„ã€‚ä¸¾ä¾‹è€Œè¨€ï¼Œåœ¨OOæ¯ä¸ªå•å…ƒçš„è¿­ä»£ä¸­ï¼Œåœ¨æµ‹è¯•å®ŒæŸä¸€æ¬¡ä½œä¸šåï¼Œè¦ä¿ç•™å¥½è‡ªå·±æ„é€ çš„æµ‹è¯•æ ·ä¾‹ï¼Œä¸‹æ¬¡è¿­ä»£å¼€å‘ä¹‹åç»§ç»­ä½¿ç”¨ã€‚ æ•°æ®æ„é€ ç­–ç•¥åœ¨ä¸‰æ¬¡ä½œä¸šä¸­ï¼Œæˆ‘å°è¯•å†™äº†ä¸¤ç§æ•°æ®ç”Ÿæˆå™¨ï¼Œä¸€ä¸ªæ˜¯é’ˆå¯¹å„ç§æŒ‡ä»¤çš„é›†æˆæµ‹è¯•æ•°æ®ç”Ÿæˆå™¨ï¼Œä¸€ä¸ªæ˜¯é’ˆå¯¹ qtvs, qbs, qcsç­‰æŒ‡ä»¤çš„å•å…ƒæµ‹è¯•/å‹åŠ›æµ‹è¯•ç”Ÿæˆå™¨ã€‚å•å…ƒæµ‹è¯•ç”Ÿæˆå™¨çš„é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œé¦–å…ˆé€šè¿‡ lnæ„å»ºä¸€ä¸ªå®Œå…¨å›¾ï¼Œç„¶ååŠ å…¥ä¸€å®šæ•°é‡çš„ tagï¼ŒåŒæ—¶ä¸æ–­ ar, mrå¹¶ä¸” qtvsï¼Œæœ€åå†ä¸€ç›´ qtvsæ€»è®¡10000æ¡æ•°æ®æ¥è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œè€ƒè™‘åˆ° OOè¯„æµ‹æœºçš„ç„å­¦å±æ€§ï¼Œå¯¹äºä¸€åˆ‡æœ¬åœ°è¿è¡Œæ—¶é—´è¶…è¿‡ 1.6sçš„æ•°æ®ï¼Œè¿›è¡Œåˆ†æï¼Œå¹¶ä¸”å¯¹äºä»£ç è¿›è¡Œç›¸åº”çš„ä¼˜åŒ–ã€‚å¯¹äºé›†æˆæµ‹è¯•æ•°æ®ç”Ÿæˆå™¨ï¼Œæˆ‘åŸæœ¬æƒ³é‡‡ç”¨å…¨éƒ¨éšæœºç”Ÿæˆçš„æ–¹å¼ï¼Œä½†å‘ç°è¿™æ ·ç”Ÿæˆçš„æ•°æ®ä¼šæœ‰å¤§é‡çš„å¼‚å¸¸ï¼Œå¯¹äºå„ç§è®¡æ•°æŒ‡ä»¤å‡ ä¹èµ·ä¸åˆ°æµ‹è¯•æ•ˆæœã€‚äºæ˜¯æˆ‘åœ¨ç”Ÿæˆå™¨ä¸­ç»´æŠ¤äº†å‡ ä¸ª idæ± ä»¥åŠå…³ç³»æ± ç”¨æ¥å­˜æ”¾å·²ç»ç”Ÿæˆçš„æ•°æ®ï¼Œå¹¶åœ¨å…·ä½“ç”ŸæˆæŒ‡ä»¤æ—¶ï¼Œé€šè¿‡éšæœºæ•°åˆ¤æ–­ç”Ÿæˆä¼šå¼•èµ·å¼‚å¸¸çš„æŒ‡ä»¤æˆ–æ˜¯ä¸ä¼šå¼•èµ·å¼‚å¸¸çš„æŒ‡ä»¤ï¼Œè¿™æ ·ç”Ÿæˆçš„æ•°æ®æ•ˆæœå°šå¯ã€‚ æ¶æ„ä¸å›¾æ¨¡å‹åœ¨æ¶æ„ä¸Šï¼Œç”±äºå®˜æ–¹åŒ…å·²ç»ç»™å‡ºäº†æ¯”è¾ƒå¤šä¸”æ˜ç¡®çš„è¦æ±‚å’Œé™åˆ¶ï¼Œæˆ‘å¹¶æ²¡æœ‰åšä»€ä¹ˆçªç ´ï¼Œä¸åŒç±»ä¹‹é—´çš„å±‚æ¬¡å…³ç³»éƒ½æ˜¯æŒ‰ç…§å®˜æ–¹åŒ…å†™çš„ã€‚è€Œå¯¹äºå›¾æ¨¡å‹çš„è®¾è®¡å’Œç»´æŠ¤åˆ™æ˜¯æœ¬å•å…ƒç®—æ³•è€ƒå¯Ÿçš„é‡ç‚¹ã€‚ä¸‹é¢é‡ç‚¹è°ˆè°ˆæˆ‘åœ¨ä¸‰æ¬¡ä½œä¸šä¸­çš„å›¾æ¨¡å‹è®¾è®¡ã€‚ å›¾ä½¿ç”¨é‚»æ¥è¡¨ï¼Œå³ Acquaintanceæ„å»ºã€‚å¯¹äº qciå’Œ qbsï¼Œhw9å°±æ¶‰åŠåˆ è¾¹ï¼Œæ•…å¹¶ä¸é‡‡ç”¨å¹¶æŸ¥é›†ç­‰ç®—æ³•ï¼Œåœ¨æ¯æ¬¡ qciæ—¶åš BFSï¼Œåœ¨åŠ è¾¹/åˆ è¾¹æ—¶BFSåŠ¨æ€ç»´æŠ¤ qbsã€‚å¯¹äº qtsï¼Œåœ¨åŠ è¾¹å’Œåˆ è¾¹æ—¶åŠ¨æ€ç»´æŠ¤ã€‚å¯¹äº qbaï¼Œå¯¹æ¯ä¸ªç‚¹å¼€ä¸€ä¸ª TreeSetï¼Œåœ¨å¢/åˆ /ä¿®æ”¹è¾¹æƒæ—¶ï¼ŒåŠ¨æ€ç»´æŠ¤è¯¥ç‚¹çš„ bestAcï¼›å¯¹äº qcsï¼Œæ¯æ¬¡éå†æ‰€æœ‰ç‚¹è¿›è¡Œç»Ÿè®¡ã€‚ ä¼˜åŒ–çš„é‡ç‚¹åœ¨äº Tagä¸­çš„æ–¹æ³•ï¼Œå°¤å…¶æ˜¯ qtvsæ–¹æ³•ï¼Œç»è¿‡æœ¬åœ°å‹åŠ›æµ‹è¯•ï¼Œå‘ç°å¦‚æœä¸è¿›è¡ŒåŠ¨æ€ç»´æŠ¤ï¼Œè€Œæ˜¯ä½¿ç”¨ JMLæè¿°çš„ç›´æ¥æŸ¥è¯¢çš„O($n^2$)çš„å¤æ‚åº¦æ–¹æ³•ï¼Œåˆ™ä¼š CTLEï¼Œå› æ­¤å¿…é¡»åœ¨æ¯æ¬¡ att, dft,ar, mrçš„æ—¶å€™è¿›è¡ŒåŠ¨æ€ç»´æŠ¤ã€‚ è§„æ ¼ä¸å®ç°åˆ†ç¦»åŠæ€§èƒ½é—®é¢˜è§„æ ¼ä¸å®ç°åˆ†ç¦»åœ¨è¿™ä¸ªå•å…ƒä¸­ï¼Œå…¶å®å¾ˆèƒ½ä½“ä¼šåˆ°è§„æ ¼ä¸å®ç°çš„åˆ†ç¦»ï¼Œå› ä¸ºå‡å¦‚ä¸åˆ†ç¦»ï¼Œå®ç°æŒ‰ç€ JMLæ¥ï¼Œä¾¿ä¼šå› ä¸ºæ€§èƒ½ä¸ä½³O($n^2$)ç”šè‡³O($n^3$)çš„æ—¶é—´å¤æ‚åº¦å¯ä¸æ˜¯é—¹ç€ç©çš„ğŸ˜…è€Œå¤§æŠŠæ‰£åˆ†ã€‚è€Œä¸ºäº†å®ç°è§„æ ¼ä¸ä»£ç çš„åˆ†ç¦»ï¼Œæˆ‘è®¤ä¸ºè¦åšä»¥ä¸‹ä¸¤æ­¥ã€‚ ç¬¬ä¸€æ­¥æ˜¯é€šè¯» JMLè§„æ ¼ï¼ŒæŠŠ JMLçš„è§„æ ¼è®¾è®¡è½¬æ¢ä¸ºè‡ªç„¶è¯­è¨€ï¼ŒæŠ½è±¡ä¸ºä¸€äº›ç¬¦åˆå¸¸è¯†çš„æè¿°ã€‚åœ¨é¢å¯¹ä¸€äº›å¤æ‚æ–¹æ³•æ—¶ï¼Œè¿™ä¸€æ­¥å°¤ä¸ºé‡è¦ï¼Œå› ä¸º JMLåªæè¿°è§„æ ¼ï¼Œè€Œæˆ‘ä»¬å†™ä»£ç ä¸€èˆ¬éœ€è¦çŸ¥é“æŸä¸ªå‡½æ•°çš„æ„ä¹‰(æˆ‘è®¤ä¸ºä¸€èˆ¬äººéƒ½æ²¡æœ‰åœ¨ä¸çŸ¥é“æ„ä¹‰çš„æƒ…å†µä¸‹ç›´æ¥æŠŠä¸€å †é€šè¿‡éå†æè¿°çš„æ–¹æ³•è½¬æ¢ä¸º dijkstraç­‰è¾ƒä¼˜ç®—æ³•çš„èƒ½åŠ›)ã€‚ ç¬¬äºŒæ­¥æ˜¯æ ¹æ®æŠ½è±¡å‡ºæ¥çš„è‡ªç„¶è¯­è¨€æè¿°é€‰å–åˆé€‚çš„æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œå®Œæˆéœ€è¦å®ç°çš„åŠŸèƒ½ã€‚ å®ç°ä¸­çš„æ€§èƒ½é—®é¢˜æˆ‘çš„ä»£ç åœ¨æœ¬å•å…ƒä¸‰æ¬¡ä½œä¸šçš„å¼ºæµ‹å’Œäº’æµ‹ä¸­å‡æœªå‡ºç°æ€§èƒ½é—®é¢˜ã€‚ç©¶å…¶åŸå› ï¼Œåœ¨äºæˆ‘åœ¨æ¯ä¸€æ¬¡é˜…è¯» JMLæ—¶å°±å¯¹å…¶ä¸­è•´æ¶µçš„æ—¶é—´å¤æ‚åº¦â€œé™·é˜±â€ï¼Œåœ¨ç»è¿‡å‹åŠ›æµ‹è¯•åé‡‡ç”¨åŠ¨æ€ç»´æŠ¤ï¼Œæœ€ç»ˆé¿å…äº† CTLEã€‚é€šè¿‡ä¸Šé¢è§„æ ¼ä¸å®ç°åˆ†ç¦»éƒ¨åˆ†çš„è®¨è®ºä¾¿å¯çœ‹å‡ºï¼Œè§„æ ¼å’Œå®ç°æ˜¯å¯ä»¥åˆ†ç¦»çš„ï¼Œè€Œä½œä¸ºç¨‹åºå‘˜ï¼Œåº”è¯¥è¿½æ±‚æ»¡è¶³è§„æ ¼ä¸‹çš„æœ€ä¼˜æ€§èƒ½å®ç°ã€‚ä½†æ˜¯å¦èƒ½è¾¾åˆ°å¾ˆå¥½çš„æ•ˆæœï¼Œåˆ™å–å†³äºç¨‹åºå‘˜çš„çŸ¥è¯†ç§¯ç´¯ä¸é˜…å†ã€‚ç®€å•æ¥è¯´ï¼Œå¦‚æœçŸ¥é“æ›´å¥½çš„ç®—æ³•ï¼Œå°±æœ‰å¯èƒ½å†™å‡ºæ€§èƒ½æ›´å¥½çš„ä»£ç ï¼Œå¦åˆ™ä»…å‡­è§„æ ¼å°±å†™ä¸å‡ºæ¥ã€‚ Junitæµ‹è¯•Junitæµ‹è¯•ä¸å……åˆ†è¯ é‡Šäº†â€œæµ‹ä¸å‡†åŸç†â€çš„ OOè¯„æµ‹æœºå…±åŒæ„æˆäº†Unit3çš„ä¸¤å¤§æ¢¦é­‡ï¼Œç”šè‡³åœ¨ä¸­æµ‹ç¯èŠ‚ï¼ŒJunitæµ‹è¯•å¸¦æ¥çš„å‹è¿«æ„Ÿè¿œæ¯”ç¨‹åºæ­£ç¡®æ€§è¦å¤§å¾—å¤šã€‚ çœ‹ç€å³å°†è§åº•çš„æäº¤å‰©ä½™æ¬¡æ•°ä¸éšæ—¶å¯èƒ½æµ‹å‡ºé—®é¢˜çš„ä»£ç ï¼Œå’Œéšæœºåˆ·æ–°çš„Junitæµ‹è¯• WAæµ‹è¯•ç‚¹ï¼Œå¤§å®¶éš¾å…éª‚éª‚å’§å’§ğŸ˜¡ï¼Œæ±—æµæµƒèƒŒğŸ˜…ã€‚ é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰åŠæ³•ç³»ç»Ÿæ€§çš„è§£å†³è¿™ä¸€é—®é¢˜å‘¢ï¼Œæˆ‘è®¤ä¸ºæ˜¯æœ‰çš„ã€‚æˆ‘ä»¬å‘ç°ï¼ŒJunitæµ‹è¯•é‡ç‚¹å…³æ³¨ä¸¤ä¸ªéƒ¨åˆ†â€”â€”è¦†ç›–ç‡é«˜çš„æµ‹è¯•æ•°æ®ï¼Œä»¥åŠç¡®ä¿â€œä¸‡æ— ä¸€å¤±â€çš„æ ‡ç¨‹ã€‚ æ„é€ è¦†ç›–ç‡é«˜çš„æ•°æ®æ„é€ è¦†ç›–ç‡é«˜çš„æ•°æ®æŠ€å·§ä¸é«˜ï¼Œåœ¨å®Œæˆæ•°æ®æ„é€ åï¼Œå¯ä»¥è¿ç”¨IDEAä¸­çš„ä½¿ç”¨è¦†ç›–ç‡è¿è¡Œtestæ¥è¿›è¡Œåˆ†æ”¯è¦†ç›–ç‡æµ‹è¯•ï¼Œæœ€ç»ˆä¸æ–­å®Œå–„ï¼Œè·å¾—ä¸€ç»„å¯¹ç›®æ ‡æ–¹æ³•åˆ†æ”¯è¦†ç›–ç‡100%çš„æµ‹è¯•æ•°æ®ã€‚ æ’°å†™æ ‡ç¨‹æ ‡ç¨‹è€ƒå¯Ÿçš„æ— éä»¥ä¸‹å‡ ä¸ªæ¡ä»¶ï¼š æ£€æŸ¥ ensureï¼› æ£€æŸ¥ pure/assignableï¼› æ£€æŸ¥ invariant/constraintï¼› ç­‰ç­‰ åœ¨å…·ä½“äº†è§£äº†è¿™äº›æ¡ä»¶åï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥å€Ÿé‰´ OKTestçš„æ–¹æ³•æ¥æ’°å†™æ ‡ç¨‹ï¼Œä¸‹é¢ä»¥ hw11ä¸­çš„ deleteColdEmoji()çš„æµ‹è¯•ä¸ºä¾‹æ¥è¿›è¡Œè¯´æ˜ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748public int judge(HashMap&lt;Integer, Integer&gt; beforeEmojis, HashMap&lt;Integer, Integer&gt; beforeMessages, HashMap&lt;Integer, Integer&gt; afterEmojis, HashMap&lt;Integer, Integer&gt; afterMessages, int limit, int result) { for (int eid : beforeEmojis.keySet()) { if (beforeEmojis.get(eid) &gt;= limit &amp;&amp; !afterEmojis.containsKey(eid)) { //System.out.println(eid + &quot; &quot; + beforeEmojis.get(eid)); return 1; } } for (int eid : afterEmojis.keySet()) { if (!beforeEmojis.containsKey(eid) || !beforeEmojis.get(eid).equals(afterEmojis.get(eid))) { return 2; } } int cnt = 0; for (Map.Entry&lt;Integer, Integer&gt; entry : beforeEmojis.entrySet()) { if (entry.getValue() &gt;= limit) { ++cnt; } } if (cnt != afterEmojis.size()) { return 3; } for (Map.Entry&lt;Integer, Integer&gt; entry : beforeMessages.entrySet()) { if (entry.getValue() != null &amp;&amp; afterEmojis.containsKey(entry.getValue()) &amp;&amp; (!afterMessages.containsKey(entry.getKey()) || !entry.getValue().equals(afterMessages.get(entry.getKey())))) { return 5; } } for (Map.Entry&lt;Integer, Integer&gt; entry : beforeMessages.entrySet()) { if (entry.getValue() == null &amp;&amp; (!afterMessages.containsKey(entry.getKey()) || afterMessages.get(entry.getKey()) != null)) { return 6; } } cnt = 0; for (Map.Entry&lt;Integer, Integer&gt; entry : beforeMessages.entrySet()) { if (entry.getValue() == null) { ++cnt; } else if (afterEmojis.containsKey(entry.getValue())) { ++cnt; } } if (cnt != afterMessages.size()) { return 7; } return result == afterEmojis.size() ? 0 : 8; } å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬é’ˆå¯¹ JMLä¸­çš„ \\oldæ¡ä»¶è®¾ç½®äº† before*çš„ä¸€ç³»åˆ—æ•°æ®ç‚¹ï¼ŒåŒæ—¶é’ˆå¯¹æ¯ä¸ª ensureæ¡ä»¶ä¾æ¬¡æµ‹è¯•ï¼Œå¯¹äºè¿åæ¡ä»¶çš„æƒ…å†µä¾æ¬¡è¿”å›ä¸åŒçš„é”™è¯¯å€¼ï¼Œè¿™æ ·ä¹Ÿæ–¹ä¾¿ Debugï¼Œæœ€åï¼Œåªè¦ assertEquals(0, judge(beforeEmojis, beforeMessages, afterEmojis, afterMessages, limit, result));å³å¯å®Œæˆæ­£ç¡®æ€§çš„åˆ¤æ–­ã€‚ å€Ÿç”± OKTestçš„æ€æƒ³ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¯¹äºæ¯ä¸€ä¸ª ensureæ¡ä»¶éƒ½è¿›è¡Œæµ‹è¯•çš„æ’°å†™ï¼Œä¿è¯äº†æ ‡ç¨‹çš„**â€œä¸‡æ— ä¸€å¤±â€**ã€‚ å¿ƒå¾—ä½“ä¼šæ”¶è·è¿˜æ˜¯ç…§ä¾‹å…ˆè°ˆè°ˆè¿™ä¸€å•å…ƒçš„æ”¶è·å§ï¼Œåœ¨Unit3çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä¸»è¦åœ¨ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢æœ‰æ‰€æ”¶è·ï¼š å¤ä¹ äº†å›¾è®ºçš„ç›¸å…³ç®—æ³•ï¼ŒåŒ…æ‹¬ BFSï¼Œå¹¶æŸ¥é›†ï¼ŒDijkstraç­‰ åˆæ­¥å­¦ä¹ äº† JMLï¼Œå¯¹äºè§„æ ¼åŒ–è®¾è®¡æœ‰äº†åˆæ­¥äº†è§£ã€‚ äº†è§£äº†å„ç§æµ‹è¯•æ–¹æ³•ï¼Œå¹¶ä¸”é‡æ–°æ¡èµ·äº†åœ¨ç”µæ¢¯å•å…ƒæ— æš‡è¿›è¡Œçš„è¯„æµ‹æœºæ’°å†™ã€‚ ä¸€ç‚¹åæ§½å…ˆè°ˆè°ˆå¯¹äº JMLçš„æ„Ÿå—å§ï¼Œåœ¨è¿›è¡Œè¿™ä¸€å•å…ƒå­¦ä¹ çš„åŒæ—¶ï¼Œæˆ‘è¯»åˆ°äº†ä¸€ä¸ªæœ‰è¶£çš„å¯¹äºè¯­è¨€çš„åæ§½ï¼Œæ¥è‡ªæˆ‘åœ¨åŒ—å¤–çš„å­¦å¼Ÿã€‚æˆ‘è®¤ä¸ºè¿™ååˆ†å¥‘åˆæˆ‘åœ¨Unit3çš„å­¦ä¹ ä½“ä¼šï¼Œå†³å¿ƒä¸€å®šè¦å†™è¿›åšå®¢ä½œä¸šé‡Œã€‚ JMLåƒæ˜¯åœ¨è‹±æ±‰å¯¹è¯‘çš„æ—¶å€™ï¼Œå…ˆå°†ä¸­æ–‡ç¿»è¯‘ä¸ºæ³•è¯­ï¼Œå†æŠŠæ³•è¯­ç¿»è¯‘æˆè‹±æ–‡ã€‚æˆ‘ä¸­æ–‡è¿˜å¥½ç‚¹ï¼Œè‹±æ–‡æ°´å¹³ä¸€èˆ¬ï¼Œæ³•è¯­åˆ™æ˜¯å®Œå…¨ä¸ä¼šã€‚çºµä½¿è¯´æ³•è¯­ä¸¥è°¨åˆ°å¤©èŠ±ä¹±å ï¼Œå¯¹æˆ‘æ¥è®²ä¸é¬¼ç”»ç¬¦çœŸæ²¡å•¥åŒºåˆ«ã€‚è°ˆåŠJMLçš„ä¼˜ç‚¹ï¼Œæˆ‘ç¡®å®æ— è¯å¯è¯´ï¼Œèƒ½ä¸JMLç›¸é‡æ˜¯æˆ‘çš„ç¼˜åˆ†ï¼Œä¸è¿‡æˆ‘å¸Œæœ›è¿™æ ·çš„ç¼˜åˆ†è¶Šå°‘è¶Šå¥½ã€‚ å½“ç„¶ï¼ŒJMLèƒ½å¤Ÿæµä¼ ä¸‹æ¥ï¼Œä¼ æ’­ç”šå¹¿ï¼Œä¸€å®šæ˜¯æœ‰å…¶ç‹¬åˆ°ä¹‹å¤„çš„ã€‚å°±åƒæ˜¯é‚£ä¸ªç»å…¸çš„å“²å­¦è¾©é¢˜â€”â€”è¢«è¯¯è§£æ˜¯ä¸æ˜¯è¡¨è¾¾è€…çš„å®¿å‘½ï¼Œæˆ‘åœ¨æƒ³ï¼Œå¦‚æœå“²å­¦å®¶è¾©è®ºæ—¶èƒ½å¤Ÿä½¿ç”¨ JMLåå±±è®ºå‰‘ï¼Œé‚£æƒ³å¿…ç­”æ¡ˆå·²ç„¶æ˜äº†ï¼Œä½œä¸ºä¸€ç§**â€œå»ºæ¨¡â€è¯­è¨€**ï¼ŒJMLæœ€å¤§çš„æœ‰ç‚¹ä¾¿æ˜¯å°½å¯èƒ½çš„å‡å°‘äº†è¯¯è§£çš„å­˜åœ¨ã€‚ ä½†äº‹å®æ˜¯å¦çœŸçš„å¦‚æ­¤å‘¢ï¼ŒJMLæ˜¾ç„¶ä¸ä¾¿äºæ’°å†™ï¼ŒUnit3æ¨ªè·¨äº”ä¸€å‡æœŸï¼Œå‡æœŸä¸­æˆ‘æœ€æ‹…å¿ƒçš„ä¾¿æ˜¯æŒ‡å¯¼ä¹¦å’Œ JMLæ ‡ç¨‹çš„çªç„¶ä¿®æ”¹ï¼Œå› ä¸ºè¿™å¾ˆæœ‰å¯èƒ½ä½¿æˆ‘çš„å‡æœŸæ³¡æ±¤ï¼Œè€Œè¿™ï¼Œåœ¨è¿™ä¸€å•å…ƒç»å¸¸å‘ç”Ÿï¼ï¼ï¼ ç¬¬äºŒåˆ™æ˜¯è¯„æµ‹æœºçš„â€œä¸ç¡®å®šæ€§â€ï¼Œè™½è¯´è¯¾ç¨‹ç»„ç»™å‡ºçš„æ—¶é—´é™åˆ¶æ˜¯10sï¼Œä½†æ˜¯åœ¨å®é™…æƒ…å†µä¸‹ï¼Œä¸€æ—¦æœ¬åœ°è¿è¡Œè¶…è¿‡1.8sï¼Œé‚£ä¹ˆä¾¿å¾ˆæœ‰å¯èƒ½å‘ç”Ÿ CTLEï¼Œè¿™å®åœ¨å«äººèƒ†æˆ˜å¿ƒæƒŠï¼Œæ¯ä¸€æ¬¡ç‚¹å¼€å¼ºæµ‹ç»“æœéƒ½åƒæ˜¯å¼€ç›²ç›’ï¼Œéå¸¸åˆºæ¿€ğŸ˜Šã€‚ æœ€åè¿˜æ˜¯æ„Ÿè°¢åŠ©æ•™çš„è¾›å‹¤ä»˜å‡ºï¼Œä»¥ä¸Šåªæ˜¯æˆ‘çš„ä¸€ç‚¹ç‰¢éªšï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆèƒ½ç†è§£åŠ©æ•™é¢‘ç¹ä¿®æ”¹æŒ‡å¯¼ä¹¦ï¼ŒJMLèƒŒåçš„ä¸æ˜“ã€‚åªæ˜¯ï¼Œè¿åŠ©æ•™å›¢é˜Ÿåœ¨å®é™…ç¼–å†™è¿‡ç¨‹ä¸­éƒ½é¢‘ç¹å‡ºé”™çš„ JMLæ˜¯å¦æœ‰ç»§ç»­æ¨å¹¿çš„ä»·å€¼å‘¢ï¼Œæˆ‘è®¤ä¸ºå€¼å¾—å•†æ¦·ï¼ï¼ï¼","link":"/2025/08/13/OO-3/"},{"title":"Hello World","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot; More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","link":"/2025/08/13/hello-world/"},{"title":"RooKie_Z Compilerç¼–è¯‘å™¨è®¾è®¡æ–‡æ¡£","text":"/* å¸¸ç”¨é¢œè‰²ç±» */ .text-cadetblue { color: CadetBlue !important; } .text-blue { color: #007bff !important; } .text-green { color: #28a745 !important; } .text-red { color: #DC143C !important; } .text-orange { color: #fd7e14 !important; } .text-purple { color: #6f42c1 !important; } .text-emphasis { color: #007bff; font-weight: bold; } .text-warning { color: #ffc107; font-weight: bold; } .text-success { color: #28a745; font-weight: bold; } .text-danger { color: #7835dc; font-weight: bold; } /* è­¦å‘Šæ¡†æ ·å¼ */ blockquote { position: relative; margin: 20px 0; padding: 16px 20px; border-left: 4px solid #007bff; background: #f8f9fa; border-radius: 0 6px 6px 0; font-style: normal; } blockquote[data-callout=\"important\"] { border-left-color: #7835dc; background: rgb(242, 241, 251); border-left-width: 6px; } blockquote[data-callout=\"important\"]::before { content: \"ğŸ’¬ é‡è¦\"; display: block; font-weight: bold; color: #7835dc; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } blockquote[data-callout=\"caution\"] { border-left-color: #ffc107; background: #fffbf0; border-left-width: 6px; } blockquote[data-callout=\"caution\"]::before { content: \"âš ï¸ æ³¨æ„\"; display: block; font-weight: bold; color: #b8860b; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } blockquote[data-callout=\"note\"] { border-left-color: #17a2b8; background: #f0f9ff; border-left-width: 6px; } blockquote[data-callout=\"note\"]::before { content: \"â„¹ï¸ æç¤º\"; display: block; font-weight: bold; color: #17a2b8; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } // å¤„ç†è­¦å‘Šæ¡† document.addEventListener('DOMContentLoaded', function() { const blockquotes = document.querySelectorAll('blockquote'); blockquotes.forEach(function(blockquote) { const firstParagraph = blockquote.querySelector('p:first-child'); if (firstParagraph) { const text = firstParagraph.textContent; const calloutMatch = text.match(/\\[!(IMPORTANT|CAUTION|NOTE)\\]/i); if (calloutMatch) { const calloutType = calloutMatch[1].toLowerCase(); blockquote.setAttribute('data-callout', calloutType); // ç§»é™¤æ ‡è®°æ–‡æœ¬ const cleanText = text.replace(/\\[![^\\]]+\\]\\s*/, ''); firstParagraph.textContent = cleanText; } } }); }); å†™åœ¨å‰é¢RooKie_Z Compilerç¼–è¯‘å™¨è®¾è®¡æ–‡æ¡£ï¼Œæœ¬ç¼–è¯‘å™¨ åœ¨æœ€ç»ˆçš„ç«é€Ÿä¸­æ’åç¬¬äº” Update time: 2024å¹´12æœˆ3æ—¥ æ˜ŸæœŸäºŒ 18æ—¶19åˆ†15ç§’ CST â€œå…è´£å£°æ˜â€ æ–‡æ¡£æ’°å†™è¦æ±‚ä¸­è¦æ±‚æŒ‰ç…§ç¼–ç å‰çš„è®¾è®¡ã€ç¼–ç å®Œæˆä¹‹åçš„ä¿®æ”¹çš„é¡ºåºå®Œæˆå„éƒ¨åˆ†æ’°å†™ è€Œäº‹å®ä¸Šï¼Œæˆ‘å‘æ¥åå¥½è°ƒç ”å…ˆäºå®è·µï¼Œè®¾è®¡æ—©äºç¼–ç çš„ä»£ç æ’°å†™ç†å¿µï¼Œè€Œè¿™ç¯‡è®¾è®¡æ–‡æ¡£ä¹Ÿå®Œå…¨æ˜¯æœ¬äººçš„æœ‰æ„Ÿè€Œå‘ï¼Œè®¾è®¡ç”¨æ—¶ç›¸è¾ƒç¼–ç ç”¨æ—¶æé•¿ï¼Œæ•…ä»£ç é‡æ„è¾ƒå°‘ï¼Œå› æ­¤ï¼Œè¯·å…è®¸æˆ‘ä¸é‡‡ç”¨æ¨èçš„æ ¼å¼ï¼ŒæŒ‰ç…§æˆ‘çš„ç¼–è¯‘å™¨è®¾è®¡å®Œæˆçš„æ€è·¯å®Œæˆè¿™ç¯‡è®¾è®¡æ–‡æ¡£ï¼Œä¸èƒœæ„Ÿæ¿€ï¼ï¼ï¼ å‚è€ƒç¼–è¯‘å™¨ä»‹ç»å‚è€ƒäº†å¼ºç”Ÿå­¦é•¿çš„ Pansyç¼–è¯‘å™¨ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„ç¼–è¯‘SysYè¯­è¨€åˆ°Mipsçš„ç¼–è¯‘å™¨ã€‚è¯¥ç¼–è¯‘å™¨è®¾è®¡æä¸ºç²¾ç¾ï¼Œæ¶æ„ç›¸å½“å®Œæ•´ï¼Œå¯æ‹“å±•æ€§å¼ºï¼Œæˆ‘çš„æ¶æ„ä¸»è¦ä¹Ÿæ¨¡ä»¿äº† Pansyç¼–è¯‘å™¨ å¦å¤–ï¼Œæ®å¼ºç”Ÿå­¦é•¿ä»‹ç»ï¼ŒPansyè¿˜æœ‰ç¾äººä¹‹æ„ï¼Œè¿™æ ·ä¸€çœ‹æˆ‘çš„ä»£ç ä¹Ÿå±äºæ˜¯ä¸œæ–½æ•ˆé¢¦äº†ğŸ˜‡ æ€»ä½“ç»“æ„ æ¥å£è®¾è®¡å…·ä½“çš„æ¥å£å±‚æœ‰å››å±‚ Tokens -&gt; CSTï¼šå‘å‰è´Ÿè´£ï¼Œæœ‰ä¸€ä¸ªç»Ÿä¸€çš„ Parser ç”¨äºç”Ÿæˆ CSTã€‚ CST -&gt; LLVM IRï¼šå‘åè´Ÿè´£ï¼ŒCST çš„æ¯ä¸ªèŠ‚ç‚¹å®ç°äº†ç›¸åº”çš„ irBuildã€‚ CST -&gt; Errorsï¼šå‘åè´Ÿè´£ï¼ŒCST çš„æ¯ä¸ªèŠ‚ç‚¹å®ç°äº†ç›¸åº”çš„ checkã€‚ LLVM IR -&gt; MIRï¼šå‘å‰è´Ÿè´£ï¼Œæœ‰ä¸€ä¸ªç»Ÿä¸€çš„ IrParser ç”¨äºç”Ÿæˆ MIRã€‚ æ–‡ä»¶ç»„ç»‡ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189.â”œâ”€â”€ Compiler.javaâ”œâ”€â”€ backâ”‚ â”œâ”€â”€ Backend.javaâ”‚ â”œâ”€â”€ README.mdâ”‚ â”œâ”€â”€ componentâ”‚ â”‚ â”œâ”€â”€ ObjBlock.javaâ”‚ â”‚ â”œâ”€â”€ ObjFunction.javaâ”‚ â”‚ â”œâ”€â”€ ObjGlobalVariable.javaâ”‚ â”‚ â””â”€â”€ ObjModule.javaâ”‚ â”œâ”€â”€ instructionâ”‚ â”‚ â”œâ”€â”€ ObjBinary.javaâ”‚ â”‚ â”œâ”€â”€ ObjBranch.javaâ”‚ â”‚ â”œâ”€â”€ ObjCall.javaâ”‚ â”‚ â”œâ”€â”€ ObjCoMove.javaâ”‚ â”‚ â”œâ”€â”€ ObjComment.javaâ”‚ â”‚ â”œâ”€â”€ ObjCompare.javaâ”‚ â”‚ â”œâ”€â”€ ObjCondType.javaâ”‚ â”‚ â”œâ”€â”€ ObjInstr.javaâ”‚ â”‚ â”œâ”€â”€ ObjLoad.javaâ”‚ â”‚ â”œâ”€â”€ ObjMove.javaâ”‚ â”‚ â”œâ”€â”€ ObjRet.javaâ”‚ â”‚ â”œâ”€â”€ ObjShift.javaâ”‚ â”‚ â””â”€â”€ ObjStore.javaâ”‚ â”œâ”€â”€ operandâ”‚ â”‚ â”œâ”€â”€ ObjImm.javaâ”‚ â”‚ â”œâ”€â”€ ObjLabel.javaâ”‚ â”‚ â”œâ”€â”€ ObjOperand.javaâ”‚ â”‚ â”œâ”€â”€ ObjPhyReg.javaâ”‚ â”‚ â”œâ”€â”€ ObjReg.javaâ”‚ â”‚ â””â”€â”€ ObjVirReg.javaâ”‚ â””â”€â”€ processâ”‚ â”œâ”€â”€ BlockLiveInfo.javaâ”‚ â”œâ”€â”€ IrParser.javaâ”‚ â”œâ”€â”€ Peephole.javaâ”‚ â””â”€â”€ RegAllocator.javaâ”œâ”€â”€ checkâ”‚ â”œâ”€â”€ CheckDataType.javaâ”‚ â”œâ”€â”€ Checker.javaâ”‚ â”œâ”€â”€ ErrorType.javaâ”‚ â”œâ”€â”€ FuncInfo.javaâ”‚ â”œâ”€â”€ PansyException.javaâ”‚ â”œâ”€â”€ README.mdâ”‚ â”œâ”€â”€ SymbolInfo.javaâ”‚ â”œâ”€â”€ SymbolTable.javaâ”‚ â””â”€â”€ VarInfo.javaâ”œâ”€â”€ driverâ”‚ â”œâ”€â”€ Config.javaâ”‚ â””â”€â”€ Driver.javaâ”œâ”€â”€ irâ”‚ â”œâ”€â”€ IrBuilder.javaâ”‚ â”œâ”€â”€ IrSymbolTable.javaâ”‚ â”œâ”€â”€ README.mdâ”‚ â”œâ”€â”€ typesâ”‚ â”‚ â”œâ”€â”€ ArrayType.javaâ”‚ â”‚ â”œâ”€â”€ DataType.javaâ”‚ â”‚ â”œâ”€â”€ FunctionType.javaâ”‚ â”‚ â”œâ”€â”€ IntType.javaâ”‚ â”‚ â”œâ”€â”€ LabelType.javaâ”‚ â”‚ â”œâ”€â”€ PointerType.javaâ”‚ â”‚ â”œâ”€â”€ ValueType.javaâ”‚ â”‚ â””â”€â”€ VoidType.javaâ”‚ â””â”€â”€ valuesâ”‚ â”œâ”€â”€ Argument.javaâ”‚ â”œâ”€â”€ BasicBlock.javaâ”‚ â”œâ”€â”€ Function.javaâ”‚ â”œâ”€â”€ GlobalVariable.javaâ”‚ â”œâ”€â”€ Module.javaâ”‚ â”œâ”€â”€ User.javaâ”‚ â”œâ”€â”€ Value.javaâ”‚ â”œâ”€â”€ constantsâ”‚ â”‚ â”œâ”€â”€ ConstArray.javaâ”‚ â”‚ â”œâ”€â”€ ConstInt.javaâ”‚ â”‚ â”œâ”€â”€ ConstStr.javaâ”‚ â”‚ â”œâ”€â”€ Constant.javaâ”‚ â”‚ â””â”€â”€ ZeroInitializer.javaâ”‚ â””â”€â”€ instructionsâ”‚ â”œâ”€â”€ Add.javaâ”‚ â”œâ”€â”€ Alloca.javaâ”‚ â”œâ”€â”€ BinInstruction.javaâ”‚ â”œâ”€â”€ Br.javaâ”‚ â”œâ”€â”€ Call.javaâ”‚ â”œâ”€â”€ GetElementPtr.javaâ”‚ â”œâ”€â”€ Icmp.javaâ”‚ â”œâ”€â”€ Instruction.javaâ”‚ â”œâ”€â”€ Load.javaâ”‚ â”œâ”€â”€ MemInstruction.javaâ”‚ â”œâ”€â”€ Mul.javaâ”‚ â”œâ”€â”€ Phi.javaâ”‚ â”œâ”€â”€ Ret.javaâ”‚ â”œâ”€â”€ Sdiv.javaâ”‚ â”œâ”€â”€ Srem.javaâ”‚ â”œâ”€â”€ Store.javaâ”‚ â”œâ”€â”€ Sub.javaâ”‚ â”œâ”€â”€ TerInstruction.javaâ”‚ â””â”€â”€ Zext.javaâ”œâ”€â”€ lexerâ”‚ â”œâ”€â”€ Lexer.javaâ”‚ â”œâ”€â”€ README.mdâ”‚ â””â”€â”€ tokenâ”‚ â”œâ”€â”€ Comment.javaâ”‚ â”œâ”€â”€ Delimiter.javaâ”‚ â”œâ”€â”€ EOFToken.javaâ”‚ â”œâ”€â”€ FormString.javaâ”‚ â”œâ”€â”€ Identifier.javaâ”‚ â”œâ”€â”€ IntConst.javaâ”‚ â”œâ”€â”€ Reserved.javaâ”‚ â”œâ”€â”€ SyntaxType.javaâ”‚ â””â”€â”€ Token.javaâ”œâ”€â”€ parserâ”‚ â”œâ”€â”€ ParseSupporter.javaâ”‚ â”œâ”€â”€ Parser.javaâ”‚ â”œâ”€â”€ README.mdâ”‚ â”œâ”€â”€ SysY.g4â”‚ â””â”€â”€ cstâ”‚ â”œâ”€â”€ AddExpNode.javaâ”‚ â”œâ”€â”€ AssignStmtNode.javaâ”‚ â”œâ”€â”€ BTypeNode.javaâ”‚ â”œâ”€â”€ BlockItemNode.javaâ”‚ â”œâ”€â”€ BlockNode.javaâ”‚ â”œâ”€â”€ BreakStmtNode.javaâ”‚ â”œâ”€â”€ CSTNode.javaâ”‚ â”œâ”€â”€ CalleeNode.javaâ”‚ â”œâ”€â”€ CondNode.javaâ”‚ â”œâ”€â”€ ConditionStmtNode.javaâ”‚ â”œâ”€â”€ ConstDeclNode.javaâ”‚ â”œâ”€â”€ ConstDefNode.javaâ”‚ â”œâ”€â”€ ConstExpNode.javaâ”‚ â”œâ”€â”€ ConstInitValNode.javaâ”‚ â”œâ”€â”€ ContinueStmtNode.javaâ”‚ â”œâ”€â”€ DeclNode.javaâ”‚ â”œâ”€â”€ EqExpNode.javaâ”‚ â”œâ”€â”€ ExpNode.javaâ”‚ â”œâ”€â”€ ExpStmtNode.javaâ”‚ â”œâ”€â”€ FuncDefNode.javaâ”‚ â”œâ”€â”€ FuncFParamNode.javaâ”‚ â”œâ”€â”€ FuncFParamsNode.javaâ”‚ â”œâ”€â”€ FuncRParamsNode.javaâ”‚ â”œâ”€â”€ FuncTypeNode.javaâ”‚ â”œâ”€â”€ InStmtNode.javaâ”‚ â”œâ”€â”€ InitValNode.javaâ”‚ â”œâ”€â”€ LAndExpNode.javaâ”‚ â”œâ”€â”€ LOrExpNode.javaâ”‚ â”œâ”€â”€ LValNode.javaâ”‚ â”œâ”€â”€ MainFuncDefNode.javaâ”‚ â”œâ”€â”€ MulExpNode.javaâ”‚ â”œâ”€â”€ NumberNode.javaâ”‚ â”œâ”€â”€ OutStmtNode.javaâ”‚ â”œâ”€â”€ PrimaryExpNode.javaâ”‚ â”œâ”€â”€ RelExpNode.javaâ”‚ â”œâ”€â”€ ReturnStmtNode.javaâ”‚ â”œâ”€â”€ RootNode.javaâ”‚ â”œâ”€â”€ StmtNode.javaâ”‚ â”œâ”€â”€ TokenNode.javaâ”‚ â”œâ”€â”€ UnaryExpNode.javaâ”‚ â”œâ”€â”€ UnaryOpNode.javaâ”‚ â”œâ”€â”€ VarDeclNode.javaâ”‚ â”œâ”€â”€ VarDefNode.javaâ”‚ â””â”€â”€ WhileStmtNode.javaâ”œâ”€â”€ passâ”‚ â”œâ”€â”€ Pass.javaâ”‚ â”œâ”€â”€ PassManager.javaâ”‚ â”œâ”€â”€ README.mdâ”‚ â”œâ”€â”€ analyzeâ”‚ â”‚ â”œâ”€â”€ BuildCFG.javaâ”‚ â”‚ â”œâ”€â”€ DomInfo.javaâ”‚ â”‚ â”œâ”€â”€ Loop.javaâ”‚ â”‚ â”œâ”€â”€ LoopInfo.javaâ”‚ â”‚ â”œâ”€â”€ LoopInfoAnalysis.javaâ”‚ â”‚ â””â”€â”€ SideEffectAnalysis.javaâ”‚ â””â”€â”€ refactorâ”‚ â”œâ”€â”€ BranchOpt.javaâ”‚ â”œâ”€â”€ DeadCodeEmit.javaâ”‚ â”œâ”€â”€ FunctionClone.javaâ”‚ â”œâ”€â”€ GCM.javaâ”‚ â”œâ”€â”€ GVN.javaâ”‚ â”œâ”€â”€ GlobalVariableLocalize.javaâ”‚ â”œâ”€â”€ InlineFunction.javaâ”‚ â”œâ”€â”€ InstructionSimplify.javaâ”‚ â”œâ”€â”€ Mem2reg.javaâ”‚ â””â”€â”€ UselessRetEmit.javaâ””â”€â”€ util â”œâ”€â”€ MyCompare.java â”œâ”€â”€ MyIO.java â”œâ”€â”€ MyList.java â”œâ”€â”€ MyMath.java â”œâ”€â”€ MyPair.java â””â”€â”€ MyPrintf.java ç¼–è¯‘å™¨æ€»ä½“è®¾è®¡æ€»ä½“ç»“æ„é€šè¿‡ç†è®ºè¯¾çš„å­¦ä¹ å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬é€šå¸¸å°†ç¼–è¯‘è¿‡ç¨‹åˆ†ä¸ºå¦‚ä¸‹é˜¶æ®µï¼š è¯æ³•åˆ†æï¼Œè¯­æ³•åˆ†æï¼Œè¯­ä¹‰åˆ†æï¼Œllvmç”Ÿæˆï¼Œllvmä¼˜åŒ–ï¼Œmipsç”ŸæˆåŠä¼˜åŒ–ï¼Œå…¶ä¸­é”™è¯¯å¤„ç†è´¯ç©¿æ•´ä¸ªå‰ç«¯è¿‡ç¨‹ã€‚ å‰ç«¯ è¯æ³•åˆ†æï¼šæ„å»ºäº†è´ªå¿ƒç®€åŒ–çš„ DFAï¼Œè¾“å…¥æºç¨‹åºï¼Œè¾“å‡º tokenåºåˆ—ã€‚ è¯­æ³•åˆ†æï¼šé€šè¿‡é€’å½’ä¸‹é™å­ç¨‹åºï¼Œè¿›è¡Œæœ€å·¦æ¨å¯¼ã€‚å…¶ä¸­é‡‡ç”¨äº† æ‰©å……çš„BNFèŒƒå¼è§£å†³å·¦é€’å½’é—®é¢˜ï¼Œå¹¶é€šè¿‡ é¢„è¯»FIRSTé›†çš„æ–¹å¼æ¥å°½å¯èƒ½é¿å…å›æº¯å¹¶å®Œæˆé”™è¯¯å¤„ç†ã€‚ è¯­ä¹‰åˆ†æï¼šé€šè¿‡éå†è¯­æ³•åˆ†æå¾—åˆ°çš„è¯­æ³•æ ‘ï¼Œæ„å»ºç¬¦å·è¡¨ã€‚ é”™è¯¯å¤„ç†ï¼šåœ¨è¯æ³•åˆ†æã€è¯­æ³•åˆ†æä¸­è¿›è¡Œè¯­æ³•é”™è¯¯å¤„ç†ï¼Œåœ¨è¯­ä¹‰åˆ†æä¸­è¿›è¡Œè¯­ä¹‰é”™è¯¯å¤„ç†ã€‚ ä¸­ç«¯(llvmä¼˜åŒ–) ä¸­ç«¯å®ç°äº† Mem2regï¼Œé‡æ„å¹¶ç”Ÿæˆäº†å¸¦æœ‰ phiå‡½æ•°çš„ä¸­é—´ä»£ç ã€‚ æ„å»ºæ§åˆ¶æµå›¾(CFG)ï¼Œæ±‚è§£æ”¯é…è€…ä¸æ”¯é…è¾¹ç•Œã€‚ é‡æ„SSAï¼ŒphiæŒ‡ä»¤çš„æ’å…¥ä¸å˜é‡é‡å‘½åã€‚ å‰¯ä½œç”¨åˆ†æ GVL DCEï¼ˆæ­»ä»£ç åˆ é™¤ï¼‰ åç«¯(mipsä»£ç ç”ŸæˆåŠä¼˜åŒ–) é phiæŒ‡ä»¤ä¸­é—´ä»£ç çš„ç¿»è¯‘ï¼ŒphiæŒ‡ä»¤çš„ç¿»è¯‘ã€‚è‡³æ­¤ä¸ºæ­¢åˆ†é…çš„éƒ½æ˜¯è™šæ‹Ÿå¯„å­˜å™¨ã€‚ å›¾ç€è‰²å¯„å­˜å™¨åˆ†é…ã€‚ å°‘é‡çª¥å­”ä¼˜åŒ–ã€‚ æ¥å£è®¾è®¡ç±»ä¼¼äº Pansyï¼š å…·ä½“çš„æ¥å£å±‚æœ‰å››å±‚ Tokens -&gt; ASTï¼šå‘å‰è´Ÿè´£ï¼Œæœ‰ä¸€ä¸ªç»Ÿä¸€çš„ Parser ç”¨äºç”Ÿæˆ ASTã€‚ AST -&gt; Symbolï¼šå‘åè´Ÿè´£ï¼ŒAST çš„æ¯ä¸ªèŠ‚ç‚¹å®ç°äº†ç›¸åº”çš„ visitæ–¹æ³•ã€‚ AST -&gt; Errorsï¼šå‘åè´Ÿè´£ï¼ŒAST çš„æ¯ä¸ªèŠ‚ç‚¹å®ç°äº†ç›¸åº”çš„ visitæ–¹æ³•åœ¨å…¶ä¸­å®Œæˆé”™è¯¯å¤„ç†ã€‚ AST -&gt; LLVM IRï¼šå‘åè´Ÿè´£ï¼ŒAST çš„æ¯ä¸ªèŠ‚ç‚¹å®ç°äº†ç›¸åº”çš„ BuildIræ–¹æ³•ã€‚ LLVM IR -&gt; MIPSï¼šå‘å‰è´Ÿè´£ï¼Œæœ‰ä¸€ä¸ªç»Ÿä¸€çš„ MipsBuilderç”¨äºç”Ÿæˆ MIPSã€‚ æ–‡ä»¶ç»„ç»‡123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170.â”œâ”€â”€ Compiler.javaâ”œâ”€â”€ backendâ”‚ â”œâ”€â”€ MipsBuilder.javaâ”‚ â”œâ”€â”€ MipsFactory.javaâ”‚ â”œâ”€â”€ componentsâ”‚ â”‚ â”œâ”€â”€ MipsBlock.javaâ”‚ â”‚ â”œâ”€â”€ MipsFunction.javaâ”‚ â”‚ â”œâ”€â”€ MipsGlobalVariable.javaâ”‚ â”‚ â””â”€â”€ MipsModule.javaâ”‚ â”œâ”€â”€ instructionsâ”‚ â”‚ â”œâ”€â”€ MipsBinary.javaâ”‚ â”‚ â”œâ”€â”€ MipsBranch.javaâ”‚ â”‚ â”œâ”€â”€ MipsCall.javaâ”‚ â”‚ â”œâ”€â”€ MipsComment.javaâ”‚ â”‚ â”œâ”€â”€ MipsCompare.javaâ”‚ â”‚ â”œâ”€â”€ MipsCondType.javaâ”‚ â”‚ â”œâ”€â”€ MipsInstruction.javaâ”‚ â”‚ â”œâ”€â”€ MipsLoad.javaâ”‚ â”‚ â”œâ”€â”€ MipsMacro.javaâ”‚ â”‚ â”œâ”€â”€ MipsMove.javaâ”‚ â”‚ â”œâ”€â”€ MipsMoveHI.javaâ”‚ â”‚ â”œâ”€â”€ MipsRet.javaâ”‚ â”‚ â”œâ”€â”€ MipsShift.javaâ”‚ â”‚ â””â”€â”€ MipsStore.javaâ”‚ â”œâ”€â”€ operandsâ”‚ â”‚ â”œâ”€â”€ MipsImm.javaâ”‚ â”‚ â”œâ”€â”€ MipsLabel.javaâ”‚ â”‚ â”œâ”€â”€ MipsOperand.javaâ”‚ â”‚ â”œâ”€â”€ MipsRealReg.javaâ”‚ â”‚ â”œâ”€â”€ MipsVirtualReg.javaâ”‚ â”‚ â””â”€â”€ RegType.javaâ”‚ â”œâ”€â”€ regâ”‚ â”‚ â”œâ”€â”€ BlockLiveVarInfo.javaâ”‚ â”‚ â””â”€â”€ RegAllocator.javaâ”‚ â””â”€â”€ utilsâ”‚ â”œâ”€â”€ MipsMathOpt.javaâ”‚ â”œâ”€â”€ MipsUtil.javaâ”‚ â”œâ”€â”€ Pair.javaâ”‚ â””â”€â”€ Triple.javaâ”œâ”€â”€ compiler.zipâ”œâ”€â”€ config.jsonâ”œâ”€â”€ errorâ”‚ â”œâ”€â”€ Error.javaâ”‚ â”œâ”€â”€ ErrorHandler.javaâ”‚ â”œâ”€â”€ ErrorType.javaâ”‚ â””â”€â”€ ErrorUtil.javaâ”œâ”€â”€ exceptionâ”‚ â””â”€â”€ LexerException.javaâ”œâ”€â”€ frontendâ”‚ â”œâ”€â”€ Lexer.javaâ”‚ â”œâ”€â”€ Parser.javaâ”‚ â””â”€â”€ Visitor.javaâ”œâ”€â”€ irâ”‚ â”œâ”€â”€ IrBuilder.javaâ”‚ â”œâ”€â”€ IrFactory.javaâ”‚ â”œâ”€â”€ IrSymbolTable.javaâ”‚ â”œâ”€â”€ IrSymbolTableStack.javaâ”‚ â”œâ”€â”€ IrUtil.javaâ”‚ â”œâ”€â”€ typesâ”‚ â”‚ â”œâ”€â”€ ArrayType.javaâ”‚ â”‚ â”œâ”€â”€ CharType.javaâ”‚ â”‚ â”œâ”€â”€ FuncType.javaâ”‚ â”‚ â”œâ”€â”€ IntType.javaâ”‚ â”‚ â”œâ”€â”€ LabelType.javaâ”‚ â”‚ â”œâ”€â”€ PointerType.javaâ”‚ â”‚ â”œâ”€â”€ ValueType.javaâ”‚ â”‚ â””â”€â”€ VoidType.javaâ”‚ â””â”€â”€ valuesâ”‚ â”œâ”€â”€ BasicBlock.javaâ”‚ â”œâ”€â”€ Function.javaâ”‚ â”œâ”€â”€ GlobalVariable.javaâ”‚ â”œâ”€â”€ Module.javaâ”‚ â”œâ”€â”€ User.javaâ”‚ â”œâ”€â”€ Value.javaâ”‚ â”œâ”€â”€ constantsâ”‚ â”‚ â”œâ”€â”€ ConstArray.javaâ”‚ â”‚ â”œâ”€â”€ ConstChar.javaâ”‚ â”‚ â”œâ”€â”€ ConstInt.javaâ”‚ â”‚ â”œâ”€â”€ ConstString.javaâ”‚ â”‚ â”œâ”€â”€ Constant.javaâ”‚ â”‚ â””â”€â”€ ZeroInitializer.javaâ”‚ â”œâ”€â”€ instructionsâ”‚ â”‚ â”œâ”€â”€ Add.javaâ”‚ â”‚ â”œâ”€â”€ Alloca.javaâ”‚ â”‚ â”œâ”€â”€ ArithmeticInstruction.javaâ”‚ â”‚ â”œâ”€â”€ Br.javaâ”‚ â”‚ â”œâ”€â”€ Call.javaâ”‚ â”‚ â”œâ”€â”€ GetElementPtr.javaâ”‚ â”‚ â”œâ”€â”€ Icmp.javaâ”‚ â”‚ â”œâ”€â”€ Instruction.javaâ”‚ â”‚ â”œâ”€â”€ Load.javaâ”‚ â”‚ â”œâ”€â”€ Mul.javaâ”‚ â”‚ â”œâ”€â”€ Phi.javaâ”‚ â”‚ â”œâ”€â”€ Ret.javaâ”‚ â”‚ â”œâ”€â”€ Sdiv.javaâ”‚ â”‚ â”œâ”€â”€ Srem.javaâ”‚ â”‚ â”œâ”€â”€ Store.javaâ”‚ â”‚ â”œâ”€â”€ Sub.javaâ”‚ â”‚ â”œâ”€â”€ Trunc.javaâ”‚ â”‚ â””â”€â”€ Zext.javaâ”‚ â””â”€â”€ passâ”‚ â”œâ”€â”€ AggressiveDeadCodeEmit.javaâ”‚ â”œâ”€â”€ BuildCFG.javaâ”‚ â”œâ”€â”€ DeadCodeEmit.javaâ”‚ â”œâ”€â”€ DomInfo.javaâ”‚ â”œâ”€â”€ GVL.javaâ”‚ â”œâ”€â”€ Loop.javaâ”‚ â”œâ”€â”€ LoopInfo.javaâ”‚ â”œâ”€â”€ Mem2Reg.javaâ”‚ â”œâ”€â”€ SideEffectAnalysis.javaâ”‚ â””â”€â”€ UselessRetEmit.javaâ”œâ”€â”€ nodeâ”‚ â”œâ”€â”€ AddExpNode.javaâ”‚ â”œâ”€â”€ BTypeNode.javaâ”‚ â”œâ”€â”€ BlockItemNode.javaâ”‚ â”œâ”€â”€ BlockNode.javaâ”‚ â”œâ”€â”€ CharacterNode.javaâ”‚ â”œâ”€â”€ CompUnitNode.javaâ”‚ â”œâ”€â”€ CondNode.javaâ”‚ â”œâ”€â”€ ConstDeclNode.javaâ”‚ â”œâ”€â”€ ConstDefNode.javaâ”‚ â”œâ”€â”€ ConstExpNode.javaâ”‚ â”œâ”€â”€ ConstInitValNode.javaâ”‚ â”œâ”€â”€ DeclNode.javaâ”‚ â”œâ”€â”€ EqExpNode.javaâ”‚ â”œâ”€â”€ ExpNode.javaâ”‚ â”œâ”€â”€ ForStmtNode.javaâ”‚ â”œâ”€â”€ FuncDefNode.javaâ”‚ â”œâ”€â”€ FuncFParamNode.javaâ”‚ â”œâ”€â”€ FuncFParamsNode.javaâ”‚ â”œâ”€â”€ FuncRParamsNode.javaâ”‚ â”œâ”€â”€ FuncTypeNode.javaâ”‚ â”œâ”€â”€ InitValNode.javaâ”‚ â”œâ”€â”€ LAndExpNode.javaâ”‚ â”œâ”€â”€ LOrExpNode.javaâ”‚ â”œâ”€â”€ LValNode.javaâ”‚ â”œâ”€â”€ MainFuncDefNode.javaâ”‚ â”œâ”€â”€ MulExpNode.javaâ”‚ â”œâ”€â”€ Node.javaâ”‚ â”œâ”€â”€ NodeType.javaâ”‚ â”œâ”€â”€ NumberNode.javaâ”‚ â”œâ”€â”€ PrimaryExpNode.javaâ”‚ â”œâ”€â”€ RelExpNode.javaâ”‚ â”œâ”€â”€ StmtNode.javaâ”‚ â”œâ”€â”€ StmtType.javaâ”‚ â”œâ”€â”€ UnaryExpNode.javaâ”‚ â”œâ”€â”€ UnaryOpNode.javaâ”‚ â”œâ”€â”€ VarDeclNode.javaâ”‚ â””â”€â”€ VarDefNode.javaâ”œâ”€â”€ optâ”‚ â””â”€â”€ Peephole.javaâ”œâ”€â”€ symbolâ”‚ â”œâ”€â”€ CharSymbol.javaâ”‚ â”œâ”€â”€ FuncSymbol.javaâ”‚ â”œâ”€â”€ NumSymbol.javaâ”‚ â”œâ”€â”€ Symbol.javaâ”‚ â”œâ”€â”€ SymbolTable.javaâ”‚ â”œâ”€â”€ SymbolTableStack.javaâ”‚ â””â”€â”€ SymbolType.javaâ”œâ”€â”€ testâ”‚ â””â”€â”€ testReg.javaâ”œâ”€â”€ tokenâ”‚ â”œâ”€â”€ Token.javaâ”‚ â””â”€â”€ TokenType.javaâ”œâ”€â”€ utilsâ”‚ â”œâ”€â”€ Config.javaâ”‚ â”œâ”€â”€ IO.javaâ”‚ â””â”€â”€ Phases.javaâ””â”€â”€ è®¾è®¡æ–‡æ¡£.md è¯æ³•åˆ†æå¤§ä½“æ€è·¯è¯æ³•åˆ†æéƒ¨åˆ†çš„ä¸»è¦ä»»åŠ¡æ˜¯é¡ºåºéå†æºç¨‹åºä»£ç ï¼Œå°†å…¶æŒ‰ç…§æ–‡æ³•è½¬åŒ–ä¸ºtokenåºåˆ—ã€‚ è¯æ³•åˆ†æå¯ä»¥é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æˆ–è€…è´ªå¿ƒç®€åŒ–è¿‡çš„DFAå®ç°ï¼Œæˆ‘å®Œæˆäº†æ­£åˆ™è¡¨è¾¾å¼çš„æ’°å†™ï¼Œä½†ç”±äºæˆ‘æ˜¯æ­£åˆ™è‹¦æ‰‹ï« ï¼Œæœ€ç»ˆæˆ‘é€‰æ‹©äº†åè€…ã€‚ DFAçš„è®¾è®¡DFAé€šè¿‡ fronted/Lexer.javaå®ç°ï¼Œæˆ‘ä»¬çš„å•è¯å¤§è‡´åˆ†ä¸ºå››ç±»ï¼Œåˆ†åˆ«æ˜¯ä¿ç•™å­—ã€ å­—ç¬¦ä¸²å¸¸é‡ã€æ ‡è¯†ç¬¦ã€åˆ†ç•Œç¬¦ã€‚é€šè¿‡è´ªå¿ƒåŒ¹é…ä¸åŒç±»åˆ«çš„FIRSTé›†åˆï¼Œå³å¯æ ¹æ®å½“å‰å­—ç¬¦ï¼Œç¡®å®šä¸‹é¢å°†è¦å¤„ç†çš„å•è¯çš„å¤§è‡´ç§ç±»ã€‚ è°ƒç”¨ next()æ–¹æ³•å³å¯è¯»å–ä¸‹ä¸€ä¸ªtokenï¼Œå¤§è‡´æ¡†æ¶å¦‚ä¸‹ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109public Token next() throws LexerException { currentToken = null; do { skipWhite(); } while (skipComment()); if (pos &gt; maxLength) { return null; } char nowChar = inputText.charAt(pos); if (Character.isDigit(nowChar)) { int endPos = pos + 1; while (endPos &lt;= maxLength &amp;&amp; Character.isDigit(inputText.charAt(endPos))) { endPos++; } String str = inputText.substring(pos, endPos); // æ›´æ–°pos pos = endPos; currentToken = new Token(str, lineNum, TokenType.INTCON); } else if (isIdentifierNondigit(nowChar)) { int endPos = pos + 1; while (endPos &lt;= maxLength &amp;&amp; isIdentifierDigit(inputText.charAt(endPos))) { endPos++; } String str = inputText.substring(pos, endPos); // æ›´æ–°pos pos = endPos; // åˆ¤æ–­æ˜¯å¦ä¸ºä¿ç•™å­— TokenType type = TokenType.isReserved(str); currentToken = new Token(str, lineNum, Objects.requireNonNullElse(type, TokenType.IDENFR)); } else if (nowChar == '\\'') { int endPos = pos + 1; boolean backslashFlag = false; while (endPos &lt;= maxLength &amp;&amp; (inputText.charAt(endPos) != '\\'' || (inputText.charAt(endPos) == '\\'' &amp;&amp; backslashFlag))) { backslashFlag = inputText.charAt(endPos) == '\\\\' &amp;&amp; !backslashFlag; endPos++; } // æ£€æŸ¥'æ˜¯å¦åŒ¹é… if (endPos &gt; maxLength) { throw new LexerException(lineNum); } endPos++; String str = inputText.substring(pos, endPos); pos = endPos; currentToken = new Token(str, lineNum, TokenType.CHRCON); } else if (nowChar == '\\&quot;') { int endPos = pos + 1; boolean backslashFlag = false; while (endPos &lt;= maxLength &amp;&amp; (inputText.charAt(endPos) != '\\&quot;' || inputText.charAt(endPos) == '\\&quot;' &amp;&amp; backslashFlag)) { backslashFlag = inputText.charAt(endPos) == '\\\\' &amp;&amp; !backslashFlag; endPos++; } // æ£€æŸ¥&quot;æ˜¯å¦åŒ¹é… if (endPos &gt; maxLength) { throw new LexerException(lineNum); } endPos++; String str = inputText.substring(pos, endPos); pos = endPos; currentToken = new Token(str, lineNum, TokenType.STRCON); } else { TokenType tokenType = null; int tokenLength = 0; String str = &quot;&quot;; if (TokenType.singleCharList.contains(nowChar)) { tokenType = TokenType.getTokenType((str = inputText.substring(pos, pos + 1))); tokenLength = 1; } if (pos &lt; maxLength &amp;&amp; TokenType.doubleCharList.contains(nowChar)) { TokenType t = TokenType.getTokenType(inputText.substring(pos, pos + 2)); if (t != null) { tokenType = t; tokenLength = 2; str = inputText.substring(pos, pos + 2); } else if (isErrorA(inputText.charAt(pos))) { System.out.println(inputText.charAt(pos) + &quot; &quot; + &quot;æˆ‘åšäº†é”™é¥­&quot;); ErrorHandler.addError(new Error(ErrorType.a, lineNum)); tokenType = (inputText.charAt(pos) == '&amp;') ? TokenType.AND : TokenType.OR; str = (inputText.charAt(pos) == '&amp;') ? &quot;&amp;&amp;&quot; : &quot;||&quot;; tokenLength = 1; } } if (tokenType != null) { currentToken = new Token(str, lineNum, tokenType); pos += tokenLength; } } if (currentToken != null) { tokenResult.add(currentToken); } return currentToken; } Tokenç±»ä¸ºäº†è¿›è¡Œå¯èƒ½çš„è¯­æ³•æ‹“å±•ï¼Œæˆ‘å¯¹äºå„ç§ tokenè¿›è¡Œäº†æŠ½è±¡ï¼Œå»ºç«‹Tokenç±»ï¼Œè¯¥ç±»è®°å½•äº† Tokençš„åŸå­—ç¬¦ä¸²ï¼Œtokençš„ç±»å‹ï¼Œä»¥åŠå…¶æ‰€åœ¨è¡Œå·ï¼ˆä¾›é”™è¯¯å¤„ç†ä½¿ç”¨ï¼‰ 12345public Token(String content, int lineNum, TokenType type) { this.content = content; this.lineNum = lineNum; this.type = type; } æœ‰å…³æ–‡æ³•è®¾å®šéƒ¨åˆ†ä½äº token/TokenType.java å¯¹äºæ‰€æœ‰ Tokenæ ‡è¯†ç¬¦ï¼Œæˆ‘éƒ½åŠ ä»¥æšä¸¾ï¼Œå®šä¹‰åœ¨æšä¸¾ç±» TokenTypeé‡Œã€‚ æ­¤å¤–ï¼Œä¸ºäº†ä¾¿äºçŠ¶æ€æœºè¯»å–å½“å‰å­—ç¬¦åçš„è¿›ä¸€æ­¥çŠ¶æ€è½¬ç§»ï¼Œå¯¹äºæ–‡æ³•ä¸­è§„å®šçš„ ä¿ç•™å­—ã€ä»¥åŠ å•/åŒåˆ†ç•Œç¬¦$ ==, \\ne, \\le, \\ge, \\gt, \\lt, !, &amp;, |$ï¼Œè¿›è¡Œå»ºè¡¨ä¸åˆ’åˆ†ã€‚ ä»¥ä¸Šä¸¤ç§ä¿¡æ¯å‡ä¸ºâ€œæ–‡æ³•ç»™å‡ºçš„è®¾å®šâ€ï¼Œå› æ­¤åœ¨è®¾è®¡ä¸Šç†åº”æ”¾å…¥ä¸€ä¸ªç±»ä¸­ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬çš„ Lexerç±»å¹¶ä¸ä¼šæŠŠæ–‡æ³•å†™æ­»åœ¨ä»£ç é‡Œï¼Œä¾¿äºåç»­æœŸä¸­æœŸæœ«è€ƒè¯•ä¿®æ”¹æ–‡æ³•æ—¶ï¼Œå¿«é€Ÿå®Œæˆè¯æ³•åˆ†æéƒ¨åˆ†çš„ä¿®æ”¹ã€‚ è¯­æ³•åˆ†æå¤§ä½“æ€è·¯è¯­æ³•åˆ†æçš„ä»»åŠ¡æ˜¯æ˜¯è¯»å…¥ tokenåºåˆ—ï¼Œå¹¶åˆ†æç¡®å®šå…¶è¯­æ³•ç»“æ„ï¼Œæœ€ç»ˆç”Ÿæˆè¯­æ³•æ ‘çš„è¿‡ç¨‹ã€‚ [!NOTE]é€šè¿‡ç†è®ºè¯¾æˆ‘ä»¬çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é€’å½’ä¸‹é™åˆ†ææ³•æ¥å®ç°è¯­æ³•åˆ†æï¼Œè€Œç”±äºé€’å½’ä¸‹é™å­ç¨‹åºæœ¬è´¨ä¸Šæ˜¯åœ¨è¿›è¡Œæœ€å·¦æ¨å¯¼ï¼Œå› æ­¤å¯èƒ½ä¼šé‡åˆ°å·¦é€’å½’å’Œå›æº¯çš„é—®é¢˜ã€‚ å…·ä½“æ¥è¯´: æˆ‘ä¸ºæ¯ä¸ªéç»ˆç»“ç¬¦ç¼–å†™ä¸€ä¸ªé€’å½’å­ç¨‹åºï¼Œä»¥å®Œæˆè¯¥éç»ˆç»“ç¬¦æ‰€å¯¹åº”çš„è¯­æ³•æˆåˆ†çš„åˆ†æä¸è¯†åˆ«ä»»åŠ¡ï¼Œè‹¥æ­£ç¡®è¯†åˆ«ï¼Œåˆ™å¯ä»¥é€€å‡ºè¯¥éç»ˆç»“ç¬¦å·çš„å­ç¨‹åºï¼Œè¿”å›åˆ°ä¸Šä¸€çº§çš„å­ç¨‹åºç»§ç»­åˆ†æï¼›è‹¥å‘ç”Ÿé”™è¯¯ï¼Œå³æºç¨‹åºä¸ç¬¦åˆæ–‡æ³•ï¼Œåˆ™è¦è¿›è¡Œç›¸åº”çš„é”™è¯¯ä¿¡æ¯æŠ¥å‘Šä»¥åŠé”™è¯¯å¤„ç†ã€‚ nextSym()çš„å®ç° [!NOTE] é€šè¿‡ç†è®ºè¯¾çš„å­¦ä¹ æˆ‘ä»¬çŸ¥é“ï¼Œæ³•åˆ†æçš„æ¨è¿›ï¼Œæœ¬è´¨ä¸Šæ˜¯ç»ˆç»“ç¬¦è¯†åˆ«è¿›åº¦çš„æ¨è¿›ï¼Œå› æ­¤ nextSymçš„è°ƒç”¨æ—¶æœºåº”å½“æ˜¯æˆåŠŸè¯†åˆ«ä¸€ä¸ªç»ˆç»“ç¬¦åã€‚ äº‹å®ä¸Šï¼Œåœ¨ç†è®ºè¯¾æä¾›çš„ Pascalè¯­è¨€ç¼–è¯‘å™¨çš„è¯­æ³•åˆ†æéƒ¨åˆ†ï¼Œå¯¹äº nextSymçš„è®¾è®¡å¤ªè¿‡ç®€å•ï¼Œå¯¼è‡´ç¤ºä¾‹ç¨‹åºä½å†…èšï¼Œé«˜è€¦åˆï¼Œè€ƒè™‘åˆ°åœ¨è¯­æ³•åˆ†æéƒ¨åˆ†å°±æœ‰è¿›è¡Œé”™è¯¯å¤„ç†çš„éœ€è¦ï¼Œæˆ‘å¯¹äº nextSym()ç¨‹åºè¿›è¡Œäº†æ”¹å†™ã€‚ å…·ä½“æ€è·¯ä¸ºï¼šå°†è¯†åˆ«ç»ˆç»“ç¬¦ï¼ŒnextSymï¼Œä»¥åŠåç»­å¯èƒ½çš„é”™è¯¯å¤„ç†æ•´åˆè¿›ä¸€ä¸ªå‡½æ•°å½“ä¸­ã€‚ å·¦é€’å½’çš„å¤„ç†æ¶‰åŠåˆ°å·¦é€’å½’çš„æ–‡æ³•ä¸»è¦æ˜¯å…³äº Expç³»åˆ—çš„éç»ˆç»“ç¬¦ã€‚ 1AddExp -&gt; MulExp | AddExp ('+' | 'âˆ’') MulExp [!NOTE] é€šè¿‡ç†è®ºè¯¾çš„å­¦ä¹ æˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºå·¦é€’å½’æ–‡æ³•ï¼Œä¸€èˆ¬æœ‰2ç§å¤„ç†æ–¹å¼â€”â€”å³é€’å½’æ”¹å†™ or é‡‡ç”¨æ‰©å……çš„BNFèŒƒå¼ å³é€’å½’æ”¹å†™ä¾‹å¦‚ï¼š 1AddExp -&gt; MulExp | MulExp ('+' | 'âˆ’') AddExp ä½†å¦‚æ­¤å¤„ç†æ˜¯å­˜åœ¨æ½œåœ¨é£é™©çš„ï¼Œå› ä¸ºä¿®æ”¹äº†æ–‡æ³• æ‰©å……çš„BNFèŒƒå¼è¿˜æœ‰ä¸€ç§å¤„ç†æ–¹å¼æ˜¯é‡‡ç”¨BNFèŒƒå¼ï¼Œä¿®æ”¹äº†æ–‡æ³•ï¼Œç›´æ¥ä¸¢æ‰ AddExpã€‚ 1AddExp -&gt; MulExp {'+' MulExp} è¿™ç§å¤„ç†æ–¹å¼ä¾ç„¶å­˜åœ¨é£é™©ï¼Œå› ä¸ºåç»­çš„æ‰€æœ‰ç¼–è¯‘ç¯èŠ‚éƒ½è¦ç›¸åº”åœ°ä½¿ç”¨ä¿®æ”¹åçš„æ–‡æ³•ã€‚ å¤„ç†æ–¹å¼ [!IMPORTANT] ç»è¿‡ä¸Šè¿°åˆ†æï¼Œè€ƒè™‘åˆ°æœªæ¥ æœŸä¸­æœŸæœ«è€ƒè¯•å¯èƒ½æ¶‰åŠçš„æ½œåœ¨çš„æ–‡æ³•ä¿®æ”¹ä¸æ›´æ–°ï¼Œé€šè¿‡å‚è€ƒå­¦é•¿ç¼–è¯‘å™¨çš„è®¾è®¡ï¼Œæˆ‘å†³å®šé‡‡ç”¨ä¸€ç§æ›´ç¬¦åˆå®é™…ç¼–è¯‘å™¨æ’°å†™çš„æ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œå³ï¼š å¯¹äºä¸Šè¿°ä¾‹å­ï¼Œåœ¨æ‰©å……çš„BNFèŒƒå¼çš„åŸºç¡€ä¸Šå†è¿›ä¸€æ­¥ï¼ŒæŠŠåˆšåˆšæ‹†å‡ºæ¥çš„æ‰€æœ‰ MulExpå…¨éƒ¨æ‰‹åŠ¨ç»„è£…å›å·¦é€’å½’çš„å½¢æ€ã€‚æˆ‘ä»¬åˆ©ç”¨ javaçš„é¢å‘å¯¹è±¡ç‰¹æ€§ï¼Œå°†è§£æå‡ºçš„ MulExpé‡æ–°ç»„è£…ä¸º AddExpã€‚ æ­¤æ—¶å·¦é€’å½’å¯¹äºåç»­çš„ç¼–è¯‘éƒ¨åˆ†ä¸å†æœ‰å½±å“ï¼Œå› ä¸ºæˆ‘ä»¬çš„ä¿¡æ¯å·²ç»å…¨éƒ¨å­˜å‚¨åœ¨ç¼–è¯‘å™¨ä¸­ï¼Œä¸å†å—åˆ°æœ€å·¦æ¨å¯¼çš„é™åˆ¶ã€‚ ä»£ç ç¤ºä¾‹ï¼š 12345678910111213// AddExp â†’ MulExp | AddExp ('+' | 'âˆ’') MulExp public AddExpNode AddExp() { AddExpNode addExpNode = null; Token opToken = null; MulExpNode mulExpNode = MulExp(); while (currentToken.type == TokenType.PLUS || currentToken.type == TokenType.MINU) { addExpNode = new AddExpNode(addExpNode, opToken, mulExpNode); opToken = matchToken(currentToken.type); mulExpNode = MulExp(); } return new AddExpNode(addExpNode, opToken, mulExpNode); } å›æº¯æ³•å¯¹äºä¸€èˆ¬çš„äº§ç”Ÿå¼ï¼Œæˆ‘ä»¬é‡‡ç”¨FIRSTé›†æ¥åˆ¤åˆ«å³å¯ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›ä¸é‚£ä¹ˆå‹å¥½çš„äº§ç”Ÿå¼ï¼Œæˆ‘ä»¬éš¾ä»¥åˆ¤åˆ«ï¼š é€‰æ‹©å“ªä¸ªäº§ç”Ÿå¼ã€‚ äº§ç”Ÿå¼ä¸­ {xxx}çš„é‡å¤éƒ¨åˆ†ï¼Œåˆ°åº•åº”è¯¥ä½•æ—¶ç»“æŸã€‚ é‡å¤éƒ¨åˆ†å•¥æ—¶å€™ç»“æŸï¼Ÿçœ‹çœ‹ )ï¼Œ]ä¸å°±å¥½äº†ï¼Ÿäº‹å®ä¸Šï¼Œæˆ‘ä»¬åœ¨åç»­é”™è¯¯å¤„ç†ä¸­é‡‡å–çš„ï¼Œè¡¥å…¨çš„é”™è¯¯å±€éƒ¨åŒ–ç­–ç•¥ï¼Œè¿«ä½¿æˆ‘ä»¬çš„ç¨‹åºåœ¨ )ï¼Œ]ç¼ºå¤±æ—¶ä¾ç„¶è¦æ­£å¸¸å·¥ä½œã€‚ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åªå¾—ä»¥å¾ªç¯éƒ¨çš„FIRSTé›†æ¥åˆ¤åˆ«ã€‚ å›åˆ°æˆ‘ä»¬çš„å›æº¯é—®é¢˜æ¥ã€‚ å›æº¯ï¼Œå³FIRSTä¹Ÿå¤±çµçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¢«è¿«è·³è¿‡æŸä¸ªéç»ˆç»“ç¬¦ï¼Œå¯¹åé¢çš„æ ‡å¿—æ€§ç¬¦å·è¿›è¡Œåˆ†æï¼Œä»è€Œåˆ¤æ–­é€‰å–çš„äº§ç”Ÿå¼åˆ†æ”¯çš„æ‰‹æ®µã€‚ å›æº¯åªäº§ç”Ÿåœ¨ Stmtçš„å·¦å€¼ä¸ Expåˆ¤åˆ«ä¸Šï¼š 1234plaintextStmt -&gt; LVal '=' Exp ';'Stmt -&gt; [Exp] ';'Stmt -&gt; LVal '=' 'getint''('')'';' åœ¨è¿™é‡Œï¼ŒExpå½“ç„¶å¯ä»¥é€è¿‡ PrimaryExpæ¨å‡ºå·¦å€¼ LValï¼ŒFIRSTé›†å¤±çµã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬è¦å¤„ç†æ‰ç¢äº‹çš„ LValï¼Œæš´éœ²å‡ºåé¢çš„ =å’Œ getintã€‚ å›æº¯ä¸»è¦æ˜¯é‡‡ç”¨ pinToken()å’Œ reflow()æ¥è®°å½•ã€å¤åŸå½“å‰æ¸¸æ ‡åœ¨tokenåºåˆ—çš„ä½ç½®ã€‚è¯¦ç»†ä»£ç åŠæ³¨é‡Šå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647default -&gt; { // æœ€å–œæ¬¢çš„ä¸€é›† // ä½™ä¸‹å››ç§æƒ…å†µï¼š // LVal '=' Exp ';' // [Exp] ';' // LVal '=' 'getint''('')'';' // LVal '=' 'getchar''('')'';' if (currentToken.type == TokenType.SEMICN) { //ç›´æ¥åŒ¹é…ï¼Œæœ€å–œæ¬¢çš„ä¸€é›† tokens.add(matchToken(TokenType.SEMICN)); type = StmtType.EXP; } else { pinToken(); LValNode lValNode = LVal(); if (currentToken.type == TokenType.ASSIGN) { nodes.add(lValNode); tokens.add(matchToken(TokenType.ASSIGN)); // LVal '=' 'getint''('')'';' // LVal '=' 'getchar''('')'';' if (currentToken.type == TokenType.GETINTTK) { tokens.add(matchToken(TokenType.GETINTTK)); tokens.add(matchToken(TokenType.LPARENT)); tokens.add(matchToken(TokenType.RPARENT)); tokens.add(matchToken(TokenType.SEMICN)); type = StmtType.LVALGETINT; } else if (currentToken.type == TokenType.GETCHARTK) { tokens.add(matchToken(TokenType.GETCHARTK)); tokens.add(matchToken(TokenType.LPARENT)); tokens.add(matchToken(TokenType.RPARENT)); tokens.add(matchToken(TokenType.SEMICN)); type = StmtType.LVALGETCHR; } else { // LVal '=' Exp ';' nodes.add(Exp()); tokens.add(matchToken(TokenType.SEMICN)); type = StmtType.LVALASSIGN; } } else { reflow(); ExpNode expNode = Exp(); nodes.add(expNode); tokens.add(matchToken(TokenType.SEMICN)); type = StmtType.EXP; } } } Nodeç±»â€”â€”å‰ç«¯ğŸ”—ä¸­ç«¯çš„å…³é”®nodeç±»æ˜¯è¯­æ³•åˆ†æä¸­ï¼Œè¯­æ³•æ ‘çš„ç»“ç‚¹ï¼Œè®°å½•äº†è¯­æ³•åˆ†æçš„ç»“æœã€‚æ˜¯è´¯ç©¿äº†è¯­æ³•åˆ†æã€é”™è¯¯å¤„ç†ã€ä¸­é—´ä»£ç ç”Ÿæˆçš„é‡è¦ç±»ã€‚ å¯¹äºæ¯ä¸€ä¸ªéç»ˆç»“ç¬¦ï¼Œéƒ½å»ºç«‹ä¸€ä¸ª nodeç±»ã€‚æ‰€æœ‰ nodeç±»éƒ½ç»§æ‰¿äº†æŠ½è±¡çˆ¶ç±» Nodeã€‚ Nodeè§„å®šäº†æ‰€æœ‰ nodeç±»éƒ½è¦å®ç°çš„ä¸‰ä¸ªæ–¹æ³•ï¼Œç”¨äºåœ¨éå†è¯­æ³•æ ‘æ—¶æ‰§è¡Œç›¸åº”çš„åŠ¨ä½œï¼ˆå³é€’å½’ä¸‹é™æ—¶çš„åŠ¨ä½œç¬¦å·ï¼‰ï¼š print()æ–¹æ³•ï¼Œé€è¿‡éå†è¯­æ³•æ ‘ï¼Œè¾“å‡ºè¯­æ³•åˆ†æç»“æœè‡³æ–‡ä»¶ã€‚ visit()æ–¹æ³•ï¼Œé€è¿‡éå†è¯­æ³•æ ‘ï¼Œæ£€æŸ¥é”™è¯¯å¹¶è®°å½•ã€‚ buildIr()æ–¹æ³•ï¼Œé€è¿‡éå†è¯­æ³•æ ‘ï¼Œç”Ÿæˆ llvmä»£ç ã€‚ è¯­ä¹‰åˆ†æ&amp;&amp;é”™è¯¯å¤„ç†åœ¨å½“å‰å‰ç«¯é˜¶æ®µï¼Œæˆ‘ä»¬è¦æ±‚ç”Ÿæˆçš„ç¬¦å·è¡¨è¿˜æ˜¯è¿‡äºç®€æ˜“ï¼Œå®é™…ä¸Šï¼Œåªå¯¹äºé”™è¯¯å¤„ç†æœ‰æŒ‡å¯¼æ„ä¹‰ï¼Œå¯ä»¥è¯´ï¼Œæˆ‘ä»¬çš„åˆæ­¥è¯­ä¹‰åˆ†æï¼Œå°±æ˜¯ä¸ºäº†é”™è¯¯å¤„ç†å‡†å¤‡çš„ã€‚ é”™è¯¯æ€»è®ºè¯­æ³•&amp;&amp;è¯æ³•é”™è¯¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„é”™è¯¯éƒ½æ˜¯è¯­ä¹‰é”™è¯¯ï¼Œå¸¸è§çš„è¯­ä¹‰é”™è¯¯æœ‰â€œå˜é‡é‡å‘½åï¼Œå˜é‡æœªå®šä¹‰â€ç­‰ï¼Œè¿™äº›é”™è¯¯æ˜¯å¯ä»¥é€šè¿‡è¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æçš„ï¼Œä¸ä¼šé€ æˆè¯­æ³•åˆ†æçš„é”™è¯¯ã€‚ä½†æ˜¯æœ‰äº›é”™è¯¯ï¼Œæ˜¯æ²¡æœ‰åŠæ³•é€šè¿‡è¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æçš„ï¼Œæœ‰å¦‚ä¸‹è¿™äº›ç±» ç¼–å· ç±»å‹ åŸå›  a éæ³•ç¬¦å· æ— æ³•é€šè¿‡è¯æ³•åˆ†æ i ç¼ºå°‘åˆ†å· æ— æ³•é€šè¿‡è¯­æ³•åˆ†æ j ç¼ºå°‘å³å°æ‹¬å· æ— æ³•é€šè¿‡è¯­æ³•åˆ†æ k ç¼ºå°‘å³ä¸­æ‹¬å· æ— æ³•é€šè¿‡è¯­æ³•åˆ†æ å¯¹äº Aç±»é”™è¯¯ï¼Œæ­¤ç±»é”™è¯¯ç›´æ¥å¤„ç†ä¹Ÿä¸ä¼šå¯¼è‡´è¯­æ³•ï¼Œè¯­ä¹‰åˆ†ææ— æ³•è¿›è¡Œï¼Œæ•…ç›´æ¥å¤„ç†ï¼š 1234ErrorHandler.addError(new Error(ErrorType.a, lineNum)); tokenType = (inputText.charAt(pos) == '&amp;') ? TokenType.AND : TokenType.OR; str = (inputText.charAt(pos) == '&amp;') ? &quot;&amp;&amp;&quot; : &quot;||&quot;; tokenLength = 1; è€Œå¯¹äº iï¼Œjï¼Œkè¿™äº›å¯¼è‡´è¯­æ³•åˆ†æè¿›è¡Œä¸ä¸‹å»çš„é”™è¯¯ä¸€å®šéœ€è¦è¢«â€œåŒ…å®¹â€ï¼Œå¦åˆ™å°±åšæŒä¸åˆ°é”™è¯¯å¤„ç†æµç¨‹äº†ã€‚è¿™ç§åŒ…å®¹è®¾ç½®è¿˜æœ‰ä¸€ç§â€œè¡¥å……â€çš„æ„å‘³åœ¨é‡Œé¢ã€‚ä½†æ˜¯æœ€éš¾çš„å…¶å®æ˜¯ç¼ºå¤±ç¬¦å·å¯¹äºæ­£å¸¸è¯­æ³•è§£æçš„å½±å“ï¼Œç¼ºå¤±ç¬¦å·ä¼šè®©åŸæœ¬å°±å¾ˆå›°éš¾çš„è¯­æ³•åˆ†æå˜å¾—æ›´åŠ å›°éš¾ï¼Œè¿™æ˜¯å› ä¸ºè¯­æ³•åˆ†ææœ¬å°±éœ€è¦ä¾é ç¬¦å·ç¡®å®šè§£æçš„åˆ†æ”¯ï¼Œç¼ºå°‘ç¬¦å·ä¼šè®©è¿™ä¸ªè¿‡ç¨‹å˜å¾—æ¨¡ç³Šä¸æ¸…ï¼Œè¿™ä¹Ÿæ˜¯åƒ i, j, k è¿™ç±»é”™è¯¯å¹¶ä¸å¤ªå¤šçš„åŸå› ï¼Œå› ä¸ºä¸€æ—¦å¤šäº†ï¼Œå°±ä¼šå¯¼è‡´è§£æå›°éš¾ã€‚ åœ¨ä¸‰ç§ç¼ºå¤±ä¸­ï¼Œä»¥ç¼ºå°‘å³ä¸­æ‹¬å·æœ€ä¸ºå¥½å¤„ç†ï¼Œä¸­æ‹¬å·æ„å‘³ç€ç»´åº¦ä¿¡æ¯ï¼Œåªè¦æœ‰å·¦ä¸­æ‹¬å·ï¼Œé‚£ä¹ˆå³ä¸­æ‹¬å·ä¸€å®šæ˜¯å¯ä»¥è¡¥ä¸Šçš„ï¼ŒåŸºæœ¬ä¸Šæ— è„‘å°±å¯ä»¥äº†ã€‚ ä½†æ˜¯å¯¹äºç¼ºå¤±åˆ†å·å’Œå°æ‹¬å·ï¼Œæœ‰å¯èƒ½é€ æˆè§£æåˆ†æ”¯çš„åˆ¤æ–­ä¸å½“ã€‚æ‰€ä»¥éœ€è¦è¿›è¡Œå›é€€å¤„ç†ï¼ˆå¦‚æœä¸å›é€€çš„è¯å°±è¦æ”¹å†™æ–‡æ³•ï¼Œè€Œä¸”æ–‡æ³•æ”¹çš„æ¯«æ— è¯­ä¹‰æ„ä¹‰ï¼‰ã€‚ å¯¹äºç¼ºå¤±åˆ†å·ï¼Œæœ‰æ— æ³•åŒºåˆ†èµ‹å€¼è¯­å¥å’Œè¡¨è¾¾å¼çš„é—®é¢˜ã€‚ 1234567// ç¼ºå¤±å‰i + 1;a = b + c;// ç¼ºå¤±åi + 1a = b + c; è¿™å°±æ„å‘³ç€æ²¡æ³•é€šè¿‡å‰ç»ï¼ˆå³â€œåœ¨åˆ†å·å‰æœ‰ä¸€ä¸ªç­‰äºå·â€œï¼‰æ¥ç¡®å®šæ˜¯å¦æ˜¯èµ‹å€¼è¯­å¥ã€‚æ‰€ä»¥åªèƒ½é€šè¿‡â€œå°è¯•è§£æ-åˆ¤æ–­ LASTâ€çš„æ–¹æ³•è¿›è¡Œã€‚ å¯¹äº return è¯­å¥ï¼Œå¯èƒ½ä¹Ÿæœ‰è¿™ç§ç°è±¡ï¼Œè™½ç„¶åº”è¯¥è¢«è¯­ä¹‰çº¦æŸäº† 1234567// ç¼ºå¤±å‰return;a;// ç¼ºå¤±åreturn a; å¯¹äº Callee è¯­å¥ï¼Œä¹Ÿæ˜¯è¿™æ ·ï¼ˆåº”è¯¥ä¹Ÿè¢«çº¦æŸäº†ï¼‰ï¼Œè¿™é‡Œåº”è¯¥æ˜¯åŒæ—¶ç¼ºå¤±äº†å°æ‹¬å·å’Œåˆ†å· 1234567// ç¼ºå¤±å‰f();a;// ç¼ºå¤±åf(a; å…·ä½“æ¥çœ‹ï¼Œæˆ‘ä»¬ç»“åˆå‰æ–‡ Parserä¸­ nextSymçš„å®ç°ï¼Œç»Ÿä¸€å¤„ç†ï¼š 12345678910111213141516171819//é€šè¿‡ä¾æ¬¡åŒ¹é…ç†æƒ³è¯­æ³•æˆåˆ†æ¥é¿å…å›æº¯ public Token matchToken(TokenType tokenType) { if (currentToken.type == tokenType) { Token tmp = currentToken; if (pos &lt; maxLength) { pos++; currentToken = tokens.get(pos); } return tmp; } else if (tokenType == TokenType.SEMICN || tokenType == TokenType.RPARENT || tokenType == TokenType.RBRACK) { int lineNum = tokens.get(pos - 1).lineNum; String str = tokenType.getStr(); ErrorType errorType = mismatchErrors.get(tokenType); ErrorHandler.addError(new Error(errorType, lineNum)); return new Token(str, lineNum, tokenType); } return null; } è¯­ä¹‰é”™è¯¯å¤„ç† &amp;&amp; è¯­ä¹‰åˆ†æé”™è¯¯å¤„ç†çš„å„ä¸ªè¯­ä¹‰é”™è¯¯ç±»å‹æ˜¯ç›¸å¯¹ç‹¬ç«‹çš„ï¼Œå½¼æ­¤ä¹‹é—´ä»…å­˜åœ¨ä¸€å®šçš„è”ç³»ï¼Œå¯ä»¥åˆ†åˆ«å¯¹æ¯ä¸€ç§é”™è¯¯è¿›è¡Œå¤„ç†ã€‚åœ¨è¿›è¡Œé”™è¯¯å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘å»ºç«‹äº†æ ˆå¼ç¬¦å·è¡¨ã€‚ ç¬¦å·Symbolæˆ‘å°†ç¬¦å·çš„ç±»å‹åˆ†ä¸ºå‡½æ•°ç¬¦å· FuncSymbolå’Œå˜é‡ç¬¦å· NumSymbol, CharSymbolï¼ŒäºŒè€…éƒ½ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±» Symbolã€‚ å¯¹äºå‡½æ•°ç¬¦å·ï¼Œæˆ‘ä»¬é¢å¤–è®°å½•å…¶è¿”å›å€¼ç±»å‹ä»¥åŠå½¢å‚çš„Symbolï¼š 12345678public class FuncSymbol extends Symbol{ public enum FuncReturnType{ INT, VOID, CHAR; } private FuncReturnType returnType; private ArrayList&lt;NumSymbol&gt; params; // å‚æ•°ç¬¦å·åˆ—è¡¨ ...} å¯¹äºå˜é‡ç¬¦å·ï¼Œç”±äºå…¶åªå¯èƒ½æ˜¯ int char æˆ–è€…int charæ•°ç»„ç±»å‹ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦é¢å¤–è®°å½•å…¶ç»´æ•°ã€‚ 1234567891011javapublic class NumSymbol extends Symbol{ private int dim; // æ•°ç»„ç»´æ•° 0 1 private String ifArray;}public class CharSymbol extends Symbol { private int dim; // æ•°ç»„ç»´æ•° 0 1 private String ifArray;} ç¬¦å·è¡¨SymbolTableå¯¹äºç¬¦å·è¡¨ï¼Œæˆ‘ä½¿ç”¨æ ˆå¼ç¬¦å·è¡¨ã€‚åœ¨è®¾è®¡ä¹‹åˆï¼Œæˆ‘æ˜¯æƒ³è¦ä¿ç•™ä¸€ä¸ªåŒå‘çš„ç±»ä¼¼æ ‘ç»“æ„ï¼ˆå…¶å®ä¹Ÿç¡®å®å®ç°äº†ï¼Œä½†æ˜¯irç”Ÿæˆæ—¶æ²¡æœ‰é‡‡ç”¨è¯¥ç¬¦å·è¡¨ï¼‰ï¼Œåœ¨ä½¿ç”¨æ ˆå¼ç¬¦å·è¡¨åä¿ç•™æ ¹èŠ‚ç‚¹ï¼Œè¿™æ ·å°±å¯ä»¥ç•™ä¸‹è¯¥ç¬¦å·è¡¨ã€‚å…·ä½“æ¥è¯´æ˜¯æŠŠä¸‹å›¾ä¸­çš„å•å‘è¾¹æ¢æˆåŒå‘è¾¹ï¼š æ¯ä¸ªç¬¦å·è¡¨ä¸­ï¼Œéƒ½ç”± TreeMapæ¥å­˜å‚¨å…·ä½“ä¿¡æ¯ï¼ŒfatherSymbolTableå’Œ sonSymbolTablesç»´æŠ¤çˆ¶å­é—´çš„å…³ç³»ã€‚ 1234567891011121314public class SymbolTable { private final TreeMap&lt;String, Symbol&gt; symbolMap; //TreeMapæé«˜æ£€ç´¢é€Ÿåº¦ private final SymbolTable fatherSymbolTable; // æ‰€å±çš„çˆ¶ç¬¦å·è¡¨ private final ArrayList&lt;SymbolTable&gt; sonSymbolTables; // æ‰€æœ‰å­ç¬¦å·è¡¨ private final Node node; // ç”±æ­¤è¯­æ³•æ ‘æˆåˆ†å¼€å§‹æ–°å»ºæ­¤ç¬¦å·è¡¨ private Integer regionIndex; public SymbolTable(SymbolTable fatherSymbolTable, Node node, Integer regionIndex) { this.symbolMap = new TreeMap&lt;&gt;(); this.fatherSymbolTable = fatherSymbolTable; this.sonSymbolTables = new ArrayList&lt;&gt;(); this.node = node; this.regionIndex = regionIndex; }} ç¬¦å·è¡¨æ ˆSymbolTableStackè¯¥ç±»å†…å°è£…æœ‰æ„å»ºç¬¦å·è¡¨ã€æŸ¥ç¬¦å·è¡¨çš„å„ç§æ–¹æ³•ï¼Œä»¥åŠä¸€ä¸ªç¬¦å·è¡¨æ ˆ Stackã€‚ è¯¥ç±»å†…è¿˜æœ‰ä¸º continueï¼Œbreakï¼Œreturnç­‰å¯¹åº”é”™è¯¯è€Œè®¾ç½®çš„æ–¹æ³•ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142public class SymbolTableStack { private Stack&lt;SymbolTable&gt; stack; private static TreeMap&lt;Integer, ArrayList&lt;Symbol&gt;&gt; visitResults = new TreeMap&lt;&gt;(); private static Integer regionIndex = 1; private SymbolTableStack() { this.stack = new Stack&lt;&gt;(); } private static SymbolTableStack instance = new SymbolTableStack(); public static SymbolTableStack getInstance() { return instance; } // ====================== æ ˆæ“ä½œ======================= public static SymbolTable peek() { if (instance.stack.empty()) { return null; } return instance.stack.peek(); } public static void stackPush(SymbolTable symbolTable) { if (!instance.stack.empty()) { peek().addSon(symbolTable); } instance.stack.push(symbolTable); } public static void nodePush(Node node) { regionIndex++; stackPush(new SymbolTable(peek(), node, regionIndex)); } public static void pop() { instance.stack.pop(); } public static void addSymbolToPeek(Symbol symbol) { peek().addSymbol(symbol); Integer index = peek().getRegionIndex(); if (!visitResults.containsKey(index)) { ArrayList&lt;Symbol&gt; symbols = new ArrayList&lt;&gt;(); symbols.add(symbol); visitResults.put(index, symbols); //System.out.println(&quot;æˆåŠŸå‘ç¬¦å·è¡¨ä¸­æ·»åŠ å…ƒç´  &quot; + index + &quot; &quot; + symbol); } else { visitResults.get(index).add(symbol); //System.out.println(&quot;æˆåŠŸå‘ç¬¦å·è¡¨ä¸­æ·»åŠ å…ƒç´  &quot; + index + &quot; &quot; + symbol); } } public static TreeMap&lt;Integer, ArrayList&lt;Symbol&gt;&gt; getVisitResults() { return visitResults; } public static void outputResult() { for (Map.Entry&lt;Integer, ArrayList&lt;Symbol&gt;&gt; entry : visitResults.entrySet()) { Integer key = entry.getKey(); ArrayList&lt;Symbol&gt; symbols = entry.getValue(); for (Symbol symbol : symbols) { System.out.println(key + &quot; - &quot; + symbol); } } } // ================= æ ˆæŸ¥æ‰¾ ================= // æ£€æµ‹æ ˆé¡¶ç¬¦å·è¡¨æ˜¯å¦åŒ…å«æŒ‡å®šåç§°çš„å…ƒç´  public static boolean peekHasSymbol(String name) { return peek().hasSymbol(name); } // åœ¨æ•´ä¸ªæ ˆå†…æŸ¥æ‰¾å¹¶è¿”å›ç¬¬ä¸€ä¸ªæŒ‡å®šåç§°æŒ‡å®šç±»å‹çš„å…ƒç´  public static Symbol getSymbol(String name, SymbolType symbolType) { Symbol symbol; for (int i = instance.stack.size() - 1; i &gt;= 0; i--) { symbol = instance.stack.get(i).getSymbol(name, symbolType); if (symbol != null) { return symbol; } } return null; } // æ£€æŸ¥æ•´ä¸ªæ ˆå†…æ˜¯å¦åŒ…å«æŒ‡å®šåç§°çš„å…ƒç´  public static boolean stackHasSymbol(String name) { for (SymbolTable symbolTable : instance.stack) { if (symbolTable.hasSymbol(name)) { return true; } } return false; } public static boolean stackHasSymbolSameType(String name, SymbolType symbolType) { for (int i = instance.stack.size() - 1; i &gt;= 0; i--) { Symbol symbol = instance.stack.get(i).getSymbol(name, null); if (symbol != null) { if (symbolType == SymbolType.Const) { return symbol.type.isConst(); } else { return symbol.type == symbolType; } } } return false; } // ================= å¾ªç¯å·¥å…· ================= // è®°å½•å½“å‰æ‰€åœ¨çš„å¾ªç¯æ·±åº¦ private int loopDepth = 0; public static boolean inLoop() { return instance.loopDepth &gt; 0; } public static void enterLoop() { instance.loopDepth++; } public static void exitLoop() { instance.loopDepth = instance.loopDepth &gt; 0 ? instance.loopDepth - 1 : 0; } // ================= å‡½æ•°å·¥å…· ================= // è®°å½•å½“å‰æ˜¯å¦åœ¨ä¸€ä¸ªæ— è¿”å›å€¼çš„å‡½æ•°å†…éƒ¨ private boolean noReturn = false; public static boolean ifNoReturn() { return instance.noReturn; } public static void setIfReturn(boolean inVoidFunc) { instance.noReturn = inVoidFunc; }} å…¥æ ˆæ–°ç¬¦å·è¡¨çš„æ—¶æœºåœ¨éå†è¯­æ³•æ ‘çš„è¿‡ç¨‹ä¸­ï¼Œäº MainFuncDefï¼ŒFuncDefä»¥åŠ Stmtçš„ StmtType.BLOCKåœºåˆä¸‹ï¼Œè°ƒç”¨ SymbolTableStackä¸­å°è£…å¥½çš„æ–¹æ³•å³å¯å…¥æ ˆæ–°çš„ç¬¦å·è¡¨ï¼Œä¾‹å¦‚ï¼š 1234567891011121314if (type == StmtType.BLOCK) { SymbolTableStack.nodePush(this); } public static void stackPush(SymbolTable symbolTable) { if (!instance.stack.empty()) { peek().addSon(symbolTable); } instance.stack.push(symbolTable); } public static void nodePush(Node node) { regionIndex++; stackPush(new SymbolTable(peek(), node, regionIndex)); } æ·»åŠ æ–°ç¬¦å·çš„æ—¶æœºåœ¨éå†è¯­æ³•æ ‘çš„è¿‡ç¨‹ä¸­ï¼Œäº MainFuncDefï¼ŒFuncDefä»¥åŠ Stmtçš„ StmtType.BLOCKåœºåˆä¸‹ï¼Œè¯»å–åˆ°æ–°ç¬¦å·ï¼ˆå˜é‡ã€å¸¸é‡ã€å‡½æ•°ï¼‰æ—¶è°ƒç”¨ SymbolTableStackä¸­å°è£…å¥½çš„æ–¹æ³•å³å¯ã€‚ 12FuncSymbol funcSymbol = new FuncSymbol(identToken.content, identToken.lineNum, this, returnType, params); SymbolTableStack.addSymbolToPeek(funcSymbol); é”™è¯¯å¤„ç†çš„é€»è¾‘é”™è¯¯è®°å½•æ–¹æ³•åœ¨ error/ErrorUtil.javaå†…å°è£…æœ‰æ£€æŸ¥å½“å‰è¯­å¢ƒä¸‹é”™è¯¯å¹¶è®°å½•çš„æ–¹æ³•ã€‚åœ¨éå†åˆ°è¯­æ³•æ ‘çš„ç‰¹å®šä½ç½®æ—¶ç›´æ¥è°ƒç”¨ï¼Œå³å¯è¿›è¡Œé”™è¯¯å¤„ç†ã€‚ è®°å½•é”™è¯¯çš„æ¥å£æˆ‘å°†æ‰€æœ‰èƒ½å¤Ÿç”Ÿæˆå¹¶è®°å½•é”™è¯¯çš„æ–¹æ³•éƒ½ç»Ÿä¸€æ”¾ç½®åœ¨äº† error/ErrorUtil.javaé‡Œï¼Œè°ƒç”¨å…¶ä¸­çš„æ–¹æ³•ä¾¿å¯ï¼ˆåˆ¤æ–­å¹¶ï¼‰è®°å½•é”™è¯¯ï¼Œä¾¿äºåæœŸä¿®æ”¹ã€‚ä¾‹å¦‚ï¼š 12345678910111213/** * @param token å½“å‰ç»ˆç»“ç¬¦ * @return noDuplicateError */ // é‡å®šä¹‰ public static boolean checkDuplicateError(Token token) { boolean noDuplicateError = true; if (SymbolTableStack.peekHasSymbol(token.content)) { ErrorHandler.addError(new Error(ErrorType.b, token.lineNum)); noDuplicateError = false; } return noDuplicateError; } å…·ä½“é”™è¯¯çš„å¤„ç†æ–¹æ³• b ç±»é”™è¯¯ - åå­—é‡å®šä¹‰ å¯¹äºå‡ºç°é”™è¯¯çš„å››æ¡æ–‡æ³•ï¼Œè¯»å–åˆ° identçš„åˆ›å»ºæ—¶ï¼Œè°ƒç”¨ï¼š 12345678public static boolean checkDuplicateError(Token token) { boolean noDuplicateError = true; if (SymbolTableStack.peekHasSymbol(token.content)) { ErrorHandler.addError(new Error(ErrorType.b, token.lineNum)); noDuplicateError = false; } return noDuplicateError; } c ç±»é”™è¯¯ - æœªå®šä¹‰çš„åå­— å¯¹äºå‡ºç°é”™è¯¯çš„ä¸‰æ¡æ–‡æ³•ï¼Œè¯»å–åˆ° identçš„å¼•ç”¨æ—¶ï¼Œè°ƒç”¨ï¼š 123456789// æœªå®šä¹‰ public static boolean checkUndefinedError(Token token) { boolean noUndefinedError = true; if (!SymbolTableStack.stackHasSymbol(token.content)) { ErrorHandler.addError(new Error(ErrorType.c, token.lineNum)); noUndefinedError = false; } return noUndefinedError; } d ç±»é”™è¯¯ - å‡½æ•°å‚æ•°ä¸ªæ•°ä¸åŒ¹é… å¯¹äºé¢˜ç›®ç»™å‡ºçš„æ–‡æ³•ï¼Œå½“ UnaryExpéœ€è¦è¿›è¡Œå‡½æ•°è°ƒç”¨æ—¶ï¼Œä»ç¬¦å·è¡¨å¾—åˆ°å…¶å½¢å‚ä¸ªæ•°ï¼Œå†è¯»å–å…¶å­èŠ‚ç‚¹çš„ funcRParamsNodeçš„ expNodesçš„ size()ï¼Œä¸¤è€…æ¯”è¾ƒï¼Œå¦‚æœä¸åŒï¼Œé‚£å°±æŠ¥é”™ã€‚ 123456789101112131415else if (identToken != null) { if (ErrorUtil.checkUndefinedError(identToken)) { FuncSymbol symbol = (FuncSymbol) SymbolTableStack.getSymbol(identToken.content, SymbolType.Func); if (symbol == null) { ErrorHandler.addError(new Error(ErrorType.d, identToken.lineNum)); } else if (symbol.getParams().size() != getParaSize()) { ErrorHandler.addError(new Error(ErrorType.d, identToken.lineNum)); } else if (!checkParamsIllegal(symbol)) { ErrorHandler.addError(new Error(ErrorType.e, identToken.lineNum)); } } if (funcRParamsNode != null) { funcRParamsNode.visit(); } } e ç±»é”™è¯¯ - å‡½æ•°å‚æ•°ç±»å‹ä¸åŒ¹é… æˆ‘ä»¬çš„å˜é‡ç±»å‹åªæœ‰2ç§ï¼šæ•´å‹ã€ä¸€ç»´æ•°ç»„ã€‚ 123456789101112131415else if (identToken != null) { if (ErrorUtil.checkUndefinedError(identToken)) { FuncSymbol symbol = (FuncSymbol) SymbolTableStack.getSymbol(identToken.content, SymbolType.Func); if (symbol == null) { ErrorHandler.addError(new Error(ErrorType.d, identToken.lineNum)); } else if (symbol.getParams().size() != getParaSize()) { ErrorHandler.addError(new Error(ErrorType.d, identToken.lineNum)); } else if (!checkParamsIllegal(symbol)) { ErrorHandler.addError(new Error(ErrorType.e, identToken.lineNum)); } } if (funcRParamsNode != null) { funcRParamsNode.visit(); } } f ç±»é”™è¯¯ - æ— è¿”å›å€¼çš„å‡½æ•°å­˜åœ¨ä¸åŒ¹é…çš„ returnè¯­å¥ï¼›g ç±»é”™è¯¯ - æœ‰è¿”å›å€¼çš„å‡½æ•°ç¼ºå°‘ returnè¯­å¥ åœ¨ stmtçš„ç±»å‹æ˜¯ Returnæ—¶ï¼Œå¦‚æœåœ¨å‡½æ•°å½“ä¸­ä½† expNode != nullå°±æŠ¥é”™ã€‚ h ç±»é”™è¯¯ - ä¸èƒ½æ”¹å˜å¸¸é‡çš„å€¼ åˆ¤æ–­ &lt;LVal&gt;å½“ä¸­çš„ &lt;ident&gt;æ˜¯å¦æ˜¯å¸¸é‡å³å¯ã€‚ m ç±»é”™è¯¯ - åœ¨éå¾ªç¯å—ä¸­ä½¿ç”¨ break å’Œ continue è¯­å¥ æˆ‘ä»¬åœ¨ç¬¦å·è¡¨æ ˆå†…ç»´æŠ¤äº† loopCountï¼Œåˆå§‹ä¸º 0ï¼Œæ¯æ¬¡è¿›å…¥å¾ªç¯å°±åŠ ä¸€ï¼Œé€€å‡ºå¾ªç¯å°±å‡ä¸€ã€‚ åœ¨ stmt çš„ç±»å‹æ˜¯ Break æˆ–è€… Continue æ—¶ï¼Œåˆ¤æ–­å½“å‰çš„ loopCount æ˜¯å¦ä¸ºé›¶å³å¯ï¼Œå¦‚æœæ˜¯ï¼Œé‚£å°±æŠ¥é”™ã€‚ è¯­ä¹‰åˆ†æç»“æœè¾“å‡º12345678910public void print() { TreeMap&lt;Integer, ArrayList&lt;Symbol&gt;&gt; visitResults = SymbolTableStack.getVisitResults(); for (Map.Entry&lt;Integer, ArrayList&lt;Symbol&gt;&gt; entry : visitResults.entrySet()) { Integer key = entry.getKey(); ArrayList&lt;Symbol&gt; symbols = entry.getValue(); for (Symbol symbol : symbols) { IO.write(IO.IOType.VISITOR, (key + &quot; &quot; + symbol), true, true); } } } LLVM IRç”ŸæˆLLVMç®€ä»‹LLVMæ˜¯ä¸€ç§ä¸‰åœ°å€ç ï¼Œå³ä¸€æ¡LLVMè¯­å¥å¯ä»¥è¡¨ç¤ºä¸ºå¦‚ä¸‹å½¢å¼ï¼š 1&lt;è¿ç®—ç»“æœ&gt; = &lt;æŒ‡ä»¤ç±»å‹&gt; &lt;æ“ä½œæ•°1&gt;, &lt;æ“ä½œæ•°2&gt; è§‚å¯Ÿè¿™ç§æŒ‡ä»¤å¯ä»¥å‘ç°ï¼Œä¸€æ¡è¯­å¥ä¸»è¦ç”±ä¸‰ä¸ªè¦ç´ ç»„æˆï¼š ï¼ˆ1ï¼‰æ“ä½œæ•°ï¼ˆ2ï¼‰æŒ‡ä»¤ç±»å‹ï¼ˆ3ï¼‰è¿ç®—ç»“æœ ç°åœ¨æˆ‘ä»¬éœ€è¦å°†LLVMçš„è¿™ç§è¯­è¨€ç‰¹æ€§ï¼Œä½¿ç”¨Javaçš„ç±»è®¾è®¡æ¥è¡¨è¾¾ï¼š åœ¨Javaä»£ç ä¸­ï¼Œä½¿ç”¨å…·ä½“çš„ç±»å¯¹è±¡ï¼Œæ¥è¡¨ç¤ºè¯­å¥ä¸­çš„å„ä¸ªå…ƒç´ ã€‚ï¼ˆå°±åƒè¯­æ³•åˆ†æä¸­ä½¿ç”¨å„ç§ nodeç±»æ¥è¡¨è¾¾å„ç§è¯­æ³•å…ƒç´ ä¸€æ ·ï¼‰ å…·ä½“æªæ–½æ˜¯ï¼Œé€šè¿‡éå†ä¹‹å‰è¯­æ³•åˆ†æçš„è¯­æ³•æ ‘ï¼Œé€è¿‡ç»“åˆå±æ€§ç¿»è¯‘æ–‡æ³•çš„é€’å½’ä¸‹é™çš„æ–¹å¼ï¼Œæ¥ç”Ÿæˆllvmçš„è¯­æ³•æ ‘ã€‚ å¯¹LLVMçš„ç®€å•ç†è§£æˆ‘ä»¬å°† llvmé‡‡ç”¨æ ‘çš„å½¢å¼å­˜å‚¨ï¼Œæ ¹èŠ‚ç‚¹ä¸º Moduleã€‚ ä¸€ä¸ª module ä¸­å¯ä»¥æ‹¥æœ‰ä¸¤ç§é¡¶å±‚å®ä½“ï¼š Function å’Œ GlobalVariable æ¯ä¸ª Function ä¸‹éƒ½æœ‰è‹¥å¹²åŸºæœ¬å— BasicBlock æ¯ä¸ª BasicBlockä¸‹éƒ½æœ‰è‹¥å¹²æŒ‡ä»¤ instruction åœ¨ä»¥ä¸Šç»“æ„ä¸­ï¼Œå…³é”®èŠ‚ç‚¹ç±»çš„è®¾è®¡å¦‚ä¸‹ï¼š ç©ºå¿ƒç²—ç®­å¤´è¡¨ç¤ºç±»ç»§æ‰¿å…³ç³»ï¼ˆUserå’ŒValueç±»ä¹Ÿæ˜¯ç»§æ‰¿å…³ç³»ï¼Œå›¾åº”è¯¥æ˜¯ç”»é”™äº†ï¼‰ã€‚ å®å¿ƒç»†ç®­å¤´è¡¨ç¤ºèšåˆå…³ç³»ï¼Œä»è€Œå½¢æˆæ ‘ç»“æ„ï¼ˆä¾‹å¦‚æ¯ä¸€ä¸ªåŸºæœ¬å— BasicBlocké‡Œæœ‰ä¸€æ¡æ¡æŒ‡ä»¤ Instructionï¼‰ã€‚ 1&lt;è¿ç®—ç»“æœ&gt; = &lt;æŒ‡ä»¤ç±»å‹&gt; &lt;æ“ä½œæ•°1&gt;, &lt;æ“ä½œæ•°2&gt; æ“ä½œæ•° Valueç±»å°†æ“ä½œæ•°è¡¨ç¤ºä¸ºä¸€ä¸ªç±»ï¼šValueï¼Œå®ƒè¡¨ç¤ºèƒ½å¤Ÿä½œä¸ºæ“ä½œæ•°çš„å¯¹è±¡ã€‚ ä¾‹å¦‚å¦‚ä¸‹ä¹˜æ³•è¯­å¥ä¸­ï¼š 1%2 = mul i32 %1, 2 æŒ‰ç…§ä¸Šé¢çš„è®¾è®¡ï¼Œ%1å’Œ 2éƒ½æ˜¯Valueï¼Œåœ¨Javaä»£ç ä¸­éƒ½ä»¥Valueç±»çš„å½¢å¼å­˜åœ¨ã€‚ æ“ä½œæ•°ä½¿ç”¨è€… Userç±»å°†æŒ‡ä»¤çš„è¿ç®—ç»“æœè¡¨ç¤ºä¸ºä¸€ä¸ªç±»ï¼šUserï¼Œå®ƒè¡¨ç¤ºèƒ½å¤Ÿä½œä¸ºè¿ç®—ç»“æœçš„å¯¹è±¡ï¼Œæˆ–è€…è¯´æ˜¯æ“ä½œæ•°çš„ä½¿ç”¨è€…ã€‚ ä¾‹å¦‚å¦‚ä¸‹ä¹˜æ³•è¯­å¥ä¸­ï¼š 1%2 = mul i32 %1, 2 æŒ‰ç…§ä¸Šé¢çš„è®¾è®¡ï¼Œ%2æ˜¯Userï¼Œå®ƒ useäº† %1å’Œ 2ã€‚%2åœ¨Javaä»£ç ä¸­ä»¥Userç±»çš„å½¢å¼å­˜åœ¨ã€‚ Userç±»ç»§æ‰¿Valueç±»è§‚å¯Ÿå¦‚ä¸‹è¯­å¥ï¼š 12%2 = mul i32 %1, 2%3 = add i32 %2, 3 ä¹˜æ³•äº§ç”Ÿçš„ %2è¿ç®—ç»“æœåœ¨ä¸‹ä¸€æ¡åŠ æ³•è¯­å¥ä¸­ä½œä¸ºäº†æ“ä½œæ•°ã€‚Userç±»åº”è¯¥ç»§æ‰¿ Valueç±»ï¼Œè¿™æ ·åé¢çš„è¿ç®—æ‰èƒ½ç”¨åˆ°å‰é¢çš„ç»“æœã€‚ æŒ‡ä»¤ Instructionç±»ä¸ºæ¯ä¸€ç§æŒ‡ä»¤ç±»å‹éƒ½åˆ›å»ºä¸€ä¸ª InstructionæŒ‡ä»¤ç±»ï¼Œè¿™ä¸ªæŒ‡ä»¤ç±»ç»§æ‰¿ Userï¼Œæ—¢ç”¨æ¥è¡¨ç¤ºè¿ç®—ç»“æœï¼Œä¹Ÿç”¨æ¥è¡¨ç¤ºè¿™ä¸€æ¡æŒ‡ä»¤ã€‚ å¦‚ä½•ç†è§£â€æ—¢ç”¨æ¥è¡¨ç¤ºè¿ç®—ç»“æœï¼Œä¹Ÿç”¨æ¥è¡¨ç¤ºè¿™ä¸€æ¡æŒ‡ä»¤â€ï¼Ÿ å›åˆ° Userç±»çš„ä¾‹å­ 1%2 = mul i32 %1, 2 åœ¨ä»£ç å®ç°å½“ä¸­ï¼Œ%2æ˜¯ä¸€ä¸ª MulæŒ‡ä»¤ç±»å¯¹è±¡ã€‚ å®ƒæ—¢è¡¨ç¤º %2è¿™ä¸ªè¿ç®—ç»“æœï¼šMul extends Userï¼Œè¿™æ„å‘³ç€è¿™ä¸ª Mulç±»å¯¹è±¡å¯ä»¥è¡¨ç¤ºè¿ç®—ç»“æœï¼›User extends Valueï¼Œè¿™æ„å‘³ç€è¿™ä¸ª Mulç±»å¯¹è±¡è¿˜å¯ä»¥ä½œä¸ºæ“ä½œæ•°ã€‚ åˆè¡¨ç¤ºè¿™æ¡è¯­å¥æœ¬èº«ï¼šMulç±»æ˜¯llvmè¯­æ³•æ ‘ä¸­ï¼ŒæŒ‚åœ¨BasicBlockä¸‹çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé€šè¿‡éå†è¯­æ³•æ ‘ï¼Œå¹¶è°ƒç”¨ toString()æ–¹æ³•ï¼Œå³å¯ä»è¿™ä¸ªMulç±»ä¸­å–å‡ºç›®æ ‡ä»£ç  1234567891011public class Mul extends ArithmeticInstruction { public Mul(String name, BasicBlock parent, Value op1, Value op2) { super(name, parent, op1, op2); } @Override public String toString() { return getArithmeticString(&quot;mul&quot;); }} å†ä¾‹å¦‚ï¼Œå¦‚ä¸‹ä¸­é—´ä»£ç ï¼Œå°†å…¶ç¿»è¯‘ä¸ºJavaä»£ç ï¼Œå¯ä»¥æ˜¯ï¼š 123456%1 = mul i32 1, 2%2 = mul i32 %1, %1// IrBuilder.buildxxxæ˜¯å°è£…äº†å…·ä½“æ“ä½œçš„å·¥å‚æ¨¡å¼æ–¹æ³•ï¼Œ// å…¶å‚æ•°æ˜¯æ“ä½œæ•°Valueç±»ï¼Œè¿”å›ç»“æœæ˜¯è®¡ç®—ç»“æœInstructionç±»Mul mul1 = IrBuilder.buildMulInstruction(new ConstInt(1), new ConstInt(1))Mul mul2 = IrBuilder.buildMulInstruction(mul2, mul2) å¸¸ç”¨çš„llvmæŒ‡ä»¤ç½—åˆ—å¦‚ä¸‹ï¼š LLVM IR ä½¿ç”¨æ–¹æ³• ç®€ä»‹ add &lt;result&gt; = add &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; / sub &lt;result&gt; = sub &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; / mul &lt;result&gt; = mul &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; / sdiv &lt;result&gt; = sdiv &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; æœ‰ç¬¦å·é™¤æ³• srem &lt;result&gt; = srem &lt;type&gt; &lt;op1&gt;, &lt;op2&gt; æœ‰ç¬¦å·å–ä½™ icmp &lt;result&gt; = icmp &lt;cond&gt; &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; æ¯”è¾ƒæŒ‡ä»¤ and &lt;result&gt; = and &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; æŒ‰ä½ä¸ or &lt;result&gt; = or &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; æŒ‰ä½æˆ– call &lt;result&gt; = call [ret attrs] &lt;ty&gt; &lt;name&gt;(&lt;...args&gt;) å‡½æ•°è°ƒç”¨ alloca &lt;result&gt; = alloca &lt;type&gt; åˆ†é…å†…å­˜ load &lt;result&gt; = load &lt;ty&gt;, ptr &lt;pointer&gt; è¯»å–å†…å­˜ store store &lt;ty&gt; &lt;value&gt;, ptr &lt;pointer&gt; å†™å†…å­˜ getelementptr &lt;result&gt; = getelementptr &lt;ty&gt;, ptr &lt;ptrval&gt;{, &lt;ty&gt; &lt;idx&gt;}* è®¡ç®—ç›®æ ‡å…ƒç´ çš„ä½ç½®ï¼ˆæ•°ç»„éƒ¨åˆ†ä¼šå•ç‹¬è¯¦ç»†è¯´æ˜ï¼‰ phi &lt;result&gt; = phi [fast-math-flags] &lt;ty&gt; [&lt;val0&gt;, &lt;label0&gt;], ... / zext..to &lt;result&gt; = zext &lt;ty&gt; &lt;value&gt; to &lt;ty2&gt; å°† ty çš„ value çš„ type æ‰©å……ä¸º ty2ï¼ˆzero extendï¼‰ trunc..to &lt;result&gt; = trunc &lt;ty&gt; &lt;value&gt; to &lt;ty2&gt; å°† ty çš„ value çš„ type ç¼©å‡ä¸º ty2ï¼ˆtruncateï¼‰ br br i1 &lt;cond&gt;, label &lt;iftrue&gt;, label &lt;iffalse&gt; br label &lt;dest&gt; æ”¹å˜æ§åˆ¶æµ ret ret &lt;type&gt; &lt;value&gt; , ret void é€€å‡ºå½“å‰å‡½æ•°ï¼Œå¹¶è¿”å›å€¼ æˆ‘åœ¨ LLVM IR å½“ä¸­ï¼Œç»™æ¯æ¡æŒ‡ä»¤éƒ½å†™äº†ä¸€ä¸ªç±»ï¼ˆBinary æŒ‡çš„æ˜¯è¯¸å¦‚ add sub mul è¿™æ ·çš„äºŒå…ƒæŒ‡ä»¤ï¼‰ï¼Œä¸ºäº†æ–¹ä¾¿æˆ‘å¯¹æ¯ç§ç±»å‹çš„æŒ‡ä»¤è¿›è¡Œç®¡ç†å’Œè¾“å‡ºã€‚ ç‰¹æ®Šçš„Valueç±»ï¼šFunctionå’ŒBasicBlockç±»Functionå’Œ BasicBlockç±»ä¹Ÿå¯ä»¥ä½œä¸ºæ“ä½œæ•°ã€‚ ä¾‹å¦‚è°ƒç”¨æŒ‡ä»¤ï¼š&lt;result&gt; = call [ret attrs] &lt;ty&gt; &lt;fnptrval&gt;(&lt;function args&gt;)çš„å®ç°ä¸Šï¼Œæˆ‘ä»¬ç›´æ¥å°†functionä½œä¸ºäº†ä¸€ä¸ªæ“ä½œæ•°ï¼Œç”¨æ¥æ„å»ºCallæŒ‡ä»¤ã€‚ 1234567891011Function function = (Function) IrSymbolTableStack.getSymbol(identToken.content); assert function != null; ArrayList&lt;Value&gt; argRValues = new ArrayList&lt;&gt;(); // å®å‚åˆ—è¡¨IrFactory.synValue = IrBuilder.buildCallInstruction(function, argRValues, IrFactory.curBlock); if (IrFactory.synValue.getType() instanceof CharType) { if (IrFactory.synValue instanceof ConstChar) { IrFactory.synValue = new ConstInt(32, ((ConstChar) IrFactory.synValue).getValue()); } else { IrFactory.synValue = IrBuilder.buildZextInstruction(IrFactory.synValue, IrFactory.curBlock); } } æ ¹èŠ‚ç‚¹ï¼šModuleç±»å¦‚åŒç¼–è¯‘å•å…ƒä¸€æ ·çš„å­˜åœ¨ï¼ŒLLVM IR æ–‡ä»¶çš„åŸºæœ¬å•ä½ç§°ä¸º moduleï¼Œæˆ‘ä»¬çš„å®éªŒåªæœ‰å• moduleã€‚ å†…å­˜ SSAllvm æ˜¯ SSA å½¢å¼çš„ï¼Œä½†æ˜¯åœ¨æ²¡æœ‰ç»è¿‡ mem2reg çš„æ—¶å€™ï¼ŒSSA æ˜¯å†…å­˜å½¢å¼çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºæ¯ä¸ªå˜é‡ï¼Œåªè¦åœ¨å®šä¹‰ä»–çš„æ—¶å€™ï¼Œä¸ºä»–åœ¨å†…å­˜ä¸­åˆ’åˆ†ç©ºé—´å­˜å…¥ï¼Œåœ¨ä½¿ç”¨ä»–çš„æ—¶å€™åœ¨å–å‡ºæ¥ï¼Œè¿™æ ·å°±å¯ä»¥è¾¾åˆ° SSA çš„æ•ˆæœã€‚è¿™æ˜¯å› ä¸º SSA åªè¦æ±‚æˆ‘ä»¬ä¸èƒ½æ”¹å˜ä¸€ä¸ªå·²ç»å®šä¹‰çš„å€¼ï¼Œæ”¹å˜å†…å­˜çš„å†…å®¹æ˜¾ç„¶å¹¶ä¸è¿æ³• SSAã€‚ è¿™ä¼šå¯¼è‡´å½“æˆ‘ä»¬æåˆ°ï¼ˆä¹Ÿå°±æ˜¯æŸ¥è¯¢ï¼‰ä¸€ä¸ªå±€éƒ¨å˜é‡çš„æ—¶å€™ï¼Œå…¶å®æ˜¯ä»ç¬¦å·è¡¨ä¸­å–å‡ºæ¥çš„æ˜¯å®ƒçš„æŒ‡é’ˆï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸€èˆ¬å‘ç”Ÿåœ¨ LValã€‚ä¸€èˆ¬æˆ‘ä»¬ä¼šå¯¹å˜é‡å¹²ä¸¤ä»¶äº‹æƒ…ï¼Œè¯»å˜é‡å’Œå†™å˜é‡å’Œåšå®å‚ã€‚å¯¹äºè¯»å˜é‡ï¼Œä¸€èˆ¬å‘ç”Ÿåœ¨ LVal ä½œä¸º PrimaryExp çš„æ—¶å€™å‘ç”Ÿï¼Œæ­¤æ—¶éœ€è¦åœ¨ PrimaryExp ä¸­å¯¹å…¶è¿›è¡Œ Loadï¼Œè€Œå†™å˜é‡ä¸€èˆ¬å‘ç”Ÿåœ¨ LVal åœ¨ AssignStmt å’Œ InStmt ä¸­ï¼Œåªéœ€è¦ç”¨ Store å°†å…¶å†™å…¥å³å¯ã€‚åšå®å‚è¦å•ç‹¬æŒ‘å‡ºæ¥è®²ï¼Œæ˜¯å› ä¸ºå®ƒçš„é€»è¾‘æ˜¯ä¸ C éœ€è¦ä¿æŒä¸€è‡´çš„ï¼Œä»–æ˜¯æœ‰æŒ‡é’ˆç±»å‹çš„ï¼Œè¿™å°±è¦æ±‚æˆ‘ä»¬å¯¹ä»–è¿›è¡Œå•ç‹¬çš„å¤„ç†ã€‚è¿™å°±æ˜¯å†…å­˜å¼ SSA çš„åŸºæœ¬é€»è¾‘ã€‚ ç¬¦å·è¡¨æ­£å¦‚å‰é¢æ‰€è¿°ï¼Œå› ä¸º LLVM IR æ˜¯ SSA å½¢å¼çš„ï¼Œæ‰€ä»¥ç¬¦å·è¡¨ä¸­å­˜çš„å†…å®¹ä¹Ÿå’Œ C ä¸­ç†è§£å¹¶ä¸ç›¸åŒï¼Œæ¯”å¦‚è¯´å¯¹äº 1234f(){ int a = 2;} åœ¨ C ä¸­ï¼Œæˆ‘ä»¬ä¼šè®¤ä¸º a åœ¨ç¬¦å·è¡¨ä¸­æ˜¯ä¸€ä¸ª intï¼Œä½†æ˜¯åœ¨ llvm ä¸­ï¼Œä¸ºäº†æ»¡è¶³ SSA ï¼Œæ‰€ä»¥åœ¨ç¬¦å·è¡¨ä¸­ï¼Œa ä¸­å¯¹åº”çš„æ˜¯ä¸€ä¸ªæŒ‡å‘ int çš„æŒ‡é’ˆï¼Œå¦‚æœæƒ³è¦è·å¾— a ä¸­çš„å†…å®¹ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨ä¸€ä¸ª load æŒ‡ä»¤ ã€‚è¿™å°±é€ æˆäº†æŸç§é€»è¾‘çš„ä¸ä¸€è‡´æ€§ã€‚æ›´å¯æ‚²çš„æ˜¯ï¼ŒC ä¸­è¿˜æœ‰ const çš„æ¦‚å¿µã€‚ 12345f(){ const a = 3; int b[a] = {1, 2, 3};} æ˜¯ä¸æ˜¯å¯ä»¥ç›´æ¥ä¹Ÿç”¨ä¸€ä¸ªæŒ‡é’ˆå»å­˜ä»–ï¼Œç„¶åç”¨ä¸€ä¸ª load è®¿å­˜å‘¢ï¼Ÿå¤§æ¦‚æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºä¸‹é¢é‚£ä¸ªè¯­å¥ä¼šç”¨åˆ° allocaï¼Œè™½ç„¶æˆ‘ä¸ç¡®å®š alloca æ˜¯å¦å¯ä»¥åŠ¨æ€åˆ†é…ï¼Œä½†æ˜¯å¦‚æœæ˜¯ä¸‹é¢è¿™ç§ï¼Œå°±è‚¯å®šä¸è¡Œäº† 123456const a = 3;int b[a] = {1, 2, 3};f(){ } åœ¨å…¨å±€éƒ¨åˆ†æ˜¯æ²¡æœ‰åŠæ³•ä½¿ç”¨ load æŒ‡ä»¤çš„ï¼Œå°¤å…¶æ˜¯æˆ‘ä»¬ä¸€èˆ¬é¢å¯¹ä¸Šé¢çš„æƒ…å†µï¼Œä¼šè¦æ±‚æ±‚å‡º b çš„ç»´åº¦ä¿¡æ¯ï¼Œå¦‚æœç»´åº¦ä¿¡æ¯ä¸æ˜¯ 3 ï¼Œè€Œæ˜¯ä¸€ä¸ª loadï¼Œæ˜¾ç„¶å°±æ— æ³•æ±‚å‡ºäº†ï¼Œè¿™å°±å¯¼è‡´é¢å¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¿…é¡»å­˜ä¸€ä¸ªå¸¸é‡åˆ°ç¬¦å·è¡¨ä¸­ï¼Œè¿™å°±æ›´è¦æ±‚æˆ‘ä»¬åœ¨è§£æçš„æ—¶å€™ï¼ŒçŸ¥é“æˆ‘ä¹ˆä½ å•¥æ—¶å€™å­˜çš„æ˜¯å¸¸é‡ï¼Œå•¥æ—¶å€™å­˜çš„æ˜¯æŒ‡é’ˆï¼Œè¿™éœ€è¦é¢å¤–çš„ç»§æ‰¿å±æ€§ï¼ˆä¹Ÿæ˜¯æœ€é‡è¦çš„ç»§æ‰¿å±æ€§ï¼‰canCalValueDown ï¼Œå…¶å®è¿™ä¸ªå±æ€§æ„å‘³ç€ä¸€ç§**â€œå¸¸é‡è¯»â€**ã€‚ ç¬¦å·çš„å®šä¹‰ç¬¦å·çš„å®šä¹‰æœ¬è´¨æ˜¯å¡«å†™ç¬¦å·è¡¨å’Œå®šä¹‰ï¼Œæˆ‘æœ¬æ¥æ‰“ç®—æ€»ç»“èµ·æ¥å†å†™ï¼Œä½†æ˜¯æ„Ÿè§‰å¤ªå†—æ‚äº†ï¼Œå¾ˆéš¾ç†å‡ºä¸€ä¸ªå¤´ç»ªï¼Œæ‰€ä»¥å°±å˜æˆäº†ç½—åˆ—ã€‚ å…¨å±€å•å¸¸é‡å¦‚æœæ˜¯ä¸€ä¸ªå•å¸¸é‡ï¼Œé‚£ä¹ˆåªéœ€è¦æŠŠ ConstInitVal æ±‚è§£å‡ºæ¥ï¼Œä¼šå¾—åˆ°ä¸€ä¸ª int ï¼Œç„¶ååœ¨ç¬¦å·è¡¨ä¸­ï¼Œåªéœ€è¦å­˜å‚¨ä¸€ä¸ª ConstInt å°±å¯ä»¥äº†ã€‚ å±€éƒ¨å•å¸¸é‡ä¸å…¨å±€å•å¸¸é‡ç›¸åŒï¼Œä¾ç„¶æ˜¯å°† ConstInt å­˜å…¥åˆ°ç¬¦å·è¡¨ä¸­ï¼Œå¹¶æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚ å…¨å±€å¸¸é‡æ•°ç»„å¯¹äºå¸¸é‡æ•°ç»„çš„åˆå§‹å€¼ï¼Œæˆ‘ä»¬è¦æ±‚æ˜¯å¯ä»¥åœ¨ç¼–è¯‘å™¨æ±‚å€¼çš„ï¼Œæ‰€ä»¥å®ƒçš„æ¯ä¸ªå…ƒç´ çš„åˆå§‹å€¼ä¸€å®šæ˜¯å¯ä»¥è¢«æ±‚å€¼çš„ï¼Œå½“æˆ‘ä»¬æ±‚å‡ºæ¥å®ƒçš„å€¼ä»¥åï¼Œæ²¡æœ‰åŠæ³•ç›´æ¥åœ¨ç¬¦å·è¡¨ä¸­å­˜å…¥å®ƒçš„å€¼ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä¼šè¿›è¡Œç±»ä¼¼äºå˜é‡çš„è®¿é—®ï¼š 12345678const int a[2] = {1, 2};int main(){ int i = 2; a[i]; return 0;} è¿™æ ·æˆ‘ä»¬æ˜¯æ²¡æœ‰åŠæ³•åœ¨ç¼–è¯‘æ—¶å°±æ±‚å‡º a[i] çš„ï¼Œæ‰€ä»¥ a å¿…é¡»æä¾›å˜é‡è®¿é—®å½¢å¼ï¼Œè¿™å°±è¦æ±‚ä»–å¿…é¡»è¢«å½“æˆä¸€ä¸ªå…¨å±€å˜é‡ï¼Œæ‰€ä»¥ä»–ç¡®å®æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œæˆ‘ä»¬åœ¨ç¬¦å·è¡¨ä¸­å­˜å…¥çš„å…¶å®æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå› ä¸ºåœ¨ llvm ä¸­ï¼Œå…¨å±€å˜é‡æœ¬è´¨æ˜¯ä¸€ä¸ªæŒ‡å‘å…¶å†…å®¹çš„æŒ‡é’ˆï¼Œæ‰€ä»¥å…¶å®ç¬¦å·è¡¨ä¸­å­˜å…¥çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚ä½†æ˜¯ä¹Ÿéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå…¶å®ç¬¦å·è¡¨ä¸­ a è¿™ä¸ªä¸œè¥¿å¯¹åº”äº†ä¸¤ä¸ª Value ï¼Œä¸€ä¸ªæ˜¯ GlobalVariable ï¼Œå¦ä¸€ä¸ªæ˜¯ GlobalVariable.getInitValue() è·å¾—çš„ ConstArray ï¼Œè¿™æ ·æ˜¯æå…¶æœ‰å¿…è¦çš„ï¼Œå› ä¸ºå¯¹äºè¿™ç§æƒ…å†µ 12345678const int a[2] = {1, 2};const int b = a[1];int main(){ int i = 2; a[i]; return 0;} b çš„åˆå§‹å€¼æ²¡æ³•ä½¿ç”¨ load è®¿é—®ï¼Œæ‰€ä»¥åªèƒ½ç”¨å¸¸é‡å½¢å¼è·å¾—ï¼Œæ‰€ä»¥ä¾ç„¶æ˜¯éœ€è¦ ConstArray çš„ã€‚ å±€éƒ¨å¸¸é‡æ•°ç»„å±€éƒ¨å¸¸é‡æ•°ç»„ä¸å…¨å±€å¸¸é‡æ•°ç»„ç±»ä¼¼ï¼Œå› ä¸ºå®ƒä¹Ÿå…·æœ‰â€œå˜é‡â€çš„è®¿é—®å½¢å¼ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½ä»…ä»…åœ¨ç¬¦å·è¡¨ä¸­å­˜å…¥ä¸€ä¸ª ConstArrayï¼Œè€Œæ˜¯éœ€è¦åˆ©ç”¨ Alloca åˆ†é…ä¸€å—å†…å­˜ï¼Œç„¶ååˆ©ç”¨ gep, store ï¼ˆè¿™ä¹ˆçœ‹æ¯”å…¨å±€å¸¸é‡æ•°ç»„è¿˜æœ‰éº»çƒ¦ä¸€äº›ï¼‰å°†è¿™ç‰‡å†…å­˜å¡«å†™æˆæ­£ç¡®çš„å€¼ã€‚åŒæ—¶ä¾ç„¶éœ€è¦æ³¨æ„ï¼Œå°±æ˜¯æˆ‘ä»¬è¿˜æ˜¯éœ€è¦åœ¨ Alloca é‡Œé¢å­˜å…¥ä¸€ä¸ª ConstArray çš„ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä¾ç„¶éœ€è¦åƒä¸€ä¸ªâ€œå¸¸é‡â€ä¸€æ ·è¯»å–è¿™ä¸ªå±€éƒ¨å¸¸é‡æ•°ç»„ï¼Œæ¯”å¦‚è¯´åœ¨ä¸€äº›å¸¸é‡åˆå§‹åŒ–æˆ–è€…ç»´åº¦ä¿¡æ¯æ–¹é¢ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦å­˜å…¥ ConstArray çš„ã€‚ å…¨å±€å•å˜é‡éœ€è¦å½“æˆä¸€ä¸ª GlobalVariable å¤„ç†ï¼Œè¿™æ˜¯å› ä¸ºå¿…é¡»ç»™è¿™ä¸ªå•å˜é‡å¼€è¾Ÿç©ºé—´ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬æœ‰å¯èƒ½ä¿®æ”¹è¿™ä¸ªå€¼ã€‚ å…¨å±€å˜é‡æ•°ç»„ä¹Ÿéœ€è¦å½“æˆä¸€ä¸ª GlobalVariable å¤„ç†ï¼Œä¼¼ä¹è¿™é‡Œä¿è¯äº†åˆå§‹å€¼ä¸€å®šæ˜¯å¸¸é‡ã€‚ å…¨å±€å˜é‡å£°æ˜ä¸­æŒ‡å®šçš„åˆå€¼è¡¨è¾¾å¼å¿…é¡»æ˜¯å¸¸é‡è¡¨è¾¾å¼ã€‚ å±€éƒ¨å•å˜é‡ç”¨ Alloca å¤„ç†ï¼Œæœ€ååœ¨ç¬¦å·è¡¨ä¸­å­˜å…¥çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚ å±€éƒ¨å˜é‡æ•°ç»„ç”¨ Alloca å¤„ç†ï¼Œä½†æ˜¯æ­¤æ—¶çš„ Alloca æ˜¯ä¸éœ€è¦åƒå±€éƒ¨å¸¸é‡æ•°ç»„ä¸€æ ·åœ¨é‡Œé¢å­˜å‚¨ä¸€ä¸ª ConstArray çš„ï¼Œè¿™æ˜¯å› ä¸ºç¬¬ä¸€æ²¡æœ‰æ„ä¹‰ï¼Œç¬¬äºŒä¸ä¸€å®šèƒ½åŠåˆ°ã€‚ ç¬¦å·çš„ä½¿ç”¨å†™å˜é‡å†™ä¸€ä¸ªå˜é‡ä¸€èˆ¬éƒ½æ˜¯å¯¹äº LVal è¿›è¡Œæ“ä½œï¼Œå¹¶ä¸æ˜¯å¯ä»¥å†™å†…å­˜ä¸­çš„æ‰€æœ‰ä¸œè¥¿ï¼Œè¿™æ˜¯å› ä¸ºå¸¸é‡æ˜¯ä¸å…è®¸å†™æ“ä½œçš„ï¼Œæ‰€ä»¥å¯¹äº LVal è·å¾—çš„ä¸œè¥¿ä¸€å®šæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ˆLVal çš„æœ¬è´¨å°±æ˜¯åœ¨ç¬¦å·è¡¨ä¸­æŒ‰ç…§ç¬¦å·æŸ¥è¯¢å‡ºå¯¹åº”çš„ Value ï¼‰ï¼Œç„¶ååˆ©ç”¨ Store æŒ‡ä»¤å°±å¯ä»¥å°†å†…å®¹å†™å…¥ï¼Œâ€œå†™å˜é‡â€è¿™ä¸ªè¿‡ç¨‹æœ¬èº«ååˆ†ç®€å•ã€‚ æ¯”è¾ƒå¤æ‚çš„æ˜¯å¦‚ä½•å¤„ç† LVal ï¼Œé¦–å…ˆéœ€è¦æ˜ç™½ï¼Œå¯¹äº LVal.builIr å¯ä»¥å°†å…¶åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ canCalValue ï¼Œä¹Ÿå°±æ˜¯å¸¸é‡å½¢å¼çš„è¯»ï¼ˆæ˜¾ç„¶æ²¡æœ‰å¸¸é‡å†™ï¼‰ï¼Œå¦å¤–å°±æ˜¯æ²¡æœ‰åŠæ³•å¸¸é‡è¯»çš„ buildï¼Œå¯¹äºç¬¬äºŒç§æƒ…å†µï¼Œé™¤äº†åœ¨ç¬¦å·è¡¨ä¸­æ‰¾åˆ°æ‰¾åˆ°æŒ‡é’ˆï¼Œå¯¹äºæ•°ç»„æŒ‡é’ˆï¼Œè¿˜æ¶‰åŠä¸€äº› gep æ“ä½œä»¥æ‰¾åˆ°æ­£ç¡®çš„æ•°ç»„å…ƒç´ ã€‚ è¯»å˜é‡è¯»å˜é‡ç”¨äºè¡¨è¾¾å¼å½“ä¸€ä¸ª LVal ç”¨äºè¡¨è¾¾å¼çš„æ—¶å€™ï¼ˆä¹Ÿå°±æ˜¯å‚ä¸è¿ç®—çš„æ—¶å€™ï¼‰ï¼Œå¯ä»¥åˆ†æˆä¸¤ä¸ªæƒ…å†µè®¨è®ºï¼Œå¦‚æœæ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œé‚£ä¹ˆå°±ç›´æ¥ç”¨å°±è¡Œäº†ï¼›å¦‚æœæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œé‚£ä¹ˆå°±éœ€è¦å°†å…¶ Load å‡ºæ¥ä½¿ç”¨ã€‚ è¯»å˜é‡ç”¨äºå®å‚å®å‚å’Œè¡¨è¾¾å¼è®¡ç®—ä¸åŒåœ¨äºï¼Œä»–å¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚è€Œå› ä¸º C çš„æŒ‡é’ˆä¸ llvm æ˜¯ä¸åŒçš„ï¼Œæ¯”å¦‚è¯´åŒæ ·ä¸€ä¸ªä¸€ç»´æ•°ç»„ a[2] ï¼Œåœ¨ C ä¸­ä¸º int* ï¼Œè€Œåœ¨ llvm ä¸­ï¼Œå´æ˜¯ [2 x i32]* ã€‚è€Œå½“å‚æ•°ä¸º int a[] çš„æ—¶å€™ï¼Œåˆè¦æ±‚ llvm åˆ’ä¸º int*ï¼Œè¿™å°±è¯´éœ€è¦æ§åˆ¶ gep çš„æ•°é‡è¿›è¡Œé™ç»´ï¼ŒåŒæ—¶å¯¹äºä¸ºæŒ‡é’ˆçš„å˜é‡ï¼Œä¹Ÿä¸èƒ½ä¸€å‘³çš„ loadï¼Œè¿™æ ·æœ‰å¯èƒ½å°†åŸæœ¬çš„æŒ‡é’ˆå®å‚ç»™ Load å‡ºä¸€ä¸ªæ•´å‹æ¥ã€‚ çŸ­è·¯æ±‚å€¼å¯¹äºçŸ­è·¯æ±‚å€¼ï¼Œå¹¶ä¸æ˜¯ä¸€ä»¶å¯æœ‰å¯æ— çš„äº‹æƒ…ï¼Œå› ä¸ºå¯¹äº 1if (1 == 2 &amp;&amp; f()) å¦‚æœæ²¡æœ‰çŸ­è·¯æ±‚å€¼ï¼Œé‚£ä¹ˆ f() å°±ä¼šè¢«æŒ‡ä»¤ï¼Œå¦‚æœ f() æ˜¯ä¸€ä¸ªæœ‰å‰¯ä½œç”¨çš„å‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯å¯¹å†…å­˜å†™äº†ï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´ bug çš„å‡ºç°ï¼Œæ‰€ä»¥çŸ­è·¯æ±‚å€¼æ˜¯å¿…è¦çš„ã€‚ å®ç°çŸ­è·¯æ±‚å€¼å°±æ˜¯å°† 1if (cond1 &amp;&amp; cond2) å˜æˆ 12if (cond1) if (cond2) è¿™æ ·çš„ç»“æ„ï¼Œå°† 1if (cond1 || cond2) å˜æˆ 123456789if (cond1) { // then-block} else { if (cond2) { // then-block } else { // else-block }} å¯¹äºå¤šä¸ªæ¡ä»¶ï¼Œåªè¦ç¡®å®šå¥½ä¼˜å…ˆçº§ï¼Œé€’å½’å¤„ç†å³å¯ã€‚ æ§åˆ¶ç»“æ„æ§åˆ¶ç»“æ„å°±æ˜¯é€šè¿‡åˆ¶é€  BasicBlock æ¥å¯¹æ•°æ®æµè¿›è¡Œæ§åˆ¶ã€‚ åˆ†æ”¯ConditionNode æœ‰ä¸¤ç§å¯èƒ½ï¼Œæœ‰æ—  else å†³å®šäº†åˆ°åº•æ˜¯ 2 ä¸ª BasicBlock æˆ–è€…æ˜¯ 3 ä¸ª BasicBlockã€‚å¯¹äºæ²¡æœ‰ else çš„åˆ†æ”¯ç»“æ„ï¼Œåªç”¨ä¸€ä¸ªä¸‰å‚æ•°çš„ Br å°±å¯ä»¥è§£å†³ï¼Œå¯¹äºæœ‰ else çš„ç»“æ„ï¼Œåªéœ€è¦å°† Br çš„ falseBlock è°ƒæ•´ä¸º else å¯¹åº”çš„å—å³å¯ã€‚ å¾ªç¯éœ€è¦åˆ¶ä½œå‡º 3 ä¸ªå—ï¼Œåˆ†åˆ«ä¸º condBlock, bodyBlock, nextBlock ï¼Œå…¶ä¸­ condBlock é€‰æ‹©è·³è½¬åˆ° bodyBlock æˆ–è€…æ˜¯ nextBlock ï¼ˆè¿™ä¸ªéƒ¨åˆ†ç”± LOrExp, LAndExp è‡ªåŠ¨å®Œæˆ ï¼‰ï¼ŒbodyBlock ä¼šæ— æ¡ä»¶è·³è½¬åˆ° condBlockã€‚ Break &amp; Continue &amp; Returnè¿™äº›æŒ‡ä»¤é¢å¯¹çš„æœ€å¤§é—®é¢˜æ˜¯ä¸ºäº†æ»¡è¶³åŸºæœ¬å—çš„å®šä¹‰ï¼Œä¸è¿™äº›æŒ‡ä»¤æ‰€å¤„åŒä¸€åŸºæœ¬å—å¹¶ä½äºè¿™äº›æŒ‡ä»¤ä¹‹åçš„æŒ‡ä»¤ä¸åº”è¯¥å¾—åˆ°ç¿»è¯‘ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥åšä¸€ä¸ªæ–°çš„å—ï¼Œè®©å…¶åçš„æŒ‡ä»¤éƒ½ä¾é™„ä¸è¿™ä¸ªå—ï¼Œè€Œå…¥å£å—å¹¶æ²¡æœ‰åˆ°è¾¾è¿™ä¸ªå—çš„æ–¹å¼ï¼Œè¿™æ ·å°±å®Œæˆäº†å¯¹å…¶åæŒ‡ä»¤çš„å¿½ç•¥ã€‚ æ­¤å¤–ï¼Œbreak, continue éƒ½éœ€è¦ç¡®å®šè·³è½¬çš„ç›®æ ‡ï¼Œbreak ä¼šè·³è½¬åˆ° nextBlock ï¼Œè€Œ continue ä¼šè·³è½¬åˆ° condBlock ï¼Œä½†æ˜¯å› ä¸ºå¾ªç¯å­˜åœ¨åµŒå¥—ç»“æ„ï¼Œæ‰€ä»¥ä¸åŒå±‚çš„ break, continue éœ€è¦è·³è½¬åˆ°ä¸åŒçš„å±‚ã€‚æ‰€ä»¥åœ¨å…¨å±€ç”¨ä¸€ä¸ªæ ˆç»´æŠ¤è¯¥ç»“æ„ï¼Œå¦‚ä¸‹æ‰€ç¤º 1234567891011/** * å¤„ç†å¤šé‡å¾ªç¯ä¸­çš„continueï¼Œ * æ ˆé¡¶çš„loopEndBlockå³æ˜¯å½“å‰å±‚Continueè·³è½¬çš„å¯¹è±¡ */ public static Stack&lt;BasicBlock&gt; loopEndBlockStack = new Stack&lt;&gt;(); /** * å¤„ç†å¤šæ¬¡å¾ªç¯ä¸­çš„break * æ ˆé¡¶çš„endBlockå³æ˜¯å½“å‰å±‚breakè·³è½¬çš„å¯¹è±¡ */ public static Stack&lt;BasicBlock&gt; endBlockStack = new Stack&lt;&gt;(); åœ¨å¾ªç¯çš„æ—¶å€™ï¼Œè¿›è¡Œå‡ºå…¥æ ˆæ“ä½œ 12345678IrFactory.loopEndBlockStack.push(loopEndBlock); IrFactory.endBlockStack.push(endBlock); // è§£æStmt ((StmtNode) nodes.get(nodePos)).setStmtReturnType(this.stmtReturnType); nodes.get(nodePos).buildIr(); // å®Œæˆå½“å‰è§£æï¼Œå¼¹æ ˆ IrFactory.loopEndBlockStack.pop(); IrFactory.endBlockStack.pop(); åœ¨ break ä¸­ï¼š 12// å¼ºåˆ¶è·³è½¬è‡³endBlock IrBuilder.buildBrInstruction(IrFactory.endBlockStack.peek(), IrFactory.curBlock); åœ¨ continue ä¸­ 12// å¼ºåˆ¶è·³è½¬è‡³endLoopBlock IrBuilder.buildBrInstruction(IrFactory.loopEndBlockStack.peek(), IrFactory.curBlock); å…·ä½“æ¶æ„è®¾è®¡IrBuilderç±»ï¼šæŒ‡ä»¤çš„å·¥å‚IrBuilderç±»æ˜¯ä¸­é—´ä»£ç çš„å…¥å£ï¼ŒåŒæ—¶ä¹Ÿå°è£…æœ‰æ„å»º llvmå…ƒç´ çš„å·¥å‚æ¨¡å¼æ–¹æ³•ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä»¬ç°åœ¨æ­£è¦å–å‡ºä¸€ä¸ªæŒ‡é’ˆç±»å‹å˜é‡æ‰€æŒ‡ç©ºé—´ä¸­çš„å†…å®¹ï¼Œå¯ä»¥æ„å»ºä¸€æ¡ LoadæŒ‡ä»¤ï¼ˆå½“ç„¶å¦‚æœæ˜¯æ•°ç»„å°±éœ€è¦GEPæŒ‡ä»¤äº†ï¼‰ï¼Œå¹¶å°†å…¶æ’å…¥å½“å‰æ‰€å¤„çš„åŸºæœ¬å—ã€‚å¯ä»¥å¦‚æ­¤åšï¼š 1234567891011121314151617181920212223242526272829303132// LValNode.javaï¼Œå…¶å¯¹åº”æ–‡æ³•LVal â†’ Ident {'[' Exp ']'}ï¼Œæ˜¯æŒ‡é’ˆçš„å‘ç¥¥åœ°Value fParamValue = IrBuilder.buildLoadInstruction(lvalValue, IrFactory.curBlock); if (expNode == null) { IrFactory.synValue = fParamValue; } else { expNode.buildIr(); if (IrFactory.synValue.getType() instanceof CharType) { if (IrFactory.synValue instanceof ConstChar) { IrFactory.synValue = new ConstInt(32, ((ConstChar) IrFactory.synValue).getValue()); } else { IrFactory.synValue = IrBuilder.buildZextInstruction(IrFactory.synValue, IrFactory.curBlock); } } Value indexValue = IrFactory.synValue; Value ptrVal = IrBuilder.buildGetElementPtrInstruction(fParamValue, indexValue, IrFactory.curBlock); if (IrUtil.getPointingTypeOfPointer(fParamValue) instanceof ArrayType) { // System.out.println(&quot;can't delete&quot;); ptrVal = IrBuilder.buildRankDownInstruction(ptrVal, IrFactory.curBlock); } IrFactory.synValue = ptrVal;// IrBuilder.java/** * æ„å»ºåŠ è½½æŒ‡ä»¤ * @param pointer è¦åŠ è½½çš„åœ°å€ï¼Œä»è¿™ä¸ªåœ°å€å¤„è¯»å–æ“ä½œæ•° * @return å®ŒæˆåŠ è½½çš„Value */ public static Load buildLoadInstruction(Value pointer, BasicBlock parent) { Load load = new Load(getName(), parent, pointer); parent.addInstruction(load); return load; } IrFactoryï¼šé€’å½’ä¸‹é™çš„ä¸Šä¸‹æ–‡ä¿¡æ¯åˆšåˆšæˆ‘ä»¬æåˆ°ï¼Œè¦è¿›è¡ŒåŸºäºå±æ€§ç¿»è¯‘æ–‡æ³•çš„é€’å½’ä¸‹é™ã€‚æ—¢ç„¶æ˜¯å±æ€§ç¿»è¯‘æ–‡æ³•ï¼ŒåŠ¿å¿…æ¶‰åŠåˆ°ç»¼åˆå±æ€§ï¼ˆsynthesized attribute)çš„å‘ä¸Šä¼ é€’ï¼Œä»¥åŠç»§æ‰¿å±æ€§ï¼ˆinherited attributeï¼‰çš„å‘ä¸‹ä¼ é€’ã€‚ å¾—ç›Šäºé€’å½’ä¸‹é™çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ nodeç±»å†…ï¼Œé€šè¿‡çˆ¶å­ nodeé—´ç›´æ¥è°ƒç”¨å¯¹æ–¹çš„ç›¸å…³ setteræˆ–è€… getteræ¥ç²—æš´åœ°å®ç°ä¿¡æ¯ä¼ é€’ã€‚ ä½†å¦‚æœæˆ‘ä»¬ä¼ é€’çš„é“¾æ¡å¾ˆé•¿å‘¢ï¼Ÿè­¬å¦‚æˆ‘ä»¬åœ¨ä¸€ä¸ª LValå†…çš„ä¿¡æ¯ï¼Œè¦ç»è¿‡å¥½é•¿å¥½é•¿çš„è·¯ï¼Œæ‰èƒ½æŠµè¾¾çœŸæ­£éœ€è¦è¯¥ä¿¡æ¯çš„ ConstExpï¼Œè¿™æ—¶å€™å¦‚æœè¿˜è¦å†™é‚£ä¹ˆå¤š setterï¼Œæœªå…ä¹Ÿè¿‡äºç¬¨ã€‚ è€ƒè™‘åˆ°åªæœ‰ç»¼åˆå±æ€§ä¼šå‡ºç°è¿™ç§é•¿çº¿çš„ä¼ é€’ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Ircé‡Œç›´æ¥è®°å½•å…¨å±€çš„ï¼Œæ­£åœ¨ä¼ é€’çš„ç»¼åˆå±æ€§ï¼ˆä»¬ï¼‰ï¼š 12345678910111213//=========================== ç»¼åˆå±æ€§ =================================/** * Valueç±»å‹åˆ—è¡¨çš„ç»¼åˆå±æ€§ upå‘ä¸Šä¼ é€’ */public static ArrayList&lt;Value&gt; synValueArray = null;/** * Valueç±»å‹çš„ç»¼åˆå±æ€§ upå‘ä¸Šä¼ é€’ */public static Value synValue = null;/** * intç±»å‹çš„ç»¼åˆå±æ€§ upå‘ä¸Šä¼ é€’ */public static int synInt = -114514; ä¸­é—´ä»£ç çš„æ„å»ºè¿‡ç¨‹ï¼Œæ˜¯å­—é¢æ„ä¹‰ä¸Šæ‹†ä¸œå¢™å»ºè¥¿å¢™çš„è¿‡ç¨‹ï¼Œå³åœ¨æ ¹æ®æ–‡æ³•é€’å½’ä¸‹é™ æ‰«æè¯­æ³•åˆ†æç»“æœçš„åŒæ—¶ï¼Œåœ¨å¦ä¸€è¾¹é€æ­¥ï¼ˆç”¨åŠ¨ä½œç¬¦å·ï¼‰æ­å»ºèµ·å¦ä¸€ä¸ª llvmçš„ä½“ç³»ã€‚ æ—¢ç„¶æ˜¯åŒæ­¥åœ¨æ‰«æä¸¤ä¸ªä½“ç³»ï¼Œå°±åº”å½“æœ‰ä¸¤ç»„æŒ‡é’ˆæ¥è®°å½•æ‰«æè¿›åº¦ã€‚è¯­æ³•åˆ†æçš„æ‰«æè¿›åº¦ï¼ˆç”±é€’å½’ä¸‹é™ä¿è¯å¤–ï¼Œè¿˜æœ‰å½“å‰æ˜¯å¦åœ¨æ‰«æå¸¸é‡è¡¨è¾¾å¼ï¼Œæ˜¯å¦åœ¨æ‰«æå‡½æ•°å®å‚ï¼Œæ˜¯å¦æ­£åœ¨ç»å†å¾ªç¯ï¼‰ï¼Œllvmçš„æ„å»ºè¿›åº¦ï¼ˆå³å½“å‰åœ¨æ­å»ºå“ªä¸ªå‡½æ•°ï¼Œå“ªä¸ªåŸºæœ¬å—ï¼Œï¼‰éƒ½åº”å½“å¾—åˆ°è®°å½•ï¼š 1234567891011121314151617181920212223242526272829303132/** * å½“å‰æ‰€åœ¨åŸºæœ¬å— */ public static BasicBlock curBlock = null; /** * å½“å‰æ‰€åœ¨å‡½æ•° */ public static Function curFunction = null; /** * å½“å‰æ˜¯å¦æ­£åœ¨è®¡ç®— æ— å˜é‡å¸¸æ•°è¡¨è¾¾å¼ * å¦‚æœæ˜¯ï¼Œé‚£ä¹ˆç»¼åˆå±æ€§åªéœ€è¦ä¼ é€’synIntï¼Œä¸”è®¡ç®—æƒ…å†µæœ‰æ‰€å‡å°‘ */ public static boolean isBuildingConstExp = false; /** * å½“å‰æ˜¯å¦åœ¨è¿›è¡Œå…¨å±€å˜é‡çš„åˆå§‹åŒ– */ public static boolean isBuildingGlobalInit = false; /** * å½“å‰æ˜¯å¦æ­£åœ¨æ„å»ºä¸€ä¸ªintç±»å‹çš„å®å‚ * å¦‚æœæ˜¯ï¼Œä½†æ˜¯å½“å‰è§£æåˆ°çš„å´æ˜¯int*ç±»å‹ï¼Œé‚£ä¹ˆéœ€è¦load */ public static boolean isBuildingPointerRParam = false; /** * å¤„ç†å¤šé‡å¾ªç¯ä¸­çš„continueï¼Œ * æ ˆé¡¶çš„loopEndBlockå³æ˜¯å½“å‰å±‚Continueè·³è½¬çš„å¯¹è±¡ */ public static Stack&lt;BasicBlock&gt; loopEndBlockStack = new Stack&lt;&gt;(); /** * å¤„ç†å¤šæ¬¡å¾ªç¯ä¸­çš„break * æ ˆé¡¶çš„endBlockå³æ˜¯å½“å‰å±‚breakè·³è½¬çš„å¯¹è±¡ */ public static Stack&lt;BasicBlock&gt; endBlockStack = new Stack&lt;&gt;(); llvmå…ƒç´ llvmå…ƒç´ ä¸»è¦æ”¾ç½®åœ¨ ir/valueså†…ã€‚ è¯¥ç±»ä¸»è¦å­˜å‚¨äº† llvmä½“ç³»ä¸‹ï¼Œè¯¥å…ƒç´ çš„è¦ç´ åŠå…¶ç›¸åº”çš„ getterå’Œ setterã€‚ æ­¤å¤–ï¼Œæ‰€æœ‰ llvmå…ƒç´ éƒ½å®ç°äº† buildMips()æ–¹æ³•ï¼ˆåŠè¾…åŠ©æ–¹æ³•ï¼‰ï¼Œç”¨äºåç»­æ„å»º mipsä½“ç³»ã€‚ å› æ­¤ï¼Œllvmå…ƒç´ ç±»æ˜¯è´¯ç©¿äº† llvmåˆæ­¥ç”Ÿæˆï¼Œä¸­ç«¯çš„ mem2regé‡æ„ï¼Œmipsåˆæ­¥ç”Ÿæˆçš„é‡è¦ç±»ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨åŸºæœ¬å— BasicBlockç±»å†…ï¼Œä¼šè®°å½•è¿™æ ·çš„ä¸€äº›ä¿¡æ¯ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990/** * å‰é©±ä¸åç»§å— */ private final HashSet&lt;BasicBlock&gt; preBlocks = new HashSet&lt;&gt;(); private final HashSet&lt;BasicBlock&gt; sucBlocks = new HashSet&lt;&gt;();// ==================æ”¯é…åˆ†æ==================== /** * æ”¯é…è€…å— */ private final ArrayList&lt;BasicBlock&gt; domers = new ArrayList&lt;&gt;(); /** * ç›´æ¥æ”¯é…çš„åŸºæœ¬å— */ private final ArrayList&lt;BasicBlock&gt; idomees = new ArrayList&lt;&gt;(); /** * ç›´æ¥æ”¯é…åŸºæœ¬å— */ private BasicBlock Idomer; /** * åœ¨æ”¯é…æ ‘ä¸­çš„æ·±åº¦ */ private int domLevel; /** * æ”¯é…è¾¹é™…ï¼Œå³åˆšå¥½ä¸è¢«å½“å‰åŸºæœ¬å—æ”¯é…çš„åŸºæœ¬å— */ private final HashSet&lt;BasicBlock&gt; dominanceFrontier = new HashSet&lt;&gt;(); public ArrayList&lt;BasicBlock&gt; getDomers() { return domers; } /** * å½“å‰å—æ˜¯å¦æ˜¯å¦ä¸€ä¸ªå—çš„æ”¯é…è€… */ public boolean isDominating(BasicBlock other) { return other.domers.contains(this); } public ArrayList&lt;BasicBlock&gt; getIdomees() { return idomees; } public void setIdomer(BasicBlock idomer) { Idomer = idomer; } public void setDomLevel(int domLevel) { this.domLevel = domLevel; } public int getDomLevel() { return domLevel; } public HashSet&lt;BasicBlock&gt; getDominanceFrontier() { return dominanceFrontier; } public BasicBlock getIdomer() { return Idomer; } // =================== å¾ªç¯åˆ†æ ====================== /** * å½“å‰å—ç›´å±çš„å¾ªç¯ */ private Loop loop = null; /** * è·å¾—å¾ªç¯æ·±åº¦ * å¦‚æœä¸åœ¨å¾ªç¯ä¸­ï¼Œåˆ™æ·±åº¦ä¸º 1 * * @return å¾ªç¯æ·±åº¦ */ public int getLoopDepth() { if (loop == null) { return 0; } return loop.getLoopDepth(); } public void setLoop(Loop loop) { this.loop = loop; } public Loop getLoop() { return loop; } å†è®® SSAç°åœ¨å†çœ‹å›SSAï¼š å½“æ¶‰åŠåˆ°åˆ†æ”¯è¯­å¥æ—¶ï¼ŒSSAä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œä»¥ä¸‹é¢è¿™ä¸ªå¾ªç¯ä¸ºä¾‹ï¼š 1234567891011int main(){ int i = 0; i = getint(); int a = 1; a = getint(); for(; i &lt; 10; i = i + 1){ i = i + 2; a = a + 3; } return 0;} æˆ‘ä»¬ä¼šå‘ç°ï¼Œå¯¹äºå¾ªç¯çš„å½’çº³å˜é‡ï¼Œå…¶æ³¨å®šä¼šæœ‰ä¸¤å¤„èµ‹å€¼ã€‚å› æ­¤åŒæ ·å¯¹äº iå’Œ aï¼Œæˆ‘ä»¬éœ€è¦å†æ¥ä¸€ä¸ª i1å’Œ a1æ¥æ”¾ç½®è¿™ç¬¬äºŒä¸ªèµ‹å€¼ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œåœ¨ i1å’Œ a1çš„æ±‡èšç‚¹ï¼Œåˆ°åº•è¯¥é‡‡å–å“ªä¸ªèµ‹å€¼ï¼Ÿè¿™æ—¶å€™å°±å¿…é¡»ç”¨åˆ° phiæŒ‡ä»¤ã€‚ phi æŒ‡ä»¤è¿™ä¸ªæŒ‡ä»¤èƒ½å¤Ÿæ ¹æ®è¿›å…¥å½“å‰åŸºæœ¬å—ä¹‹å‰æ‰§è¡Œçš„æ˜¯å“ªä¸€ä¸ªåŸºæœ¬å—çš„ä»£ç æ¥é€‰æ‹©ä¸€ä¸ªå˜é‡çš„å€¼ã€‚ 1&lt;result&gt; = phi &lt;ty&gt; [&lt;val0&gt;, &lt;label0&gt;], [&lt;val1&gt;, &lt;label1&gt;] ... æœ‰äº† phiï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™å‡ºä»£ç ï¼š 1234567891011121314151617181920define dso_local i32 @main() {b0: %i3 = call i32 @getint() %i7 = call i32 @getint() br label %b9b9: %p25 = phi i32 [ %i3, %b0 ], [ %i16, %b11 ] %p24 = phi i32 [ %i7, %b0 ], [ %i19, %b11 ] %i14 = icmp slt i32 %p25, 10 br i1 %i14, label %b10, label %b12b10: %i19 = add i32 %p24, 2 %i22 = add i32 %p25, 3 br label %b11b11: %i16 = add i32 %i22, 1 br label %b9b12: ret i32 0} ä½†å®é™…ä¸Šï¼ŒphiæŒ‡ä»¤çš„æ„å»ºæœ‰äº¿ç‚¹ç‚¹å¤æ‚ï¼Œè¿™ä¹Ÿå¤ªéš¾å†™äº†ï¼å¦‚æœæœ‰ä¸€ä¸ªèƒ½å¤Ÿæ‘†è„±SSAé™åˆ¶çš„åŠæ³•å°±å¥½äº†ã€‚ è¿™å°±è¦ç”¨åˆ°æˆ‘ä»¬ä¹‹å‰æåˆ°çš„å†…å­˜SSAï¼š è¿™ç§ç”Ÿæˆå­˜å–å†…å­˜çš„ llvmæœ‰å››ä¸ªç‰¹ç‚¹ï¼š æ¯ä¸ªå±€éƒ¨å˜é‡éƒ½å˜ä¸ºäº†æ ˆä¸Šåˆ†é…çš„ç©ºé—´ï¼ˆå˜é‡åœ¨ç¬¦å·è¡¨ä¸­å­˜çš„å…¶å®æ˜¯å…¶ alloca æŒ‡ä»¤ï¼‰ æ¯æ¬¡å¯¹å±€éƒ¨å˜é‡çš„è¯»éƒ½å˜æˆäº†ä»å†…å­˜ç©ºé—´ä¸­çš„ä¸€æ¬¡è¯»ï¼ˆåœ¨ LValNodeä¸­å®ç°ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¿™é‡Œæ˜¯æŒ‡é’ˆçš„æ•…ä¹¡ä¹‹ä¸€ï¼ï¼‰ æ¯æ¬¡å¯¹å±€éƒ¨å˜é‡çš„å†™éƒ½å˜æˆäº†å¯¹å†…å­˜çš„ä¸€æ¬¡å†™ï¼ˆæ¯æ¬¡æ›´æ–°ä¸€ä¸ªå˜é‡çš„å€¼éƒ½å˜æˆäº†é€šè¿‡ store å¯¹å˜é‡æ‰€åœ¨å†…å­˜çš„å†™ï¼‰ è·å–å±€éƒ¨å˜é‡çš„åœ°å€ç­‰ä»·äºè·å–å†…å­˜çš„åœ°å€ éœ€è¦è¿›è¡Œçš„ä¸»è¦æ“ä½œæœ‰ï¼š å±€éƒ¨å˜é‡å®šä¹‰æ—¶ï¼š allocaï¼ˆåˆ†é…å˜é‡çš„æ ˆç©ºé—´ï¼Œè¿”å›æŒ‡å‘è¯¥ç©ºé—´çš„æŒ‡é’ˆï¼‰ å°† allocaè®°å½•è¿›å…¥ç¬¦å·è¡¨ã€‚ storeï¼ˆç»™å˜é‡èµ‹å€¼ï¼Œå³å‘æŒ‡é’ˆæ‰€æŒ‡ç©ºé—´å†…è¿›è¡Œå†™ï¼‰ å±€éƒ¨å˜é‡ä½¿ç”¨æ—¶ï¼š LVal: æŸ¥ç¬¦å·è¡¨è·å¾—æŒ‡å®šå±€éƒ¨å˜é‡æˆ–å½¢å‚çš„ allocaæŒ‡é’ˆ PrimaryExp: å¯¹äºLValä¼ ä¸Šæ¥çš„ allocaæŒ‡é’ˆï¼Œè¿›è¡Œ loadå¤„ç† å‡½æ•°å½¢å‚æ¥æ”¶æ—¶ï¼š ç‰¹åˆ«åœ°ï¼Œå‡½æ•°çš„å½¢å‚ä¹Ÿç±»ä¼¼äºå±€éƒ¨å˜é‡ï¼Œæˆ‘ä»¬ä¹Ÿè¦å°†å…¶å¤„ç†ä¸ºSSAå½¢å¼ï¼Œåœ¨æ ˆä¸Šåˆ†é…ç©ºé—´å¹¶èµ‹å€¼ä»¥ä»£ä¹‹ï¼Œå¦åˆ™è¿˜æ˜¯ä¼šé‡åˆ°æˆ‘ä»¬ä¸Šä¸€èŠ‚åˆ†æå‡ºæ¥çš„é—®é¢˜ï¼ FuncFParamNodeï¼šè¯»å–å½¢å‚çš„ç±»å‹ã€åç§°ï¼Œåˆ›å»ºå½¢å‚çš„Value FuncFParamsNodeï¼š å¯¹äºæ¯ä¸€ä¸ªå½¢å‚ï¼Œéƒ½è¿›è¡Œ allocaï¼Œstoreï¼Œå…¶ä¸­ storeçš„å†…å®¹å°±æ˜¯åˆšåˆ›å»ºçš„å½¢å‚çš„Valueã€‚ç¬¦å·è¡¨ä¸­å­˜å…¥çš„ä¹Ÿæ˜¯ allocaå¯¹åº”çš„value ConstExpçš„å¤„ç†ä¸â€œåé—¨â€å¸¸é‡ä¼ æ’­åœ¨æˆ‘ä»¬çš„æ–‡æ³•å½“ä¸­ï¼Œæœ‰è¿™æ ·çš„å£°æ˜ï¼š å¸¸é‡è¡¨è¾¾å¼ ConstExp ConstExp -&gt; AddExp ä¸­ä½¿ç”¨çš„ ident å¿…é¡»æ˜¯å¸¸é‡ ä½•ä¸ºå¸¸é‡ï¼Ÿå³èƒ½å¤Ÿåœ¨ç¼–è¯‘é˜¶æ®µå°±ç¡®å®šå€¼çš„é‡ï¼ŒåŒ…æ‹¬äº†å¸¸é‡æ ‡è¯†ç¬¦ä¸ç«‹å³æ•°ã€‚å¯¹äºå¸¸é‡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µå°±è®¡ç®—å‡ºå¸¸é‡è¡¨è¾¾å¼çš„å€¼ï¼Œä»¥åŠå°†å¸¸é‡æ ‡è¯†ç¬¦æ›¿æ¢ä¸ºå…¶å€¼ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬åœ¨ IrFactoryé‡Œè®¾ç½®æœ‰å­—æ®µï¼Œåœ¨ Expç³»çš„ buildIrå†…ï¼Œæ„å»ºå¸¸é‡æ—¶çš„åˆ†ç±»è®¨è®ºçš„æ–¹å¼æœ‰æ‰€ä¸åŒï¼Œä¸”ç”±äºèƒ½å¤Ÿè®¡ç®—å‡ºintç±»å‹å…·ä½“å€¼ï¼Œæˆ‘ä»¬åªéœ€è¦è¿›è¡Œ synIntç»¼åˆå±æ€§çš„ä¼ é€’ã€‚ å¸¸é‡åˆ†ä¸ºæ•°ç»„å¸¸é‡å’Œéæ•°ç»„å¸¸é‡ï¼Œå…¶è¡Œä¸ºæœ‰æ‰€ä¸åŒï¼š intå¸¸é‡ æ•°ç»„å¸¸é‡ æ˜¯å¦åœ¨llvmä»£ç ä¸­æ˜¾å¼å£°æ˜ å¦ ä¸æ™®é€šæ•°ç»„å˜é‡ä¸€è‡´ï¼Œé‡‡ç”¨alloca,store åœ¨ ConstExpä¸‹ ç›´æ¥æ±‚å‡ºint, charå€¼ ç›´æ¥æ±‚å‡ºæŒ‡å®šå…ƒç´ çš„intå€¼ é ConstExpä¸‹ ç›´æ¥æ±‚å‡ºint, charå€¼ ä¸æ™®é€šæ•°ç»„å˜é‡ä¸€è‡´ï¼Œé‡‡ç”¨gepï¼Œload Mips ç”Ÿæˆåœ¨llvmä¸­ï¼Œæˆ‘ä»¬å·²ç»å°†æºä»£ç è½¬æ¢æˆäº†å¾ˆæ¥è¿‘ä¸­é—´ä»£ç çš„å½¢å¼äº†ï¼šæˆ‘ä»¬åˆ’åˆ†å¹¶ç”Ÿæˆäº†åŸºæœ¬å—ï¼Œç”Ÿæˆäº†å‡ ä¹èƒ½ä¸€ç­‰ä¸€è½¬åŒ–ä¸ºmipsçš„llvmæŒ‡ä»¤ã€‚å› æ­¤åœ¨ç›®æ ‡ä»£ç çš„åˆæ­¥ç”Ÿæˆçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬çš„å…³æ³¨ç‚¹ä¸»è¦åœ¨äºå­˜å‚¨ç®¡ç†ã€æŒ‡ä»¤çš„ç­‰ä»·ç¿»è¯‘ã€‚ MipsBuilderï¼šæŒ‡ä»¤çš„å·¥å‚ç±»åœ¨MipsBuilderä¸­å°è£…æœ‰æ„å»ºå„ç§æŒ‡ä»¤ã€æ„å»ºæ“ä½œæ•°çš„å·¥å‚æ¨¡å¼æ–¹æ³•ã€‚ ä¾‹å¦‚æ„å»ºä¸€æ¡ addæŒ‡ä»¤å¹¶åŠ å…¥æŒ‡å®šçš„ MipsBlockï¼š 12345678910/** * æ„å»ºåŒæ“ä½œæ•°æŒ‡ä»¤ * * @param type æŒ‡ä»¤ç±»å‹ */ public static MipsBinary buildBinary(MipsBinary.BinaryType type, MipsOperand dst, MipsOperand src1, MipsOperand src2, BasicBlock irBlock) { MipsBinary binary = new MipsBinary(type, dst, src1, src2); MipsFactory.irBlock2MipsBlock(irBlock).addInstruction(binary); return binary; } MipsFactoryï¼šè®°å½• llvmæˆåˆ†åˆ° mipsæˆåˆ†çš„æ˜ å°„æˆ‘ä»¬æ˜¯åœ¨llvmçš„æˆåˆ†ç±»ä¸­è¿›è¡Œçš„mipsç”Ÿæˆï¼Œå› æ­¤éœ€è¦å°†llvmæˆåˆ†ä¸mipsæˆåˆ†è¿›è¡Œæ˜ å°„ã€‚ 1234567891011121314151617181920212223242526272829/** * è·å–irå‡½æ•°å¯¹è±¡ å¯¹åº”çš„ mipså‡½æ•°å¯¹è±¡ * * @param irFunction irå‡½æ•°å¯¹è±¡ * @return mipså‡½æ•°å¯¹è±¡ */ public static MipsFunction irFunction2MipsFunction(Function irFunction) { return functionMap.get(irFunction); } /** * è·å–iråŸºæœ¬å—å¯¹è±¡ å¯¹åº”çš„ mipsåŸºæœ¬å—å¯¹è±¡ * * @param irBlock iråŸºæœ¬å—å¯¹è±¡ * @return mipsåŸºæœ¬å—å¯¹è±¡ */ public static MipsBlock irBlock2MipsBlock(BasicBlock irBlock) { return blockMap.get(irBlock); } /** * è·å–ir Valueå¯¹è±¡ å¯¹åº”çš„ mipsOperandå¯¹è±¡ * * @param irValue ir Valueå¯¹è±¡ * @return mipsOperandå¯¹è±¡ */ public static MipsOperand irValue2MipsOp(Value irValue) { return opMap.get(irValue); } llvmçš„æˆåˆ†ç±»ï¼šmipsç”Ÿæˆçš„ä¸»è¦åœºæ‰€é€šè¿‡éå† llvmçš„æ ‘å½¢ç»“æ„æ¥ç”Ÿæˆ mipsï¼Œéå†åœ¨ ir/valuesä¸‹çš„å„ä¸ªvalueç±»è¿›è¡Œï¼Œä»–ä»¬éƒ½å®ç°äº†çˆ¶ç±» Valueçš„ buildMips()æ–¹æ³•ã€‚ backend/instructions: MipsæŒ‡ä»¤ç±»æŒ‡ä»¤ç±»éƒ½ç»§æ‰¿äº† MipsInstructionç±»ï¼Œè¯¥ç±»å†…æœ‰ srcæ“ä½œæ•°å’Œ dstæ“ä½œæ•°çš„ç›¸åº”ç®¡ç†æ–¹æ³•ï¼ŒåŒ…æ‹¬ useï¼Œdefçš„è®°å½•ï¼Œç”¨äºæ´»è·ƒå˜é‡åˆ†æï¼Œä»¥åŠåç»­å¯„å­˜å™¨åˆ†é…æ—¶ï¼Œå¯¹è™šæ‹Ÿå¯„å­˜å™¨è¿›è¡ŒæŸ¥è¯¢ã€æ›¿æ¢ã€‚ backend/operands: æ“ä½œæ•°ç±»è¯¥åŒ…å†…çš„ç±»å‡å¯ä»¥ä½œä¸º mipsæŒ‡ä»¤çš„æ“ä½œæ•°ï¼Œå…·ä½“æ¥è¯´æœ‰ç«‹å³æ•°ã€è™šæ‹Ÿå¯„å­˜å™¨ã€ç‰©ç†å¯„å­˜å™¨ã€æ ‡ç­¾ã€‚ ç‰©ç†å¯„å­˜å™¨çš„ç›¸å…³é…ç½®åœ¨ RegTypeæšä¸¾ç±»ä¸­ï¼Œè®°å½•äº†ç‰©ç†å¯„å­˜å™¨çš„ç¼–å·ã€åç§°ã€ä½•è€…éœ€è¦åœ¨å‡½æ•°è°ƒç”¨æ—¶ä¿å­˜ã€ä½•è€…èƒ½å¤Ÿä½œä¸ºå…¨å±€å¯„å­˜å™¨åˆ†é…ç­‰ä¿¡æ¯ã€‚ æ„å»ºæµç¨‹å¸¦æœ‰è™šæ‹Ÿå¯„å­˜å™¨çš„mipsçš„æ€»ä½“æ„å»ºæµç¨‹å¦‚ä¸‹ï¼š æ„å»º.dataæ®µæ„å»º.dataæ®µä¸»è¦æ˜¯åœ¨ç¿»è¯‘ llvmçš„å…¨å±€å˜é‡å…ƒç´  GlobalVariableã€‚ å…ˆå‰åœ¨ llvmç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†éœ€è¦ printfè¾“å‡ºçš„å­—ç¬¦ä¸²é‡æ–°åˆ†é…ä¸ºäº†å…¨å±€å¸¸é‡å­—ç¬¦ä¸²ï¼Œå› æ­¤è¿™é‡Œå…¨å±€å˜é‡å…±æœ‰ä¸‰ç±»ï¼šå­—ç¬¦ä¸²ã€intå˜é‡ã€intæ•°ç»„ã€‚ä¾æ¬¡æ„å»º mipsGlobalVariableï¼Œç„¶ååŠ å…¥ MipsModuleå³å¯ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142@Override public void buildMips() { MipsGlobalVariable mipsGlobalVariable = null; // æ— åˆå§‹å€¼é”™è¯¯ if (initValue == null) { System.out.println(&quot;[buildMips] GlobalVariableï¼šinitValue == null&quot;); } // æœªåˆå§‹åŒ–çš„å…¨å±€æ•°ç»„ else if (initValue instanceof ZeroInitializer) { mipsGlobalVariable = new MipsGlobalVariable(getName(), initValue.getType().getSize()); } // å¸¸é‡å­—ç¬¦ä¸² else if (initValue instanceof ConstString) { mipsGlobalVariable = new MipsGlobalVariable(getName(), ((ConstString) initValue).getContent()); } // intå˜é‡ else if (initValue instanceof ConstInt) { mipsGlobalVariable = new MipsGlobalVariable(getName(), new ArrayList&lt;&gt;() {{ add(((ConstInt) initValue).getValue()); }}, MipsGlobalVariable.GVType.Int); } else if (initValue instanceof ConstChar) { mipsGlobalVariable = new MipsGlobalVariable(getName(), new ArrayList&lt;&gt;() {{ add(((ConstChar) initValue).getValue()); }}, MipsGlobalVariable.GVType.Char); } // int | Charæ•°ç»„ else if (initValue instanceof ConstArray) { ArrayList&lt;Integer&gt; inits = new ArrayList&lt;&gt;(); if (((ConstArray) initValue).getElements().get(0).getType() instanceof IntType) { for (Constant element : ((ConstArray) initValue).getElements()) { inits.add(((ConstInt) element).getValue()); } mipsGlobalVariable = new MipsGlobalVariable(getName(), inits, MipsGlobalVariable.GVType.Int); } else { for (Constant element : ((ConstArray) initValue).getElements()) { inits.add(((ConstChar) element).getValue()); } mipsGlobalVariable = new MipsGlobalVariable(getName(), inits, MipsGlobalVariable.GVType.Char); } } MipsModule.addGlobalVariable(mipsGlobalVariable); } ä¸ºæ‰€æœ‰Blockå’ŒFunctionåˆ›å»ºMipså¯¹è±¡ï¼Œå¹¶æ˜ å°„åˆ°llvmçš„ç›¸åº”å¯¹è±¡æ²¡æœ‰å¤ªå¤šå¯è¯´çš„ï¼Œä½œç”¨ä¸»è¦æ˜¯æ–¹ä¾¿åœ¨åç»­éå†è¯­å¥æ—¶ï¼Œèƒ½å¤Ÿæ–¹ä¾¿åœ°å¼•ç”¨å‡½æ•°å’ŒåŸºæœ¬å—ï¼ˆç”¨äºcallã€brç­‰llvmæŒ‡ä»¤çš„ç¿»è¯‘ï¼‰ 123456789101112131415161718192021222324252627282930/** * å°†ä¸­é—´ä»£ç çš„å‡½æ•°å’ŒåŸºæœ¬å—å¯¹è±¡: * 1.æ„å»ºmipsé‡Œçš„ç›¸åº”å¯¹è±¡ * 2.åŠ å…¥Module * 3.ä¿¡æ¯å­˜å‚¨åˆ°mipså¯¹è±¡é‡Œ */ private void mapFunctionBlockIr2Mips() { // éå†æ‰€æœ‰å‡½æ•° for (Function irFunction : functions) { // æ„å»ºå‡½æ•°å¯¹è±¡ MipsFunction mipsFunction = new MipsFunction(irFunction.getName(), irFunction.isLibFunc()); MipsFactory.addFunctionMapping(irFunction, mipsFunction); MipsModule.addFunction(mipsFunction); // æ„å»ºåŸºæœ¬å—å¯¹è±¡ ArrayList&lt;BasicBlock&gt; blocks = irFunction.getBasicBlocks(); for (BasicBlock irBlock : blocks) { MipsBlock mipsBlock = new MipsBlock(irBlock.getName(), irBlock.getLoopDepth()); MipsFactory.addBlockMapping(irBlock, mipsBlock); } // è®°å½•mipsBlockçš„å‰é©±å—ä¿¡æ¯, å‰é©±å—å½“ç„¶ä¹Ÿæ˜¯mipsBlock for (BasicBlock irBlock : blocks) { MipsBlock mipsBlock = MipsFactory.irBlock2MipsBlock(irBlock); for (BasicBlock irPreBlock : irBlock.getPreBlocks()) { mipsBlock.addPreBlock(MipsFactory.irBlock2MipsBlock(irPreBlock)); } } } } éå† llvmçš„æ ‘å½¢ç»“æ„ä¾åºéå† llvmçš„æ‰€æœ‰å‡½æ•°ã€æ‰€æœ‰åŸºæœ¬å—ã€æ‰€æœ‰æŒ‡ä»¤ï¼Œè¿›è¡Œç¿»è¯‘ã€‚ å…·ä½“æ„å»ºéš¾ç‚¹å®é™…ä¸Šï¼Œå°† LLVMæŒ‡ä»¤æŒ¨ä¸ªç¿»è¯‘æˆ MIPSæŒ‡ä»¤å¹¶ä¸å›°éš¾ï¼Œæˆ‘ä»¬é‡ç‚¹è®²ä¸€ä¸‹ç¿»è¯‘æˆ Mipsæ—¶å‡½æ•°è°ƒç”¨çš„éƒ¨åˆ†ï¼Œè¿™æ˜¯ä¸€å¤§éš¾ç‚¹ï¼Œè‡³äºå¯„å­˜å™¨åˆ†é…åˆ™æ”¾åˆ°ä¼˜åŒ–éƒ¨åˆ†è¯¦è¿°ã€‚ Callï¼šå‚æ•°ä¼ é€’Callçš„ä½œç”¨æ˜¯è°ƒç”¨å‡½æ•°ï¼Œç†æ‰€å½“ç„¶åœ°ï¼Œåœ¨mipsä¸­éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨è¿›è¡Œå®å‚çš„ä¼ é€’ï¼ŒåŒæ—¶è®°å½• MipsCallæŒ‡ä»¤å¯¹äºå¯„å­˜å™¨çš„ä¿®æ”¹ï¼ˆå³defï¼‰ã€‚ å¯¹äºå‰å››ä¸ªå‚æ•°ï¼Œä¿å­˜åœ¨ a0-a3é‡Œå³å¯ã€‚å¯¹äºæ›´å¤šçš„å‚æ•°ï¼Œéœ€è¦ä¿å­˜åœ¨æ ˆä¸Šã€‚ è°ƒç”¨å‡½æ•°åœ¨è°ƒç”¨è€…å¤„çš„å‡†å¤‡å·¥ä½œï¼Œéƒ½ç”±Callè¿›è¡Œç¿»è¯‘ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081@Override public void buildMips() { MipsBuilder.buildComment(this.toString(), getParent()); MipsBlock mipsBlock = MipsFactory.irBlock2MipsBlock(getParent()); MipsFunction mipsFunction = MipsFactory.irFunction2MipsFunction(function); // å…ˆæ„å»ºå‡ºcallæŒ‡ä»¤ï¼Œåç»­è¦è®°å½•è¯¥æŒ‡ä»¤ç”¨åˆ°çš„Aå¯„å­˜å™¨ // ï¼è¿™ä¹Ÿæ˜¯å”¯ä¸€ä¸€æ¬¡ä½¿ç”¨é‡ç”Ÿæœªå°è£…çš„new MipsInstruction MipsInstruction call; // å†…å»ºå‡½æ•°ï¼Œéœ€è¦å®è°ƒç”¨ if (function.isLibFunc()) { call = new MipsMacro(mipsFunction.getName()); // ç³»ç»Ÿè°ƒç”¨å¿…ç„¶æ”¹å˜ v0, v0åŠ å…¥def call.addDefReg(MipsRealReg.V0); // TODO: addDefReg åŒå‚æ•°ä¿®æ”¹ä¸ºå•å‚æ•° } // éå†…å»ºå‡½æ•°ï¼Œç›´æ¥æ„å»ºjalæŒ‡ä»¤å³å¯ else { call = new MipsCall(mipsFunction); } // è¿›è¡Œä¼ å‚, éå†æ‰€æœ‰irValueå‚æ•° int argc = getArgs().size(); for (int i = 0; i &lt; argc; i++) { Value irArg = getArgs().get(i); MipsOperand src; // å‰å››ä¸ªå‚æ•°å­˜å‚¨åœ¨a0-3å†… if (i &lt; 4) { src = MipsBuilder.buildOperand(irArg, true, MipsFactory.curIrFunction, getParent()); MipsMove move = MipsBuilder.buildMove(new MipsRealReg(&quot;a&quot; + i), src, getParent()); // åŠ å…¥useï¼Œä¿æŠ¤å¯„å­˜å™¨åˆ†é…æ—¶ä¸æ¶ˆé™¤move call.addUseReg(move.getDst()); } // åé¢çš„å‚æ•°å…ˆå­˜è¿›å¯„å­˜å™¨é‡Œï¼Œå†storeè¿›å†…å­˜ else { boolean isByte = irArg.getType() instanceof CharType; // è¦æ±‚å­˜å…¥å¯„å­˜å™¨ src = MipsBuilder.buildOperand(irArg, false, MipsFactory.curIrFunction, getParent()); // å­˜å…¥ SP - 4 * nowNum å¤„ MipsImm offsetOperand = new MipsImm(-(argc - i) * 4); MipsBuilder.buildStore(src, MipsRealReg.SP, offsetOperand, getParent(), isByte); } } // æ ˆçš„ç”Ÿé•¿ if (argc &gt; 4) { // å‘ä¸‹ç”Ÿé•¿4 * allNum: SP = SP - 4 * allNum MipsOperand offsetOperand = MipsBuilder.buildImmOperand(4 * (argc - 4), true, MipsFactory.curIrFunction, getParent()); MipsBuilder.buildBinary(MipsBinary.BinaryType.SUBU, MipsRealReg.SP, MipsRealReg.SP, offsetOperand, getParent()); } // å‚æ•°å‡†å¤‡å¦¥å½“åï¼Œå†æ‰§è¡ŒjalæŒ‡ä»¤ mipsBlock.addInstruction(call); // è¿™æ¡è¯­å¥æ‰§è¡Œå®Œæˆçš„åœºåˆï¼Œæ°æ˜¯ä»å‡½æ•°ä¸­è¿”å› // æ ˆçš„æ¢å¤ ä¸ç”Ÿé•¿ç›¸åï¼ŒåšåŠ æ³•å³å¯ if (argc &gt; 4) { MipsOperand offsetOperand = MipsBuilder.buildImmOperand(4 * (argc - 4), true, MipsFactory.curIrFunction, getParent()); MipsBuilder.buildBinary(MipsBinary.BinaryType.ADDU, MipsRealReg.SP, MipsRealReg.SP, offsetOperand, getParent()); } // å› ä¸ºå¯„å­˜å™¨åˆ†é…æ˜¯ä»¥å‡½æ•°ä¸ºå•ä½çš„ï¼Œæ‰€ä»¥ç›¸å½“äº call æŒ‡ä»¤åªéœ€è¦è€ƒè™‘åœ¨è°ƒç”¨è€…å‡½æ•°ä¸­çš„å½±å“ // é‚£ä¹ˆ call å¯¹åº”çš„ bl æŒ‡ä»¤ä¼šä¿®æ”¹ lr å’Œ r0 (å¦‚æœæœ‰è¿”å›å€¼çš„è¯) // æ­¤å¤–ï¼Œr0 - r3 æ˜¯è°ƒç”¨è€…ä¿å­˜çš„å¯„å­˜å™¨ï¼Œè¿™ä¼šå¯¼è‡´å¯èƒ½éœ€è¦é¢å¤–çš„æ“ä½œ mov ï¼Œæ‰€ä»¥è¿™è¾¹è€ƒè™‘å…¨éƒ¨å¼„æˆè¢«è°ƒç”¨è€…ä¿å­˜ for (int i = 0; i &lt; 4; i++) { call.addDefReg(new MipsRealReg(&quot;a&quot; + i)); } // éå†…å»ºå‡½æ•°éœ€è¦ä¿å­˜è¿”å›åœ°å€ ra if (!function.isLibFunc()) { call.addDefReg(MipsRealReg.RA); } // å¤„ç†è¿”å›å€¼ // è°ƒç”¨è€…åº”å½“ä¿å­˜ v0ï¼Œæ— è®ºæœ‰æ²¡æœ‰è¿”å›å€¼ ValueType returnType = function.getReturnType(); call.addDefReg(MipsRealReg.V0); // å¸¦æœ‰è¿”å›å€¼ï¼Œåˆ™éœ€è¦è®°å½•è¯¥è¿”å›å€¼ if (!(returnType instanceof VoidType)) { MipsOperand dst = MipsBuilder.buildOperand(this, false, MipsFactory.curIrFunction, getParent()); MipsBuilder.buildMove(dst, MipsRealReg.V0, getParent()); } } MipsFunctionï¼šä¿å­˜ç°åœºMipsFunctionæ˜¯Mipså‡½æ•°å¯¹è±¡ã€‚ åœ¨ä¸Callçš„å…³ç³»ä¸­ï¼ŒMipsFunctionæ˜¯è¢«è°ƒç”¨çš„ä¸€æ–¹ï¼Œç”±MipsFunctionè´Ÿè´£ä¿å­˜ç°åœºã€‚ å¦‚ä¸‹æ–¹æ³•èƒ½å¤Ÿè®°å½•åœ¨æœ¬å‡½æ•°å†…æœ‰æ”¹åŠ¨ï¼ˆdefï¼‰çš„å¯„å­˜å™¨ï¼ŒåŒæ—¶è®¡ç®—æ ˆå¸§å¤§å°ã€‚è¿™äº›å¯„å­˜å™¨åœ¨è¿”å›è°ƒç”¨è€…åå¯èƒ½æœ‰æ”¹å˜ï¼Œéœ€è¦ä¿å­˜åœ¨æ ˆå¸§å†…ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738/** * æ ˆä¸Šçš„ç©ºé—´ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡ä¸ºï¼š * 1.è°ƒç”¨è€…ä¿å­˜çš„å¯„å­˜å™¨ * 2.å…¶ä»–alloca * 3.å‚æ•°alloca */ public void rebuildStack() { // éå†ä¸‹å±æ‰€æœ‰è¯­å¥ï¼Œè®°å½•æ‰€æœ‰ç”¨è¿‡çš„å¯„å­˜å™¨ï¼Œä½œä¸ºå‡½æ•°è°ƒç”¨å‰è¦ä¿å­˜çš„ç°åœº for (MipsBlock block : blocks) { for (MipsInstruction instruction : block.getInstructions()) { // ä¿å­˜å†™è¿‡çš„å¯„å­˜å™¨(çš„ç±»å‹) for (MipsOperand defReg : instruction.getDefRegs()) { if (defReg instanceof MipsRealReg) { RegType regType = ((MipsRealReg) defReg).getType(); if (RegType.regsNeedProtection.contains(regType)) { regsNeedSaving.add(regType); } } else { System.out.println(&quot;[MipsFunction] defRegä¸­æ··å…¥äº†éç‰©ç†å¯„å­˜å™¨ï¼&quot;); } } } } // éœ€è¦åˆ†é…çš„ç”¨äºä¿å­˜ç°åœºçš„ç©ºé—´ int stackRegSize = 4 * regsNeedSaving.size(); System.out.println(stackRegSize); for (RegType regType : regsNeedSaving) { System.out.println(regType); } // æ€»çš„ç©ºé—´å¤§å°ï¼šallocaç©ºé—´ + ä¿å­˜ç°åœºçš„ç©ºé—´ totalStackSize = stackRegSize + allocaSize; // æ›´æ–°å…ˆå‰è®°å½•çš„ ä¿å­˜åœ¨æ ˆä¸Šçš„å‚æ•° çš„ä½ç§» for (MipsImm argOffset : argOffsets) { int newOffset = argOffset.getValue() + totalStackSize; argOffset.setValue(newOffset); }// System.out.println(&quot;é‡å»ºå‡½æ•°æ ˆ&quot; + getName() + &quot;, stackRegSize:&quot; + stackRegSize + &quot;, allocaSize:&quot; + allocaSize); } ä¿å­˜ç°åœºçš„å…·ä½“ä»£ç åˆ™ç›´æ¥æ”¾åœ¨äº† MipsFunctionçš„æ‰“å°å¤„ï¼Œå®é™…ä¸Šæ²¡æœ‰åŠ å…¥æŒ‡ä»¤åºåˆ—ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839/** * éœ€è¦è¾“å‡ºï¼š * å‡½æ•° label * ä¿å­˜è¢«è°ƒç”¨è€…å¯„å­˜å™¨ * ç§»åŠ¨æ ˆæŒ‡é’ˆ sp * åŸºæœ¬å—çš„mipsä»£ç  */ @Override public String toString() { if (isLibFunc) { return &quot;&quot;; } StringBuilder sb = new StringBuilder(); sb.append(name).append(&quot;:\\n&quot;); // éä¸»å‡½æ•°éœ€è¦ä¿å­˜å¯„å­˜å™¨ if (!name.equals(&quot;main&quot;)) { // ä¿å­˜ç°åœº int stackOffset = -4; for (RegType regType : regsNeedSaving) { // ä¿å­˜ä½ç½®ï¼š-stackOffset($SP) sb.append(&quot;\\t&quot;).append(&quot;sw\\t&quot;).append(regType).append(&quot;,\\t&quot;) .append(stackOffset).append(&quot;($sp)\\n&quot;); // ç»§ç»­å‘ä¸‹ç”Ÿé•¿ stackOffset -= 4; } } // $SP = $SP - totalStackSize if (totalStackSize != 0) { sb.append(&quot;\\taddiu\\t$sp,\\t$sp,\\t&quot;).append(-totalStackSize).append(&quot;\\n&quot;); }// System.out.println(blocks); // ç”ŸæˆåŸºæœ¬å—çš„mips for (MipsBlock block : blocks) { sb.append(block); } return sb.toString(); } MipsRetï¼šæ¢å¤ç°åœºMipsRetæ˜¯Mipsçš„è¿”å›æŒ‡ä»¤å¯¹è±¡ï¼Œç”±llvmçš„RetæŒ‡ä»¤ç›´æ¥ç¿»è¯‘è€Œæ¥ã€‚ Retå¯¹è±¡ä¼šè®°å½•å…¶æ‰€å±çš„MipsFunctionï¼Œä»¥æ–¹ä¾¿åœ°å–ç”¨å¯„å­˜å™¨çš„ä¿å­˜ä¿¡æ¯ã€‚ åŒæ ·åœ°ï¼Œæ¢å¤ç°åœºçš„å…·ä½“ä»£ç åˆ™ç›´æ¥æ”¾åœ¨äº† MipsRetçš„æ‰“å°å¤„ï¼Œå®é™…ä¸Šæ²¡æœ‰åŠ å…¥æŒ‡ä»¤åºåˆ—ã€‚ 123456789101112131415161718192021222324252627@Override public String toString() { StringBuilder sb = new StringBuilder(); int stackSize = function.getTotalStackSize(); // è¿”å›å‰å°†SPå¤ä½ if (stackSize != 0) { sb.append(&quot;addiu\\t$sp, \\t$sp,\\t&quot;).append(stackSize).append(&quot;\\n&quot;); } // ä¸»å‡½æ•°ç›´æ¥ç»“æŸè¿è¡Œ if (function.getName().equals(&quot;main&quot;)) { sb.append(&quot;\\tli\\t$v0,\\t10\\n&quot;); sb.append(&quot;\\tsyscall\\n\\n&quot;); } // éä¸»å‡½æ•°ï¼Œéœ€è¦æ¢å¤ç°åœº else { // åœ¨è¿”å›ä¹‹å‰å›å¤å¯„å­˜å™¨å¯„å­˜å™¨ int stackOffset = -4; for (RegType regType : function.getRegsNeedSaving()) { sb.append(&quot;\\t&quot;).append(&quot;lw\\t&quot;).append(regType).append(&quot;,\\t&quot;).append(stackOffset).append(&quot;($sp)\\n&quot;); stackOffset -= 4; } // è·³è½¬è¿”å› sb.append(&quot;\\tjr\\t$ra\\n&quot;); } return sb.toString(); } ä»£ç ä¼˜åŒ–æ€»è®ºä¼˜åŒ–åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯åˆ†æå‹ä¼˜åŒ–ï¼Œè¿™ç§ç±»å‹çš„ä¼˜åŒ–å¹¶ä¸ä¼šæ”¹å˜ llvm ir çš„ç»“æ„ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šæœ‰å®é™…çš„ä¼˜åŒ–æ•ˆæœï¼Œä½†æ˜¯å®ƒä»¬åˆ†æå‡ºæ¥çš„ä¿¡æ¯ï¼Œä¼šå»æŒ‡å¯¼åŠ å·¥å‹ä¼˜åŒ–çš„è¿›è¡Œã€‚å¦ä¸€ç§æ˜¯åŠ å·¥å‹ä¼˜åŒ–ï¼Œè¿™ç§ä¼˜åŒ–ä¼šçœŸæ­£æ”¹å˜ llvm ir &amp; mips çš„ç»“æ„ï¼Œè¾¾åˆ°ä¼˜åŒ–çš„ç›®çš„ã€‚ æ§åˆ¶æµå›¾æ„å»ºåœ¨æ„å»ºæ§åˆ¶æµå›¾ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè¿›è¡Œç®€å•çš„æ­»ä»£ç åˆ é™¤ï¼š è¯¥éƒ¨åˆ†ä¼šåˆ é™¤æ‰€æœ‰ retæŒ‡ä»¤åçš„ä»£ç ã€‚ è¿™å…¶å®æ˜¯ä¸ºäº†è§£å†³åœ¨debugæ—¶å‘ç°çš„ä¸€ä¸ªä¸¥é‡é”™è¯¯ï¼šä¸ºäº†ç¡®ä¿åœ¨æ„å»ºæ§åˆ¶æµå›¾æ—¶ï¼Œä¸ä¼šäº§ç”Ÿå¥‡æ€ªçš„åç»§ï¼Œä»è€Œå¯¼è‡´æ§åˆ¶æµå›¾æ„å»ºé”™è¯¯ã€phiæŒ‡ä»¤æŠ¥é”™ã€‚ åœ¨é‡åˆ° retæŒ‡ä»¤åï¼Œåˆ é™¤æ‰€æœ‰æŒ‡ä»¤å³å¯ã€‚ 123456789101112public static void deadCodeEmit(BasicBlock block) { LinkedList&lt;Instruction&gt; instructions = new LinkedList&lt;&gt;(block.getInstructions()); boolean flag = false; for (Instruction instruction : instructions) { if (flag) { instruction.dropAllOperands(); instruction.eraseFromParent(); } else if (instruction instanceof Ret || instruction instanceof Br) { flag = true; } } } æ”¯é…åˆ†æ [!IMPORTANT] åœ¨è¿›è¡Œå¾ˆå¤šåˆ†æä¹‹å‰ï¼Œéƒ½éœ€è¦è¿›è¡Œæ”¯é…åˆ†æï¼Œè¿™æ˜¯å› ä¸ºæ”¯é…æ ‘ä¼šæä¾›å¾ˆå¤šçš„æ”¯é…æµä¿¡æ¯ï¼Œå°¤å…¶æ˜¯æ•°æ®æ˜¯æ€æ ·åœ¨æ•°æ®å—ä¸­æµåŠ¨ï¼Œå“ªäº›æ•°æ®å¿…ç„¶ä»è¿™ä¸ªå—æµå…¥å¦ä¸€ä¸ªå—ï¼Œå¯ä»¥è¯´ï¼Œæ”¯é…ä¿¡æ¯æ˜¯å¯¹äº CFG å›¾çš„ä¸€ç§é«˜åº¦å‡ç»ƒçš„è¡¨è¾¾ã€‚ åœ¨æ±‚è§£æ”¯é…æ ‘çš„æ—¶å€™ï¼Œåˆ†ä¸ºä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥é¦–å…ˆæ”¯é…è€…å’Œè¢«æ”¯é…è€…ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸åŠ¨ç‚¹é—®é¢˜ï¼Œåˆ©ç”¨çš„å…¬å¼æ˜¯ $$temp = {index} \\cup (\\bigcap_{j \\in preds(index)} domer(j) )$$ [!IMPORTANT] éœ€è¦ä¸€ç›´æ±‚è§£åˆ°ä¸å‘ç”Ÿå˜åŒ–ä¸ºæ­¢ã€‚ ç¬¬äºŒæ­¥æ˜¯è®¡ç®—æ”¯é…è¾¹ç•Œï¼Œæ„é€ æ”¯é…æ ‘ï¼Œæ”¯é…æ ‘æ˜¯æ¯”åŸæ¥çš„æ”¯é…å›¾æ›´åŠ ç›´è§‚è€Œä¸”â€œå¼ºâ€çš„æ¡ä»¶ï¼Œæˆ‘ä»¬åœ¨ä¼˜åŒ–ä¸­ä¸€èˆ¬ä¹Ÿæ˜¯ä½¿ç”¨æ”¯é…æ ‘çš„ä¿¡æ¯æ¡ä»¶ã€‚æ‰€è°“æ”¯é…è¾¹ç•Œï¼Œå°±æ˜¯æ°å¥½ä¸è¢«æ”¯é…çš„ä¸€ä¸ªå—ã€‚ éœ€è¦å¼ºè°ƒï¼Œæ”¯é…æ ‘ä¸ä»…åº”ç”¨åœ¨ç¼–è¯‘é¢†åŸŸï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„å›¾è®ºç®—æ³•ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ç½‘ä¸Šæ‰¾åˆ°è¯¦å®çš„èµ„æ–™ï¼Œæ‰€ä»¥å¯¹äºç®—æ³•é—®é¢˜å°±ä¸èµ˜è¿°ã€‚ æ”¯é…åˆ†æåŸºäº CFGå›¾ä¼šè¢«ç”¨åœ¨ LoopInfoAnalyzeï¼Œ mem2regï¼Œæ‰€ä»¥åªè¦ CFG å‘ç”Ÿæ”¹å˜ï¼Œå°±ä¼šéœ€è¦é‡æ–°åˆ†æã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495/** * è®¡ç®—æ”¯é…ä¿¡æ¯ * * @param function å¾…åˆ†æçš„å‡½æ•° */ public static void passDominanceInfo(Function function) { // å…¥å£å— BasicBlock entryBlock = function.getHeadBlock(); // åŸºæœ¬å—çš„æ•°ç›® int blockNum = function.getBasicBlocks().size(); // æ¯ä¸ªåŸºæœ¬å—éƒ½æœ‰ä¸€ä¸ª bitSetï¼Œç”¨äºè¡¨ç¤ºè¿™ä¸ªå—çš„ domer ArrayList&lt;BitSet&gt; domers = new ArrayList&lt;&gt;(blockNum); ArrayList&lt;BasicBlock&gt; blocks = function.getBasicBlocks(); // ä½œä¸º block çš„ç´¢å¼• int index = 0; for (BasicBlock block : blocks) { domers.add(new BitSet()); // å…¥å£å—çš„æ”¯é…è€…æ˜¯è‡ªå·± if (block == entryBlock) { domers.get(index).set(index); } else { domers.get(index).set(0, blockNum); } index++; } // ä¸åŠ¨ç‚¹ç®—æ³• è®¡ç®—domer boolean changed = true; while (changed) { changed = false; index = 0; // éå†åŸºæœ¬å— for (BasicBlock curBlock : blocks) { // å¯¹äºéå…¥å£å— if (curBlock != entryBlock) { // temp åˆå§‹å…¨ç½®1 BitSet temp = new BitSet(); temp.set(0, blockNum); // å°±æ˜¯ä¸‹é¢çš„å…¬å¼ // temp &lt;- {index} \\cup (\\BigCap_{j \\in preds(index)} domer(j) ) for (BasicBlock preBlock : curBlock.getPreBlocks()) { int preIndex = blocks.indexOf(preBlock); temp.and(domers.get(preIndex)); } // è‡ªå·±ä¹Ÿæ˜¯è‡ªå·±çš„domer temp.set(index); // è‹¥tempæ›´æ–°ï¼Œåˆ™temp èµ‹ç»™domer if (!temp.equals(domers.get(index))) { domers.get(index).clear(); domers.get(index).or(temp); changed = true; } } index++; } } // å°†domerä¿¡æ¯å­˜å…¥æ‰€æœ‰åŸºæœ¬å— for (int i = 0; i &lt; blockNum; i++) { BasicBlock curBlock = blocks.get(i); BitSet domerInfo = domers.get(i); // éå†bitsetï¼Œæ‰¾åˆ°å¹¶è®°å½•æ¯ä¸€ä¸ªæ”¯é…è€… for (int domerIndex = domerInfo.nextSetBit(0); domerIndex &gt;= 0; domerIndex = domerInfo.nextSetBit(domerIndex + 1)) { BasicBlock domerBlock = blocks.get(domerIndex); curBlock.getDomers().add(domerBlock); } } // è®¡ç®—æ‰€æœ‰åŸºæœ¬å—çš„ï¼šç›´æ¥æ”¯é…è€… ç›´æ¥è¢«æ”¯é…è€… for (BasicBlock curBlock : blocks) { // éå†å½“å‰å—çš„æ”¯é…è€… for (BasicBlock maybeIdomerBlock : curBlock.getDomers()) { // æ’é™¤è‡ªèº« if (maybeIdomerBlock != curBlock) { boolean isIdom = true; for (BasicBlock domerBlock : curBlock.getDomers()) { // maybeIdomerBlockæ”¯é…äº†domerBlockï¼ŒdomerBlockæ”¯é…curBlockï¼Œè¡¨æ˜å¹¶ä¸æ˜¯ç›´æ¥çš„æ”¯é…è€… if (domerBlock != curBlock &amp;&amp; domerBlock != maybeIdomerBlock &amp;&amp; domerBlock.getDomers().contains(maybeIdomerBlock)) { isIdom = false; break; } } // æ˜¯ç›´æ¥æ”¯é…å—ï¼Œåˆ™åŒæ–¹éƒ½è¦äº’ç›¸ç™»è®° if (isIdom) { curBlock.setIdomer(maybeIdomerBlock); maybeIdomerBlock.getIdomees().add(curBlock); break; } } } } // calculate dom level passDominanceLevel(entryBlock, 0); } å‡½æ•°è°ƒç”¨åˆ†æ [!IMPORTANT] å¦‚æœåœ¨è°ƒç”¨è€…å’Œè¢«è°ƒç”¨è€…ä¹‹é—´æ„å»ºä¸€æ¡æœ‰å‘è¾¹ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ„å»ºä¸€ä¸ªå‡½æ•°è°ƒç”¨å›¾ï¼Œå‡½æ•°è°ƒç”¨å…³ç³»ä¸»è¦æ˜¯ä¸ºäº†åé¢çš„å‰¯ä½œç”¨åˆ†æï¼Œæ— ç”¨å‡½æ•°åˆ é™¤åšå‡†å¤‡ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¸€èˆ¬ä¸ä¼šå•ç‹¬ä½œä¸ºä¸€ä¸ª pass ï¼Œè¿™æ˜¯å› ä¸ºè¿™ä¸ªç”¨çš„å¾ˆå¤šï¼ŒåŸºæœ¬ä¸Šæ˜¯éšç”¨éšåšã€‚ å› ä¸º SysYå¹¶ä¸æ”¯æŒå‡½æ•°å£°æ˜ï¼Œæ‰€ä»¥å…¶å®ä¸ä¼šå‡ºç°å¾ªç¯é€’å½’æˆ–è€…å…¶ä»–çš„é˜´é—´æƒ…å†µï¼Œè¿™æ— ç–‘å¯¹åé¢æ˜¯ä¸€ä¸ªå¥½æ¶ˆæ¯ã€‚ å‰¯ä½œç”¨åˆ†æ [!IMPORTANT] æ‰€è°“çš„å‰¯ä½œç”¨ï¼ˆSideEffectï¼‰ï¼Œå…¶å®æ²¡æœ‰ä¸€ä¸ªæ˜ç¡®çš„æ¦‚å¿µï¼Œå¤§æ¦‚å°±æ˜¯æˆ‘ä»¬ä¸å–œæ¬¢çš„ä½œç”¨ï¼Œå°±ä¼šè¢«å«åšå‰¯ä½œç”¨ã€‚åœ¨ä¸­ç«¯çš„å‰¯ä½œç”¨ï¼ŒæŒ‡çš„æ˜¯æŸä¸ªæŒ‡ä»¤æˆ–è€…å‡½æ•°ï¼Œä¼šä¸ä¼šå¯¹å†…å­˜æˆ–è€… IO é€ æˆå½±å“ï¼Œå¦‚æœä¸ä¼šï¼Œé‚£ä¹ˆå°±æ˜¯æ²¡æœ‰å‰¯ä½œç”¨çš„ã€‚ æ²¡æœ‰å‰¯ä½œç”¨çš„ä¸œè¥¿å¾ˆè‰¯å¥½ï¼Œå› ä¸ºä»–ä»¬é€ æˆçš„å”¯ä¸€å½±å“åªèƒ½é€šè¿‡è¿”å›å€¼ï¼Œæ‰€ä»¥å¦‚æœè¿”å›å€¼æ²¡æœ‰ç”¨åˆ°ï¼Œé‚£ä¹ˆè¿™ä¸ªä¸œè¥¿å°±å¯ä»¥å»æ‰äº†ã€‚ä¸ä»…ä»…æ˜¯å»æ‰è¿™ä¹ˆæš´åŠ›ï¼Œå¦‚æœæ²¡æœ‰å‰¯ä½œç”¨ï¼Œç›¸å½“äºæœ‰äº†ä¸€ä¸ªå¾ˆâ€œå¼ºâ€çš„æ¡ä»¶ä¿è¯ï¼Œæˆ‘ä»¬å¯¹äºæŸäº›ä¼˜åŒ–çš„è¿›è¡Œä¼šå˜å¾—æ›´åŠ è‡ªä¿¡ï¼Œæ¯”å¦‚è¯´ä¸€ä¸ªå‡½æ•°å¦‚æœæ²¡æœ‰å‰¯ä½œç”¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥æŠŠä»–å½“æˆä¸€æ¡æŒ‡ä»¤å¤„ç†ï¼Œå¯¹äº 12%i1 = call i32 f(%a1);%i2 = call i32 f(%a1); [!IMPORTANT] æˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ¤æ–­ i1 == i2 æ˜¯å¾ˆå¥½çš„ä¸œè¥¿ã€‚ è¿›è¡Œå‰¯ä½œç”¨åˆ†æçš„æ—¶å€™ï¼Œéœ€è¦å…ˆæ„å»ºä¸€ä¸ªå‡½æ•°è°ƒç”¨å…³ç³»å›¾ï¼Œè¿™æ˜¯å› ä¸ºæœ‰çš„å‡½æ•°æœ¬èº«å¹¶ä¸ä¼šé€ æˆå‰¯ä½œç”¨ï¼Œä½†æ˜¯ä»–è°ƒç”¨çš„å‡½æ•°å°±ä¼šæœ‰å‰¯ä½œç”¨ï¼Œå¯¼è‡´è°ƒç”¨è¿™ä¸ªå‡½æ•°ä¹Ÿä¼šæœ‰å‰¯ä½œç”¨ã€‚ æˆ‘ä»¬ä¸€èˆ¬è®¤ä¸ºè¿™å‡ ä¸ªä¸œè¥¿æœ‰å‰¯ä½œç”¨ store æŒ‡ä»¤ call å†…è”å‡½æ•° call æœ‰å‰¯ä½œç”¨çš„å‡½æ•° å‰¯ä½œç”¨åˆ†æä¼šè¢«ç”¨åœ¨ AggressiveDeadCodeEmit ä¸­ã€‚ Mem2Regåœ¨ LLVMç”Ÿæˆéƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†SSAçš„ä¸¤ç§å½¢å¼ï¼šèµ°è®¿å­˜åé—¨çš„SSAï¼Œå’ŒçœŸæ­£èƒ½æé«˜æ•ˆç‡çš„é‡‡å– phiçš„çœŸSSA ã€‚ åœ¨è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†è¿›è¡Œå¦‚ä¸‹ä¸¤é¡¹å·¥ä½œä»¥é‡æ„llvmä»£ç ï¼š åé—¨SSAä¸­ï¼Œç¹å¤ alloca,store,loadä¸‰ä»¶å¥—çš„å½»åº•é“²é™¤ä¼˜åŒ–ã€‚ phiæŒ‡ä»¤çš„æ’å…¥ä¸å˜é‡çš„é‡å‘½åã€‚ [!IMPORTANT] ä¸€ä¸ªåŸºæœ¬å—çš„å¼€å§‹éœ€è¦æ’å…¥ä¸€ä¸ªå˜é‡çš„ phi èŠ‚ç‚¹çš„æ¡ä»¶ï¼Œæ˜¯è¿™ä¸ªåŸºæœ¬å—æ˜¯è¿™ä¸ªå˜é‡æŸä¸ªå®šä¹‰çš„æ”¯é…è¾¹ç•Œã€‚è¿™ä¸ªæ“ä½œéœ€è¦è¿­ä»£ï¼Œäº‹å®ä¸Šå°±åªéœ€è¦å»ºç«‹ä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ¯æ¬¡å–å‡ºé˜Ÿé¦–ï¼Œè®¡ç®—å…¶æ”¯é…è¾¹ç•Œï¼Œå¹¶æŠŠæ–°ç®—å‡ºçš„æ”¯é…è¾¹ç•Œæ’å…¥åˆ°é˜Ÿåˆ—çš„æœ«å°¾ã€‚ æ³¨æ„ï¼Œè¿™æ—¶çš„ phi èŠ‚ç‚¹è¿˜æ˜¯ç©ºçš„ï¼Œå³åªæœ‰å·¦å€¼æ²¡æœ‰å³å€¼ã€‚ ç®€å•çš„è¿ç®—å¼ºåº¦å‰Šå¼±å³å¯¹äº a * 0, 0 / a, a % 1, a / aè¿™ä¸€ç±»æŒ‡ä»¤æå‰å®Œæˆä¼˜åŒ–ï¼Œé¿å…ç¹å¤è®¡ç®— Aggressive Dead Code Emit [!IMPORTANT] åœ¨è¿™ä¸€æ­¥ä¸­æˆ‘ä»¬è®¤ä¸ºçš„æ­»ä»£ç ï¼Œå°±æ˜¯ä¸ä¼šå¯¹ç¨‹åºé€ æˆå½±å“çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸â€œå‰¯ä½œç”¨åˆ†æâ€ç±»ä¼¼çš„çœ¼å…‰å»çœ‹ï¼Œæ‰€æœ‰çš„è®¿å­˜æŒ‡ä»¤ï¼Œreturn æŒ‡ä»¤ï¼Œcall ä¸€ä¸ªæœ‰å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œåˆ†æ”¯æŒ‡ä»¤ï¼Œè¿™äº›ä¸œè¥¿éƒ½æ˜¯æœ‰ç”¨çš„ï¼Œæˆ‘ä»¬ä¸èƒ½åˆ é™¤ï¼Œé‚£ä¹ˆè¿™äº›æŒ‡ä»¤ä½¿ç”¨åˆ°çš„æŒ‡ä»¤ï¼ŒåŒæ ·ä¹Ÿæ˜¯ä¸èƒ½åˆ é™¤çš„ï¼Œä»¥æ­¤ç±»æ¨ï¼Œè¿™æ ·æ±‚å‡ºä¸€ä¸ªæœ‰ç”¨æŒ‡ä»¤çš„é—­åŒ…ï¼Œæ‰€æœ‰ä¸åœ¨è¿™ä¸ªæŒ‡ä»¤é—­åŒ…å†…çš„æŒ‡ä»¤ï¼Œéƒ½æ˜¯æ­»ä»£ç ï¼Œæ˜¯å¯ä»¥åˆ é™¤çš„ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142/** * DFSæ±‚è§£é—­åŒ… */ private void findUsefulClosure(Instruction instruction) { if (!usefulInstrClosure.contains(instruction)) { // è®°å½•æ‰€æœ‰ç”¨åˆ°çš„æŒ‡ä»¤ usefulInstrClosure.add(instruction); for (Value operand : instruction.getOperands()) { if (operand instanceof Instruction) { findUsefulClosure((Instruction) operand); } } } } private void deleteDeadInstructions(Function curFunction) { usefulInstrClosure.clear(); for (BasicBlock basicBlock : curFunction.getBasicBlocks()) { for (Instruction instruction : basicBlock.getInstructions()) { if (isUseful(instruction)) { findUsefulClosure(instruction); } } } // åˆ é™¤ä¸åœ¨é—­åŒ…å†…çš„æŒ‡ä»¤ for (BasicBlock basicBlock : curFunction.getBasicBlocks()) { LinkedList&lt;Instruction&gt; newInstructions = new LinkedList&lt;&gt;(); for (Instruction instruction : basicBlock.getInstructions()) { boolean delete = false; if (!usefulInstrClosure.contains(instruction)) { instruction.dropAllOperands(); delete = true; //instruction.eraseFromParent(); } if (!delete) { newInstructions.add(instruction); } } basicBlock.setInstructions(newInstructions); } } å…¨å±€å˜é‡å±€éƒ¨åŒ– [!IMPORTANT] å› ä¸ºå…¨å±€å˜é‡çš„è®¿é—®éœ€è¦åœ¨ llvm ä¸­è®¿å­˜ï¼Œæ¯”è¾ƒä½æ•ˆï¼Œæ‰€ä»¥è€ƒè™‘å¯¹äºåªè¢«ä¸€ä¸ªå‡½æ•°ä½¿ç”¨äº†çš„å…¨å±€å˜é‡ï¼ˆè¿™å°±æ²¡æœ‰æ„ä¹‰æ˜¯å…¨å±€çš„äº†ï¼‰ï¼Œå°†å…¶ç§»å…¥æˆå±€éƒ¨å˜é‡ã€‚ ä¹˜é™¤æ³•ä¼˜åŒ–å¯¹äºå¤„ç†å™¨æ¥è¯´ï¼Œæ‰§è¡Œä¹˜é™¤æ³•çš„ä»£ä»·è¦è¿œå¤§äºæ‰§è¡Œå…¶ä»–æŒ‡ä»¤ï¼Œè€Œæ‰§è¡Œé™¤æ³•çš„ä»£ä»·åˆè¿œå¤§äºä¹˜æ³•çš„ä»£ä»·ï¼Œæ‰€ä»¥æˆ‘ä»¬ç†æƒ³çš„æƒ…å†µæ˜¯é€šè¿‡ç®—æœ¯è¿ç®—å°†é™¤å¸¸æ•°è½¬åŒ–ä¸ºä¹˜æ³•å’Œç§»ä½æŒ‡ä»¤ï¼Œå°†ä¹˜å¸¸æ•°è½¬åŒ–ä¸ºç§»ä½å’Œå…¶ä»–æŒ‡ä»¤ã€‚ ä¹˜æ³•ä¼˜åŒ–ä¹˜æ³•å¯ä»¥è¢«ä¼˜åŒ–æˆåŠ æ³•å’Œç§»ä½æ“ä½œï¼Œå› ä¸ºä¹˜æ³•çš„ä»£ä»·æ˜¯ 4ï¼Œæ‰€ä»¥åŠ æ³•å’Œç§»ä½æ“ä½œæœ€å¤šæœ‰ 3 æ¡ï¼Œé‚£ä¹ˆè€ƒè™‘â€œç§»ä½-åŠ æ³•-ç§»ä½â€çš„ç»„åˆï¼Œé‚£ä¹ˆä¹Ÿå°±æ˜¯å¯ä»¥æ‹†å‡ºä¸¤æ¡ç§»ä½æŒ‡ä»¤ï¼Œé‚£ä¹ˆå¯ä»¥æšä¸¾ 32 ä½å†…ç”±ä¸Šè¿°ç»„åˆå¯ä»¥è¾¾åˆ°çš„ç»„åˆï¼Œç„¶åè®°å½•ä¸‹æ¥ã€‚åœ¨ä¹˜æ³•è¿ç®—çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‰ç…§äº‹å…ˆå‡†å¤‡çš„è¿›è¡Œæ“ä½œã€‚ é™¤æ³•ä¼˜åŒ–å¯¹äºä»»ä½•å¤„ç†å™¨ï¼Œè¿›è¡Œé™¤æ³•è®¡ç®—æ‰€éœ€è¦çš„æ—¶é—´éƒ½è¿œè¿œé«˜äºä¹˜æ³•å’Œç§»ä½è¿ç®—ï¼ˆå½“ç„¶è¿™ä¸¤è€…ä¹Ÿä¸åœ¨ä¸€ä¸ªé‡çº§ä¸Šï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰ä¸€ç§æƒ³æ³•ï¼Œå°±æ˜¯æŠŠé™¤æ³•è½¬æ¢æˆä¹˜æ³•å’Œç§»ä½æ“ä½œï¼Œä¹Ÿå°±æ˜¯ $$\\tt{quotient = \\frac{dividend}{divisor} = (dividend \\times multiplier) &gt;&gt; shift}$$ å…·ä½“å®ç°åˆ™å‚è€ƒäº†æ•™ç¨‹æ‰€ç»™è®ºæ–‡ï¼šDivision by Invariant Integers using Multiplicationã€‚ å›¾ç€è‰²å¯„å­˜å™¨åˆ†é…é¦–å…ˆä»¥å‡½æ•°ä¸ºå•ä½ï¼Œå¯¹å…¶æ‰€æœ‰åŸºæœ¬å—è¿›è¡Œæ´»è·ƒå˜é‡åˆ†æã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667/** * å¯¹ä¸€ä¸ªå‡½æ•°ä»¥å—ä¸ºå•ä½è¿›è¡Œæ´»è·ƒå˜é‡åˆ†æ * * @return ä¸€ä¸ªæ¯ä¸ª block éƒ½å¯¹åº”çš„ä¸€ä¸ª info çš„ map */ public static HashMap&lt;MipsBlock, BlockLiveVarInfo&gt; liveAnalysis(MipsFunction func) { HashMap&lt;MipsBlock, BlockLiveVarInfo&gt; liveInfoMap = new HashMap&lt;&gt;(); // å¼€å§‹éå†æ¯ä¸€ä¸ª block for (MipsBlock block : func.getMipsBlocks()) { BlockLiveVarInfo blockLiveInfo = new BlockLiveVarInfo(); liveInfoMap.put(block, blockLiveInfo); // å¼€å§‹éå† block ä¸­çš„æŒ‡ä»¤, è·Ÿå®šä¹‰ä¸­çš„ä¸€æ¨¡ä¸€æ · for (MipsInstruction instruction : block.getInstructions()) { // è¿˜æ²¡å®šä¹‰å°±è¢«ä½¿ç”¨ï¼Œè¿™é‡Œæ˜¯æ­£ç¡®çš„ instruction.getUseRegs().stream() .filter(MipsOperand::needsColor) .filter(use -&gt; !blockLiveInfo.liveDef.contains(use)) .forEach(blockLiveInfo.liveUse::add); // è¿˜æ²¡ä½¿ç”¨å°±è¢«å®šä¹‰ï¼Œè¿™é‡Œåº”è¯¥æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºå®šä¹‰å°±æ˜¯å®šä¹‰ï¼Œå°±æ˜¯æ€æ­»ï¼Œä¸ä¼šå› ä¸ºä½¿ç”¨è€Œä¸æ€æ­» instruction.getDefRegs().stream() .filter(MipsOperand::needsColor) .forEach(blockLiveInfo.liveDef::add); } // è¿™é‡Œåº”è¯¥æ˜¯æ²¡æœ‰é—®é¢˜çš„ blockLiveInfo.liveIn.addAll(blockLiveInfo.liveUse); } // ä¸åŠ¨ç‚¹ boolean changed = true; while (changed) { changed = false; // å¼€å§‹éå† func ä¸­çš„ block for (MipsBlock block : func.getMipsBlocks()) { BlockLiveVarInfo blockLiveInfo = liveInfoMap.get(block); HashSet&lt;MipsOperand&gt; newLiveOut = new HashSet&lt;&gt;(); // ä¸‹é¢æ˜¯åŠ å…¥ä¸¤ä¸ªåç»§,è¿™é‡Œæ˜¯æ­£ç¡®çš„ï¼ŒLiveOut å°±æ˜¯ LiveIn çš„å¹¶é›† if (block.getTrueSucBlock() != null) { BlockLiveVarInfo sucBlockInfo = liveInfoMap.get(block.getTrueSucBlock()); newLiveOut.addAll(sucBlockInfo.liveIn); } if (block.getFalseSucBlock() != null) { BlockLiveVarInfo sucBlockInfo = liveInfoMap.get(block.getFalseSucBlock()); newLiveOut.addAll(sucBlockInfo.liveIn); } // ç¬¬ä¸€æ¬¡çš„æ—¶å€™åº”è¯¥æ˜¯æ²¡æœ‰åŠæ³• equal çš„ï¼Œè¿™æ˜¯å› ä¸ºä¹‹å‰ liveOut å¹¶æ²¡æœ‰è¢«èµ‹å€¼ if (!newLiveOut.equals(blockLiveInfo.liveOut)) { changed = true; blockLiveInfo.liveOut = newLiveOut; // è¿™é‡Œæ¨¡æ‹Ÿçš„æ˜¯ LiveUse blockLiveInfo.liveIn = new HashSet&lt;&gt;(blockLiveInfo.liveUse); // liveIn = liveUse + liveOut - liveDef blockLiveInfo.liveOut.stream() .filter(objOperand -&gt; !blockLiveInfo.liveDef.contains(objOperand)) .forEach(blockLiveInfo.liveIn::add); } } } return liveInfoMap; } åŸºäºæ´»è·ƒå˜é‡åˆ†æçš„ç»“æœï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å›¾ç€è‰²ç®—æ³•äº†ï¼š ä¸»è¦æµç¨‹å¦‚ä¸‹ï¼Œéå†æ‰€æœ‰å‡½æ•°ï¼Œå¯¹äºæ¯ä¸ªå‡½æ•°ï¼Œè¿›è¡Œæ´»è·ƒå˜é‡åˆ†æç›´è‡³ä¸å†å˜åŒ–ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960/** * è¿›è¡Œå¯„å­˜å™¨åˆ†é… * å…¥å£æ–¹æ³• */ public void buildRegs() { // éå†æ‰€æœ‰å‡½æ•° for (MipsFunction function : mipsModule.getFunctions()) { if (function.isLibFunc()) { continue; } curFunction = function; // å¯¹äºæ¯ä¸ªå‡½æ•°ï¼Œè¿›è¡Œæ´»è·ƒå˜é‡åˆ†æç›´è‡³ä¸å†å˜åŒ– boolean finished = false; while (!finished) { initStatus(); buildConflictGraph(); buildWorklist(); do { if (!simplifyList.isEmpty()) { doSimplify(); } if (!mergableMoves.isEmpty()) { coalesce(); } if (!freezeList.isEmpty()) { doFreeze(); } if (!spillList.isEmpty()) { doSelectSpill(); } } while (!(simplifyList.isEmpty() &amp;&amp; mergableMoves.isEmpty() &amp;&amp; freezeList.isEmpty() &amp;&amp; spillList.isEmpty())); assignColors(function); // å®é™…æº¢å‡ºçš„èŠ‚ç‚¹ if (spilledNodes.isEmpty()) { finished = true; } // å­˜åœ¨å®é™…æº¢å‡ºçš„ç‚¹ else { try { rewriteProgram(function); } catch (Exception e) { System.out.println(&quot;[RewriteProgramException] &quot; + e + &quot;, function: &quot; + function.getName()); } } } } // å› ä¸ºåœ¨ color çš„æ—¶å€™ï¼Œä¼šæŠŠ isAllocated è®¾ç½®æˆ trueï¼Œè¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½å°±æ˜¯è®¾ç½®æˆ false // åº”è¯¥æ˜¯ä¸ºäº†é¿å…ç‰©ç†å¯„å­˜å™¨åœ¨åˆ¤å®š equals æ—¶çš„é”™è¯¯ resetRealRegState(); for (MipsFunction function1 : mipsModule.getFunctions()) { if (function1.isLibFunc()) { continue; } function1.rebuildStack(); } } æ„é€ å†²çªå›¾(build)æœ¬é˜¶æ®µçš„ä¸»è¦ä»»åŠ¡æ˜¯é€šè¿‡æ•°æ®æµåˆ†ææ–¹æ³•ï¼Œè®¡ç®—åœ¨æ¯æ¡æŒ‡ä»¤æ‰§è¡Œæ—¶åŒæ—¶æ´»è·ƒçš„ä¸´æ—¶å˜é‡ï¼Œè¯¥é›†åˆçš„æ¯ä¸€å¯¹ä¸´æ—¶å˜é‡ä¸¤ä¸¤å½¢æˆä¸€æ¡è¾¹åŠ å…¥å†²çªå›¾ä¸­ï¼Œ æ„é€ é˜¶æ®µçš„ä¸»è¦å·¥ä½œæ˜¯è¿›è¡Œæ•°æ®æµåˆ†æï¼Œåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šåŸºæœ¬å—çš„æ•°æ®æµåˆ†æï¼ŒæŒ‡ä»¤é—´çš„æ•°æ®æµåˆ†æï¼Œå¾—åˆ°å†²çªå›¾ï¼ŒæŒ‡ä»¤å†²çªçš„æ¡ä»¶æ˜¯åœ¨å˜é‡å®šä¹‰å¤„æ‰€æœ‰å‡ºå£æ´»è·ƒçš„å˜é‡å’Œå®šä¹‰çš„å˜é‡æ˜¯äº’ç›¸å†²çªçš„ï¼Œä»¥åŠåŒä¸€æ¡æŒ‡ä»¤çš„å‡ºå£å˜é‡äº’ç›¸ä¹‹é—´æ˜¯å†²çªçš„ã€‚ ç®€åŒ–ï¼ˆsimplifyï¼‰è¿›è¡Œå¯å‘å¼å›¾ç€è‰²ï¼Œåˆ é™¤åº¦æ•°å°äºKï¼ˆé€šç”¨å¯„å­˜å™¨ä¸ªæ•°ï¼‰çš„èŠ‚ç‚¹ï¼Œç®€åŒ–å†²çªå›¾ï¼Œäº§ç”Ÿæ›´å¤šå›¾ç€è‰²æœºä¼šã€‚ å…·ä½“çš„åšæ³•æ˜¯å¯¹äºä¸€ä¸ªèŠ‚ç‚¹mï¼Œå¦‚æœå®ƒçš„åº¦æ•°å°äºKï¼Œé‚£ä¹ˆå°†å®ƒä»å†²çªå›¾å½“ä¸­åˆ é™¤ï¼Œå¹¶ä¸”å°†å…¶å‹å…¥æ ˆä¸­ï¼Œä»¥ä¾¿è¿›è¡Œåç»­çš„ç€è‰²ã€‚ è¿™æ ·è¿›è¡Œå¯å‘å¼åˆ é™¤ä¹‹åï¼Œéƒ½ä¼šå‡å°‘å…¶ä»–ç»“ç‚¹çš„åº¦æ•°ï¼Œä»è€Œäº§ç”Ÿæ›´å¤šçš„ç®€åŒ–çš„æœºä¼šï¼Œå¹¶ä¸”ä¹Ÿä¸ºä¹‹åçš„åˆå¹¶æä¾›æ›´å¤šæœºä¼šï¼Œè¿™è¦æ±‚åœ¨è¿™ä¸ªé˜¶æ®µä¸ä¼šç®€åŒ–éå†»ç»“æŒ‡ä»¤ã€‚ åˆå¹¶ï¼ˆcoalesceï¼‰è¿›è¡Œä¿å®ˆçš„åˆå¹¶ï¼Œå‡å°‘æœ€ç»ˆä»£ç çš„moveæŒ‡ä»¤ã€‚ å¯¹äºmoveæŒ‡ä»¤ï¼ˆä¾‹å¦‚ move $2, $3ï¼‰ï¼Œæºæ“ä½œæ•°å’Œç›®çš„æ“ä½œæ•°å®é™…ä¸Šç›¸åŒï¼Œè¿™ç§æƒ…å†µä¸‹å¯ä»¥å°†ä¸¤ä¸ªèŠ‚ç‚¹åˆå¹¶ï¼Œå‡å°‘ä¸€æ¡moveæŒ‡ä»¤çš„ä»£ä»·ï¼Œä½†æ˜¯ï¼Œåˆå¹¶ä¸¤ä¸ªç»“ç‚¹ä¹‹åï¼Œä¸¤ä¸ªèŠ‚ç‚¹çš„æ´»è·ƒèŒƒå›´ä¼šå¢åŠ ï¼Œå…¶é‚»æ¥ç»“ç‚¹çš„é›†åˆå®é™…ä¸Šæ˜¯åŸæ¥ä¸¤ä¸ªé›†åˆçš„å¹¶é›†ï¼Œè¿™ç§æƒ…å†µä¸‹å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›èƒ½å¤Ÿç€è‰²çš„èŠ‚ç‚¹å˜ä¸ºè¢«æº¢å‡ºçš„ç»“ç‚¹ï¼Œè¿™æ ·å°±å¾—ä¸å¿å¤±äº†ï¼Œå› æ­¤æˆ‘ä»¬ç»™å‡ºçš„ä¸€ç§ç­–ç•¥æ˜¯åœ¨åˆå¹¶çš„æ—¶å€™è¿›è¡Œåˆ¤æ–­ï¼Œä¿è¯åˆå¹¶ä¹‹åé«˜åº¦æ•°ï¼ˆåº¦æ•°&gt;=Kï¼‰çš„ç»“ç‚¹ä¸ä¼šå¢åŠ ã€‚é€šè¿‡ç®€åŒ–ä¹‹åï¼Œå†²çªå›¾å¾ˆå¤šèŠ‚ç‚¹çš„åº¦æ•°å·²ç»é™ä½ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™åˆå¹¶çš„æœºä¼šå¯èƒ½å¤šäºåŸæœ‰çš„å†²çªå›¾ã€‚ åˆå¹¶çš„æ•ˆæœé€šå¸¸å†³å®šäº†æ•´ä¸ªå›¾ç€è‰²ç®—æ³•çš„è´¨é‡ï¼Œå¦å¤–ç”±äºåœ¨è¿›è¡ŒæŒ‡ä»¤é€‰æ‹©ä¹‹å‰éœ€è¦æ¶ˆPHIï¼Œä¼šåœ¨è¿™ä¸ªæ—¶å€™äº§ç”Ÿå¾ˆå¤šå†—ä½™çš„moveæŒ‡ä»¤ï¼Œé€šè¿‡å›¾ç€è‰²çš„æ—¶å€™è¿›è¡Œåˆå¹¶èƒ½å¤Ÿæå¤§çš„å‡å°‘å†—ä½™çš„moveæŒ‡ä»¤ï¼Œè¿™å¯¹ç¨‹åºæ€§èƒ½çš„æå‡éå¸¸å¤§ã€‚ å†»ç»“ï¼ˆfreezeï¼‰åœ¨è¿›è¡Œç®€åŒ–å’Œåˆå¹¶ä¹‹åï¼Œæœ‰ä¸€äº›å˜é‡æ— æ³•è¿›è¡Œåˆå¹¶ï¼Œå¹¶ä¸”å¯ä»¥è¿›è¡Œç®€åŒ–ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦å°†å…¶æ ‡è®°ä¸ºä¼ é€å†»ç»“çš„ç»“ç‚¹ï¼Œé‡æ–°å¼€å§‹ç®€åŒ–é˜¶æ®µã€‚ æº¢å‡ºï¼ˆspillï¼‰ç®€åŒ–å’Œåˆå¹¶å®Œæˆä¹‹åï¼Œå†²çªå›¾ä¸­åªå‰©ä¸‹é«˜åº¦æ•°ï¼ˆåº¦æ•°&gt;=Kï¼‰çš„èŠ‚ç‚¹ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨å›¾ä¸­é€‰æ‹©ä¸€ä¸ªé«˜åº¦æ•°çš„ç»“ç‚¹ï¼Œå°†å®ƒå­˜å…¥å†…å­˜å½“ä¸­ï¼Œç„¶åå°†å®ƒå‹å…¥æ ˆä¸­ã€‚è¿™ä¸ªæ—¶å€™å…¶ä»–ç»“ç‚¹çš„åº¦æ•°é™ä½ï¼Œå¯ä»¥ç»§ç»­è¿›è¡Œç®€åŒ–ã€‚ é€‰æ‹©ï¼ˆselectï¼‰å¯¹è™šæ‹Ÿå¯„å­˜å™¨æŒ‡æ´¾é¢œè‰²ï¼Œå³åˆ†é…çœŸå®çš„å¯„å­˜å™¨ã€‚å…·ä½“åšæ³•æ˜¯ä»¥ä¸€ä¸ªç©ºå›¾å¼€å§‹ï¼Œä»æ ˆä¸­å¼¹å‡ºä¸€ä¸ªèŠ‚ç‚¹ï¼ŒåŠ å…¥åˆ°å†²çªå›¾ä¸­ï¼Œå¹¶ä¸”ä¸ºä»–æŒ‡æ´¾ä¸€ç§é¢œè‰²ï¼Œè¯¥èŠ‚ç‚¹å¿…é¡»æ˜¯å¯ç€è‰²çš„ï¼Œå¯ç€è‰²çš„æ¡ä»¶æ˜¯å…¶é‚»æ¥ç»“ç‚¹ä½¿ç”¨çš„é¢œè‰²å°äºçœŸå®çš„å¯„å­˜å™¨æ•°Kï¼Œå¯¹äºç®€åŒ–é˜¶æ®µå…¥æ ˆçš„å˜é‡æ˜¾ç„¶ä¸€å®šèƒ½å¤Ÿç€è‰²ï¼Œå¯¹äºæº¢å‡ºé˜¶æ®µå…¥æ ˆçš„å˜é‡ï¼Œé€šè¿‡åˆå¹¶ä¹‹åï¼Œé‚»æ¥ç‚¹ä¸­æœ‰ä¸€äº›å˜é‡çš„é¢œè‰²ç›¸åŒï¼Œæœ€åé‚»æ¥ç‚¹çš„é¢œè‰²å°äºKç§ï¼Œèƒ½å¤Ÿè¿›è¡Œç€è‰²ï¼Œå¯ä»¥å°†å…¶åŠ å…¥å†²çªå›¾ä¸­ï¼Œå¦åˆ™å°†å…¶åŠ å…¥æ— æ³•è¿›è¡Œç€è‰²çš„é›†åˆä¸­ã€‚ é‡æ–°å¼€å§‹(restart)å¦‚æœæ— æ³•è¿›è¡Œç€è‰²çš„é›†åˆä¸ä¸ºç©ºï¼Œé‚£ä¹ˆåˆ™éœ€è¦æ”¹å†™ç¨‹åºï¼Œä¸ºè¿™äº›å˜é‡åœ¨å†…å­˜å½“ä¸­åˆ†é…ç©ºé—´ï¼Œå¹¶ä¸”åœ¨æ¯æ¬¡ä½¿ç”¨éœ€è¦å°†å…¶ä»å†…å­˜å½“ä¸­å–å‡ºï¼Œæ¯æ¬¡ä¿®æ”¹éœ€è¦å­˜è¿›å†…å­˜å½“ä¸­ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæº¢å‡ºçš„ä¸´æ—¶å˜é‡ä¼šè½¬å˜ä¸ºå‡ ä¸ªæ´»è·ƒèŒƒå›´å¾ˆå°çš„æ–°çš„ä¸´æ—¶å˜é‡ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦é‡æ–°è¿›è¡Œæ´»è·ƒåˆ†æã€å¯„å­˜å™¨åˆ†é…ï¼Œç›´åˆ°æ²¡æœ‰æº¢å‡ºå’Œç®€åŒ–ä¸ºæ­¢ï¼ˆé€šå¸¸åªéœ€è¦è¿­ä»£ä¸€ä¸¤æ¬¡ï¼‰ã€‚ çª¥å­”ä¼˜åŒ–å¯¹äºç›¸é‚»çš„éƒ¨åˆ†å°‘é‡æŒ‡ä»¤è¿›è¡Œä¼˜åŒ–ã€‚ å¤„ç†æ— æ„ä¹‰çš„åŠ å‡æ³• æ—§æŒ‡ä»¤ æ–°æŒ‡ä»¤ add/sub r0, r0, 0 åˆ é™¤ add/sub r0, r1, 0 move r0, r1 å¤„ç†æ— æ„ä¹‰çš„mov æ—§æŒ‡ä»¤ æ–°æŒ‡ä»¤ move r0, r0 åˆ é™¤ å¤„ç†å¯¹åŒä¸€ä¸ªdstçš„è¿ç»­mov æ—§æŒ‡ä»¤ æ–°æŒ‡ä»¤ move r0, r1 move r0, r2 â€¦ move r0, rk move r0, rk å¤„ç†å‘ç›¸é‚»å—æˆ–è€…æ— æ„ä¹‰å—çš„è·³è½¬ æ—§æŒ‡ä»¤ æ–°æŒ‡ä»¤ j next_block Move r0, rk å¤„ç†å‘åŒä¸€ä¸ªåœ°å€çš„å­˜å‚¨+åŠ è½½çš„store+loadå¯¹ æ—§æŒ‡ä»¤ æ–°æŒ‡ä»¤ store a, memory load b, sameMemory move b, a","link":"/2025/08/14/compiler/"},{"title":"å­¦æµ·ä¼´èˆªâ€”â€”æ•™è¾…å¹³å°ç³»ç»Ÿè®¾è®¡æ–‡æ¡£","text":"/* å¸¸ç”¨é¢œè‰²ç±» */ .text-cadetblue { color: CadetBlue !important; } .text-blue { color: #007bff !important; } .text-green { color: #28a745 !important; } .text-red { color: #DC143C !important; } .text-orange { color: #fd7e14 !important; } .text-purple { color: #6f42c1 !important; } .text-emphasis { color: #007bff; font-weight: bold; } .text-warning { color: #ffc107; font-weight: bold; } .text-success { color: #28a745; font-weight: bold; } .text-danger { color: #7835dc; font-weight: bold; } /* è­¦å‘Šæ¡†æ ·å¼ */ blockquote { position: relative; margin: 20px 0; padding: 16px 20px; border-left: 4px solid #007bff; background: #f8f9fa; border-radius: 0 6px 6px 0; font-style: normal; } blockquote[data-callout=\"important\"] { border-left-color: #7835dc; background: rgb(242, 241, 251); border-left-width: 6px; } blockquote[data-callout=\"important\"]::before { content: \"ğŸ’¬ é‡è¦\"; display: block; font-weight: bold; color: #7835dc; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } blockquote[data-callout=\"caution\"] { border-left-color: #ffc107; background: #fffbf0; border-left-width: 6px; } blockquote[data-callout=\"caution\"]::before { content: \"âš ï¸ æ³¨æ„\"; display: block; font-weight: bold; color: #b8860b; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } blockquote[data-callout=\"note\"] { border-left-color: #17a2b8; background: #f0f9ff; border-left-width: 6px; } blockquote[data-callout=\"note\"]::before { content: \"â„¹ï¸ æç¤º\"; display: block; font-weight: bold; color: #17a2b8; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } // å¤„ç†è­¦å‘Šæ¡† document.addEventListener('DOMContentLoaded', function() { const blockquotes = document.querySelectorAll('blockquote'); blockquotes.forEach(function(blockquote) { const firstParagraph = blockquote.querySelector('p:first-child'); if (firstParagraph) { const text = firstParagraph.textContent; const calloutMatch = text.match(/\\[!(IMPORTANT|CAUTION|NOTE)\\]/i); if (calloutMatch) { const calloutType = calloutMatch[1].toLowerCase(); blockquote.setAttribute('data-callout', calloutType); // ç§»é™¤æ ‡è®°æ–‡æœ¬ const cleanText = text.replace(/\\[![^\\]]+\\]\\s*/, ''); firstParagraph.textContent = cleanText; } } }); }); å†™åœ¨å‰é¢è¿™æ˜¯å­¦æµ·ä¼´èˆªâ€”â€”æ•™è¾…å¹³å°çš„ç³»ç»Ÿè®¾è®¡æ–‡æ¡£ï¼Œæºäºå¤§ä¸‰ä¸Šæ•°æ®åº“è¯¾ç¨‹å¤§ä½œä¸šã€‚æœ¬é¡¹ç›®ç”±RooKie_Z,Galaxy_Jew, LPFä¸‰äººä¸€åŒå®Œæˆï¼Œåœ¨æœ€ç»ˆçš„å±•ç¤ºåå–å¾—äº† æ»¡åˆ†ğŸ’¯çš„æˆç»©ã€‚ ğŸ‘‰ ç³»ç»Ÿå®ç°æŠ¥å‘Š ä¸€ã€éœ€æ±‚åˆ†æ1.1 éœ€æ±‚æè¿°1.1.1 èƒŒæ™¯è°ƒç ”é€šè¿‡ç§¯æè°ƒç ”æ–°ç”Ÿéœ€æ±‚ï¼Œäº†è§£å­¦é™¢æ•™å­¦éœ€è¦ï¼ŒåŒæ—¶ä¸è¾…å¯¼å‘˜è€å¸ˆæ²Ÿé€šï¼Œæˆ‘ä»¬å‘ç°ä¼ ç»Ÿçš„å¾®ä¿¡QQç¾¤å­¦ä¹ å°ç»„çš„ç­”ç–‘æ•™è¾…æ¨¡å¼å·²ä¸å†é«˜æ•ˆã€‚å»ºç«‹åŠŸèƒ½æ›´ä¸°å¯Œï¼Œäº¤äº’æ›´ä¾¿æ·ï¼Œä¸Šæ‰‹æ›´ç®€å•ï¼Œè¿æ¥æ›´ç´§å¯†çš„æ•™è¾…å¹³å°éœ€æ±‚è¿«åœ¨çœ‰ç«ã€‚ ä»¥ä¸‹ä¸ºä¼ æºä¹¦é™¢è®¡åˆ’å¼€å‘çš„å¾®ä¿¡ç­”ç–‘å°ç¨‹åºï¼š 1.1.2 ç”¨æˆ·è°ƒç ”å¯¹äºå­¦ç”Ÿä¸è¾…å¯¼å¸ˆçš„è¯‰æ±‚ï¼Œæˆ‘ä»¬é€šè¿‡è”ç³»ä¼ æºä¹¦é™¢çš„è¾…å¯¼å‘˜ï¼Œè·å–äº†ä»–ä»¬é—®å·è°ƒæŸ¥çš„æ•°æ®ï¼Œåˆæ­¥æ€»ç»“éœ€æ±‚å¦‚ä¸‹ï¼š å­¦ç”Ÿ è¾…å¯¼å¸ˆ ç®¡ç†äººå‘˜ æå‡ºé—®é¢˜ï¼Œå¹¶å¾—åˆ°åŠæ—¶å›ç­” é¿å…è¿‡åº¦åŒè´¨åŒ–çš„æé—® äº†è§£åŒå­¦ä»¬çš„å­¦ä¹ æƒ…å†µ è·å–å„ç§‘ç›®èµ„æ–™é›†åˆï¼Œè¿›è¡Œè‡ªå­¦è‡ªæµ‹ é¿å…ç­”ç–‘æ´»åŠ¨å¯¹è¯¾ä¸‹ç”Ÿæ´»çš„æ‰“æ‰° äº†è§£åŒå­¦ä»¬çš„å­¦ä¹ è¯‰æ±‚ çœ‹è§å…¶ä»–åŒå­¦çš„ç­”ç–‘å†…å®¹ ä¾¿äºç»„ç»‡æ¨¡æ‹Ÿè€ƒè¯•å¹¶åŠ ä»¥æ‰¹æ”¹ ç»Ÿè®¡è¾…å¯¼å¸ˆçš„å·¥ä½œé‡ å¼€å±•æ¨¡æ‹Ÿè€ƒè¯• å‘å¸ƒå…¬å‘Š 1.1.3 éœ€æ±‚æ€»ç»“å¯¹äºéœ€è¦è·å–å­¦ä¸šå¸®æ‰¶çš„å­¦ç”Ÿä»–ä»¬éœ€è¦ä¸€æ¬¾äº§å“ï¼Œèƒ½å¤Ÿï¼š æå‡ºè¯¾ä¸šä¸Šçš„é—®é¢˜ï¼Œå¹¶è·å¾—åŠæ—¶å‡†ç¡®çš„å›ç­”ã€‚ çœ‹è§å…¶å®ƒåŒå­¦çš„ç­”ç–‘å†…å®¹ã€‚ è·å–å„ç§‘ä¹ é¢˜èµ„æ–™ï¼ŒåŒ…æ‹¬å¾€å¹´èµ„æ–™ã€‚ æœ‰æ¡ç†åœ°è·å–è‡ªå·±çš„å­¦ä¹ åšé¢˜è®°å½•ã€‚ å‚ä¸æ¨¡æ‹Ÿæµ‹è¯•ï¼Œå¹¶åŠæ—¶è·å–ç­”é¢˜æƒ…å†µã€‚ å¯¹äºè¾…å¯¼å¸ˆä»–ä»¬éœ€è¦ä¸€æ¬¾äº§å“ï¼Œèƒ½å¤Ÿï¼š é¿å…å¯¹æ—¥å¸¸ç”Ÿæ´»çš„è¿‡åº¦æ‰“æ‰°ã€‚ é¿å…è¿‡åº¦åŒè´¨åŒ–çš„æé—®ã€‚ è·å¾—åŒå­¦ä»¬å¯¹å›ç­”çš„åé¦ˆã€‚ åŠæ—¶æ›´æ–°é¢˜åº“ å‘å¸ƒæ¨¡æ‹Ÿè€ƒè¯•å¹¶åŠ ä»¥æ‰¹æ”¹ å¯¹äºå­¦ä¸šæ”¯æŒä¸­å¿ƒ/å¯¼å‘˜ä»–ä»¬éœ€è¦ä¸€æ¬¾äº§å“ï¼Œèƒ½å¤Ÿï¼š ç›´è§‚äº†è§£è¾…å¯¼å¸ˆå·¥ä½œæƒ…å†µï¼Œæ–¹ä¾¿ç›‘ç£ã€‚ è‡ªåŠ¨ç»Ÿè®¡è¾…å¯¼å¸ˆçš„å·¥ä½œé‡å¹¶æ¢ç®—ä¸ºå¿—æ„¿æ—¶é•¿ã€‚ å¼€å±•æ¨¡æ‹Ÿè€ƒè¯•ç­‰é›†ä½“å­¦ä¹ æ´»åŠ¨ï¼Œå¹¶å‘å¸ƒå…¬å‘Šã€‚ 1.1.4 é¡¹ç›®ä¼˜åŠ¿é€šè¿‡ä¸Šè¿°éœ€æ±‚åˆ†æï¼Œå¯è§ï¼Œå­¦æµ·ä¼´èˆªå…·æœ‰åºå¤§çš„éœ€æ±‚ç©ºé—´ï¼Œå…‰æ˜çš„åº”ç”¨å‰æ™¯ï¼Œå…·æœ‰å¼€å‘çš„ä»·å€¼ï¼Œé€šè¿‡æˆ‘ä»¬çš„å¹³å°ï¼Œä¸‰ç±»ç›®æ ‡ç”¨æˆ·å¯ä»¥åœ¨å¤šç§åœºæ™¯ä¸‹è·å¾—åˆ©å¥½ï¼š ä»å­¦ç”Ÿçš„è§’åº¦ å…±äº«å­¦ä¹ èµ„æ–™ï¼šå¹³å°ç»Ÿä¸€æ•´åˆå­¦ä¹ èµ„æ–™ï¼Œæ–¹ä¾¿åŒå­¦æŸ¥é˜…ä¸‹è½½ã€‚ å…±äº«é—®é¢˜ä¸è§£ç­”ï¼šæ‰€æœ‰é—®é¢˜å‡å…¬å¼€å…±äº«ï¼ŒåŒå­¦å¯ä»¥æœç´¢è‡ªå·±å›°æƒ‘çš„ç›¸ä¼¼çš„é—®é¢˜ï¼Œä»å…¶ä»–äººçš„å·²è§£å†³é—®é¢˜å’Œå›ç­”å¾—åˆ°å¯å‘ã€‚ è‡ªä¸»å­¦ä¹ ï¼šå¹³å°ç»„ç»‡ç»Ÿä¸€æ¨¡æ‹Ÿæµ‹è¯•ï¼Œå­¦ç”Ÿè·å–æ¨¡æ‹Ÿæƒ…å†µï¼ŒæŒ‡å¯¼è‡ªä¸»å­¦ä¹ ã€‚ æ¿€åŠ±å­¦ä¹ ï¼šå¯è§†åŒ–è‡ªå·±è§£å†³çš„é—®é¢˜æ•°é‡ï¼ŒåŒæ—¶åœ¨ä¸»é¡µè·å–æ¨èé¢˜ç›®ï¼Œå­¦ä¹ æ›´æœ‰åŠ¨åŠ›ï¼Œæ›´æœ‰ç§¯ææ€§ã€‚ å‡å°‘å¾®ä¿¡ç§èŠæ•°é‡ï¼šå­¦ç”Ÿåé¦ˆç¾¤èŠæ•°é‡è¿‡å¤šçš„é—®é¢˜ï¼Œä¸€ä¸ªçº¿ä¸‹ç­”ç–‘æ´»åŠ¨éœ€è¦å»ºç«‹å¾ˆå¤šçš„ç¾¤èŠï¼Œå¤§ç¾¤ã€å°ç»„ç¾¤ã€äº’åŠ©ç¾¤ï¼Œå½±å“æ—¥å¸¸çš„æ¶ˆæ¯æ¥æ”¶ï¼Œå¸¦æ¥ä¸å¿…è¦çš„éº»çƒ¦ã€‚é€šè¿‡å¹³å°è¿›è¡Œä¿¡æ¯æ•´åˆï¼Œäº¤æµä¸ä¿¡æ¯ç»Ÿä¸€åŒ–ã€‚ ä»å°å¯¼å¸ˆè§’åº¦ è¾…å¯¼ç§¯ææ€§æ›´é«˜ï¼šåŸºäºå›ç­”é—®é¢˜ï¼Œä¸Šä¼ é¢˜ç›®ï¼Œç»„ç»‡è€ƒè¯•ï¼Œæ‰¹æ”¹è¯•é¢˜çš„æ¬¡æ•°åˆ†é…å¿—æ„¿æ—¶é•¿ï¼Œå¥–åŠ±æœºåˆ¶æ›´åŠ å…¬å¹³åˆç†ï¼Œå¢å¼ºè¾…å¯¼å¸ˆçš„è§£ç­”ç§¯ææ€§ã€‚ åœ¨å¹³å°ç»Ÿä¸€ç­”ç–‘ï¼Œé¿å…å ç”¨è¾…å¯¼å¸ˆè¿‡å¤šè¯¾ä¸‹ç§äººæ—¶é—´ã€‚ ä»å­¦é™¢ç»„ç»‡è€…è§’åº¦ æ´»åŠ¨æ¨è¿›ï¼šå¯è§†åŒ–æ´»åŠ¨æ´»è·ƒåº¦æƒ…å†µï¼Œå­¦ç”Ÿå‚ä¸åº¦æƒ…å†µï¼Œæœ‰æ•ˆæ¨è¿›æ´»åŠ¨å¼€å±•ã€‚ æ°›å›´è¥é€ ï¼šé€šè¿‡å¹³å°ç»Ÿä¸€ç®¡ç†æ´»åŠ¨ï¼Œå®šæœŸå‘å¸ƒç›¸å…³å­¦ä¹ å…¬å‘Šï¼Œè¥é€ è‰¯å¥½çš„å­¦ä¹ æ°›å›´ã€‚ 1.2 æ•°æ®æµå›¾1.2.1 æ€»ä½“æ•°æ®æµå›¾ 1.2.2 ç”¨æˆ·ç®¡ç†éƒ¨åˆ†æ•°æ®æµå›¾ 1.2.3 æ¶ˆæ¯å…¬å‘Šéƒ¨åˆ†æ•°æ®æµå›¾ 1.2.4 é¢˜ç›®é¢˜åº“éƒ¨åˆ†æ•°æ®æµå›¾ 1.2.5 æ¨¡æ‹Ÿè€ƒè¯•éƒ¨åˆ†æ•°æ®æµå›¾ 1.2.6 è®¨è®ºåŒºéƒ¨åˆ†æ•°æ®æµå›¾ 1.2.7 ç”¨æˆ·ä¸»é¡µéƒ¨åˆ†æ•°æ®æµå›¾ 1.3 æ•°æ®å…ƒç´ è¡¨1.3.1 ç”¨æˆ·ç®¡ç†éƒ¨åˆ†ç”¨æˆ·è¡¨ å­—æ®µåç§° æ•°æ®ç±»å‹ å¯å¦ä¸ºç©º è¯´æ˜ id int NO ç”¨æˆ·idï¼Œä¸»é”® user_id varchar NO å­¦å· pass_word varchar NO å¯†ç  mail varchar NO é‚®ç®± college varchar NO å­¦é™¢ entryYear varchar NO å…¥å­¦å¹´ä»½ avatar varchar NO å¤´åƒ user_role varchar NO ç”¨æˆ·èº«ä»½ï¼ˆå­¦ç”Ÿ/è¾…å¯¼å¸ˆï¼‰ 1.3.2 æ¶ˆæ¯éƒ¨åˆ†æ¶ˆæ¯è¡¨ å­—æ®µåç§° æ•°æ®ç±»å‹ å¯å¦ä¸ºç©º è¯´æ˜ id int NO æ¶ˆæ¯idï¼Œä¸»é”® sender int NO å¤–é”®ï¼Œå‘é€æ¶ˆæ¯å­¦ç”Ÿç¼–å· sender_avatar varchar NO å‘é€è€…å¤´åƒ sent_at date NO å‘é€æ—¶é—´ receiver int NO å¤–é”®ï¼Œæ¥æ”¶æ¶ˆæ¯å­¦ç”Ÿç¼–å· content varchar NO æ¶ˆæ¯å†…å®¹ is_read boolean NO æ˜¯å¦å·²é˜… 1.3.3 å…¬å‘Šéƒ¨åˆ†å…¬å‘Šè¡¨ å­—æ®µåç§° æ•°æ®ç±»å‹ å¯å¦ä¸ºç©º è¯´æ˜ id int NO å…¬å‘Šidï¼Œä¸»é”® sender int NO å¤–é”®ï¼Œå‘å¸ƒè€…ç¼–å· sender_avatar varchar NO å‘å¸ƒè€…å¤´åƒ sent_at date NO å‘å¸ƒæ—¶é—´ last_updated date NO æ—¶é—´ content varchar NO å…¬å‘Šå†…å®¹ title varchar NO å…¬å‘Šæ ‡é¢˜ 1.3.4 é¢˜ç›®éƒ¨åˆ†é¢˜ç›®è¡¨ å­—æ®µåç§° æ•°æ®ç±»å‹ å¯å¦ä¸ºç©º è¯´æ˜ id int NO é¢˜ç›®idï¼Œä¸»é”® type varchar NO é¢˜ç›®ç±»å‹ content varchar NO é¢˜ç›®å†…å®¹ subject varchar NO é¢˜ç›®æ‰€å±ç§‘ç›® added_at date NO ä¸Šä¼ æ—¶é—´ source varchar NO é¢˜ç›®æ¥æº tags json YES é¢˜ç›®æ ‡ç­¾ difficulty int NO é¢˜ç›®éš¾åº¦ added_by int NO é¢˜ç›®æ·»åŠ è€…id question_banks json YES å¤–é”®ï¼Œé¢˜ç›®æ‰€å±é¢˜åº“ option_count int NO é¢˜ç›®é€‰é¡¹æ•°é‡ é¢˜åº“è¡¨ å­—æ®µåç§° æ•°æ®ç±»å‹ å¯å¦ä¸ºç©º è¯´æ˜ id int NO é¢˜åº“idï¼Œä¸»é”® subject varchar NO é¢˜åº“æ‰€å±ç§‘ç›® estimated_time date NO é¢˜åº“é¢„è®¡å®Œæˆæ—¶é—´ created_at date NO é¢˜åº“åˆ›å»ºæ—¶é—´ creator int NO é¢˜åº“åˆ›å»ºè€…id description varchar NO é¢˜åº“æè¿° question_count int NO é¢˜åº“é¢˜ç›®æ•°é‡ é¢˜ç›®è®¨è®ºåŒºè¡¨ å­—æ®µåç§° æ•°æ®ç±»å‹ å¯å¦ä¸ºç©º è¯´æ˜ id int NO é¢˜ç›®è®¨è®ºåŒºidï¼Œä¸»é”® question int NO é¢˜ç›®idï¼Œå¤–é”® created_at date NO é¢˜ç›®åˆ›å»ºæ—¶é—´ creator int NO é¢˜ç›®åˆ›å»ºè€…id content varchar NO é¢˜ç›®è®¨è®ºåŒºå†…å®¹ é¢˜ç›®è®¨è®ºåŒºè®¨è®ºè¡¨ å­—æ®µåç§° æ•°æ®ç±»å‹ å¯å¦ä¸ºç©º è¯´æ˜ id int NO é¢˜ç›®è®¨è®ºåŒºidï¼Œä¸»é”® question int NO é¢˜ç›®idï¼Œå¤–é”® created_at date NO é¢˜ç›®åˆ›å»ºæ—¶é—´ creator int NO é¢˜ç›®åˆ›å»ºè€…id content varchar NO é¢˜ç›®è®¨è®ºåŒºå†…å®¹ åšé¢˜è®°å½•è¡¨ å­—æ®µåç§° æ•°æ®ç±»å‹ å¯å¦ä¸ºç©º è¯´æ˜ id int NO åšé¢˜è®°å½•idï¼Œä¸»é”® user int NO åšé¢˜è€…ç”¨æˆ·idï¼Œå¤–é”® question int NO é¢˜ç›®idï¼Œå¤–é”® attempted_at date NO åšé¢˜æ—¶é—´ is_correct boolean NO æ˜¯å¦åšå¯¹æœ¬é¢˜ 1.3.5 æ¨¡æ‹Ÿè€ƒè¯•éƒ¨åˆ†è€ƒè¯•è¡¨ å­—æ®µåç§° æ•°æ®ç±»å‹ å¯å¦ä¸ºç©º è¯´æ˜ id int NO æ¨¡æ‹Ÿè€ƒè¯•idï¼Œä¸»é”® title varchar NO æ¨¡æ‹Ÿè€ƒè¯•æ ‡é¢˜ subject varchar NO é¢˜ç›®æ‰€å±ç§‘ç›® description varchar NO æ¨¡æ‹Ÿè€ƒè¯•æè¿° created_at date NO è€ƒè¯•åˆ›å»ºæ—¶é—´ start_time date NO è€ƒè¯•å¼€å§‹æ—¶é—´ duration int NO è€ƒè¯•æŒç»­æ—¶é—´ end_time date NO è€ƒè¯•ç»“æŸæ—¶é—´ created_by int NO è€ƒè¯•åˆ›å»ºè€…idï¼Œå¤–é”® students json YES å¤–é”®ï¼Œæ¨¡æ‹Ÿè€ƒè¯•æ‰€æœ‰æŠ¥åå­¦ç”Ÿ questions json NO å¤–é”®ï¼Œæ¨¡æ‹Ÿè€ƒè¯•æ‰€æœ‰é¢˜ç›® æ¨¡æ‹Ÿè€ƒè¯•ä½œç­”è¡¨ å­—æ®µåç§° æ•°æ®ç±»å‹ å¯å¦ä¸ºç©º è¯´æ˜ id int NO åšé¢˜è®°å½•idï¼Œä¸»é”® exam int NO ä½œç­”æ‰€å±è€ƒè¯•idï¼Œå¤–é”® user int NO åšç­”ç”¨æˆ·idï¼Œå¤–é”® question int NO ä½œç­”é¢˜ç›®idï¼Œå¤–é”® submitted_answer varchar NO æœ€ååšç­”ç­”æ¡ˆ submitted_at date NO æœ€ååšç­”æ—¶é—´ is_correct boolean NO æ˜¯å¦åšå¯¹æœ¬é¢˜ 1.3.6 è®¨è®ºåŒºéƒ¨åˆ†è®¨è®ºå¸–è¡¨ å­—æ®µåç§° æ•°æ®ç±»å‹ å¯å¦ä¸ºç©º è¯´æ˜ id int NO é¢˜ç›®è®¨è®ºåŒºidï¼Œä¸»é”® title varchar NO è®¨è®ºå¸–æ ‡é¢˜ content varchar NO è®¨è®ºå¸–å†…å®¹ publisher int NO å‘å¸–è€…idï¼Œå¤–é”® avatar varchar NO å‘å¸–è€…å¤´åƒ publish_time date NO å‘å¸–æ—¶é—´ last_updated date NO è®¨è®ºå¸–æœ€åæ›´æ–°æ—¶é—´ tag varchar NO è®¨è®ºå¸–æ ‡ç­¾ subscribers json YES è®¢é˜…è€…idé›†åˆ likes json YES å–œçˆ±è€…idé›†åˆ is_marked boolean NO å¸–å­æ˜¯å¦ä¸ºç²¾åå¸– å¸–å­å›å¤è¡¨ å­—æ®µåç§° æ•°æ®ç±»å‹ å¯å¦ä¸ºç©º è¯´æ˜ id int NO é¢˜ç›®è®¨è®ºåŒºidï¼Œä¸»é”® discussion int NO å›å¸–æ‰€å±è®¨è®ºå¸–idï¼Œå¤–é”® content varchar NO å›å¤å†…å®¹ publisher int NO å›å¸–è€…idï¼Œå¤–é”® avatar varchar NO å›å¸–è€…å¤´åƒ publish_time date NO å›å¸–æ—¶é—´ last_updated date NO å›å¸–æœ€åæ›´æ–°æ—¶é—´ likes json YES å›å¸–å–œçˆ±è€…idé›†åˆ â¼†ã€æ•°æ®åº“æ¦‚å¿µæ¨¡å¼è®¾è®¡2.1 ç³»ç»Ÿåˆæ­¥ ER å›¾2.1.1 å®ä½“ ER å›¾ 2.1.2 å…³ç³» ER å›¾ 2.2 ç³»ç»ŸåŸºæœ¬ ER å›¾ [!IMPORTANT]ç”±äºå®ä½“å±æ€§è¿‡äºå¤æ‚ï¼Œå°†å±æ€§ç”»å…¥ERå›¾å†…å°†å¤§å¤§å½±å“å›¾çš„ç¾è§‚æ€§ï¼Œæ•…ä¸‹é¢ERå›¾å†…å°†ä¸åŒ…å«å±æ€§ï¼ŒåªæŒ‡ç¤ºå…³ç³» ä¸‰ã€æ•°æ®åº“é€»è¾‘æ¨¡å¼è®¾è®¡ä¸ä¼˜åŒ–3.1 æ•°æ®åº“å…³ç³»æ¨¡å¼ [!IMPORTANT] å…³ç³»æ¨¡å¼å¯ä»¥å½¢å¼åŒ–è¡¨ç¤ºä¸ºR(U, D, DOM, F)ã€‚Uä¸ºç»„æˆè¯¥å…³ç³»çš„å±æ€§åï¼ŒDä¸ºUä¸­å±æ€§æ‰€æ¥â¾ƒçš„åŸŸï¼ŒDOM æŒ‡çš„æ˜¯å±æ€§ä¸åŸŸçš„æ˜ å°„ï¼ŒFæŒ‡çš„æ˜¯å±æ€§é—´çš„ä¾èµ–å…³ç³»é›†åˆã€‚ä»¥ä¸‹çº¦å®šNè¡¨ç¤ºæ­£æ•´æ•°ï¼ŒFLOAT è¡¨ç¤ºæµ®ç‚¹æ•°ï¼ŒSä¸ºä»»æ„å­—ç¬¦ç»„æˆçš„å­—ç¬¦Sï¼ŒTè¡¨ç¤ºæ—¶é—´ï¼ŒBè¡¨ç¤ºå¸ƒå°”å€¼ï¼ŒJè¡¨ç¤ºjsonç±»å‹ã€‚ç ä»¥ä¸‹åˆ’çº¿æ ‡è¯†ã€‚ ä»¥ä¸‹æ˜¯ç”± E-R å›¾å¾—åˆ°çš„å…³ç³»æ¨¡å¼ã€‚ 3.1.1 å®ä½“ å­¦ç”Ÿ students({idï¼Œå¤´åƒï¼Œé‚®ç®±, å¯†ç , å§“å, å­¦å·, å¹´çº§ï¼Œå­¦é™¢ï¼Œèº«ä»½}, D, DOM, F) D = {STR, N} DOM = {DOM(id) = DOM(å¹´çº§) = DOM(èº«ä»½) = N,DOM(å¤´åƒ) = DOM(é‚®ç®±) = DOM(å¯†ç ) = DOM(å§“å) = DOM(å­¦å·) = STR} F = {id$\\to$å…¶ä»–å±æ€§} è¾…å¯¼å¸ˆ teachers({idï¼Œå¤´åƒï¼Œé‚®ç®±, å¯†ç , å§“å, å­¦å·, å¹´çº§ï¼Œå­¦é™¢ï¼Œèº«ä»½}, D, DOM, F) D = {STR, N} DOM = {DOM(å¹´çº§) = DOM(èº«ä»½) = N,DOM(å¤´åƒ) = DOM(é‚®ç®±) = DOM(å¯†ç ) = DOM(å§“å) = DOM(å­¦å·) = STR} F = {id$\\to$å…¶ä»–å±æ€§} æ¶ˆæ¯ messages({idï¼Œå‘é€è€…ï¼Œå‘é€è€…å¤´åƒï¼Œå‘é€æ—¶é—´ï¼Œæ¥æ”¶è€…ï¼Œ æ¶ˆæ¯å†…å®¹ï¼Œæ˜¯å¦å·²é˜…}ï¼ŒDï¼ŒDOMï¼ŒF) D = {STR, N, B, T} DOM = {DOM(id) = DOM(å‘é€è€…) = DOM(æ¥æ”¶è€…) = Nï¼Œ DOM(å¤´åƒ) = DOM(å†…å®¹) = STRï¼ŒDOM(å‘é€æ—¶é—´) = Tï¼ŒDOM(æ˜¯å¦å·²é˜…) = B} F = {id$\\to$å…¶ä»–å±æ€§} å…¬å‘Š broadcasts({idï¼Œå‘å¸ƒè€…ï¼Œå‘å¸ƒè€…å¤´åƒï¼Œå‘å¸ƒæ—¶é—´ï¼Œæ›´æ–°æ—¶é—´ï¼Œå…¬å‘Šå†…å®¹ï¼Œå…¬å‘Šæ ‡é¢˜}ï¼ŒDï¼ŒDOMï¼ŒF) D = {STR, Nï¼ŒT} DOM = {DOM(id) = DOM(å‘å¸ƒè€…) = Nï¼Œ DOM(å‘å¸ƒè€…å¤´åƒ) = DOM(å†…å®¹) = DOM(æ ‡é¢˜) = STRï¼ŒDOM(å‘å¸ƒæ—¶é—´) = DOM(æ›´æ–°æ—¶é—´) = T} F = {id$\\to$å…¶ä»–å±æ€§} é¢˜åº“ quesionbanks({idï¼Œç§‘ç›®ï¼Œé¢„è®¡å®Œæˆæ—¶é—´ï¼Œåˆ›å»ºæ—¶é—´ï¼Œåˆ›å»ºè€…ï¼Œé¢˜åº“æè¿°ï¼Œé¢˜ç›®æ•°é‡}ï¼ŒDï¼ŒDOMï¼ŒF) D = {STR, Nï¼ŒT} DOM = {DOM(id) = DOM(åˆ›å»ºè€…) = DOM(é¢˜ç›®æ•°é‡) = Nï¼Œ DOM(ç§‘ç›®) = DOM(é¢˜åº“æè¿°) = STRï¼ŒDOM(åˆ›å»ºæ—¶é—´) = DOM(é¢„è®¡å®Œæˆæ—¶é—´) = T} F = {id$\\to$å…¶ä»–å±æ€§} é¢˜ç›® questions({idï¼Œç±»å‹ï¼Œå†…å®¹ï¼Œç§‘ç›®ï¼Œä¸Šä¼ æ—¶é—´ï¼Œæ¥æºï¼Œæ ‡ç­¾ï¼Œéš¾åº¦ï¼Œä¸Šä¼ è€…ï¼Œé€‰é¡¹æ•°é‡ï¼Œæ‰€å±é¢˜åº“ï¼ŒDï¼ŒDOMï¼ŒF) D = {STR, Nï¼ŒTï¼ŒJ} DOM = {DOM(id) = DOM(ä¸Šä¼ è€…) = DOM(é¢˜ç›®éš¾åº¦) = DOM(é€‰é¡¹æ•°é‡) = DOM(æ‰€å±é¢˜åº“) = Nï¼Œ DOM(ç§‘ç›®) = DOM(ç±»å‹) = DOM(æ¥æº) = DOM(å†…å®¹) = STRï¼ŒDOM(æ ‡ç­¾) = DOM(æ‰€å±é¢˜åº“) = Jï¼ŒDOM(ä¸Šä¼ æ—¶é—´) = T} F = {id$\\to$å…¶ä»–å±æ€§} è®¨è®ºå¸– discussions({idï¼Œå‘å¸ƒè€…ï¼Œå‘å¸ƒè€…å¤´åƒï¼Œå‘å¸ƒæ—¶é—´ï¼Œæ›´æ–°æ—¶é—´ï¼Œå¸–å­å†…å®¹ï¼Œå¸–å­æ ‡é¢˜ï¼Œå¸–å­æ ‡ç­¾ï¼Œè®¢é˜…è€…ï¼Œå–œçˆ±è€…ï¼Œæ˜¯å¦åŠ ç²¾}ï¼ŒDï¼ŒDOMï¼ŒF) D = {STR, Nï¼ŒTï¼ŒJï¼ŒB} DOM = {DOM(id) = DOM(å‘å¸ƒè€…) = Nï¼Œ DOM(å‘å¸ƒè€…å¤´åƒ) = DOM(å†…å®¹) = DOM(æ ‡é¢˜) = DOM(æ ‡ç­¾) = STRï¼ŒDOM(è®¢é˜…è€…) = DOM(å–œçˆ±è€…) = Jï¼ŒDOM(å‘å¸ƒæ—¶é—´) = DOM(æ›´æ–°æ—¶é—´) = Tï¼ŒDOM(æ˜¯å¦åŠ ç²¾) = B} F = {id$\\to$å…¶ä»–å±æ€§} å›å¤å¸– replies({idï¼Œæ‰€å±è®¨è®ºå¸–ï¼Œå‘å¸ƒè€…ï¼Œå‘å¸ƒè€…å¤´åƒï¼Œå‘å¸ƒæ—¶é—´ï¼Œæ›´æ–°æ—¶é—´ï¼Œå¸–å­å†…å®¹ï¼Œå–œçˆ±è€…}ï¼ŒDï¼ŒDOMï¼ŒF) D = {STR, Nï¼ŒTï¼ŒJ} DOM = {DOM(id) = DOM(æ‰€å±è®¨è®ºå¸–) = DOM(å‘å¸ƒè€…) = Nï¼Œ DOM(å‘å¸ƒè€…å¤´åƒ) = DOM(å†…å®¹) = STRï¼ŒDOM(å–œçˆ±è€…) = Jï¼ŒDOM(å‘å¸ƒæ—¶é—´) = DOM(æ›´æ–°æ—¶é—´) = T} F = {id$\\to$å…¶ä»–å±æ€§} æ¨¡æ‹Ÿè€ƒè¯• exams({idï¼Œæ ‡é¢˜ï¼Œç§‘ç›®ï¼Œå¼€å§‹æ—¶é—´ï¼ŒæŒç»­æ—¶é—´ï¼Œç»“æŸæ—¶é—´ï¼Œåˆ›å»ºæ—¶é—´ï¼Œåˆ›å»ºè€…ï¼Œè€ƒè¯•æè¿°ï¼Œè€ƒè¯•é¢˜ç›®ï¼Œå‚è€ƒå­¦ç”Ÿ}ï¼ŒDï¼ŒDOMï¼ŒF) D = {STR, Nï¼ŒTï¼ŒJ} DOM = {DOM(id) = DOM(åˆ›å»ºè€…) = Nï¼Œ DOM(ç§‘ç›®) = DOM(æ ‡é¢˜) = DOM(è€ƒè¯•æè¿°) = STRï¼ŒDOM(è€ƒè¯•è¯•é¢˜) = DOM(å‚è€ƒå­¦ç”Ÿ) = Jï¼ŒDOM(åˆ›å»ºæ—¶é—´) = DOM(æŒç»­æ—¶é—´) = DOM(åˆ›å¼€å§‹æ—¶é—´) = DOM(ç»“æŸæ—¶é—´) = T} F = {id$\\to$å…¶ä»–å±æ€§} 3.1.2 è”ç³» [!IMPORTANT] çº¦å®šä»¥ä¸‹å‡½æ•°ä¾èµ–é›†åˆçœç•¥â¾®ä¸»å±æ€§å¯¹ç çš„å®Œå…¨å‡½æ•°ä¾èµ–ã€‚ 3.1.2.1 å¤šå¯¹å¤šè”ç³» å­¦ç”Ÿâ€”â€”è€ƒè¯• studentExam({student, exam}, D, DOM, F) D = {N} DOM = {DOM(student) = DOM(exam) = N} å¤–ç ï¼šstudent å¯¹åº”å­¦â½£è¡¨çš„ä¸»ç  student.id, course å¯¹åº”è€ƒè¯•è¡¨çš„ä¸»ç  course.id è€ƒè¯•â€”â€”é¢˜ç›® questionExam({question, exam}, D, DOM, F) D = {N} DOM = {DOM(question) = DOM(exam) = N} å¤–ç ï¼šquestion å¯¹åº”é¢˜ç›®è¡¨çš„ä¸»ç  question.id, course å¯¹åº”è€ƒè¯•è¡¨çš„ä¸»ç  course.id é¢˜åº“â€”â€”é¢˜ç›® questionQuestionbank({question, questionbank}, D, DOM, F) D = {N} DOM = {DOM(question) = DOM(questionbank) = N} å¤–ç ï¼šquestion å¯¹åº”é¢˜ç›®è¡¨çš„ä¸»ç  question.id, questionbank å¯¹åº”é¢˜åº“è¡¨çš„ä¸»ç  questionbank.id å¸–å­â€”â€”è®¢é˜… subscibeDiscussion({student, discussion}, D, DOM, F) D = {N} DOM = {DOM(student) = DOM(discussion) = N} å¤–ç ï¼šstudent å¯¹åº”å­¦â½£è¡¨çš„ä¸»ç  student.id, discussion å¯¹åº”è®¨è®ºå¸–è¡¨çš„ä¸»ç  discussion.id å¸–å­â€”â€”å–œçˆ± likeDiscussion({student, discussion}, D, DOM, F) D = {N} DOM = {DOM(student) = DOM(discussion) = N} å¤–ç ï¼šstudent å¯¹åº”å­¦â½£è¡¨çš„ä¸»ç  student.id, discussion å¯¹åº”è®¨è®ºå¸–è¡¨çš„ä¸»ç  discussion.id å›å¤â€”â€”å–œçˆ± likeReply({student, reply}, D, DOM, F) D = {N} DOM = {DOM(student) = DOM(reply) = N} å¤–ç ï¼šstudent å¯¹åº”å­¦â½£è¡¨çš„ä¸»ç  student.id, reply å¯¹åº”å›å¤å¸–è¡¨çš„ä¸»ç  reply.id å­¦ç”Ÿä½œç­”é¢˜ç›® studentSubmission({student, question, time, submission, is_correct}, D, DOM, F) D = {STR, N, T, B} DOM = {DOM(submission) = STR,DOM(student) = DOM(question) = N, DOM(time) = T, DOM(is_correct) = B} å¤–ç ï¼šstudent å¯¹åº”å­¦â½£è¡¨çš„ä¸»ç  student.id, question å¯¹åº”é¢˜ç›®è¡¨çš„ä¸»ç  question.id 3.1.2.2 ä¸€å¯¹å¤šè”ç³» å­¦ç”Ÿâ€”â€”å‘é€æ¶ˆæ¯ sendMessage({message, student}, D, DOM, F) D = {N} DOM = {DOM(student) = DOM(message) = N} å¤–ç ï¼šstudent å¯¹åº”å­¦â½£è¡¨çš„ä¸»ç  student.id, message å¯¹åº”æ¶ˆæ¯è¡¨çš„ä¸»ç  message.id å­¦ç”Ÿâ€”â€”æ¥æ”¶æ¶ˆæ¯ receiveMessage({message, student}, D, DOM, F) D = {N} DOM = {DOM(student) = DOM(message) = N} å¤–ç ï¼šstudent å¯¹åº”å­¦â½£è¡¨çš„ä¸»ç  student.id, message å¯¹åº”æ¶ˆæ¯è¡¨çš„ä¸»ç  message.id å­¦ç”Ÿâ€”â€”æ¥æ”¶å…¬å‘Š receiveBroadcast({message, student}, D, DOM, F) D = {N} DOM = {DOM(student) = DOM(broadcast) = N} å¤–ç ï¼šstudent å¯¹åº”å­¦â½£è¡¨çš„ä¸»ç  student.id, broadcast å¯¹åº”å…¬å‘Šè¡¨çš„ä¸»ç  broadcast.id æ•™å¸ˆâ€”â€”å‘å¸ƒå…¬å‘Š publishBroadcast({message, teacher}, D, DOM, F) D = {N} DOM = {DOM(teacher) = DOM(broadcast) = N} å¤–ç ï¼šteacher å¯¹åº”æ•™å¸ˆè¡¨çš„ä¸»ç  teacher.id, broadcast å¯¹åº”å…¬å‘Šè¡¨çš„ä¸»ç  broadcast.id æ•™å¸ˆâ€”â€”é¢˜åº“ teacherQuestionbank({questionbank, teacher}, D, DOM, F) D = {N} DOM = {DOM(teacher) = DOM(questionbank) = N} å¤–ç ï¼šteacher å¯¹åº”æ•™å¸ˆè¡¨çš„ä¸»ç  teacher.id, questionbank å¯¹åº”é¢˜åº“è¡¨çš„ä¸»ç  questionbank.id æ•™å¸ˆâ€”â€”é¢˜ç›® teacherQuestion({question, teacher}, D, DOM, F) D = {N} DOM = {DOM(teacher) = DOM(question) = N} å¤–ç ï¼šteacher å¯¹åº”æ•™å¸ˆè¡¨çš„ä¸»ç  teacher.id, question å¯¹åº”é¢˜åº“è¡¨çš„ä¸»ç  question.id æ•™å¸ˆâ€”â€”è€ƒè¯• teacherExam({exam, teacher}, D, DOM, F) D = {N} DOM = {DOM(teacher) = DOM(exam) = N} å¤–ç ï¼šteacher å¯¹åº”æ•™å¸ˆè¡¨çš„ä¸»ç  teacher.id, exam å¯¹åº”è€ƒè¯•è¡¨çš„ä¸»ç  exam.id å­¦ç”Ÿâ€”â€”è®¨è®º studentDiscussion({discussion, student}, D, DOM, F) D = {N} DOM = {DOM(student) = DOM(discussion) = N} å¤–ç ï¼šstudent å¯¹åº”å­¦â½£è¡¨çš„ä¸»ç  student.id, discussionå¯¹åº”è®¨è®ºè¡¨çš„ä¸»ç  discussion.id å­¦ç”Ÿâ€”â€”å›å¤ studentReply({reply, student}, D, DOM, F) D = {N} DOM = {DOM(student) = DOM(reply) = N} å¤–ç ï¼šstudent å¯¹åº”å­¦â½£è¡¨çš„ä¸»ç  student.id, replyå¯¹åº”å›å¤è¡¨çš„ä¸»ç  reply.id è®¨è®ºå¸–â€”â€”å›å¤ discussionReply({reply, discussion}, D, DOM, F) D = {N} DOM = {DOM(reply) = DOM(discussion) = N} å¤–ç ï¼šdiscussionå¯¹åº”è®¨è®ºè¡¨çš„ä¸»ç  discussion.id, replyå¯¹åº”å›å¤è¡¨çš„ä¸»ç  reply.id 3.2 å…³ç³»æ¨¡å¼èŒƒå¼ç­‰çº§çš„åˆ¤å®šä¸è§„èŒƒ [!NOTE] åˆ†åˆ«å¯¹ä¸Šè¿°è¡¨è¿›â¾èŒƒå¼ç­‰çº§åˆ¤æ–­ï¼Œç„¶åå°†æœªè¾¾åˆ° 3NF çš„è¡¨è§„èŒƒåˆ° 3NFã€‚ 3.2.1 å®ä½“ å­¦ç”Ÿ students({idï¼Œå¤´åƒï¼Œé‚®ç®±, å¯†ç , å§“å, å­¦å·, å¹´çº§ï¼Œå­¦é™¢ï¼Œèº«ä»½}, D, DOM, F) D = {STR, N} DOM = {DOM(id) = DOM(å¹´çº§) = DOM(èº«ä»½) = N,DOM(å¤´åƒ) = DOM(é‚®ç®±) = DOM(å¯†ç ) = DOM(å§“å) = DOM(å­¦å·) = STR} F = {id$\\to$å…¶ä»–å±æ€§} å¯¹äºå­¦ç”Ÿè¡¨ï¼Œidæ˜¯ä¸»ç ï¼Œâ¾®ä¸»å±æ€§ä»…ä»…ä¾èµ–äºå”¯â¼€çš„ä¸»ç ï¼Œæ‰€ä»¥å­¦ç”Ÿè¡¨$\\in BCNF$ï¼Œå­¦ç”Ÿè¡¨$\\in 3NF$ è¾…å¯¼å¸ˆ teachers({idï¼Œå¤´åƒï¼Œé‚®ç®±, å¯†ç , å§“å, å­¦å·, å¹´çº§ï¼Œå­¦é™¢ï¼Œèº«ä»½}, D, DOM, F) D = {STR, N} DOM = {DOM(å¹´çº§) = DOM(èº«ä»½) = N,DOM(å¤´åƒ) = DOM(é‚®ç®±) = DOM(å¯†ç ) = DOM(å§“å) = DOM(å­¦å·) = STR} F = {id$\\to$å…¶ä»–å±æ€§} å¯¹äºè¾…å¯¼å¸ˆè¡¨ï¼Œidæ˜¯ä¸»ç ï¼Œâ¾®ä¸»å±æ€§ä»…ä»…ä¾èµ–äºå”¯â¼€çš„ä¸»ç ï¼Œæ‰€ä»¥è¾…å¯¼å¸ˆè¡¨$\\in BCNF$ï¼Œè¾…å¯¼å¸ˆè¡¨$\\in 3NF$ æ¶ˆæ¯ messages({idï¼Œå‘é€è€…ï¼Œå‘é€è€…å¤´åƒï¼Œå‘é€æ—¶é—´ï¼Œæ¥æ”¶è€…ï¼Œ æ¶ˆæ¯å†…å®¹ï¼Œæ˜¯å¦å·²é˜…}ï¼ŒDï¼ŒDOMï¼ŒF) D = {STR, N, B, T} DOM = {DOM(id) = DOM(å‘é€è€…) = DOM(æ¥æ”¶è€…) = Nï¼Œ DOM(å¤´åƒ) = DOM(å†…å®¹) = STRï¼ŒDOM(å‘é€æ—¶é—´) = Tï¼ŒDOM(æ˜¯å¦å·²é˜…) = B} F = {id$\\to$å…¶ä»–å±æ€§} å¯¹äºæ¶ˆæ¯è¡¨ï¼Œidæ˜¯ä¸»ç ï¼Œâ¾®ä¸»å±æ€§ä»…ä»…ä¾èµ–äºå”¯â¼€çš„ä¸»ç ï¼Œæ‰€ä»¥æ¶ˆæ¯è¡¨$\\in BCNF$ï¼Œæ¶ˆæ¯è¡¨$\\in 3NF$ å…¬å‘Š broadcasts({idï¼Œå‘å¸ƒè€…ï¼Œå‘å¸ƒè€…å¤´åƒï¼Œå‘å¸ƒæ—¶é—´ï¼Œæ›´æ–°æ—¶é—´ï¼Œå…¬å‘Šå†…å®¹ï¼Œå…¬å‘Šæ ‡é¢˜}ï¼ŒDï¼ŒDOMï¼ŒF) D = {STR, Nï¼ŒT} DOM = {DOM(id) = DOM(å‘å¸ƒè€…) = Nï¼Œ DOM(å‘å¸ƒè€…å¤´åƒ) = DOM(å†…å®¹) = DOM(æ ‡é¢˜) = STRï¼ŒDOM(å‘å¸ƒæ—¶é—´) = DOM(æ›´æ–°æ—¶é—´) = T} F = {id$\\to$å…¶ä»–å±æ€§} å¯¹äºå…¬å‘Šè¡¨ï¼Œidæ˜¯ä¸»ç ï¼Œâ¾®ä¸»å±æ€§ä»…ä»…ä¾èµ–äºå”¯â¼€çš„ä¸»ç ï¼Œæ‰€ä»¥å…¬å‘Šè¡¨$\\in BCNF$ï¼Œå…¬å‘Šè¡¨$\\in 3NF$ é¢˜åº“ quesionbanks({idï¼Œç§‘ç›®ï¼Œé¢„è®¡å®Œæˆæ—¶é—´ï¼Œåˆ›å»ºæ—¶é—´ï¼Œåˆ›å»ºè€…ï¼Œé¢˜åº“æè¿°ï¼Œé¢˜ç›®æ•°é‡}ï¼ŒDï¼ŒDOMï¼ŒF) D = {STR, Nï¼ŒT} DOM = {DOM(id) = DOM(åˆ›å»ºè€…) = DOM(é¢˜ç›®æ•°é‡) = Nï¼Œ DOM(ç§‘ç›®) = DOM(é¢˜åº“æè¿°) = STRï¼ŒDOM(åˆ›å»ºæ—¶é—´) = DOM(é¢„è®¡å®Œæˆæ—¶é—´) = T} F = {id$\\to$å…¶ä»–å±æ€§} å¯¹äºé¢˜åº“è¡¨ï¼Œidæ˜¯ä¸»ç ï¼Œâ¾®ä¸»å±æ€§ä»…ä»…ä¾èµ–äºå”¯â¼€çš„ä¸»ç ï¼Œæ‰€ä»¥é¢˜åº“è¡¨$\\in BCNF$ï¼Œé¢˜åº“è¡¨$\\in 3NF$ é¢˜ç›® questions({idï¼Œç±»å‹ï¼Œå†…å®¹ï¼Œç§‘ç›®ï¼Œä¸Šä¼ æ—¶é—´ï¼Œæ¥æºï¼Œæ ‡ç­¾ï¼Œéš¾åº¦ï¼Œä¸Šä¼ è€…ï¼Œé€‰é¡¹æ•°é‡ï¼Œæ‰€å±é¢˜åº“ï¼ŒDï¼ŒDOMï¼ŒF) D = {STR, Nï¼ŒTï¼ŒJ} DOM = {DOM(id) = DOM(ä¸Šä¼ è€…) = DOM(é¢˜ç›®éš¾åº¦) = DOM(é€‰é¡¹æ•°é‡) = DOM(æ‰€å±é¢˜åº“) = Nï¼Œ DOM(ç§‘ç›®) = DOM(ç±»å‹) = DOM(æ¥æº) = DOM(å†…å®¹) = STRï¼ŒDOM(æ ‡ç­¾) = DOM(æ‰€å±é¢˜åº“) = Jï¼ŒDOM(ä¸Šä¼ æ—¶é—´) = T} F = {id$\\to$å…¶ä»–å±æ€§} å¯¹äºé¢˜ç›®è¡¨ï¼Œidæ˜¯ä¸»ç ï¼Œâ¾®ä¸»å±æ€§ä»…ä»…ä¾èµ–äºå”¯â¼€çš„ä¸»ç ï¼Œæ‰€ä»¥é¢˜ç›®è¡¨$\\in BCNF$ï¼Œé¢˜ç›®è¡¨$\\in 3NF$ è®¨è®ºå¸– discussions({idï¼Œå‘å¸ƒè€…ï¼Œå‘å¸ƒè€…å¤´åƒï¼Œå‘å¸ƒæ—¶é—´ï¼Œæ›´æ–°æ—¶é—´ï¼Œå¸–å­å†…å®¹ï¼Œå¸–å­æ ‡é¢˜ï¼Œå¸–å­æ ‡ç­¾ï¼Œè®¢é˜…è€…ï¼Œå–œçˆ±è€…ï¼Œæ˜¯å¦åŠ ç²¾}ï¼ŒDï¼ŒDOMï¼ŒF) D = {STR, Nï¼ŒTï¼ŒJï¼ŒB} DOM = {DOM(id) = DOM(å‘å¸ƒè€…) = Nï¼Œ DOM(å‘å¸ƒè€…å¤´åƒ) = DOM(å†…å®¹) = DOM(æ ‡é¢˜) = DOM(æ ‡ç­¾) = STRï¼ŒDOM(è®¢é˜…è€…) = DOM(å–œçˆ±è€…) = Jï¼ŒDOM(å‘å¸ƒæ—¶é—´) = DOM(æ›´æ–°æ—¶é—´) = Tï¼ŒDOM(æ˜¯å¦åŠ ç²¾) = B} F = {id$\\to$å…¶ä»–å±æ€§} å¯¹äºè®¨è®ºå¸–è¡¨ï¼Œidæ˜¯ä¸»ç ï¼Œâ¾®ä¸»å±æ€§ä»…ä»…ä¾èµ–äºå”¯â¼€çš„ä¸»ç ï¼Œæ‰€ä»¥è®¨è®ºå¸–è¡¨$\\in BCNF$ï¼Œè®¨è®ºå¸–è¡¨$\\in 3NF$ å›å¤å¸– replies({idï¼Œæ‰€å±è®¨è®ºå¸–ï¼Œå‘å¸ƒè€…ï¼Œå‘å¸ƒè€…å¤´åƒï¼Œå‘å¸ƒæ—¶é—´ï¼Œæ›´æ–°æ—¶é—´ï¼Œå¸–å­å†…å®¹ï¼Œå–œçˆ±è€…}ï¼ŒDï¼ŒDOMï¼ŒF) D = {STR, Nï¼ŒTï¼ŒJ} DOM = {DOM(id) = DOM(æ‰€å±è®¨è®ºå¸–) = DOM(å‘å¸ƒè€…) = Nï¼Œ DOM(å‘å¸ƒè€…å¤´åƒ) = DOM(å†…å®¹) = STRï¼ŒDOM(å–œçˆ±è€…) = Jï¼ŒDOM(å‘å¸ƒæ—¶é—´) = DOM(æ›´æ–°æ—¶é—´) = T} F = {id$\\to$å…¶ä»–å±æ€§} å¯¹äºå›å¤å¸–è¡¨ï¼Œidæ˜¯ä¸»ç ï¼Œâ¾®ä¸»å±æ€§ä»…ä»…ä¾èµ–äºå”¯â¼€çš„ä¸»ç ï¼Œæ‰€ä»¥å›å¤å¸–è¡¨$\\in BCNF$ï¼Œå›å¤å¸–è¡¨$\\in 3NF$ æ¨¡æ‹Ÿè€ƒè¯• exams({idï¼Œæ ‡é¢˜ï¼Œç§‘ç›®ï¼Œå¼€å§‹æ—¶é—´ï¼ŒæŒç»­æ—¶é—´ï¼Œç»“æŸæ—¶é—´ï¼Œåˆ›å»ºæ—¶é—´ï¼Œåˆ›å»ºè€…ï¼Œè€ƒè¯•æè¿°ï¼Œè€ƒè¯•é¢˜ç›®ï¼Œå‚è€ƒå­¦ç”Ÿ}ï¼ŒDï¼ŒDOMï¼ŒF) D = {STR, Nï¼ŒTï¼ŒJ} DOM = {DOM(id) = DOM(åˆ›å»ºè€…) = Nï¼Œ DOM(ç§‘ç›®) = DOM(æ ‡é¢˜) = DOM(è€ƒè¯•æè¿°) = STRï¼ŒDOM(è€ƒè¯•è¯•é¢˜) = DOM(å‚è€ƒå­¦ç”Ÿ) = Jï¼ŒDOM(åˆ›å»ºæ—¶é—´) = DOM(æŒç»­æ—¶é—´) = DOM(åˆ›å¼€å§‹æ—¶é—´) = DOM(ç»“æŸæ—¶é—´) = T} F = {id$\\to$å…¶ä»–å±æ€§} å¯¹äºæ¨¡æ‹Ÿè€ƒè¯•è¡¨ï¼Œidæ˜¯ä¸»ç ï¼Œâ¾®ä¸»å±æ€§ä»…ä»…ä¾èµ–äºå”¯â¼€çš„ä¸»ç ï¼Œæ‰€ä»¥æ¨¡æ‹Ÿè€ƒè¯•è¡¨$\\in BCNF$ï¼Œæ¨¡æ‹Ÿè€ƒè¯•è¡¨$\\in 3NF$ 3.2.2 è”ç³» [!IMPORTANT] çº¦å®šä»¥ä¸‹å‡½æ•°ä¾èµ–é›†åˆçœç•¥â¾®ä¸»å±æ€§å¯¹ç çš„å®Œå…¨å‡½æ•°ä¾èµ–ã€‚ 3.2.2.1 å¤šå¯¹å¤šè”ç³» å­¦ç”Ÿâ€”â€”è€ƒè¯• studentExam({student, exam}, D, DOM, F) D = {N} DOM = {DOM(student) = DOM(exam) = N} å¤–ç ï¼šstudent å¯¹åº”å­¦â½£è¡¨çš„ä¸»ç  student.id, course å¯¹åº”è€ƒè¯•è¡¨çš„ä¸»ç  course.id å¯¹äºè¯¥è¡¨ï¼Œæ‰€æœ‰å‡½æ•°ä¾èµ–å·¦ç«¯éƒ½æ˜¯ä¸»ç ï¼Œæ‰€ä»¥$ \\in BCNF$ï¼Œå› æ­¤ä¹Ÿ$\\in 3NF$ã€‚ è€ƒè¯•â€”â€”é¢˜ç›® questionExam({question, exam}, D, DOM, F) D = {N} DOM = {DOM(question) = DOM(exam) = N} å¤–ç ï¼šquestion å¯¹åº”é¢˜ç›®è¡¨çš„ä¸»ç  question.id, course å¯¹åº”è€ƒè¯•è¡¨çš„ä¸»ç  course.id å¯¹äºè¯¥è¡¨ï¼Œæ‰€æœ‰å‡½æ•°ä¾èµ–å·¦ç«¯éƒ½æ˜¯ä¸»ç ï¼Œæ‰€ä»¥$ \\in BCNF$ï¼Œå› æ­¤ä¹Ÿ$\\in 3NF$ã€‚ é¢˜åº“â€”â€”é¢˜ç›® questionQuestionbank({question, questionbank}, D, DOM, F) D = {N} DOM = {DOM(question) = DOM(questionbank) = N} å¤–ç ï¼šquestion å¯¹åº”é¢˜ç›®è¡¨çš„ä¸»ç  question.id, questionbank å¯¹åº”é¢˜åº“è¡¨çš„ä¸»ç  questionbank.id å¯¹äºè¯¥è¡¨ï¼Œæ‰€æœ‰å‡½æ•°ä¾èµ–å·¦ç«¯éƒ½æ˜¯ä¸»ç ï¼Œæ‰€ä»¥$ \\in BCNF$ï¼Œå› æ­¤ä¹Ÿ$\\in 3NF$ã€‚ å¸–å­â€”â€”è®¢é˜… subscibeDiscussion({student, discussion}, D, DOM, F) D = {N} DOM = {DOM(student) = DOM(discussion) = N} å¤–ç ï¼šstudent å¯¹åº”å­¦â½£è¡¨çš„ä¸»ç  student.id, discussion å¯¹åº”è®¨è®ºå¸–è¡¨çš„ä¸»ç  discussion.id F = {(student, discussion) $\\to$ subscribed} å¯¹äºè¯¥è¡¨ï¼Œæ‰€æœ‰å‡½æ•°ä¾èµ–å·¦ç«¯éƒ½æ˜¯ä¸»ç ï¼Œæ‰€ä»¥$ \\in BCNF$ï¼Œå› æ­¤ä¹Ÿ$\\in 3NF$ã€‚ å¸–å­â€”â€”å–œçˆ± likeDiscussion({student, discussion}, D, DOM, F) D = {N} DOM = {DOM(student) = DOM(discussion) = N} å¤–ç ï¼šstudent å¯¹åº”å­¦â½£è¡¨çš„ä¸»ç  student.id, discussion å¯¹åº”è®¨è®ºå¸–è¡¨çš„ä¸»ç  discussion.id F = {(student, discussion) $\\to$ liked} å¯¹äºè¯¥è¡¨ï¼Œæ‰€æœ‰å‡½æ•°ä¾èµ–å·¦ç«¯éƒ½æ˜¯ä¸»ç ï¼Œæ‰€ä»¥$ \\in BCNF$ï¼Œå› æ­¤ä¹Ÿ$\\in 3NF$ã€‚ å›å¤â€”â€”å–œçˆ± likeReply({student, reply}, D, DOM, F) D = {N} DOM = {DOM(student) = DOM(reply) = N} å¤–ç ï¼šstudent å¯¹åº”å­¦â½£è¡¨çš„ä¸»ç  student.id, reply å¯¹åº”å›å¤å¸–è¡¨çš„ä¸»ç  reply.id F = {(student, reply) $\\to$ liked} å¯¹äºè¯¥è¡¨ï¼Œæ‰€æœ‰å‡½æ•°ä¾èµ–å·¦ç«¯éƒ½æ˜¯ä¸»ç ï¼Œæ‰€ä»¥$ \\in BCNF$ï¼Œå› æ­¤ä¹Ÿ$\\in 3NF$ã€‚ å­¦ç”Ÿä½œç­”é¢˜ç›® studentSubmission({student, question, time, submission, is_correct}, D, DOM, F) D = {STR, N, T, B} DOM = {DOM(submission) = STR,DOM(student) = DOM(question) = N, DOM(time) = T, DOM(is_correct) = B} å¤–ç ï¼šstudent å¯¹åº”å­¦â½£è¡¨çš„ä¸»ç  student.id, question å¯¹åº”é¢˜ç›®è¡¨çš„ä¸»ç  question.id F = {(student, question ) $\\to$ is_correct, (student, question ) $\\to$ time} å¯¹äºè¯¥è¡¨ï¼Œæ‰€æœ‰å‡½æ•°ä¾èµ–å·¦ç«¯éƒ½æ˜¯ä¸»ç ï¼Œæ‰€ä»¥$ \\in BCNF$ï¼Œå› æ­¤ä¹Ÿ$\\in 3NF$ã€‚ 3.2.2.2 â¼€å¯¹å¤šè”ç³» å­¦ç”Ÿâ€”â€”å‘é€æ¶ˆæ¯ sendMessage({message, student}, D, DOM, F) D = {N} DOM = {DOM(student) = DOM(message) = N} å¤–ç ï¼šstudent å¯¹åº”å­¦â½£è¡¨çš„ä¸»ç  student.id, message å¯¹åº”æ¶ˆæ¯è¡¨çš„ä¸»ç  message.id F = {message $\\to$ student} å‡½æ•°ä¾èµ–å·¦ç«¯ä»…åŒ…å«ä¸»ç ï¼Œä¸å­˜åœ¨ä¼ é€’å‡½æ•°ä¾èµ–å’Œéƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼Œæ‰€ä»¥ $\\in BCNF$ï¼Œå› æ­¤ä¹Ÿ$\\in 3NF$ã€‚ å­¦ç”Ÿâ€”â€”æ¥æ”¶æ¶ˆæ¯ receiveMessage({message, student}, D, DOM, F) D = {N} DOM = {DOM(student) = DOM(message) = N} å¤–ç ï¼šstudent å¯¹åº”å­¦â½£è¡¨çš„ä¸»ç  student.id, message å¯¹åº”æ¶ˆæ¯è¡¨çš„ä¸»ç  message.id F = {message $\\to$ student} å‡½æ•°ä¾èµ–å·¦ç«¯ä»…åŒ…å«ä¸»ç ï¼Œä¸å­˜åœ¨ä¼ é€’å‡½æ•°ä¾èµ–å’Œéƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼Œæ‰€ä»¥ $\\in BCNF$ï¼Œå› æ­¤ä¹Ÿ$\\in 3NF$ã€‚ å­¦ç”Ÿâ€”â€”æ¥æ”¶å…¬å‘Š receiveBroadcast({message, student}, D, DOM, F) D = {N} DOM = {DOM(student) = DOM(broadcast) = N} å¤–ç ï¼šstudent å¯¹åº”å­¦â½£è¡¨çš„ä¸»ç  student.id, broadcast å¯¹åº”å…¬å‘Šè¡¨çš„ä¸»ç  broadcast.id F = {broadcast $\\to$ student} å‡½æ•°ä¾èµ–å·¦ç«¯ä»…åŒ…å«ä¸»ç ï¼Œä¸å­˜åœ¨ä¼ é€’å‡½æ•°ä¾èµ–å’Œéƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼Œæ‰€ä»¥ $\\in BCNF$ï¼Œå› æ­¤ä¹Ÿ$\\in 3NF$ã€‚ æ•™å¸ˆâ€”â€”å‘å¸ƒå…¬å‘Š publishBroadcast({message, teacher}, D, DOM, F) D = {N} DOM = {DOM(teacher) = DOM(broadcast) = N} å¤–ç ï¼šteacher å¯¹åº”æ•™å¸ˆè¡¨çš„ä¸»ç  teacher.id, broadcast å¯¹åº”å…¬å‘Šè¡¨çš„ä¸»ç  broadcast.id F = {broadcast $\\to$ teacher} å‡½æ•°ä¾èµ–å·¦ç«¯ä»…åŒ…å«ä¸»ç ï¼Œä¸å­˜åœ¨ä¼ é€’å‡½æ•°ä¾èµ–å’Œéƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼Œæ‰€ä»¥ $\\in BCNF$ï¼Œå› æ­¤ä¹Ÿ$\\in 3NF$ã€‚ æ•™å¸ˆâ€”â€”é¢˜åº“ teacherQuestionbank({questionbank, teacher}, D, DOM, F) D = {N} DOM = {DOM(teacher) = DOM(questionbank) = N} å¤–ç ï¼šteacher å¯¹åº”æ•™å¸ˆè¡¨çš„ä¸»ç  teacher.id, questionbank å¯¹åº”é¢˜åº“è¡¨çš„ä¸»ç  questionbank.id F = {questionbank $\\to$ teacher} å‡½æ•°ä¾èµ–å·¦ç«¯ä»…åŒ…å«ä¸»ç ï¼Œä¸å­˜åœ¨ä¼ é€’å‡½æ•°ä¾èµ–å’Œéƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼Œæ‰€ä»¥ $\\in BCNF$ï¼Œå› æ­¤ä¹Ÿ$\\in 3NF$ã€‚ æ•™å¸ˆâ€”â€”é¢˜ç›® teacherQuestion({question, teacher}, D, DOM, F) D = {N} DOM = {DOM(teacher) = DOM(question) = N} å¤–ç ï¼šteacher å¯¹åº”æ•™å¸ˆè¡¨çš„ä¸»ç  teacher.id, question å¯¹åº”é¢˜åº“è¡¨çš„ä¸»ç  question.id F = {question $\\to$ teacher} å‡½æ•°ä¾èµ–å·¦ç«¯ä»…åŒ…å«ä¸»ç ï¼Œä¸å­˜åœ¨ä¼ é€’å‡½æ•°ä¾èµ–å’Œéƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼Œæ‰€ä»¥ $\\in BCNF$ï¼Œå› æ­¤ä¹Ÿ$\\in 3NF$ã€‚ æ•™å¸ˆâ€”â€”è€ƒè¯• teacherExam({exam, teacher}, D, DOM, F) D = {N} DOM = {DOM(teacher) = DOM(exam) = N} å¤–ç ï¼šteacher å¯¹åº”æ•™å¸ˆè¡¨çš„ä¸»ç  teacher.id, exam å¯¹åº”è€ƒè¯•è¡¨çš„ä¸»ç  exam.id F = {exam $\\to$ teacher} å‡½æ•°ä¾èµ–å·¦ç«¯ä»…åŒ…å«ä¸»ç ï¼Œä¸å­˜åœ¨ä¼ é€’å‡½æ•°ä¾èµ–å’Œéƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼Œæ‰€ä»¥ $\\in BCNF$ï¼Œå› æ­¤ä¹Ÿ$\\in 3NF$ã€‚ å­¦ç”Ÿâ€”â€”è®¨è®º studentDiscussion({discussion, student}, D, DOM, F) D = {N} DOM = {DOM(student) = DOM(discussion) = N} å¤–ç ï¼šstudent å¯¹åº”å­¦â½£è¡¨çš„ä¸»ç  student.id, discussionå¯¹åº”è®¨è®ºè¡¨çš„ä¸»ç  discussion.id F = {discussion $\\to$ student} å‡½æ•°ä¾èµ–å·¦ç«¯ä»…åŒ…å«ä¸»ç ï¼Œä¸å­˜åœ¨ä¼ é€’å‡½æ•°ä¾èµ–å’Œéƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼Œæ‰€ä»¥ $\\in BCNF$ï¼Œå› æ­¤ä¹Ÿ$\\in 3NF$ã€‚ å­¦ç”Ÿâ€”â€”å›å¤ studentReply({reply, student}, D, DOM, F) D = {N} DOM = {DOM(student) = DOM(reply) = N} å¤–ç ï¼šstudent å¯¹åº”å­¦â½£è¡¨çš„ä¸»ç  student.id, replyå¯¹åº”å›å¤è¡¨çš„ä¸»ç  reply.id F = {reply $\\to$ student} å‡½æ•°ä¾èµ–å·¦ç«¯ä»…åŒ…å«ä¸»ç ï¼Œä¸å­˜åœ¨ä¼ é€’å‡½æ•°ä¾èµ–å’Œéƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼Œæ‰€ä»¥ $\\in BCNF$ï¼Œå› æ­¤ä¹Ÿ$\\in 3NF$ã€‚ è®¨è®ºå¸–â€”â€”å›å¤ discussionReply({reply, discussion}, D, DOM, F) D = {N} DOM = {DOM(reply) = DOM(discussion) = N} å¤–ç ï¼šdiscussionå¯¹åº”è®¨è®ºè¡¨çš„ä¸»ç  discussion.id, replyå¯¹åº”å›å¤è¡¨çš„ä¸»ç  reply.id F = {reply $\\to$ discussion} å‡½æ•°ä¾èµ–å·¦ç«¯ä»…åŒ…å«ä¸»ç ï¼Œä¸å­˜åœ¨ä¼ é€’å‡½æ•°ä¾èµ–å’Œéƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼Œæ‰€ä»¥ $\\in BCNF$ï¼Œå› æ­¤ä¹Ÿ$\\in 3NF$ã€‚ 3.3 æ•°æ®åº“å…³ç³»æ¨¡å¼ä¼˜åŒ–3.3.1 ä½¿â½¤å¤–é”®ä½¿â½¤å¤–é”®æ¥ä¿è¯æ•°æ®çš„å…³è”æ€§å¹¶æâ¾¼è®¿é—®é€Ÿåº¦ï¼ŒåŒæ—¶åœ¨ä½¿â½¤è¿‡ç¨‹ä¸­ä¿è¯æ•°æ®çš„å‚ç…§å®Œæ•´æ€§ã€‚åœ¨æœ¬é¡¹â½¬çš„åç«¯æ•°æ®åº“ä¸­ï¼Œå„è¡¨å…·æœ‰å®Œå¤‡çš„å¤–é”®è”ç³»ï¼Œé€šè¿‡éµå¾ªè¿™ç§å¤–é”®å…³ç³»è¿›â¾å®é™…æ•°æ®åº“çš„å»ºâ½´ï¼Œå°†ä»é€»è¾‘çš„â»†åº¦ä¿è¯æ•°æ®åº“çš„è®¾è®¡åŠŸèƒ½èƒ½å¤Ÿå®Œå…¨æ­£ç¡®æ‰§â¾åˆ°ä½ã€‚ 3.3.2 ä¼˜åŒ–æŸ¥è¯¢è¯­å¥å¯ä»¥ä¼˜åŒ–çš„åœ°â½…æœ‰å¦‚ä¸‹â¼ç‚¹ï¼š èƒ½ä½¿â½¤è”è¡¨æŸ¥è¯¢çš„åœ°â½…å°½å¯èƒ½ä½¿â½¤è”è¡¨æŸ¥è¯¢â½è¾ƒâ¾¼æ•ˆ å°½å¯èƒ½ä¸å°†æŸ¥è¯¢è¯­å¥æ”¾åœ¨å¾ªç¯å†… ä½¿â½¤é«˜æ•ˆçš„ ORM æ¡†æ¶ 3.3.3 åˆå¹¶ç›¸åŒä¸»ç çš„è¡¨å¯¹äºä¸»ç ç›¸åŒçš„è¡¨ï¼Œå¯ä»¥åœ¨è®¾è®¡çš„æ—¶å€™å°†å…¶åˆå¹¶ï¼Œä¾‹å¦‚å°†é¢˜ç›®åˆ›å»ºè¡¨å’Œé¢˜ç›®è¡¨åˆå¹¶ï¼Œç›´æ¥å°†é¢˜ç›®çš„ä¸Šä¼ è€…å’Œä¸Šä¼ æ—¶é—´å­˜â¼Šé¢˜ç›®è¡¨ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯åœ¨åŒæ—¶éœ€è¦æŸ¥è¯¢ä¸¤ä¸ªè¡¨ä¸­çš„æ•°æ®æ—¶ï¼Œå‡å°‘äº†â¼€æ¬¡è¿æ¥æ“ä½œï¼Œæâ¾¼æ•ˆç‡ã€‚ 3.3.4 ä¸¥æ ¼çº¦æŸåŠ â¼Šæ•°æ®åº“çš„æ•°æ®é€šè¿‡å»ºè¡¨æ—¶æ·»åŠ çº¦æŸã€â½¤è§¦å‘å™¨å®ç°çº¦æŸç­‰â½…æ³•ï¼Œä¸¥æ ¼çº¦æŸå¯¹æ•°æ®åº“çš„å¢åˆ æ“ä½œï¼Œé¿å…å°†å¼‚å¸¸æ•°æ®æ’â¼Šæ•°æ®è¡¨ã€‚ å»ºè¡¨æ—¶å¯ä»¥æ·»åŠ çš„çº¦æŸæœ‰ä¸»é”®çº¦æŸã€UNIQUE çº¦æŸã€å¤–ç çº¦æŸç­‰ã€‚ å››ã€æ•°æ®åº“ç‰©ç†è®¾è®¡4.1 å­˜å–æ–¹æ³•å­˜å‚¨å¼•æ“ï¼š é€‰æ‹©æ”¯æŒäº‹åŠ¡å’Œç´¢å¼•ä¼˜åŒ–çš„å­˜å‚¨å¼•æ“â€”â€”æ”¯æŒMySQL çš„ GAUSSDBã€‚ ç†ç”±ï¼šGAUSSDBæ”¯æŒäº‹åŠ¡å’Œå¤–é”®çº¦æŸï¼Œå¯ä»¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼ŒåŒæ—¶MySQLé’ˆå¯¹å¤æ‚æŸ¥è¯¢æ€§èƒ½è¾ƒä¼˜ã€‚ åˆ†åŒºç­–ç•¥ï¼š å‚ç›´åˆ†åŒº å°†æ ¸å¿ƒè¡¨ï¼ˆå¦‚ Userã€Question å’Œ QuestionBankï¼‰ä¸éæ ¸å¿ƒè¡¨ï¼ˆå¦‚ QuestionComment å’Œ QuestionDiscussionï¼‰åˆ†å¼€å­˜å‚¨ã€‚ ç†ç”±ï¼šæ ¸å¿ƒè¡¨é¢‘ç¹è¢«æŸ¥è¯¢ï¼Œå¯ä»¥ä¼˜åŒ–å­˜å‚¨å’ŒæŸ¥è¯¢æ•ˆç‡ï¼›éæ ¸å¿ƒè¡¨å¦‚è¯„è®ºå’Œè®¨è®ºï¼Œå±äºé«˜å¹¶å‘å†™å…¥çš„è¡¨ï¼Œå¯ç‹¬ç«‹ä¼˜åŒ–ã€‚ æ°´å¹³åˆ†åŒº é’ˆå¯¹å¤§æ•°æ®é‡è¡¨ï¼ˆå¦‚ Question å’Œ UserQuestionRecordï¼‰ï¼Œæ ¹æ®å­—æ®µï¼ˆå¦‚ added_by æˆ– user_idï¼‰è¿›è¡Œåˆ†ç‰‡ã€‚ ç†ç”±ï¼šä¾¿äºé«˜å¹¶å‘ç¯å¢ƒä¸‹çš„æ•°æ®åˆ†å¸ƒå’Œæ‰©å±•æ€§ã€‚ æ•°æ®ç±»å‹é€‰æ‹©ï¼š ä½¿ç”¨åˆé€‚çš„æ•°æ®ç±»å‹ï¼Œå¦‚ INTEGERã€VARCHARã€DATE ç­‰ã€‚ å¯¹äº JSON æ ¼å¼æ•°æ®ï¼ˆå¦‚ tagsï¼‰ï¼Œé€‰æ‹©åˆ©ç”¨å­—ç¬¦ä¸²å­˜å‚¨ã€‚ 4.2 ç´¢å¼•å®šä¹‰ä¸ºæé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œæˆ‘ä»¬è®¾è®¡ç´¢å¼•å¦‚ä¸‹ï¼š 1. User è¡¨ ä¸»é”®ç´¢å¼•ï¼šidï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰ å”¯ä¸€ç´¢å¼•ï¼šstudent_id ä¼˜ç‚¹ï¼šå­¦ç”Ÿå­¦å·å”¯ä¸€ï¼Œä¸”å¸¸ç”¨äºæŸ¥è¯¢ï¼ŒåŠ å¿«æŸ¥è¯¢é€Ÿåº¦ ç´¢å¼•ï¼šuser_role ä¼˜ç‚¹ï¼šè¾…å¯¼å¸ˆè§’è‰²ï¼ˆuser_role = 1ï¼‰åœ¨æƒé™æ£€æŸ¥ä¸­é¢‘ç¹ä½¿ç”¨ï¼ŒåŠ å¿«æŸ¥è¯¢é€Ÿåº¦ 2. Question è¡¨ ä¸»é”®ç´¢å¼•ï¼šidï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰ ç´¢å¼•ï¼šadded_by ä¼˜ç‚¹ï¼šä¾¿äºæ ¹æ®åˆ›å»ºè€…å¿«é€ŸæŸ¥è¯¢ ç´¢å¼•ï¼štypeå’Œ subject ä¼˜ç‚¹ï¼šæŒ‰é¢˜ç›®ç±»å‹å’Œç§‘ç›®åˆ†ç±»æŸ¥è¯¢æ—¶æå‡æ•ˆç‡ ç´¢å¼•ï¼šadded_at ä¼˜ç‚¹ï¼šæ—¶é—´æ’åºæŸ¥è¯¢ä¼˜åŒ– ç´¢å¼•ï¼štags ä¼˜ç‚¹ï¼šæ”¯æŒåŸºäºå…³é”®è¯çš„æœç´¢ï¼ˆå¦‚ å·¥ç§‘æ•°å­¦åˆ†æï¼‰ 3. QuestionBank è¡¨ ä¸»é”®ç´¢å¼•ï¼šidï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰ ç´¢å¼•ï¼šsubject ä¼˜ç‚¹ï¼šæŒ‰å­¦ç§‘åˆ†ç±»æŸ¥è¯¢ä¼˜åŒ– ç´¢å¼•ï¼šcreator ä¼˜ç‚¹ï¼šä¾¿äºæŒ‰åˆ›å»ºè€…ç­›é€‰ 4. QuestionDiscussion è¡¨ ä¸»é”®ç´¢å¼•ï¼šidï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰ ç´¢å¼•ï¼šquestion_id ä¼˜ç‚¹ï¼šæŒ‰é¢˜ç›®å¿«é€ŸæŸ¥è¯¢è®¨è®ºåŒºã€‚ ç´¢å¼•ï¼šcreated_by ä¼˜ç‚¹ï¼šä¾¿äºæŒ‰åˆ›å»ºè€…ç­›é€‰è®¨è®ºã€‚ 5. QuestionComment è¡¨ ä¸»é”®ç´¢å¼•ï¼šidï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰ ç´¢å¼•ï¼šdiscussion_id ä¼˜ç‚¹ï¼šä¾¿äºæŒ‰è®¨è®ºåŒºå¿«é€ŸæŸ¥è¯¢è¯„è®º ç´¢å¼•ï¼šcreated_by ä¼˜ç‚¹ï¼šä¾¿äºæŒ‰åˆ›å»ºè€…ç­›é€‰è¯„è®º 6. UserQuestionRecord è¡¨ ä¸»é”®ç´¢å¼•ï¼šidï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰ å”¯ä¸€å¤åˆç´¢å¼•ï¼š(user_id, question_id) ä¼˜ç‚¹ï¼šç¡®ä¿æ¯ä¸ªç”¨æˆ·å¯¹æ¯é“é¢˜ç›®åªæœ‰ä¸€ä¸ªåšé¢˜è®°å½• ç´¢å¼•ï¼šuser_id ä¼˜ç‚¹ï¼šæŒ‰ç”¨æˆ·å¿«é€Ÿç­›é€‰åšé¢˜è®°å½• ç´¢å¼•ï¼šquestion_id ä¼˜ç‚¹ï¼šæŒ‰é¢˜ç›®å¿«é€Ÿç­›é€‰åšé¢˜è®°å½• 7. ExamRecordRecord è¡¨ ä¸»é”®ç´¢å¼•ï¼šidï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰ å”¯ä¸€å¤åˆç´¢å¼•ï¼š(student_id, question_id) ä¼˜ç‚¹ï¼šç¡®ä¿æ¯ä¸ªç”¨æˆ·å¯¹æ¯é“é¢˜ç›®åªæœ‰ä¸€ä¸ªåšé¢˜è®°å½• ç´¢å¼•ï¼šstudent_id ä¼˜ç‚¹ï¼šæŒ‰ç”¨æˆ·å¿«é€Ÿç­›é€‰åšé¢˜è®°å½• ç´¢å¼•ï¼šquestion_id ä¼˜ç‚¹ï¼šæŒ‰é¢˜ç›®å¿«é€Ÿç­›é€‰åšé¢˜è®°å½• 8. Discussionè¡¨ ä¸»é”®ç´¢å¼•ï¼šidï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰ ç´¢å¼•ï¼špublisher ä¼˜ç‚¹ï¼šä¾¿äºæŒ‰åˆ›å»ºè€…ç­›é€‰è®¨è®º 9. Replyè¡¨ ä¸»é”®ç´¢å¼•ï¼šidï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰ ç´¢å¼•ï¼špublisher ä¼˜ç‚¹ï¼šä¾¿äºæŒ‰åˆ›å»ºè€…ç­›é€‰è®¨è®º ç´¢å¼•ï¼šdiscussion ä¼˜ç‚¹ï¼šä¾¿äºæŒ‰è®¨è®ºå¸–ç­›é€‰å›å¤ 10. Messageè¡¨ ä¸»é”®ç´¢å¼•ï¼šidï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰ ç´¢å¼•ï¼šsender ä¼˜ç‚¹ï¼šä¾¿äºæŒ‰å‘é€è€…ç­›é€‰æ¶ˆæ¯ ç´¢å¼•ï¼šreceiver ä¼˜ç‚¹ï¼šä¾¿äºæŒ‰æ¥æ”¶è€…ç­›é€‰æ¶ˆæ¯ 11. Broadcastè¡¨ ä¸»é”®ç´¢å¼•ï¼šidï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰ ç´¢å¼•ï¼šsender ä¼˜ç‚¹ï¼šä¾¿äºæŒ‰å‘å¸ƒè€…ç­›é€‰å…¬å‘Š 12. å¤–é”®çº¦æŸ ä¸ºå¤–é”®å­—æ®µè‡ªåŠ¨åˆ›å»ºç´¢å¼•ï¼š QuestionBank.questions $\\to$ Question.id QuestionDiscussion.question $\\to$ Question.id QuestionComment.discussion $\\to$ QuestionDiscussion.id UserQuestionRecord.question $\\to$ Question.id UserQuestionRecord.user $\\to$ User.id","link":"/2025/08/14/database/"}],"tags":[{"name":"OO","slug":"OO","link":"/tags/OO/"},{"name":"OS","slug":"OS","link":"/tags/OS/"},{"name":"Hexo","slug":"Hexo","link":"/tags/Hexo/"},{"name":"compiler","slug":"compiler","link":"/tags/compiler/"},{"name":"database","slug":"database","link":"/tags/database/"}],"categories":[{"name":"å¤§äºŒä¸‹è¯¾ä¸Š","slug":"å¤§äºŒä¸‹è¯¾ä¸Š","link":"/categories/%E5%A4%A7%E4%BA%8C%E4%B8%8B%E8%AF%BE%E4%B8%8A/"},{"name":"Hexo","slug":"Hexo","link":"/categories/Hexo/"},{"name":"å¤§ä¸‰ä¸Šè¯¾ä¸Š","slug":"å¤§ä¸‰ä¸Šè¯¾ä¸Š","link":"/categories/%E5%A4%A7%E4%B8%89%E4%B8%8A%E8%AF%BE%E4%B8%8A/"}],"pages":[{"title":"About Me","text":"/* å¸¸ç”¨é¢œè‰²ç±» */ .text-cadetblue { color: CadetBlue !important; } .text-blue { color: #007bff !important; } .text-green { color: #28a745 !important; } .text-red { color: #DC143C !important; } .text-orange { color: #fd7e14 !important; } .text-purple { color: #6f42c1 !important; } .text-emphasis { color: #007bff; font-weight: bold; } .text-warning { color: #ffc107; font-weight: bold; } .text-success { color: #28a745; font-weight: bold; } .text-danger { color: #7835dc; font-weight: bold; } /* è­¦å‘Šæ¡†æ ·å¼ */ blockquote { position: relative; margin: 20px 0; padding: 16px 20px; border-left: 4px solid #007bff; background: #f8f9fa; border-radius: 0 6px 6px 0; font-style: normal; } blockquote[data-callout=\"important\"] { border-left-color: #7835dc; background: rgb(242, 241, 251); border-left-width: 6px; } blockquote[data-callout=\"important\"]::before { content: \"ğŸ’¬ é‡è¦\"; display: block; font-weight: bold; color: #7835dc; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } blockquote[data-callout=\"caution\"] { border-left-color: #ffc107; background: #fffbf0; border-left-width: 6px; } blockquote[data-callout=\"caution\"]::before { content: \"âš ï¸ æ³¨æ„\"; display: block; font-weight: bold; color: #b8860b; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } blockquote[data-callout=\"note\"] { border-left-color: #17a2b8; background: #f0f9ff; border-left-width: 6px; } blockquote[data-callout=\"note\"]::before { content: \"â„¹ï¸ æç¤º\"; display: block; font-weight: bold; color: #17a2b8; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } // å¤„ç†è­¦å‘Šæ¡† document.addEventListener('DOMContentLoaded', function() { const blockquotes = document.querySelectorAll('blockquote'); blockquotes.forEach(function(blockquote) { const firstParagraph = blockquote.querySelector('p:first-child'); if (firstParagraph) { const text = firstParagraph.textContent; const calloutMatch = text.match(/\\[!(IMPORTANT|CAUTION|NOTE)\\]/i); if (calloutMatch) { const calloutType = calloutMatch[1].toLowerCase(); blockquote.setAttribute('data-callout', calloutType); // ç§»é™¤æ ‡è®°æ–‡æœ¬ const cleanText = text.replace(/\\[![^\\]]+\\]\\s*/, ''); firstParagraph.textContent = cleanText; } } }); }); ğŸ‘‹ ä½ å¥½ï¼Œæˆ‘æ˜¯ RooKie_ZğŸ“ ä¸ªäººç®€ä»‹æˆ‘æ˜¯ä¸€ååŒ—äº¬èˆªç©ºèˆªå¤©å¤§å­¦çš„è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯ä¸“ä¸šçš„æœ¬ç§‘ç”Ÿï¼Œå¯¹äººå·¥æ™ºèƒ½ã€è½¯ä»¶å·¥ç¨‹ã€ç¼–è¯‘å™¨æŠ€æœ¯ç­‰æ–¹å‘æœ‰ç€æµ“åšå…´è¶£ã€‚åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œæˆ‘æ³¨é‡ç†è®ºä¸å®è·µç»“åˆï¼Œå‚ä¸è¿‡å¤šé¡¹è¯¾ç¨‹é¡¹ç›®ä¸ç§‘ç ”å®ä¹ ï¼Œç§¯ç´¯äº†æ‰å®çš„ç¼–ç¨‹èƒ½åŠ›å’Œé¡¹ç›®ç®¡ç†ç»éªŒã€‚ ğŸš€ æŠ€æœ¯æ ˆ ç¼–ç¨‹è¯­è¨€: C++, Java, Python, JavaScript, Go å¼€å‘å·¥å…·: IntelliJ IDEA, CLion, PyCharm, GoLand, VS Code æ¡†æ¶ä¸æŠ€æœ¯: Django, Qt, Vue.js, Pytorch, Hexo æ•°æ®åº“: MySQL æ“ä½œç³»ç»Ÿ: Linux, macOS, Windows ğŸ“š å­¦ä¹ ä¸å®è·µ é¢å‘å¯¹è±¡è®¾è®¡ä¸æ„é€  (OO): æ‹…ä»»è¯¾ç¨‹åŠ©æ•™ä¸é«˜é˜¶åŠ©æ•™ï¼Œè´Ÿè´£å‘½é¢˜ä¸æŒ‡å¯¼å­¦ç”Ÿé¡¹ç›®å®ç°ã€‚ ç§‘ç ”å®ä¹ : å‚ä¸å¤§è¯­è¨€æ¨¡å‹è¶Šç‹±æ”»å‡»ç ”ç©¶ï¼Œç§¯ç´¯äº†äººå·¥æ™ºèƒ½å®‰å…¨æ–¹å‘çš„å®éªŒä¸åˆ†æç»éªŒã€‚ è½¯ä»¶å·¥ç¨‹é¡¹ç›®: æ‹…ä»»â€œç§‘ç ”æ–‡çŒ®åŠ©æ‰‹â€é¡¹ç›®ç»ç†åŠAIåŠŸèƒ½è´Ÿè´£äººï¼Œå¸¦é¢†å›¢é˜Ÿå®Œæˆä»éœ€æ±‚åˆ†æåˆ°åŠŸèƒ½å®ç°çš„å…¨æµç¨‹ï¼Œå¹¶ä¸å¯¼å¸ˆåˆä½œæ¨è¿›é¡¹ç›®è¿­ä»£ã€‚ ğŸ† è£èª‰ä¸å¥–é¡¹ å¤šæ¬¡è·å¾—æ ¡çº§å¥–å­¦é‡‘ä¸å­¦ç§‘ç«èµ›å¥–é¡¹ å…¨å›½å¤§å­¦ç”Ÿè‹±è¯­ç«èµ›åŒ—äº¬å¸‚äºŒç­‰å¥– å…¨å›½å¤§å­¦ç”Ÿæ•°å­¦ç«èµ›åŒ—äº¬å¸‚ä¸€ç­‰å¥– ç¾å›½å¤§å­¦ç”Ÿæ•°å­¦å»ºæ¨¡ç«èµ› Meritorious Winner äº’è”ç½‘+åŒ—äº¬èµ›åŒºä¸‰ç­‰å¥– ğŸŒŸ å…´è¶£çˆ±å¥½ ç®—æ³•ä¸ç¼–ç¨‹ç«èµ› å¼€æºé¡¹ç›®è´¡çŒ® æŠ€æœ¯å†™ä½œä¸åˆ†äº« é˜…è¯»ä¸æ¢ç´¢æ–°æŠ€æœ¯ ğŸ’Œ è”ç³»æ–¹å¼ GitHub: RooKie_Z é‚®ç®±ï¼šRooKie_Z åšå®¢: RooKie_Zçš„å°çª ğŸ’¡ åº§å³é“­ â€œEver tried, Ever failed, No matter. Try again, Fail again, Fail better.â€ â€”â€” å¡ç¼ªå°”Â·è´å…‹ç‰¹ æ„Ÿè°¢è®¿é—®æˆ‘çš„åšå®¢ï¼å¦‚æœä½ å¯¹æˆ‘çš„é¡¹ç›®æˆ–æŠ€æœ¯æ–‡ç« æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿éšæ—¶äº¤æµã€‚","link":"/about.html"},{"title":"MathJax æ•°å­¦å…¬å¼æµ‹è¯•","text":"ğŸ§® MathJax æ•°å­¦å…¬å¼æµ‹è¯•é¡µé¢1. è¡Œå†…å…¬å¼æµ‹è¯•è¿™æ˜¯ä¸€ä¸ªè¡Œå†…å…¬å¼ï¼š$E = mc^2$ï¼Œçˆ±å› æ–¯å¦çš„è´¨èƒ½æ–¹ç¨‹ã€‚ å¦ä¸€ä¸ªè¡Œå†…å…¬å¼ï¼š$\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}$ï¼Œé«˜æ–¯ç§¯åˆ†ã€‚ 2. å—çº§å…¬å¼æµ‹è¯•äºŒæ¬¡æ–¹ç¨‹æ±‚æ ¹å…¬å¼ï¼š $$x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$$ æ¬§æ‹‰å…¬å¼ï¼š $$e^{i\\pi} + 1 = 0$$ å‚…é‡Œå¶å˜æ¢ï¼š $$F(\\omega) = \\int_{-\\infty}^{\\infty} f(t) e^{-i\\omega t} dt$$ 3. å¤æ‚å…¬å¼æµ‹è¯•çŸ©é˜µä¹˜æ³•ï¼š $$\\begin{pmatrix}a &amp; b \\c &amp; d\\end{pmatrix}\\begin{pmatrix}e &amp; f \\g &amp; h\\end{pmatrix} =\\begin{pmatrix}ae+bg &amp; af+bh \\ce+dg &amp; cf+dh\\end{pmatrix}$$ ç§¯åˆ†æ–¹ç¨‹ï¼š $$\\int_{0}^{1} \\frac{x^n}{1+x} dx = \\sum_{k=0}^{\\infty} \\frac{(-1)^k}{n+k+1}$$ æé™å…¬å¼ï¼š $$\\lim_{n \\to \\infty} \\left(1 + \\frac{1}{n}\\right)^n = e$$ 4. ä¸­æ–‡æ··åˆå…¬å¼æµ‹è¯•å½“ $x \\to 0$ æ—¶ï¼Œ$\\sin x \\approx x$ï¼Œè¿™æ˜¯æ­£å¼¦å‡½æ•°åœ¨åŸç‚¹é™„è¿‘çš„çº¿æ€§è¿‘ä¼¼ã€‚ å¯¹äºä»»æ„å®æ•° $a$ å’Œ $b$ï¼Œéƒ½æœ‰ï¼š$(a+b)^2 = a^2 + 2ab + b^2$ 5. ç‰¹æ®Šç¬¦å·æµ‹è¯•å¸Œè…Šå­—æ¯ï¼š $\\alpha, \\beta, \\gamma, \\delta, \\epsilon, \\zeta, \\eta, \\theta$ æ•°å­¦ç¬¦å·ï¼š $\\sum, \\prod, \\int, \\oint, \\nabla, \\partial, \\infty$ å…³ç³»ç¬¦å·ï¼š $\\leq, \\geq, \\neq, \\approx, \\equiv, \\propto$ å¦‚æœä¸Šé¢çš„æ•°å­¦å…¬å¼éƒ½èƒ½æ­£ç¡®æ˜¾ç¤ºå’Œå±…ä¸­ï¼Œè¯´æ˜ MathJax é…ç½®æˆåŠŸï¼","link":"/math-test.html"},{"title":"","text":"/* è‡ªå®šä¹‰é¢œè‰²ç±» */ .text-cadetblue { color: CadetBlue !important; } .text-blue { color: #007bff !important; } .text-green { color: #28a745 !important; } .text-red { color: #7835dc !important; } .text-orange { color: #fd7e14 !important; } .text-purple { color: #6f42c1 !important; } .text-pink { color: #e83e8c !important; } .text-gray { color: #6c757d !important; } .text-dark { color: #343a40 !important; } /* å¼ºè°ƒæ–‡æœ¬ */ .text-emphasis { color: #007bff; font-weight: bold; } /* è­¦å‘Šæ–‡æœ¬ */ .text-warning { color: #ffc107; font-weight: bold; } /* æˆåŠŸæ–‡æœ¬ */ .text-success { color: #28a745; font-weight: bold; } /* é”™è¯¯æ–‡æœ¬ */ .text-danger { color: #7835dc; font-weight: bold; } /* æ–‡ç« æ‘˜è¦æ ·å¼ */ .article-excerpt { background: #f8f9fa; border-left: 4px solid #007bff; padding: 15px; margin: 20px 0; border-radius: 0 5px 5px 0; } .article-excerpt p { margin: 0; color: #6c757d; font-style: italic; } /* å°é¢å›¾ç‰‡æ ·å¼ */ .article-cover { width: 100%; max-height: 300px; object-fit: cover; border-radius: 8px; margin-bottom: 20px; } /* é˜…è¯»æ›´å¤šæŒ‰é’®æ ·å¼ */ .read-more { display: inline-block; background: #007bff; color: white; padding: 8px 16px; text-decoration: none; border-radius: 4px; margin-top: 10px; transition: background-color 0.3s; } .read-more:hover { background: #0056b3; color: white; text-decoration: none; } /* æ–‡ç« åº•éƒ¨æ ‡ç­¾å’Œåˆ†ç±»æ ·å¼ */ .article-tags, .article-categories { margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #007bff; } .article-tags h4, .article-categories h4 { margin: 0 0 10px 0; color: #495057; font-size: 16px; font-weight: 600; } .article-tags .tag, .article-categories .category { display: inline-block; background: #007bff; color: white; padding: 4px 12px; margin: 2px 4px 2px 0; border-radius: 20px; font-size: 12px; text-decoration: none; transition: all 0.3s ease; } .article-tags .tag:hover, .article-categories .category:hover { background: #0056b3; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); } .article-categories .category { background: #28a745; } .article-categories .category:hover { background: #1e7e34; } /* æ–‡ç« å…ƒä¿¡æ¯æ ·å¼ */ .article-meta { display: flex; flex-wrap: wrap; gap: 20px; margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; font-size: 14px; color: #6c757d; } .article-meta .meta-item { display: flex; align-items: center; gap: 5px; } .article-meta .meta-item i { color: #007bff; width: 16px; } /* Giscusè¯„è®ºç³»ç»Ÿæ ·å¼ */ #giscus-comments { margin-top: 40px; padding: 20px; background: #ffffff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #eaecef; } #giscus-comments h3 { margin: 0 0 20px 0; color: #24292e; font-size: 20px; font-weight: 600; text-align: center; } /* è¯„è®ºåŠ è½½çŠ¶æ€ */ .giscus-loading { text-align: center; padding: 40px; color: #6a737d; } .giscus-loading::before { content: \"ğŸ”„ æ­£åœ¨åŠ è½½è¯„è®º...\"; font-size: 16px; } /* è¯„è®ºåŒºåŸŸå“åº”å¼è®¾è®¡ */ @media (max-width: 768px) { #giscus-comments { margin: 20px 10px; padding: 15px; } #giscus-comments h3 { font-size: 18px; } } /* Callout è­¦å‘Šæ¡†æ ·å¼ */ blockquote { position: relative; margin: 20px 0; padding: 16px 20px; border-left: 4px solid #007bff; background: #f8f9fa; border-radius: 0 6px 6px 0; font-style: normal; } /* IMPORTANT è­¦å‘Šæ¡† */ blockquote[data-callout=\"important\"], blockquote:has(> p:first-child:contains(\"[!IMPORTANT]\")) { border-left-color: #7835dc; background: rgb(242, 241, 251); border-left-width: 6px; } blockquote[data-callout=\"important\"]::before, blockquote:has(> p:first-child:contains(\"[!IMPORTANT]\"))::before { content: \"ğŸ’¬ é‡è¦\"; display: block; font-weight: bold; color: #7835dc; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } /* CAUTION è­¦å‘Šæ¡† */ blockquote[data-callout=\"caution\"], blockquote:has(> p:first-child:contains(\"[!CAUTION]\")) { border-left-color: #ffc107; background: #fffbf0; border-left-width: 6px; } blockquote[data-callout=\"caution\"]::before, blockquote:has(> p:first-child:contains(\"[!CAUTION]\"))::before { content: \"âš ï¸ æ³¨æ„\"; display: block; font-weight: bold; color: #b8860b; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } /* NOTE æç¤ºæ¡† */ blockquote[data-callout=\"note\"], blockquote:has(> p:first-child:contains(\"[!NOTE]\")) { border-left-color: #17a2b8; background: #f0f9ff; border-left-width: 6px; } blockquote[data-callout=\"note\"]::before, blockquote:has(> p:first-child:contains(\"[!NOTE]\"))::before { content: \"â„¹ï¸ æç¤º\"; display: block; font-weight: bold; color: #17a2b8; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } /* SUCCESS æˆåŠŸæ¡† */ blockquote[data-callout=\"success\"], blockquote:has(> p:first-child:contains(\"[!SUCCESS]\")) { border-left-color: #28a745; background: #f0fff4; border-left-width: 6px; } blockquote[data-callout=\"success\"]::before, blockquote:has(> p:first-child:contains(\"[!SUCCESS]\"))::before { content: \"âœ… æˆåŠŸ\"; display: block; font-weight: bold; color: #28a745; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } /* WARNING è­¦å‘Šæ¡† */ blockquote[data-callout=\"warning\"], blockquote:has(> p:first-child:contains(\"[!WARNING]\")) { border-left-color: #fd7e14; background: #fff8f0; border-left-width: 6px; } blockquote[data-callout=\"warning\"]::before, blockquote:has(> p:first-child:contains(\"[!WARNING]\"))::before { content: \"ğŸš¨ è­¦å‘Š\"; display: block; font-weight: bold; color: #fd7e14; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } /* ç§»é™¤ç¬¬ä¸€ä¸ªæ®µè½çš„ [!TYPE] æ ‡è®° */ blockquote p:first-child { margin-top: 0; } /* å“åº”å¼è®¾è®¡ */ @media (max-width: 768px) { blockquote { margin: 15px 10px; padding: 12px 16px; } blockquote::before { font-size: 12px; } } /* MathJax æ ·å¼ä¼˜åŒ– */ .MathJax_Display { text-align: center !important; margin: 1em auto !important; } .MathJax { outline: none; } /* è¡Œå†…å…¬å¼æ ·å¼ */ .MathJax_Display .MathJax { text-align: center !important; } /* å—çº§å…¬å¼å®¹å™¨ */ .MathJax_Display { display: block !important; text-align: center !important; margin: 1em auto !important; } /* ç¡®ä¿å…¬å¼ä¸è¢«æˆªæ–­ */ .MathJax_Display .MathJax { overflow-x: auto; overflow-y: hidden; } /* å“åº”å¼è®¾è®¡ */ @media (max-width: 768px) { .MathJax_Display { margin: 0.5em auto !important; } } mjx-container[display=\"true\"] { display: block !important; text-align: center !important; margin: 1em auto !important; } mjx-container[display=\"false\"] { display: inline-block !important; } /* åˆ—è¡¨é¡µ/é¦–é¡µæ‘˜è¦ä¸­çš„è­¦å‘Šæ¡†è¦†ç›– */ article.media .media-content .content blockquote, .article-excerpt .content blockquote { background: rgba(2, 215, 242, 0.15) !important; /* è“è‰²åŠé€æ˜èƒŒæ™¯ï¼Œç¬¦åˆ cyberpunk */ border: .5px solid #02d7f2 !important; border-left: 5px solid #02d7f2 !important; } /* æ–‡å­—é¢œè‰²æäº®ï¼Œé¿å…è¢«é€šç”¨æ–‡å­—è‰²è¦†ç›– */ article.media .media-content .content blockquote, article.media .media-content .content blockquote p, article.media .media-content .content blockquote * , .article-excerpt .content blockquote, .article-excerpt .content blockquote p, .article-excerpt .content blockquote * { color: #ffffff !important; font-weight: 500 !important; text-shadow: 0 0 2px rgba(0,0,0,.6) !important; } /* åˆ†ç±»å‹ï¼šIMPORTANT / CAUTION / NOTE */ article.media .media-content .content blockquote[data-callout=\"important\"], .article-excerpt .content blockquote[data-callout=\"important\"] { background: rgba(149,97,210,.22) !important; /* ç´«è‰²åŠé€æ˜ */ border-left-color: #02d7f2 !important; } article.media .media-content .content blockquote[data-callout=\"caution\"], .article-excerpt .content blockquote[data-callout=\"caution\"] { background: rgba(255,142,60,.22) !important; /* æ©™è‰²åŠé€æ˜ */ border-left-color: #ff8e3c !important; } article.media .media-content .content blockquote[data-callout=\"note\"], .article-excerpt .content blockquote[data-callout=\"note\"] { background: rgba(2,215,242,.20) !important; /* è“è‰²åŠé€æ˜ */ border-left-color: #02d7f2 !important; } /* æ ‡é¢˜è¡Œï¼ˆ::beforeï¼‰æäº® */ article.media .media-content .content blockquote[data-callout]::before, .article-excerpt .content blockquote[data-callout]::before { color: #02d7f2 !important; text-shadow: 0 0 4px rgba(2,215,242,.6) !important; }","link":"/css/custom.css"},{"title":"","text":"/* FontAwesome 6.5.2 CDN */ @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css'); /* ç¡®ä¿ FontAwesome 6.5.2 ä¼˜å…ˆçº§æœ€é«˜ */ .fab.fa-x::before { content: \"\\f1e3\" !important; } .fab.fa-x-twitter::before { content: \"\\f1e3\" !important; } /* è¦†ç›–ä¸»é¢˜é»˜è®¤çš„ FontAwesome ç‰ˆæœ¬ */ .fab.fa-twitter::before { content: \"\\f099\" !important; }","link":"/css/fontawesome-6.5.2.css"},{"title":"","text":"","link":"/theme-test.html"},{"title":"åŠŸèƒ½æµ‹è¯•é¡µé¢","text":"ğŸ§ª åŠŸèƒ½æµ‹è¯•é¡µé¢ /* å†…è”æ ·å¼æµ‹è¯• */ .text-cadetblue { color: CadetBlue !important; } .text-blue { color: #007bff !important; } .text-green { color: #28a745 !important; } .text-red { color: #DC143C !important; } .text-orange { color: #fd7e14 !important; } .text-purple { color: #6f42c1 !important; } .text-emphasis { color: #007bff; font-weight: bold; } .text-warning { color: #ffc107; font-weight: bold; } .text-success { color: #28a745; font-weight: bold; } .text-danger { color: #7835dc; font-weight: bold; } /* è­¦å‘Šæ¡†æ ·å¼ */ blockquote { position: relative; margin: 20px 0; padding: 16px 20px; border-left: 4px solid #007bff; background: #f8f9fa; border-radius: 0 6px 6px 0; font-style: normal; } blockquote[data-callout=\"important\"] { border-left-color: #7835dc; background:rgb(242, 241, 251); border-left-width: 6px; } blockquote[data-callout=\"important\"]::before { content: \"ğŸ’¬ é‡è¦\"; display: block; font-weight: bold; color: #7835dc; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } blockquote[data-callout=\"caution\"] { border-left-color: #ffc107; background: #fffbf0; border-left-width: 6px; } blockquote[data-callout=\"caution\"]::before { content: \"âš ï¸ æ³¨æ„\"; display: block; font-weight: bold; color: #b8860b; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } blockquote[data-callout=\"note\"] { border-left-color: #17a2b8; background: #f0f9ff; border-left-width: 6px; } blockquote[data-callout=\"note\"]::before { content: \"â„¹ï¸ æç¤º\"; display: block; font-weight: bold; color: #17a2b8; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } blockquote[data-callout=\"success\"] { border-left-color: #28a745; background: #f0fff4; border-left-width: 6px; } blockquote[data-callout=\"success\"]::before { content: \"âœ… æˆåŠŸ\"; display: block; font-weight: bold; color: #28a745; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } blockquote[data-callout=\"warning\"] { border-left-color: #fd7e14; background: #fff8f0; border-left-width: 6px; } blockquote[data-callout=\"warning\"]::before { content: \"ğŸš¨ è­¦å‘Š\"; display: block; font-weight: bold; color: #fd7e14; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } // å†…è”JavaScriptæµ‹è¯• document.addEventListener('DOMContentLoaded', function() { console.log('å†…è”JavaScriptåŠ è½½æˆåŠŸï¼'); // å¤„ç†è­¦å‘Šæ¡† const blockquotes = document.querySelectorAll('blockquote'); blockquotes.forEach(function(blockquote) { const firstParagraph = blockquote.querySelector('p:first-child'); if (firstParagraph) { const text = firstParagraph.textContent; const calloutMatch = text.match(/\\[!(IMPORTANT|CAUTION|NOTE|SUCCESS|WARNING)\\]/i); if (calloutMatch) { const calloutType = calloutMatch[1].toLowerCase(); blockquote.setAttribute('data-callout', calloutType); // ç§»é™¤æ ‡è®°æ–‡æœ¬ const cleanText = text.replace(/\\[![^\\]]+\\]\\s*/, ''); firstParagraph.textContent = cleanText; console.log('å¤„ç†è­¦å‘Šæ¡†:', calloutType); } } }); }); 1. é¢œè‰²ç±»æµ‹è¯•è¿™æ˜¯CadetBlueé¢œè‰²çš„æ–‡æœ¬ è¿™æ˜¯è“è‰²æ–‡æœ¬ è¿™æ˜¯ç»¿è‰²æ–‡æœ¬ è¿™æ˜¯çº¢è‰²æ–‡æœ¬ è¿™æ˜¯æ©™è‰²æ–‡æœ¬ è¿™æ˜¯ç´«è‰²æ–‡æœ¬ 2. è­¦å‘Šæ¡†æµ‹è¯• [!IMPORTANT]è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„è­¦å‘Šæ¡†æµ‹è¯• [!CAUTION]è¿™æ˜¯ä¸€ä¸ªæ³¨æ„æç¤ºæ¡†æµ‹è¯• [!NOTE]è¿™æ˜¯ä¸€ä¸ªæç¤ºä¿¡æ¯æ¡†æµ‹è¯• [!SUCCESS]è¿™æ˜¯ä¸€ä¸ªæˆåŠŸä¿¡æ¯æ¡†æµ‹è¯• [!WARNING]è¿™æ˜¯ä¸€ä¸ªè­¦å‘Šä¿¡æ¯æ¡†æµ‹è¯• 3. å¼ºè°ƒæ–‡æœ¬æµ‹è¯•è¿™æ˜¯å¼ºè°ƒæ–‡æœ¬ è¿™æ˜¯è­¦å‘Šæ–‡æœ¬ è¿™æ˜¯æˆåŠŸæ–‡æœ¬ è¿™æ˜¯é”™è¯¯æ–‡æœ¬ å¦‚æœä¸Šé¢çš„æ ·å¼éƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œè¯´æ˜å†…è”æ ·å¼å’ŒJavaScriptå·¥ä½œæ­£å¸¸ï¼","link":"/test.html"},{"title":"","text":"// Giscusè¯„è®ºç³»ç»ŸåŠ è½½è„šæœ¬ (function() { // ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½ function initGiscus() { // æ£€æŸ¥æ˜¯å¦åœ¨æ–‡ç« é¡µé¢ const isArticlePage = document.querySelector('.article') || document.querySelector('.content') || document.querySelector('.post') || document.querySelector('.column-main') || window.location.pathname.includes('/2025/'); if (isArticlePage) { console.log('æ£€æµ‹åˆ°æ–‡ç« é¡µé¢ï¼Œæ­£åœ¨åŠ è½½Giscusè¯„è®ºç³»ç»Ÿ...'); // æ£€æŸ¥æ˜¯å¦å·²ç»åŠ è½½è¿‡è¯„è®º if (document.getElementById('giscus-comments')) { console.log('è¯„è®ºç³»ç»Ÿå·²å­˜åœ¨ï¼Œè·³è¿‡é‡å¤åŠ è½½'); return; } // åˆ›å»ºGiscuså®¹å™¨ const giscusContainer = document.createElement('div'); giscusContainer.id = 'giscus-comments'; giscusContainer.style.marginTop = '40px'; giscusContainer.style.padding = '20px'; giscusContainer.style.borderTop = '1px solid #eaecef'; giscusContainer.style.background = '#ffffff'; giscusContainer.style.borderRadius = '8px'; giscusContainer.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)'; // æ·»åŠ åŠ è½½çŠ¶æ€ giscusContainer.innerHTML = ` ğŸ’¬ è¯„è®º ğŸ”„ æ­£åœ¨åŠ è½½è¯„è®º... `; // æŸ¥æ‰¾æ–‡ç« å†…å®¹åŒºåŸŸå¹¶æ’å…¥è¯„è®ºæ¡† const articleContent = document.querySelector('.article') || document.querySelector('.content') || document.querySelector('.post') || document.querySelector('.column-main') || document.querySelector('main') || document.querySelector('article'); if (articleContent) { articleContent.appendChild(giscusContainer); // å»¶è¿ŸåŠ è½½Giscusè„šæœ¬ï¼Œç¡®ä¿é¡µé¢å®Œå…¨æ¸²æŸ“ setTimeout(function() { try { // åŠ è½½Giscusè„šæœ¬ const script = document.createElement('script'); script.src = 'https://giscus.app/client.js'; script.setAttribute('data-repo', 'rookie-zgy1513/rookie-zgy1513.github.io'); script.setAttribute('data-repo-id', 'R_kgDOKRlxNA'); script.setAttribute('data-category', 'General'); script.setAttribute('data-category-id', 'DIC_kwDOKRlxNM4CuKH8'); script.setAttribute('data-mapping', 'pathname'); script.setAttribute('data-strict', '0'); script.setAttribute('data-reactions-enabled', '1'); script.setAttribute('data-emit-metadata', '0'); script.setAttribute('data-input-position', 'bottom'); script.setAttribute('data-theme', 'preferred_color_scheme'); script.setAttribute('data-lang', 'zh-CN'); script.crossOrigin = 'anonymous'; script.async = true; // è„šæœ¬åŠ è½½æˆåŠŸåçš„å¤„ç† script.onload = function() { console.log('Giscusè„šæœ¬åŠ è½½æˆåŠŸ'); // ç§»é™¤åŠ è½½çŠ¶æ€ const loadingElement = giscusContainer.querySelector('.giscus-loading'); if (loadingElement) { loadingElement.remove(); } }; // è„šæœ¬åŠ è½½å¤±è´¥çš„å¤„ç† script.onerror = function() { console.error('Giscusè„šæœ¬åŠ è½½å¤±è´¥'); giscusContainer.innerHTML = ` ğŸ’¬ è¯„è®º âŒ è¯„è®ºç³»ç»ŸåŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯• `; }; giscusContainer.appendChild(script); } catch (error) { console.error('åŠ è½½Giscusæ—¶å‘ç”Ÿé”™è¯¯:', error); giscusContainer.innerHTML = ` ğŸ’¬ è¯„è®º âŒ è¯„è®ºç³»ç»ŸåŠ è½½å¤±è´¥: ${error.message} `; } }, 1500); // å»¶è¿Ÿ1.5ç§’åŠ è½½ } else { console.warn('æœªæ‰¾åˆ°æ–‡ç« å†…å®¹åŒºåŸŸï¼Œæ— æ³•åŠ è½½è¯„è®ºç³»ç»Ÿ'); } } else { console.log('éæ–‡ç« é¡µé¢ï¼Œè·³è¿‡è¯„è®ºç³»ç»ŸåŠ è½½'); } } // å¤šé‡æ£€æŸ¥ç¡®ä¿é¡µé¢åŠ è½½å®Œæˆ if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', initGiscus); } else { // å¦‚æœDOMå·²ç»åŠ è½½å®Œæˆï¼Œç­‰å¾…ä¸€å°æ®µæ—¶é—´å†æ‰§è¡Œ setTimeout(initGiscus, 100); } // é¢å¤–æ£€æŸ¥ï¼Œç¡®ä¿åœ¨Icarusä¸»é¢˜å®Œå…¨åŠ è½½åæ‰§è¡Œ window.addEventListener('load', function() { setTimeout(initGiscus, 500); }); // å¦‚æœé¡µé¢ä½¿ç”¨äº†PJAXï¼Œéœ€è¦é‡æ–°åˆå§‹åŒ– if (window.pjax) { document.addEventListener('pjax:end', function() { setTimeout(initGiscus, 300); }); } })();","link":"/js/giscus.js"},{"title":"","text":"// Callout è­¦å‘Šæ¡†å¢å¼ºå™¨ (function() { function enhanceCallouts() { // æŸ¥æ‰¾æ‰€æœ‰ blockquote å…ƒç´  const blockquotes = document.querySelectorAll('blockquote'); blockquotes.forEach(function(blockquote) { // æ£€æŸ¥ç¬¬ä¸€ä¸ªæ®µè½æ˜¯å¦åŒ…å« callout æ ‡è®° const firstParagraph = blockquote.querySelector('p:first-child'); if (firstParagraph) { const text = firstParagraph.textContent; // åŒ¹é… [!TYPE] æ ¼å¼ const calloutMatch = text.match(/\\[!(IMPORTANT|CAUTION|NOTE|SUCCESS|WARNING)\\]/i); if (calloutMatch) { const calloutType = calloutMatch[1].toLowerCase(); // æ·»åŠ  data-callout å±æ€§ blockquote.setAttribute('data-callout', calloutType); // ç§»é™¤ç¬¬ä¸€ä¸ªæ®µè½ä¸­çš„ [!TYPE] æ ‡è®° const cleanText = text.replace(/\\[![^\\]]+\\]\\s*/, ''); firstParagraph.textContent = cleanText; // æ·»åŠ å›¾æ ‡å’Œæ ‡é¢˜ const calloutHeader = document.createElement('div'); calloutHeader.className = 'callout-header'; calloutHeader.style.cssText = ` display: block; font-weight: bold; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; `; // æ ¹æ®ç±»å‹è®¾ç½®æ ·å¼ const calloutConfig = { important: { icon: 'âš ï¸', text: 'é‡è¦', color: '#7835dc' }, caution: { icon: 'âš ï¸', text: 'æ³¨æ„', color: '#b8860b' }, note: { icon: 'â„¹ï¸', text: 'æç¤º', color: '#17a2b8' }, success: { icon: 'âœ…', text: 'æˆåŠŸ', color: '#28a745' }, warning: { icon: 'ğŸš¨', text: 'è­¦å‘Š', color: '#fd7e14' } }; const config = calloutConfig[calloutType]; if (config) { calloutHeader.innerHTML = `${config.icon} ${config.text}`; calloutHeader.style.color = config.color; // åœ¨ç¬¬ä¸€ä¸ªæ®µè½ä¹‹å‰æ’å…¥æ ‡é¢˜ firstParagraph.parentNode.insertBefore(calloutHeader, firstParagraph); } } } }); } // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', enhanceCallouts); } else { enhanceCallouts(); } // å¦‚æœé¡µé¢ä½¿ç”¨äº†PJAXï¼Œéœ€è¦é‡æ–°æ‰§è¡Œ if (window.pjax) { document.addEventListener('pjax:end', enhanceCallouts); } // ç›‘å¬åŠ¨æ€å†…å®¹å˜åŒ– const observer = new MutationObserver(function(mutations) { mutations.forEach(function(mutation) { if (mutation.type === 'childList' && mutation.addedNodes.length > 0) { enhanceCallouts(); } }); }); // å¼€å§‹è§‚å¯Ÿ observer.observe(document.body, { childList: true, subtree: true }); })();","link":"/js/callout-enhancer.js"}]}